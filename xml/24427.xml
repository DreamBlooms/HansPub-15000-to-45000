<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">MET</journal-id><journal-title-group><journal-title>Mechanical Engineering and Technology</journal-title></journal-title-group><issn pub-type="epub">2167-6631</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/MET.2018.72012</article-id><article-id pub-id-type="publisher-id">MET-24427</article-id><article-categories><subj-group subj-group-type="heading"><subject>MET20180200000_94318944.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于网络的工程图纸报审流程的设计与实现
  Design and Implementation of a Network-Based Review Process System for Engineering Drawing
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>武</surname><given-names>鹏飞</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>张</surname><given-names>应中</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>晓芳</surname><given-names>罗</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><addr-line>大连理工大学，机械工程学院，辽宁 大连</addr-line></aff><aff id="aff2"><addr-line>null</addr-line></aff><author-notes><corresp id="cor1">* E-mail:<email>wpf@mail.dlut.edu.cn(武鹏)</email>;<email>zhangyz@dlut.edu.cn(张应)</email>;</corresp></author-notes><pub-date pub-type="epub"><day>19</day><month>03</month><year>2018</year></pub-date><volume>07</volume><issue>02</issue><fpage>97</fpage><lpage>104</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   目前基本上所有的企业都已经应用电子工程图纸。随着企业中的工程图档数量的增加，如何更好的管理和有效的利用这些图档至关重要。本文结合制造企业工程图纸管理需求，设计和实现一个适用于一般中小型制造企业的图文档审核流程方法。对电子图纸审核流程的功能需求进行了分析，之后对审核流程系统进行了总体设计，包括信息模型的建立，数据库的设计等内容，最后利用ObjectARX对AutoCAD进行二次开发，实现在绘图平台上开展图纸报审和审核处理。开发完成的系统已经在企业测试运行，运行状况良好。 Currently, all enterprises have widely used e-engineering drawing. With the increase in the number of engineering drawing files in enterprises, it is very important to manage and utilize these drawings effectively and efficiently. In this paper, based on the requirements of the engineering drawing management in manufacturing enterprises, a network-based review process system for engineering drawing of small and mediumsized manufacturing enterprises is designed and implemented. The functional requirements for review processes of electronic drawing are analyzed, and the design for overall system is presented, including the establishment of information model, database design and using ObjectARX to develop user’s review programs. The developed system has been tested and run well in a manufacturing enterprise. 
  
 
</p></abstract><kwd-group><kwd>工程图档，审核流程，ObjectARX，工程图档管理, Engineering Drawing</kwd><kwd> Reviewing Process</kwd><kwd> ObjectARX</kwd><kwd> Engineering Drawing Management</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于网络的工程图纸报审流程的设计与实现<sup> </sup></title><p>武鹏飞，张应中<sup>*</sup>，罗晓芳</p><p>大连理工大学，机械工程学院，辽宁 大连</p><disp-formula id="hanspub.24427-formula18"><graphic xlink:href="//html.hanspub.org/file/3-2340483x5_hanspub.png"  xlink:type="simple"/></disp-formula><p>收稿日期：2018年3月27日；录用日期：2018年4月12日；发布日期：2018年4月19日</p><disp-formula id="hanspub.24427-formula19"><graphic xlink:href="//html.hanspub.org/file/3-2340483x6_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>目前基本上所有的企业都已经应用电子工程图纸。随着企业中的工程图档数量的增加，如何更好的管理和有效的利用这些图档至关重要。本文结合制造企业工程图纸管理需求，设计和实现一个适用于一般中小型制造企业的图文档审核流程方法。对电子图纸审核流程的功能需求进行了分析，之后对审核流程系统进行了总体设计，包括信息模型的建立，数据库的设计等内容，最后利用ObjectARX对AutoCAD进行二次开发，实现在绘图平台上开展图纸报审和审核处理。开发完成的系统已经在企业测试运行，运行状况良好。</p><p>关键词 :工程图档，审核流程，ObjectARX，工程图档管理</p><disp-formula id="hanspub.24427-formula20"><graphic xlink:href="//html.hanspub.org/file/3-2340483x7_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2018 by authors and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/3-2340483x8_hanspub.png" /> <img src="//html.hanspub.org/file/3-2340483x9_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>工程图纸是传递设计思想的信息载体，是指导生产的纲领性文件，是后续生产过程中加工、装配和检验的依据。一张工程设计图纸从设计完成后，必须经过设计、制图、工艺、标准化等多个环节的审核，才能确保其准确无误，可以投入生产使用。传统的图纸审核流程，通常都是由设计人员携带纸质或者电子图纸到各个部门，找相应的负责人完成审核任务。在这个过程中，不仅效率低、容易产生错误，而且对于图纸的保存，共享，安全性等产生不利影响。如果将这些报审环节流程化，采用网上审核，使各个环节的相关人员可以通过计算机网络直接完成这些任务，无疑会提高图纸审核的效率、降低其生产成本，提高图纸的安全性，使企业在市场竞争中保持优势，具有重要意义。该报审流程方法利用已有技术结合企业的实际业务流程，具有一定的创新性。</p><p>图纸报审管理是工程图纸管理中的一项功能，而图纸管理属于产品管理范畴，大型公司基本上采用PDM来管理企业数据。然而由于大型PDM价格昂贵、操作复杂，在中小型企业难以推广。面向中小制造企业或设计单位，结合工程图纸CAD平台和网络环境，开发符合企业实际需求的工程图纸管理系统有其必要性和实际应用价值。陈威，等 [<xref ref-type="bibr" rid="hanspub.24427-ref1">1</xref>] 开发了一个基于web的线上施工图纸审查管理系统，陈永辉，等 [<xref ref-type="bibr" rid="hanspub.24427-ref2">2</xref>] 基于AutoCAD平台，开展了产品图纸审核的图纸信息提取工作。</p><p>本文通过对一般制造企业工程图纸审核流程分析，结合目前计算机网络技术、数据库技术及AutoCAD二次开发平台，设计和开发了一个工程图纸报审流程管理软件系统，该系统也是作者开发的捷惠工程图纸管理软件系统的一部分。通过该报审流程管理软件系统，可以实现设计完成的工程图纸报审、审核批注、图纸审核和修改通知、图纸上传入库等流程操作的网络化和自动化，系统以标准、统一的信息化存储模式对企业的DRW、DWG、PDF、OFFICE等文件进行管理，不仅保证了图纸信息的完整性、安全性以及数据的统一性，也提高了企业图纸审核的效率。</p></sec><sec id="s4"><title>2. 总体设计</title><sec id="s4_1"><title>2.1. 功能需求分析</title><p>通过调研企业具体生产情况，结合一般制造行业的实际需要，有针对性的设计了该图纸审核流程方法。并将该系统分为如下功能模块。</p><p>1) 报审功能</p><p>设计人员在图纸设计完成后，需要提出图纸审核申请，只有通过所有节点的审核，图纸才能最终投入生产使用。该功能通过报审功能模块来实现。报审功能主要有以下几部分构成：</p><p>a) 提交报审信息。包括报审人相关信息，例如报审人姓名、部门、职务、设计完成时间等。</p><p>b) 提交图纸信息。包括图纸图号、图纸名称、产品型号、材料等。</p><p>c) 选择审核相关信息。包括要审核的内容，例如工艺审核、标准化审核等；有资质和权限的审核人员，审核人员通常由系统预先限定，报审人员只能从列表框中选择；要求审核完成的时间等。</p><p>d) 报审图纸上传到文件服务器中，以便审核人员能打开或者下载进行审核操作。</p><p>2) 审核功能</p><p>工程图纸审核是一项很重要和严肃的产品设计活动环节，且相关审核人员均需有一定的资质才能进行该操作。审核功能模块包括如下功能：</p><p>a) 审核权限。用户的权限由系统管理员分配，只有拥有相应的审核权限的用户才能使用图纸的审核功能。</p><p>b) 下载审核图纸。登录系统之后，审核人员可以通过该功能将图纸下载到本地，进而打开图纸文件，进行审核操作。</p><p>c) 审核批注和签字。在审核过程中，审核人员可以批注修改意见，并进行电子签名。如果图纸不能满足有关要求，设计人员在登录系统之后就会看到审核未通过的信息，及时修改。</p><p>d) 审核决策。在每一个审核节点上，审核人员都会给出最终的审核结果。当所有节点全部审核通过后，图纸即是合格的，可以用于指导生产。</p></sec><sec id="s4_2"><title>2.2. 系统架构设计</title><p>目前主流的网络工作模式主要有C/S(Client/Server)模式和B/S(Browser/Server)模式，各自有其特点。出于具体的应用需求，本文采取的是C/S架构 [<xref ref-type="bibr" rid="hanspub.24427-ref3">3</xref>] 。该模式适用于局域网环境，具有可靠的稳定性和灵活性等优点，由于客户端实现与服务器的直接连接，没有中间环节，因此响应速度快。</p><p>工程图纸管理主要涉及图纸属性信息、图纸的管理信息及电子图纸本身的数字信息。电子图纸本身的数字信息通常由电子图纸设计软件平台确定其存储格式，目前常用的格式有AuotCAD的DWG和DXF格式、PDF格式、各种图像格式等，并且每一张图纸文件占用空间有大有小，大的可能达几十兆，一个中小型企业的产品图纸也可能达10万张以上，因此，将工程图纸存储在共享的文件服务器中，通过文件服务管理实现图纸的上传、下载和安全管理等。图纸的属性信息和管理信息采用共享的数据库服务。</p><p>在一个项目启动之后，由系统管理员将用户分为初级用户，高级用户。同时给不同级别的用户分配不同权限的角色。这些角色可以是设计人员、制图人员、工艺人员、标准化人员、审核人员、批准人员。通常情况下，设计人员和制图人员拥有上传报审图纸的功能权限，在他们完成设计之后，需要执行该功能来完成图纸的上传报审。根据上述图纸报审功能需求分析，工程图纸报审流程系统架构如图1所示。</p></sec><sec id="s4_3"><title>2.3. 系统开发环境</title><p>系统运行及开发环境分为如下两个层面：</p><p>1) 客户端</p><p>应用程序完全采用面向对象技术，选择采用Visual Studio 2010编程；图纸设计和审核平台采用AutoCAD 2013，AutoCAD是目前应用最广泛的工程设计绘图平台，提供功能强大的二次开发工具ObjectARX，因此，客户端在AutoCAD下的程序采用ObjectARX2013开发。</p><p>图1. 工程图纸报审流程系统架构图</p><p>2) 服务端</p><p>安装Windows Server 2008；安装Serv-U V7.3作为文件服务程序，在文件服务器中分为工程图纸库和工程图纸审核区；数据库服务程序采用微软公司的MS SQL Server 2008，SQL Server是一个功能强大、应用广泛的数据库管理系统。</p></sec></sec><sec id="s5"><title>3. 系统功能的设计与实现</title><sec id="s5_1"><title>3.1. 图纸报审</title><p>按照上述需求功能分析，图纸报审功能就是设计人员在图纸设计完成后，提出图纸审核请求，在请求中输入相关信息。本系统提供两种方式报审：</p><p>1) 在图纸管理系统界面下报审</p><p>从已经设计完成的图纸中选择报审，需要报审人员输入图纸的相关信息。在Visual C++2010下，基于MFC开发输入界面。图纸报审界面对话框包括图纸信息组、报审信息组，图纸审核信息组。其中图纸信息组应包括：产品编号、产品型号、图纸编号、图纸名称等；报审信息组应包括：报审人、报审部门、报审日期信息；图纸审核信息组应包括：设计和设计日期、工艺和工艺日期等，如图2所示。</p><p>2) 在AutoCAD图纸设计界面下报审</p><p>在图纸设计完成后，在设计平台上报审是一个很自然和效率高的方式。本文基于AutoCAD平台，利用ObjectARX技术 [<xref ref-type="bibr" rid="hanspub.24427-ref4">4</xref>] 对其进行二次开发，将系统功能嵌入AutoCAD中实现图纸报审。主要包括两方面工作：</p><p>a) 菜单设计。利用CUIX功能对AutoCAD进行菜单设计，设计效果见图3。</p><p>b) 图纸报审。系统首先对当前图纸标题栏框进行信息搜寻，自动提取图纸相关信息，例如产品型号、图纸图号、图纸名称、设计者、设计时间等；将自动提取的信息自动写入如图2所示图纸报审对话框中。</p><p>报审确认后，系统首先要检查是否有相同图纸已经在审核。如果存在，提示不能重复报审。图纸检查实际上是打开数据库服务器中图纸报审信息表，以图纸图号作为关键字检索，如果存在，则不能重复报审。此外，图纸报审后，由于各种原因，存在撤销(或者删除)报审、修改报审等需求，同样也需要打开数据库服务器中图纸审核状态信息表，以图纸图号作为关键字检索，如果图纸还未进入审核状态，即还未发生任何审核操作，可以执行报审撤销、修改操作，否则禁止操作，需要将图纸审核状态退回到修改状态。</p><p>如果是一个新的图纸报审，则将图纸的报审信息作为一条数据库记录添加到图纸报审表中，将图纸属性信息和审核需求信息作为一条数据库记录添加到图纸审核状态表中；审核的图纸以文件形式上传到</p><p>图2. 上传图纸报审对话框</p><p>图3. AutoCAD图纸审核菜单</p><p>文件服务器中图纸审核区中。整个图纸报审流程如图4所示。</p></sec><sec id="s5_2"><title>3.2. 图纸审核</title><p>经过之前的上传报审图纸流程，相应的图纸信息和对应的图纸状态已经写入数据库，其中图纸状态在没有经过任何审核流程的时候，状态皆为“待审”。经过系统管理员给相关用户分配权限之后，用户就可以利用自己的账号登录图纸管理系统，在系统里会有通知消息，这样审核人员就会知道自己需要完成的审核任务。通过将图纸文件和CAD程序关联，审核人员可以将图纸从文件服务器中直接下载，进入CAD环境中进行图纸的审核。审核的过程中，审核人员可以给出审核意见，以及是否通过该审核环节。不通过则将图纸返回给设计人员，设计人员可以本系统了解图纸的审核状态，及时修改。如果通过，则继续剩下的审核过程，如果图纸审核批准完成，则该图纸从文件服务器转移进入到图纸库中，相应的图纸信息也写入数据库，这样图纸就可以用于指导生产实践。图纸审核流程见图5。</p><p>本系统按照设计、制图、工艺、标准化、审核、批准的审核流程完成图纸的审核功能。在拥有审核权限的用户登录系统之后，系统会通过检索报审信息数据库，将对应的审核任务提醒显示出来，这样该用户就知道他需要完成的审核内容。逐级审核，如果特定审核环节出现问题，则不能进行下一个审核任务。在用户下载报审图纸之后，系统会自动将图纸的信息提取到图纸审核处理对话框，且用户在自己的权限范围内进行操作，其他属性全部以不可编辑状态显示。如图6图纸审核处理对话框中显示的状态。</p><p>在图纸完成设计制图之后，能够进行工艺审核的用户可以对图纸进行审核，填写审核意见，并且判定该图纸是否通过工艺审核。在完成该审核环节之后，数据库中的报审图纸信息的工艺属性状态就会从</p><p>图4. 上传报审图纸流程图</p><p>图5. 图纸审核流程图</p><p>图6. 图纸审核处理对话框</p><p>“待审”变为“已审”。如果图纸不能通过工艺审核，则报审图纸信息的工艺属性状态仍为“待审”且审核意见属性会出现相应的内容。这样，设计人员在登录系统之后就会看到自己负责的图纸的审核状态，及时进行修改。直到所有的审核任务全部完成，则表明该图纸符合各个环节的要求，可以入库存档，进而用于直到生产。</p></sec><sec id="s5_3"><title>3.3. 图纸报审系统实现的关键技术</title><p>1) 报审信息数据服务</p><p>采用SQL server数据库服务实现报审信息和图纸信息共享。本系统在工程图纸管理数据库系统中建立如下两个数据表：</p><p>a) 报审信息表</p><p>报审信息表建立图纸编号、图纸名称、产品编号、产品型号、报审人、报审时间、报审部门和各审核流程节点人员、审核完成时间、审核意见等24个字段，图纸编号作为关键字段。</p><p>b) 待审图纸信息表</p><p>待审图纸信息表记录图纸编号、图纸名称、图纸用途、产品型号、和已完成的各审核流程节点人员、审核完成的时间、图纸预览缩略图等24个字段，图纸编号作为关键字段。</p><p>利用ADO (ActiveX Data Object)技术连接数据库服务器，通过SQL语言完成数据库的访问，存取数据。ADO的三个核心对象Connection对象表示了到数据库的连接，它管理应用程序和数据库之间的通信。 Recordset和Command对象都有一个ActiveConnection属性，该属性用来引用Connection对象。Command对象被用来处理重复执行的查询，或处理需要检查在存储过程调用中的输出或返回参数的值的查询。Recordset对象被用来获取数据。Recordset对象存放查询的结果，这些结果由数据的行(称为记录)和列(称为字段)组成。每一列都存放在Recordset的Fields集合中的一个Field对象中。本方法将访问数据库的程序进行封装，其中包括连接数据库智能指针对象m_pConnection，存放返回字符集的记录集对m_pRecordset，数据库初始化方法，执行查询并返回记录集方法，SQL语句执行方法等。</p><p>2) 审核图纸文件服务</p><p>报审确认后，上传待审图纸保存在文件服务器的图纸审核区，图纸以图号作为文件名存储。前面已介绍，采用Serv-U V7.3作为文件服务程序，使用UploadFile (ServerIp, LocalFile, RemoteFile)和GetFile (RName, SName)方法实现图纸文件的上传、下载。</p><p>客户端应用程序采用FTP (File Transfer Protocol)协议实现与文件服务器的连接和文件的传输，目前实现FTP协议，有两种方式，WinInet API和Winsock，WinInet效率更高，而且简单。本系统采用MFC的WinInet API实现FTP连接。</p><p>要连接到FTP服务器，需要两个步骤，首先必须创建一个CInternetSession对象，用类CInternetSession创建并初始化一个或几个Internet会话(session)，并描述与代理服务器的连接，然后利用CInternetsession对象获取CFtpConnection对象。MFC中的类CFtpConnection管理与Internet服务器的连接，并直接操作服务器上的目录和文件。</p><p>3) 基于ObjectArx开发工具实现工程图纸信息提取</p><p>AutoCAD图是一个存储在数据库中的对象的集合,这些对象不仅表示图形实体，而且也表示内部结构，如符号表和词典等，ObjectARX提供了访问这种数据库的功能。利用ObjectARX这种功能，将AutoCAD图形数据库中的字符串数据信息检索出来 [<xref ref-type="bibr" rid="hanspub.24427-ref5">5</xref>] 。通过使用AcDbTable类，建立块表对象，构建read<xref ref-type="table" rid="table">Table </xref>(pt 1,pt 2)函数(其中形参pt 1, pt2均为AcGePoint3d类型)，返回值为给定位置的字符串。因此，可以获得图纸的标题栏及明细表信息。</p></sec></sec><sec id="s6"><title>4. 结束语</title><p>针对一般制造型中小企业的工程图纸报审流程需求，在工程图纸管理系统下设计和实现了一个工程图纸报审流程管理软件系统，采用数据库服务、文件服务和面向对象技术，实现了工程图纸基于网络的报审、上传，审核，入库等流程操作。开发完成的系统，目前已经在一互感器企业实际使用，应用效果良好，简化了企业中实际的图纸审核流程，提高了企业的生产效率。</p><p>工程图纸审核流程的网络化是制造企业无纸办公化的重要组成部分，也是企业信息化的重要内容。系统依照制造行业的审图流程，规范了图纸文件的存储方式，有利于各中小型企业对图纸的有效管理，提升了图纸文件的科学化管理水平。</p></sec><sec id="s7"><title>文章引用</title><p>武鹏飞,张应中,晓芳罗. 基于网络的工程图纸报审流程的设计与实现Design and Implementation of a Network-Based Review Process System for Engineering Drawing[J]. 机械工程与技术, 2018, 07(02): 97-104. https://doi.org/10.12677/MET.2018.72012</p></sec><sec id="s8"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.24427-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">陈威, 刘新亮, 袁言, 等. 线上施工图纸审查管理系统设计与实现[J]. 土木建筑工程信息技术, 2017(5): 75-78.</mixed-citation></ref><ref id="hanspub.24427-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">陈永辉, 姜萌. 基于AutoCAD的产品图纸审核软件开发[J]. 机械设计与制造, 2011(8): 259-261.</mixed-citation></ref><ref id="hanspub.24427-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">刘亮. 工程图纸管理软件系统的设计与实现[D]. 大连理工大学, 2006.</mixed-citation></ref><ref id="hanspub.24427-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">张帆. ObjectARX2006实例教程[Z]. 2006.</mixed-citation></ref><ref id="hanspub.24427-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">程静, 杜春涛. AutoCAD图形数据库中的字符串数据信息的提取方法[J]. 大连水产学院学报, 2001(4): 303-306.</mixed-citation></ref></ref-list></back></article>