<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">SEA</journal-id><journal-title-group><journal-title>Software Engineering and Applications</journal-title></journal-title-group><issn pub-type="epub">2325-2286</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/SEA.2020.93026</article-id><article-id pub-id-type="publisher-id">SEA-36288</article-id><article-categories><subj-group subj-group-type="heading"><subject>SEA20200300000_91044075.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于互联网+技术的大病术后吹气练习仪设计
  Design of Blowing Exercise Apparatus Based on Internet+ Technology for Postoperative Severe Disease
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>刘</surname><given-names>光乾</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>刘</surname><given-names>桄序</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><addr-line>西南科技大学城市学院，四川 绵阳</addr-line></aff><aff id="aff3"><addr-line>四川科技职业学院鼎利学院，四川 成都</addr-line></aff><aff id="aff2"><addr-line>null</addr-line></aff><pub-date pub-type="epub"><day>22</day><month>05</month><year>2020</year></pub-date><volume>09</volume><issue>03</issue><fpage>228</fpage><lpage>243</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  手术是目前西医治疗重大疾病的一种常见手段，由于手术后容易感染(特别是肺部感染)，并需要对肺部功能进行训练，一般在术后均安排有3~10天，每天不低于3次的吹气练习过程训练，以帮助病人恢复和增强感染抗体。本文设计采用气体传感器模块通过单片机系统采集和分析数据，再经过WIFI网络分别在手机APP上做出练习数据记录和提醒，同时将吹气练习信息传递给主治医生，以便通过吹气练习判断病人的治疗状态和分析病情、练习情况等。所有病人的吹气练习数据，都会保存在自己的手机APP端及网站云端，是典型的基于互联网+技术的智慧医疗设备系统。能有效地提升病人术后吹气练习的数据采集和分析，为疾病的治疗恢复和肺功能练习关联研究提供了数据支撑，也是大数据医疗的一个应用分支。
   Surgery is currently a common method of Western medicine for treating major diseases. Due to the susceptibility to infection (especially lung infection) after surgery, and the need to train the function of the department, it is generally arranged for 3~10 days after surgery. Not less than 3 blow training exercises per day are done to help the patient recover from the lungs and enhance the infection antibodies. In this paper, the gas sensor module is used to collect and analyze data through the single-chip microcomputer system, and then make exercise data records and remind-ers on the mobile phone APP through the WIFI network. At the same time, the information of the insufflation practice is transferred to the attending doctor, so as to judge the patient’s treatment status and analyze illness, practice, etc. All patients' breathing practice data will be stored in their mobile APP and website cloud, which is a typical smart medical equipment system based on In-ternet+ technology. It can effectively improve the data collection and analysis of patients’ postop-erative insufflation exercises, provide data support for the treatment of disease recovery and es-tablish the relationship between breath and disease, and it is also an application branch of big data medical treatment.
 
</p></abstract><kwd-group><kwd>智慧医疗，互联网+，吹气练习仪，单片机应用，气体流量传感器, Smart Healthcare</kwd><kwd> Internet+</kwd><kwd> Blowing Exerciser</kwd><kwd> SCM Application</kwd><kwd> Gas Flow Sensor</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于互联网+技术的大病术后吹气 练习仪设计<sup> </sup></title><p>刘光乾<sup>1</sup>，刘桄序<sup>2</sup></p><p><sup>1</sup>西南科技大学城市学院，四川 绵阳</p><p><sup>2</sup>四川科技职业学院鼎利学院，四川 成都</p><p>收稿日期：2020年6月7日；录用日期：2020年6月21日；发布日期：2020年6月28日</p><disp-formula id="hanspub.36288-formula145"><graphic xlink:href="//html.hanspub.org/file/8-2690446x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>手术是目前西医治疗重大疾病的一种常见手段，由于手术后容易感染(特别是肺部感染)，并需要对肺部功能进行训练，一般在术后均安排有3~10天，每天不低于3次的吹气练习过程训练，以帮助病人恢复和增强感染抗体。本文设计采用气体传感器模块通过单片机系统采集和分析数据，再经过WIFI网络分别在手机APP上做出练习数据记录和提醒，同时将吹气练习信息传递给主治医生，以便通过吹气练习判断病人的治疗状态和分析病情、练习情况等。所有病人的吹气练习数据，都会保存在自己的手机APP端及网站云端，是典型的基于互联网+技术的智慧医疗设备系统。能有效地提升病人术后吹气练习的数据采集和分析，为疾病的治疗恢复和肺功能练习关联研究提供了数据支撑，也是大数据医疗的一个应用分支。</p><p>关键词 :智慧医疗，互联网+，吹气练习仪，单片机应用，气体流量传感器</p><disp-formula id="hanspub.36288-formula146"><graphic xlink:href="//html.hanspub.org/file/8-2690446x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2020 by author(s) and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY 4.0).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/8-2690446x7_hanspub.png" /> <img src="//html.hanspub.org/file/8-2690446x8_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>大病手术后的肺部功能恢复至关重要，是病人最容易受到感染的器官之一。经某一三甲医院ICU (即重症加强护理病房)一个月的数据统计，因为手术后肺部感染严重的病例占87.6%，而100%的大病手术后均有一定程度的肺部感染，更有38.7%以上的病例因为肺部感染而加重病情 [<xref ref-type="bibr" rid="hanspub.36288-ref1">1</xref>]。由此可以看出，在大病手术后进行肺部功能练习，采集肺功能练习的数据分析，有利于医生对肺部感染的科学依判，对进行对症消炎下药有着重要的参考。多方面医学案例反映重大病患者在术后肺部护理的重要性，及合适的肺部护理对肺部感染的有效抑制。</p><p>早期医院的吹气练习就是最常见的小孩玩具——气球，能把小气球吹起来的病人，基本证明身体已无大碍。根据科学技术的进步，出现了专业的小轻球吹气练习仪，作为病人手术后的一种专门练习工具。不论是气球吹气练习，还是专门的小轻球吹气练习，都只是在纯物理实施的条件和方式下进行的恢复练习，均指家属报告给医生吹气场景的描述，没有直接的数据能验证吹气练习肺部功能的有效性。真实的情况是：照顾病人的护理人员一旦离开，病人对吹气练习往往就是敷衍交差，没有达到肺部功能练习的目的。</p><p>结合临床需求，希望能有一套智能化的大病术后吹气练习仪，以便通过对吹气和吸气的运动，令肺部恢复缓慢地吸入空气、降低呼吸频率，增加吹气量和有效通气量，使其“肺廊”和“肺泡”得到充分扩张，能有效预防“肺不张”，便于痰液排出，有效抑制炎症，练习肺部功能正常化。结合需求与实际情况，将目前用于大病术后肺部功能练习的方式及设备做出比较(表1)。</p><table-wrap id="table1" ><label><xref ref-type="table" rid="table1">Table 1</xref></label><caption><title> Comparison of the methods and equipment for lung function training after serious illnes</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >肺部练习工具 功能对比</th><th align="center" valign="middle" >吹气功能</th><th align="center" valign="middle" >便用性</th><th align="center" valign="middle" >数据记录</th><th align="center" valign="middle" >数据保存与跟踪</th><th align="center" valign="middle" >数据分析与量化</th><th align="center" valign="middle" >价格应用</th><th align="center" valign="middle" >其他</th></tr></thead><tr><td align="center" valign="middle" >气球</td><td align="center" valign="middle" >能实现</td><td align="center" valign="middle" >好买</td><td align="center" valign="middle" >手动记录</td><td align="center" valign="middle" >监护者口头描述</td><td align="center" valign="middle" >口头描述与记录，无法实际量化</td><td align="center" valign="middle" >便宜</td><td align="center" valign="middle" >气球易爆，质量和规格不一致，难以衡量</td></tr><tr><td align="center" valign="middle" >轻小球</td><td align="center" valign="middle" >能实现</td><td align="center" valign="middle" >专门配置</td><td align="center" valign="middle" >手动记录</td><td align="center" valign="middle" >监护者口头描述</td><td align="center" valign="middle" >口头描述与记录，无法实际量化</td><td align="center" valign="middle" >一般</td><td align="center" valign="middle" >规格统一，相对数据准确</td></tr><tr><td align="center" valign="middle" >呼吸仪(心率检测仪)</td><td align="center" valign="middle" >能实现</td><td align="center" valign="middle" >需要护士操作</td><td align="center" valign="middle" >护士查看</td><td align="center" valign="middle" >护士操作设备疾苦</td><td align="center" valign="middle" >只有部分监测功能</td><td align="center" valign="middle" >较贵，且不一定能配用</td><td align="center" valign="middle" >部分功能具备</td></tr><tr><td align="center" valign="middle" >智能肺部练习仪(本文设计产品)</td><td align="center" valign="middle" >能实现</td><td align="center" valign="middle" >家属手机和本机均可操作</td><td align="center" valign="middle" >手机查看、本机一键查看、医生云端查看</td><td align="center" valign="middle" >全智能测试数据保存与跟踪</td><td align="center" valign="middle" >根据每次练习给出分析结果和建议</td><td align="center" valign="middle" >一般，可重复使用，租用</td><td align="center" valign="middle" >智能设备，操作简单，具有云端，数据分析应用科学合理</td></tr></tbody></table></table-wrap><p>表1. 大病术后肺部功能练习的方式及设备对比表</p></sec><sec id="s4"><title>2. 系统方案设计与选择</title><sec id="s4_1"><title>2.1. 整体方案设计</title><p>随着电子技术的发展，互联网+技术的推行使得将传统的电子设备与网络进行互联互通，可以方便的通过便携式设备查看相关数据和控制数据的修正，并可以通过云端网站进行数据的分析和记录，给出具备丰富治疗经验的综合参考方案，服务于智慧医疗体系中。系统设计框图见图1所示。</p><p>图1. 整机系统结构框图</p></sec><sec id="s4_2"><title>2.2. 气体流量传感器模块电路设计</title><p>吹气练习仪的气流传感器是依据气体流通原理，进行数字流速测量的新型气体流量计传感器模块，本文采用的是Renesas/IDT全面校准且线性化的气体和液体流量传感器(FS2012)模块。该模块具有灵敏度高、稳定性能优异、具备I<sup>2</sup>C数据传输和模拟数据传输两种方式。提供高效的矫正方式和补偿协议，使得气体流量的数据采集精度很高，减轻了单片机数据处理的能力和参数要求，为普及病者使用奠定可使用的低价基础 [<xref ref-type="bibr" rid="hanspub.36288-ref2">2</xref>]。</p></sec><sec id="s4_3"><title>2.3. 单片机控制系统设计</title><p>本吹气练习仪的控制采用常见的稳定型MSP430FR2633 微控制器单片机系统，是智能化产品的底层设备参考选择的芯片之一。单片机系统实现对气体的监控与测量对医疗恢复测量，是具有快速、稳定的系统设计选择方案。本设计主要是通过MSP430FR2633 对气体流量传感器进行控制采集数字流速信号并进行处理，分三路给出数据分析及控制，一路是系统本身的按键功能，及使其进行精准的数据传输至数码显示管，一路是经过“蓝牙”模块与手机APP链接，实现便携移动设备对吹气练习仪的数据采集分析及设置，第三路是通过WIFI与云端网络进行链接，发送到医生终端供医生治疗参考。</p></sec><sec id="s4_4"><title>2.4. 网络数据交互方案设计</title><p>在互联网+技术时代，通常采用“蓝牙”或WIFI进行数据采集与控制数据的交互，本文设计系统兼容这两种方式的数据传输形式，以满足各类用户的需求。“蓝牙”模块采用最为稳定的HC-08模块，WIFI模块选用ESP8266-01模块。</p></sec><sec id="s4_5"><title>2.5. 手机APP与云端网站设计</title><sec id="s4_5_1"><title>2.5.1. 手机APP设计</title><p>手机APP主要是为了设置和查看吹气练习仪对吹气的设置和控制，以方便不会操作设备按键的病人陪伴。主要功能布局见图2所示。</p><p>图2. APP设计架构图</p></sec><sec id="s4_5_2"><title>2.5.2. 云端网站设计</title><p>云端网站设计主要为了医生掌握病人的吹气练习情况，系统还将有智能功能对比，以大数据形式实现云端设计，将数据联网，一是形成自己病人的呼吸练习情况，二是由数据分析出根据吹气的力度、频率等电参数，给出合理和科学的数据建议。当然，如果病人家属查看信息，也是具备了本项功能的，只是不会有大数据的分析与治疗方案提供，这样大大减少人们对治疗的进展情况。详细设计见后面网站设计关键资料。</p></sec></sec></sec><sec id="s5"><title>3. 功能设计</title><sec id="s5_1"><title>3.1. 基本功能设计</title><p>患者做吹气练习时，为方便使用，加入了手机端监控系统，合理科学地运用万物互联原理，实现在远方也能查看病患的身体健康状态，以及当日进行的吹气练习的记录。在此设备的基础上，设置了医生在线的病患查看网站，使用该网站，进行浏览每一位在医院进行康复训练的病患状态，查看病患资料和数据，使用患者在当天的吹气数据记录，了解患者恢复情况。</p></sec><sec id="s5_2"><title>3.2. 应用领域设计</title><p>根据相关调查显示，国外一些情况表现要好一些，由于国外一些医疗条件要比国内好一些，但是手术之后的肺部功能恢复，还是十分的麻烦，目前能做到的，只是一些简单传统的医疗术后恢复，难以实现精确和高效；而国内，肺部功能恢复的医疗现状，能够做到的只是能够恢复，但是不够卫生，带来的隐患是留下一些后遗症，例如：肺部供气不足，肺大泡，肺部肿胀等，会对以后的日常生活造成严重的影响。</p><p>近年来随着汽车使用数量成直线上升截至2019年6月全国机动车数量达到3.4亿，据卫生部、华经产业研究院整理的数据(2015~2018年我国肺移植手术数量图见图3所示)就2019年全年，全国发生4121起交通事故，造成1981人死亡，6141人受伤。数据显示，2017年中国肺移植注册系统共上报肺移植手术达299例，2018年达到403例 [<xref ref-type="bibr" rid="hanspub.36288-ref3">3</xref>]。</p><p>图3. 2015~2018年我国肺移植手术数量图</p><p>截至2020年3月2日24时，全国新型冠状病毒肺炎确诊病例25,352例(其中重症病例5952例)，累计治愈出院病例52,045例，累计死亡病例3012例，累计报告确诊病例80,409例，有疑似病例522例，全国新型冠状病毒肺炎累计确诊，其病例数据见图4所示 [<xref ref-type="bibr" rid="hanspub.36288-ref4">4</xref>]。</p></sec><sec id="s5_3"><title>3.3. 技术可行性设计</title><p>按照系统分析提出的在该项目开发过程中可能产生的技术难关、硬件兼容等不利因素，确保顺利开发出所需要的系统，包括硬件和软件两部分 [<xref ref-type="bibr" rid="hanspub.36288-ref5">5</xref>]，硬件水平是否符合我们的项目需求，软件算法是否能实现我们所需要的功能等等。</p><p>系统运行环境为Win7以上常用操作系统，在数据库和应用程序服务器的整合方面，采用App Inventor 2开发软件。App Inventor2软件有着完善的数据库设计功能，而且同时可以很好地兼容第三方的产品，该软件集成了编码和调试等诸多功能为一体采用模块式开发，是一款采用拖拉操作的可视化编程工具，主要用于构建运行在“安卓”系统上的移动应用，App Inventor2 向用户提供基于Web的图形用户界面设计工具，开发人员按照实际需求设计应用的外观。</p><p>图4. 全国新型冠状病毒肺炎累计确诊数据</p></sec><sec id="s5_4"><title>3.4. 经济可行性设计</title><p>新型冠状病毒肺炎的爆发使得肺部疾病的危害性极其明显，社会医疗资源匮乏和床位紧张使得患者出现被收容容量受限，该设备能使已经被治愈的患者在家进行肺部恢复同时通过线上让医生进行对患者的康复情况进行观测。</p><p>就目前的常用恢复措施来看，提供给患者手术后进行肺部恢复的只有三种方法：</p><p>第一种定期手术清理，这种方式伤口在短时间里面会被再次打开，对刚做完手术的病人身体根本不可能坚持下来创伤很大，这种方式只能排出肺部多余的杂质，对肺部功能的恢复作用不大。</p><p>第二种吹气球方式，这种方式经济成本低，很大病患家属选择这种方式。但是吹气球对于刚刚做完手的病人，气球中的有害气体太多，肺部的新伤要忍受巨大的痛苦，还会留下后遗症。</p><p>第三种术后恢复方案，是通过吹一种装在瓶子中的轻质小球，通过小球的回旋，来造成咳嗽，排出多余的杂质及其淤血。这种方式对于刚刚做完手术的病患，其伤口和肺部还没有得到有效的恢复治疗，咳嗽会造成伤口出血，肺部疼痛等二次创伤。</p><p>基于以上临床需求设计开发了该设备，在健康环保的基础上加入传感器，有效利用物联网技术，采集并且分析病患的身体健康程度；上位机采用了App inventor2进行APP的编写，简单易懂方便用户使用；云端数据库，为医生的控制端口，改变了传统的“查房”，使用云端轻松了解每一位病患的身体状况，得到真实数据，及时给出用药剂量，确保准确高效。</p></sec><sec id="s5_5"><title>3.5. 可操作性设计</title><p>该设备应用APP界面简单易操作，只需要会手机的简单操作就能轻松使用，APP功能分类明确能够短时间内找到自己需要的模块，获取自己的需要的信息。</p><p>云端采用姓氏排序并添加搜索，使得医生能快速的找到自己的患者进行查看信息。系统整体性能和可操作性很好，很适合一般病患经济、方便有效的使用。</p></sec></sec><sec id="s6"><title>4. APP部分设计</title><sec id="s6_1"><title>4.1. APP的开发工具</title><p>APP Inventer 2是一款谷歌公司开发的一种可视化的App编程开发工具软件，集成了编码和调试等诸多功能，并且同时可以支持不同的开源一款模块式编程产品。</p></sec><sec id="s6_2"><title>4.2. APP的功能实现</title><p>该系统APP首先要实现“登录”和“注册”功能，保证每个用户账号的唯一性和安全性，要确保信息安全的同时还要保证信息不会重复记录 [<xref ref-type="bibr" rid="hanspub.36288-ref6">6</xref>]。</p><p>接着是上传数据功能，详细记录需要上传的该数据详细信息，特别是上传时间，持续时间和肺活量等功能，要保证准确性。</p><p>然后是医生查看患者信息，点开该患者能够看到的信息，包括出院时间、手术或治愈时间、肺部锻炼次数、每次锻炼时间和锻炼的效果等信息。</p><p>最后实现患者和医生的对话交流，让医生根据患者的恢复情况，决定是否继续开药或者前往医院复查等一系列功能。</p></sec><sec id="s6_3"><title>4.3. APP的设计</title><sec id="s6_3_1"><title>4.3.1. APP的“登录”界面的设计</title><p>1) 为登录界面添加“对话框”、“网络微数据库”组件。</p><p>2) “登录”界面设计逻辑</p><p>编辑“网络微数据库”的逻辑，设定为：假如用户没有填写账户名或者密码时，系统弹出“对话框”，提示用户“账号或密码不能为空”。当账号密码不为空时，把账号及密码输入框的文本保存至数据库。当保存完成时，弹出对话框提示“注册成功”，同时清空密码输入框，当用户再次输入时则可登陆成功。</p><p>3) 遇到的问题</p><p>当把账号密码同时设置为标签和储存值，就会存在一个问题：因为没有将账号密码分开保存，则一个账号可以注册无数次，并且可以用不同的密码登录。</p><p>4) 解决方法</p><p>把账号和密码合并成列表储存，不同的是，在把列表储存之前先把账号和账号两个同样的文本合并储存，这样可以用“逻辑”中的“不等于”来判断是否注册，如果已经注册则弹出对话框提示“账号已注册”。如果没有，则提示“注册成功”。这样一个用户只能用唯一的密码登录 [<xref ref-type="bibr" rid="hanspub.36288-ref7">7</xref>]。</p><p>同时这个方法也会有缺点，就是一个用户储存两次数据，则对数据库的占用是以前的两倍。</p></sec><sec id="s6_3_2"><title>4.3.2. APP的主界面及逻辑设计</title><p>在App的主页面上，我们设计了两种——一种是用户界面，另一种是医生界面。</p><p>1) 在用户界面上，设计了“设备自检”“开始”以及“清空数值”三个按钮，和两个“标签框”用于输出数据，医生界面会多了一个“病人床号”。</p><p>2) 首先要在“创建屏幕”内添加一个图像、两个标签及三个按钮。再添加两个非可视“计时器”和“蓝牙客户端”组件。在“计时器”中设定一个时间隔点，当“计时器”到达时间隔点就会运行“蓝牙客户端”，从而调用“蓝牙客户端”给App发送数据。</p><p>3) 在医生端上，我们可以通过点击“病人病号”在线查看病人的数据情况。</p></sec><sec id="s6_3_3"><title>4.3.3. APP的逻辑设计</title><p>主要的难点在下位机与手机的稳定联通和数据同步上。</p><p>当“设备自检”被按下时，程序会自动检测到是否与“蓝牙”连接，如果连接成功，则“设备自检”按钮背景色改变。此时点击“开始”按钮并使用下位机，程序就会自动调用“蓝牙客户端”进行数据上传，并将数据显示在界面上。也可以使其传输至数据库，让医生远程观察病人的情况。</p></sec></sec><sec id="s6_4"><title>4.4. APP界面设计</title><p>经过各项功能模块的设计，针对不同的用户群体，其APP的界面风格也有差异。针对本系统的应用，设计了针对用户使用的APP界面(见图5所示)和医护人员使用的APP界面(见图6所示)。设计这2种版本，一种是普通的用户端，方便家人在远程使用能够查看病人的身体状态，不必时刻担心，弥补一些特殊人群(警察、消防队员、边防军人等)没办法陪伴在病患身边而担心。另外一个手机APP端是一个管理端口，这个端口是提供给医生使用，方便医生随时对病患进行查看，通过科学的数据和病人的身体状态，及时给病人对症下药，以免延误病情。</p><p>图5. 用户APP界面</p><p>图6. 医护端APP界面</p><p>图5设计和图6设计最大的区别点在于，医生的APP客户端模块比用户APP多出了病人床号，以方便查看病人的吹气练习数据状态。</p></sec></sec><sec id="s7"><title>5. 硬件系统设计</title><p>硬件系统设计包含：单片机系统设计，气体流量传感器、整机系统电路等部分。</p><sec id="s7_1"><title>5.1. 单片机系统</title><p>单片机采用最为常见的MSP430FR2633 微控制器系列单片机，采用5 V供电，与其他模块电路供电电路一致。</p><p>电路系统中，除最小系统应用电路引脚外，单片机功能引脚方面注意：1、2脚接按键，对运行的模式进行调控，12~15及21~28为数码管LED显示“段码”控制端。22、23脚(RXD、TXD)为外接“WIFI及蓝牙”模块，11、12引脚接FS2011气体流量传感器和运算放大器电路，进行AD模拟信号输入 [<xref ref-type="bibr" rid="hanspub.36288-ref8">8</xref>]。</p></sec><sec id="s7_2"><title>5.2. 气体流量传感器</title><p>本系统电路中，气体流量传感器采用IDT提供的FS2011，本模块各引脚功能键见表2所示。</p><table-wrap id="table2" ><label><xref ref-type="table" rid="table2">Table 2</xref></label><caption><title> FS2011 gas flow sensor pin function tabl</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >Pin Number</th><th align="center" valign="middle" >Pad Name</th><th align="center" valign="middle" >Type</th><th align="center" valign="middle" >Description</th></tr></thead><tr><td align="center" valign="middle" >1</td><td align="center" valign="middle" >V<sub>IN</sub></td><td align="center" valign="middle" >Input</td><td align="center" valign="middle" >Supply voltage</td></tr><tr><td align="center" valign="middle" >2</td><td align="center" valign="middle" >SDA</td><td align="center" valign="middle" >Input/Output</td><td align="center" valign="middle" >Serial data</td></tr><tr><td align="center" valign="middle" >3</td><td align="center" valign="middle" >SCL</td><td align="center" valign="middle" >Input</td><td align="center" valign="middle" >Serial clock</td></tr><tr><td align="center" valign="middle" >4</td><td align="center" valign="middle" >GND</td><td align="center" valign="middle" >Ground</td><td align="center" valign="middle" >Ground</td></tr><tr><td align="center" valign="middle" >5</td><td align="center" valign="middle" >MOSI</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >Do not connect</td></tr><tr><td align="center" valign="middle" >6</td><td align="center" valign="middle" >V<sub>OUT</sub></td><td align="center" valign="middle" >Output</td><td align="center" valign="middle" >Analog output</td></tr></tbody></table></table-wrap><p>表2. FS2011气体流量传感器引脚功能表</p></sec><sec id="s7_3"><title>5.3. 整机系统电路设计(电路见图7、图8所示)</title><p>图7. 整机电路原理图</p><p>图8. 整机系统电路功能实物图</p></sec><sec id="s7_4"><title>5.4. 单片机系统程序数据量化设计</title><p>在数据量化中，可以参考：</p><disp-formula id="hanspub.36288-formula147"><graphic xlink:href="//html.hanspub.org/file/8-2690446x17_hanspub.png"  xlink:type="simple"/></disp-formula><p>以及：</p><disp-formula id="hanspub.36288-formula148"><graphic xlink:href="//html.hanspub.org/file/8-2690446x18_hanspub.png"  xlink:type="simple"/></disp-formula><p>由于传感器的高灵敏性，使得在计算之前必须要进行补偿，否则数据将不会准确。相关流量采集数据程序如下：</p><p>void datapros()</p><p>{</p><p>u8 temp1;</p><p>temp1 = Read_AD_Data(0xE4)/16;</p><p>disp[<xref ref-type="bibr" rid="hanspub.36288-ref0">0</xref>]=temp1/1000;</p><p>disp[<xref ref-type="bibr" rid="hanspub.36288-ref1">1</xref>]=temp1%1000/100;</p><p>disp[<xref ref-type="bibr" rid="hanspub.36288-ref2">2</xref>]=temp1%100/10;</p><p>disp[<xref ref-type="bibr" rid="hanspub.36288-ref3">3</xref>]=temp1%10;</p><p>if(m==4)</p><p>{</p><p>m=0;</p><p>}</p><p>}</p><p>void datapros1()</p><p>{</p><p>static u16 temp3;</p><p>static u8 i;</p><p>if(i==100)</p><p>{</p><p>i=0;</p><p>temp3 = Read_AD_Data(0xE4);</p><p>if(temp3&gt;100)</p><p>{</p><p>temp2=temp3+temp2;</p><p>}</p><p>else</p><p>temp2=temp2;</p><p>}</p></sec><sec id="s7_5"><title>5.5. “蓝牙”模块</title><p>本电路采用市售现成的蓝牙模块HC-08与单片机串口系统相连，以便实施手机APP与硬件系统的数据交互，其交互程序设计如下。</p><p>void UsartInit()</p><p>{</p><p>SCON=0X50;</p><p>TMOD=0X20;</p><p>PCON=0X00;</p><p>TH1=0XFd;</p><p>TL1=0XFd;</p><p>ES=1;</p><p>EA=1;</p><p>TR1=1;</p><p>}</p></sec><sec id="s7_6"><title>5.6. WIFI模块</title><p>本电路采用市售现成的WIFI模块ESP8266-01与单片机串口系统相连，以便实施手机APP、云端程序与硬件系统的数据交互，其交互程序设计如下。</p><p>void UsartInit()</p><p>{</p><p>SCON=0X50;</p><p>TMOD=0X20;</p><p>PCON=0X00;</p><p>TH1=0XFd;</p><p>TL1=0XFd;</p><p>ES=1;</p><p>EA=1;</p><p>TR1=1;</p><p>}</p></sec><sec id="s7_7"><title>5.7. 按键电路</title><p>本系统中设置了2个按键，即K1和K2对应电路，可对运行状况、各类参数进行设置调控。</p></sec><sec id="s7_8"><title>5.8. 显示电路</title><p>该系统显示电路采用由74HC595驱动译码的八位数字显示电路。其中，高4位显示为瞬间气体流量值，低4位为单次吹气小计流量值，其部分程序设计如下。</p><p>void DigDisplay()</p><p>{</p><p>for(m=0;m&lt;4;m++)</p><p>{</p><p>UsartInit();</p><p>SBUF='0'+disp[m];</p><p>delay2ms();</p><p>TI=0;</p><p>}</p><p>}</p></sec></sec><sec id="s8"><title>6. 云端系统设计</title><sec id="s8_1"><title>6.1. 用户登录界面</title><p>在用户登录界面，在用户名文本框内输入用户名，在密码文本框内输入密码，如果用户名和密码同时与数据库中的用户名和密码相符合，点击“登录”后进入系统的主界面。如果输入的信息不正确，则给出提示，设计流程见图9所示 [<xref ref-type="bibr" rid="hanspub.36288-ref9">9</xref>]。</p><p>图9. PC云端结构设计图</p><p>输入：用户名和密码。</p><p>处理：校验字符的有效性，该系统要求用户登录到提供用户名和密码，测试用户的输入是否满足该测试，是否用户名和密码的文本框为空。如果为空，系统会提示用户输入用户名和密码。检查用户名是否存在或密码是否正确，即判断用户输入用户名和密码是否正确。从基于用户名和密码的数据库和用户权限提取，根据从权限的数据库用户权限中提取的主要形式实施，如果你能操作管理员的所有功能，用户可以仅当它是函数的一部分，该功能不能设置操作和管理用户信息。输出：登录成功，进入管理员的系统使用资源页面，否则显示错误信息页面 [<xref ref-type="bibr" rid="hanspub.36288-ref9">9</xref>]。根据上述功能介绍，得到该模块的程序流程图，如图10所示：</p><p>图10. 系统用户登录设计</p></sec><sec id="s8_2"><title>6.2. 用户登记模块的设计</title><p>输入：用户的基本信息(用户账号，姓名，性别，年龄，联系方式等)。</p><p>添加：添加用户名称，账号，姓名，性别，年龄，联系方式，备注，密码。</p><p>输出：提交成功，提示成功信息，不成功则显示错误的信息页面。</p><p>据上述功能介绍，得到该模块的程序流程图，如图11所示：</p><p>图11. 用户登录模块流程图</p><p>后台云端数据库：</p><p>记录患者的身体状态；实现与医生端口的连接，方便医生管理；与下位机硬件互联，实现病患身体状态数据与云端数据实时交付。</p><p>根据以上软硬件配合，设置了以下功能：</p><p>1) 仪器便携方便，吹气量化精确，为治疗提供重要参考数据；</p><p>2) 仪器具备设备显示和手机APP操作、显示，网站储存病患数据，并具备数据记忆和查询功能，方便病人和家属以及医生观察使用；</p><p>3) 测试数据具有云端功能，方便医生对病人吹气量的掌握，数据科学，避免家属护理中数据出现差错，影响医治和用药判断；</p><p>4) 测试提醒功能：护理病人家属可能因为照顾不周，忘记定期测试和测试时间，本功能测试仪具有设置定时提醒功能；</p><p>5) 仪器具备线上病患管理功能，为医生和病患做出更加科学的判断和处理，并且使用云端储存，记录当天每位病患的吹气次数、吹气的肺活量、吹气的总量，方便医生做进一步的数据统计；</p><p>6) 这款产品可以用于社区体检中，只需要一台机器，即可测得相关人的肺活量。</p></sec><sec id="s8_3"><title>6.3. 整体云端设计</title><p>1) 云端查询设计见图12所示。</p><p>图12. PC云端网站界面</p><p>2) 云端可视数据库设计见图13所示。</p><p>图13. 云端可视数据库设计</p></sec></sec><sec id="s9"><title>7. 结语</title><p>IDT气体流量传感器安装在MSP430FR2633单片机上面，病患通过吹气体流量传感器来获得数据，然后使用单片机进行数据处理，最终的病患数据通过“蓝牙”发射模块或者通过WiFi发射模块，进行传输至家人手机APP端和医生的APP端，最后与后台云端数据库进行数据交互，来达到产品功能的实现。</p></sec><sec id="s10"><title>文章引用</title><p>刘光乾,刘桄序. 基于互联网+技术的大病术后吹气练习仪设计Design of Blowing Exercise Apparatus Based on Internet+ Technology for Postoperative Severe Disease[J]. 软件工程与应用, 2020, 09(03): 228-243. https://doi.org/10.12677/SEA.2020.93026</p></sec><sec id="s11"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.36288-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">张雪芹. 分析综合护理对高血压脑出血患者术后肺部感染的作用[J]. 智慧健康, 2020(8): 36-38.</mixed-citation></ref><ref id="hanspub.36288-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">李爱民. Web信息系统软件可靠性测试初探[J]. 科技信息, 2009(8): 204, 207.</mixed-citation></ref><ref id="hanspub.36288-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">杨蓉. PD-1 PD-L1在卵巢肿瘤的表达及其临床意义[D]: [硕士学位论文]. 延安: 延安大学, 2019.</mixed-citation></ref><ref id="hanspub.36288-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">孙远波, 闻芷艺, 徐瑞鸽, 罗飞, 李歌. 新型冠状病毒肺炎疫情数据可视化设计综述[J]. 包装工程, 2020(8): 51-62.</mixed-citation></ref><ref id="hanspub.36288-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">刘桄序, 刘光乾. 带“电”玩具充电电源管理系统设计[J]. 电子产品世界, 2019(10): 55-58.</mixed-citation></ref><ref id="hanspub.36288-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">Almomani, F. (2020) Kinetic Modeling of Microalgae Growth and CO2 Bio-Fixation Using Central Composite Design Statistical Approach. Science of the Total Environment, 720, Article ID: 137594.  
&lt;br&gt;https://doi.org/10.1016/j.scitotenv.2020.137594</mixed-citation></ref><ref id="hanspub.36288-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">Khuntia, S., Sinha, M.K. and Saini, B. (2020) Conversion of NO2 through Ozonation and Peroxone Process in Gas and Aqueous Phase: Finding the Suitable Process through Experimental Route. Chemical Engineering Journal, 387, Article ID: 124082. &lt;br&gt;https://doi.org/10.1016/j.cej.2020.124082</mixed-citation></ref><ref id="hanspub.36288-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">李博, 李秀娟, 季锋, 陈辉. 低流量新鲜气体下观察风箱法用于判断喉罩漏气的有效性和安全性[J]. 国际麻醉学与复苏杂志, 2018(5): 418-421.</mixed-citation></ref><ref id="hanspub.36288-ref9"><label>9</label><mixed-citation publication-type="other" xlink:type="simple">刘光乾, 陈丹, 马兴茹. 智慧环境监测设计与应用[J]. 电子报, 2020(7): 007.</mixed-citation></ref></ref-list></back></article>