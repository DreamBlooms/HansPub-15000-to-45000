<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">GST</journal-id><journal-title-group><journal-title>Geomatics Science and Technology</journal-title></journal-title-group><issn pub-type="epub">2329-549X</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/GST.2020.81004</article-id><article-id pub-id-type="publisher-id">GST-33753</article-id><article-categories><subj-group subj-group-type="heading"><subject>GST20200100000_25654977.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于C#的地震安评成果应用系统的设计与实现
  Design and Implementation of Seismic Safety Evaluation Results Application System Based on C#
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>王</surname><given-names>波</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>徐</surname><given-names>朝辉</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>赵</surname><given-names>子文</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><addr-line>南京市水利规划设计院股份有限公司，江苏 南京</addr-line></aff><aff id="aff2"><addr-line>null</addr-line></aff><pub-date pub-type="epub"><day>06</day><month>11</month><year>2019</year></pub-date><volume>08</volume><issue>01</issue><fpage>29</fpage><lpage>37</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  针对高邮市城区区域性地震安全评价成果分散及信息化应用困难等问题，设计了基于Visual Studio集成开发环境和C#语言的地震安评成果应用系统。系统采用单机版架构，数据存储采用Access，利用天地图API、开源的GIS类库实现要素展示、参数查询等功能。本文对系统的设计方案进行详细的阐述，然后对系统涉及的关键技术及实现过程进行了描述。该系统提供了图件查询、时程曲线展示、设定场地参数查询与导出等功能，实践证明，该系统可很好地对地震安评成果数据管理、查询与综合应用，可为地震管理部门提供便捷的查询服务与决策支持。
   According to the difficulties of applying seismic safety evaluation results in Gaoyou, we design seis-mic evaluation result application system by C# language, in Visual Studio development platform. The system adopts the stand-alone architecture, using access, Tianditu API, Open GIS class library to achieve elements display, parameter query and other functions. This paper describes the design of the system in detail, and then describes the key technologies involved in the system and the implementation process. The system provides functions such as map query, time history curve display, site parameter query and export, etc. Practice has proved that the system can be well used in the management, inquiry and comprehensive application of seismic safety evaluation data, and can provide convenient inquiry service and decision support for the seismic management department.
 
</p></abstract><kwd-group><kwd>地震安评成果，成果应用，C#语言，GIS, Seismic Safety Evaluation Results</kwd><kwd> Results Application</kwd><kwd> C#</kwd><kwd> GIS</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于C#的地震安评成果应用系统的 设计与实现<sup> </sup></title><p>王波，徐朝辉，赵子文</p><p>南京市水利规划设计院股份有限公司，江苏 南京</p><p>收稿日期：2019年12月13日；录用日期：2019年12月26日；发布日期：2020年1月2日</p><disp-formula id="hanspub.33753-formula40"><graphic xlink:href="//html.hanspub.org/file/4-2840269x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>针对高邮市城区区域性地震安全评价成果分散及信息化应用困难等问题，设计了基于Visual Studio集成开发环境和C#语言的地震安评成果应用系统。系统采用单机版架构，数据存储采用Access，利用天地图API、开源的GIS类库实现要素展示、参数查询等功能。本文对系统的设计方案进行详细的阐述，然后对系统涉及的关键技术及实现过程进行了描述。该系统提供了图件查询、时程曲线展示、设定场地参数查询与导出等功能，实践证明，该系统可很好地对地震安评成果数据管理、查询与综合应用，可为地震管理部门提供便捷的查询服务与决策支持。</p><p>关键词 :地震安评成果，成果应用，C#语言，GIS</p><disp-formula id="hanspub.33753-formula41"><graphic xlink:href="//html.hanspub.org/file/4-2840269x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2020 by author(s) and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/4-2840269x7_hanspub.png" /> <img src="//html.hanspub.org/file/4-2840269x8_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>地震是危及人民生命财产及破坏建筑设施的突发式自然灾害，地震造成的人员伤亡及建筑严重损坏等大规模次生灾害，给国家、人民造成了巨大的损失，防震减灾工作已成为各级政府部门十分关注的工作 [<xref ref-type="bibr" rid="hanspub.33753-ref1">1</xref>]。从震害调查的资料分析，造成地震灾害和人员伤亡的主要原因是由建筑物的倒塌引起的。在防震减灾的众多环节中，预防工作尤为重要，科学的选址并进行场地地震安全性评价是工程建设防震减灾的首要环节。国内学者田勤虎等 [<xref ref-type="bibr" rid="hanspub.33753-ref2">2</xref>] 开展基于GIS在地震安评工作数据管理的研究，但对数据综合应用功能较弱。聂树明等 [<xref ref-type="bibr" rid="hanspub.33753-ref3">3</xref>] 提出对地震安评成果集中管理，在空间数据管理与应用方面仍存在不足。随着GIS技术应用的深入，贺瑞喜等 [<xref ref-type="bibr" rid="hanspub.33753-ref4">4</xref>] 研发了基于GIS的地震场地危险性分析系统，系统将GIS算法应用到危险性评价与分析中取得良好的效果。万娜等 [<xref ref-type="bibr" rid="hanspub.33753-ref5">5</xref>] 利用ASP.NET技术实现了地震安全性评价钻孔信息系统的开发，实现了钻孔数据库的存储与表达。王金艳等 [<xref ref-type="bibr" rid="hanspub.33753-ref6">6</xref>] 研究了利用GDB模型对地震安评成果进行标准建库，可有效进行数据管理。</p><p>地震安全性评价是根据对工程场地及周围地震活动、地质环境分析，计算出工程设防不同概率水准要求相应的地震动参数及预测结果。本文以江苏高邮市城区区域性地震安全性评价项目为基础，采用C#开发了一套地震安评成果应用系统，实现成果管理、查询与应用功能。</p></sec><sec id="s4"><title>2. 系统设计</title><sec id="s4_1"><title>2.1. 总体建设方案</title><p>采用地理信息系统(GIS)技术、空间数据库等技术，收集、整合基础地理数据、地震地质信息数据、地震活动性、工程场地的地震工程地质条件数据、基岩地震动与地表地震动数据等各相关数据资源并入库，实现数据资源空间数据、属性数据一体化管理。在此基础上基于相关软件开发规范，开发数据查询与展示平台，实现成果的共享应用服务。系统总体架构如下图1所示。</p><p>1) 利用ArcGIS、Excel、Access等管理软件平台，按照成果数据建设标准与要求，对地震安全性评价成果、图件成果、参数成果、场地数据地震安全性评价成果进行收集、整理、数字化编辑后形成空间图形数据并入库。</p><p>2) 以微软Access数据库管理系统(DBMS)为管理平台，对于属性数据采用二维表形式存储，对于涉及到的空间数据(线、面)采用GeoJSON空间数据模型建立数据资源空间数据库，通过空间数据引擎实现地震相关数据资源入库管理与快速调用。对于图形图件成果，则采用原始的图片格式存储组织。</p><p>3) 在已建立的数据库基础上，采用统一的应用集成框架、系统架构与开发环境，实现城区区域地震安全性评价成果的查询、输出与辅助应用。</p><p>4) 为保障系统可扩展性，应用支撑平台内部服务组件之间严格按照系统定义的服务接口设计，便于相互之间的调用。提供统一的应用集成框架，其中包含共用的服务组件、工具和系统字典以及基于数据库访问控制等功能。平台遵循两层结构显示逻辑和业务逻辑区分的体系，合理运用消息机制关联系统事件，增加部署的灵活性，模型和方法类程序允许开发者使用继承性的语言开发，提供良好的可扩展性。</p><p>图1. 系统框架</p></sec><sec id="s4_2"><title>2.2. 数据库设计</title><p>1) 数据库内容</p><p>高邮市城区地震安全性评价成果库主体由地震专题数据库与基础地理数据库组成，地震专题数据库包括区域地震构造图、震中分布图、地质构造图、钻孔资料、地震动参数等数据构成，基础地理数据库包括行政区划、水系图、道路等图形数据与卫星影像、地形地貌等栅格数据构成，数据库逻辑结构图如下图2。</p><p>2) 数据库建库流程</p><p>整个数据库的建库流程主要依据《中国地震活动断层探测技术系统技术规程》(中国地震局，2005)、《活动断层探测》(中华人民共和国住房和城乡建设部等，2010)等标准和指南进行数据库建设。建库流程依次为：资料收集、数据整理、数字化、图形编绘、拓扑构建、属性数据采集、空间数据与属性数据的关联、数据集成建库，建库流程见图3。</p><p>图2. 数据库结构图</p><p>图3. 数据建库流程</p><p>3) 数据组织与存储设计</p><p>数据组织采用“属性表 + 空间文件”的存储模式对本项目涉及的地理底图成果、安评成果、各指标数据成果等进行统一建库，对数据进行集中管理。</p><p>a) 文件组织方式</p><p>涉及的图件、文本成果如地震构造图、震中分布图、液化分区图、工程地质分区图等图件成果，其格式为JPG、BMP等栅格形式，加速度时程为一系列的二进制文本文件，因这两类数据具有非结构性、数据量大等特点，存储数据库中势必会造成数据库庞大、读取效率降低。基于以上考虑，针对此类数据存储采用“文件 + 属性索引”方式进行，即将文件属性索引存储到数据库表中。</p><p>b) 二维属性表存储</p><p>涉及的钻孔资料、计算模型、地震动参数表、分区地表设计地震动参数表等成果，该类数据为二维表格数据，具有数据量小、结构统一、查询频繁等特点，利用Access数据库平台对此类数据进行集中存储与管理。</p><p>c) 空间数据文件组织</p><p>涉及的基础地理数据，如行政区划图、河流水系、道路等数据，为空间矢量图形数据，利用通用的GeoJSON模型进行存储管理。</p></sec><sec id="s4_3"><title>2.3. 系统功能模块设计</title><p>高邮城区地震安全性评价技术服务系统包含成果查询、地震动参数与图件查询、设定场地参数计算以及报告导出等，系统主要包括三大模块：地图浏览、安评成果查询、参数查询三大模块，如下图4所示。</p><p>图4. 功能结构图</p></sec></sec><sec id="s5"><title>3. 关键技术</title><p>1) 单机架构下集成天地图资源</p><p>单机版GIS系统中间件需采用开源非商业平台，地理底图采用互联网天地图资源。天地图系统为网络Web系统，系统将内嵌Web页面的方式进行地理地理底图的调用与展示。系统采用嵌入.NET Framework自带的WebBrowser控件来实现地图展示与调用。</p><p>网页与应用程序的交互是系统实现的关键步骤，WebBrowser支持“由Windows Form响应Web页面的事件”。整个HTML文档以及其包含的各个HTML元素都和一个HtmlDocument、HtmlElement之类的.Net对象对应。因此只要找到对对应的HtmlElement对象，为其添加Event Handler即可，具体实现技术方案如下：</p><p>HTML页面中有一按钮，点击调用应用程序方法</p><p>在C#应用程序中需检索获取该按钮，并为之绑定操作事件。</p><p>HtmlDocumenthtmlDoc = webBrowser.Document;</p><p>HtmlElementbtnElement = htmlDoc.All[btnClose];</p><p>if (btnElement != null)</p><p>{</p><p>btnElement.click += new HtmlElementEventHandler(HtmlBtnClose_Click);</p><p>}</p><p>C#应用程序调用HTML脚本，在某种程度上看作是Web页面调用WinForm；系统除了WinForm直接访问Web页面的HTML元素之外，还涉及到应用程序直接调用Web页面里的各种Script方法，WebBrowser类提供了Document.InvokeScript接口，通过该接口可实现应用程序与Web脚本的交互操作。</p><p>private void button3_Click(object sender, EventArgs e)</p><p>{//绘制圆</p><p>doublelon = 119.46538;</p><p>doublelat = 32.77195;</p><p>Object[<xref ref-type="bibr" rid="hanspub.33753-ref"></xref>] objArray = new Object[<xref ref-type="bibr" rid="hanspub.33753-ref2">2</xref>];</p><p>objArray[<xref ref-type="bibr" rid="hanspub.33753-ref0">0</xref>] = (Object)lon;</p><p>objArray[<xref ref-type="bibr" rid="hanspub.33753-ref1">1</xref>] = (Object)lat;</p><p>webBrowser1.Document.InvokeScript(Draw200MCircle, objArray);</p><p>}</p><p>其中“Draw200MCircle”为Html页面中的JavaScript函数方法，objArray为方式传入参数。</p><p>2) 2000国家大地坐标框架下投影距离计算</p><p>系统中</p><p>因2000国家大地坐标系属于地系坐标系，大地坐标系转为平面坐标系属于严密投影转换，按照高斯投影方式直接投影即可，系统将采用开源的坐标转换工具Proj.NET，Proj.NET是一个开源的空间参照与投影引擎，遵循OGC相关标准。Proj.NET支持基准面转换，地理坐标系，投影坐标系，地心坐标系，可在多种.NET框架下使用。它可进行点对点之间的坐标变换，同时也可以把坐标系转换为Well-Known Text (WKT)和XML。目前支持投影类型有：Mercator、横轴墨卡托投影(Transverse Mercator)、Albers、正轴等角割圆锥投影(Lambert Conformal Conic、兰勃特投影)等。</p><p>项目涉及到的坐标系统定义采用WTK格式，CGCS2000大地坐标系WTK格式定义如下：</p><p>GEOGCS[\CGCS2000\,DATUM[\WGS_1984\,SPHEROID[\WGS 84\,6378137,298.257223563,AUTHORITY[\EPSG\,\7030\]],AUTHORITY[\EPSG\,\6326\]],PRIMEM[\Greenwich\,0,AUTHORITY[\EPSG\,\8901\]],UNIT[\degree\,0.0174532925199433,AUTHORITY[\EPSG\,\9122\]],AUTHORITY[\EPSG\,\4326\]]</p><p>利用Proj.NET进行投影转换代码如下所示：</p><p>private static ICoordinateTransformationGetCoordinateTransformation()</p><p>{</p><p>varctf = new CoordinateTransformationFactory();</p><p>varcf = new CoordinateSystemFactory();</p><p>var cgcs2000Wkt = cf.CreateFromWkt(strCGCS2000Wkt);</p><p>var UTMZone50N = cf.CreateFromWkt(str UTMZone50NWkt);</p><p>varct = ctf.CreateFromCoordinateSystems(cgcs2000Wkt, UTMZone50N);</p><p>returnct;</p><p>}</p></sec><sec id="s6"><title>4. 系统实现</title><p>系统采用单机版开发，数据库管理信息采用Access平台，空间数据采用GeoJSON空间数据模型进行存储与管理。系统软件以.Net为运行平台，C#作为开发语言开发，采用插件式框架。利用插件开发技术将各组件按照指定的通信契约组合最终形成整个系统，其基本思想是把各大功能模块划分为几个控件，每个控件完成不同的功能。各控件之间，可以方便地通过可视化的软件开发工具集成起来，形成最终的完整的系统应用。具有小巧灵、应用高效，可直接嵌入开发工具等特点，系统主界面见图5。</p><p>图5. 场地设定及参数计算</p><p>图6. 参数查询</p><p>1) 地震安评图件成果查询：地震构造、震中分布、钻孔柱状图、地质纵剖面图、地震动参数分区图、地震地质灾害分布图等主要图件。</p><p>2) 地震动参数查询与输出：对目标区或钻孔的不同概率水准地震动参数数据表展示，以及相关图件展示，包括钻孔地层结构、地震动参数等。</p><p>3) 设定场点设计地震动参数的确定</p><p>对设定场点设计地震动参数的确定，输入该点位置(场点经纬度或通过地理底图定点)、工程类型和场地类别后，具备能够给出基于区域性地震安全性评价结果、符合场地条件和工程结构抗震设计所需要概率水准的地震动参数的功能，包括峰值加速度、加速度反应谱和地震动加速度时程，参数查询结果见图6。</p><p>4) 地震动参数查询简本</p><p>根据不同概率水准地震动参数计算结果及相关规范要求，对设定的场地的地震灾害情况进行初步评价，并可导出参数查询报告。</p></sec><sec id="s7"><title>5. 结论</title><p>本文中利用C#语言开发了单机版成果应用技术服务系统，将地震安评成果数据进行查询展示与综合应用，该系统具有以下意义：1) 为系统使用者提供了一套集成果查看、参数查询与导出的应用系统，提高成果利用效率。2) 可快捷、方便地对设定场地的地震动参数进行计算并输出，为城市建设过程中科学抗震设防提供技术支持，也为城市规划、重大工程选址、抗震救灾决策等工作提供参考。</p></sec><sec id="s8"><title>文章引用</title><p>王 波,徐朝辉,赵子文. 基于C#的地震安评成果应用系统的设计与实现Design and Implementation of Seismic Safety Evaluation Results Application System Based on C#[J]. 测绘科学技术, 2020, 08(01): 29-37. https://doi.org/10.12677/GST.2020.81004</p></sec><sec id="s9"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.33753-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">王斐斐, 孙杰, 赵显刚, 等. 基于GIS的地震安全性评价成果管理系统建设[J]. 内陆地震, 2019, 33(1): 35-42.</mixed-citation></ref><ref id="hanspub.33753-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">田勤虎, 李晓聪, 魏电信. 基于GIS的地震安全性评价数据管理的研究[J]. 陕西地质, 2010, 28(2): 111-115.</mixed-citation></ref><ref id="hanspub.33753-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">聂树明, 李宏志, 杜鹏. 地震安全性评价数据的集中管理[J]. 国际地震动态, 2006(2): 26-28.</mixed-citation></ref><ref id="hanspub.33753-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">贺瑞喜. 基于GIS的工程场地地震危险性分析系统的研究与开发[D]: [硕士学位论文]. 昆明: 昆明理工大学, 2010.</mixed-citation></ref><ref id="hanspub.33753-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">万娜, 胡金虎, 韩艳杰, 等. 基于B/S架构的工程场地地震安全性评价钻孔信息系统开发[J]. 内陆地震, 2015(2): 129-133.</mixed-citation></ref><ref id="hanspub.33753-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">王金艳, 孙硕, 张金川, 等. 基于ArcGIS建立地震安全性评价信息数据库[J]. 防灾减灾工程学报, 2011(31): 115-118.</mixed-citation></ref></ref-list></back></article>