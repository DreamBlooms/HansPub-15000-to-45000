<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">OE</journal-id><journal-title-group><journal-title>Optoelectronics</journal-title></journal-title-group><issn pub-type="epub">2164-5450</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/OE.2016.63016</article-id><article-id pub-id-type="publisher-id">OE-18514</article-id><article-categories><subj-group subj-group-type="heading"><subject>OE20160300000_75140455.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  角膜地形图仪中基于USB2.0传输方式的成像系统设计与实现
  Design and Implementation of Image System Based on USB2.0 Transmission Mode in Corneal Topography
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>隋</surname><given-names>成华</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>韩</surname><given-names>勇浩</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>徐</surname><given-names>丹阳</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib></contrib-group><aff id="aff2"><addr-line>浙江工业大学理学院，浙江 杭州</addr-line></aff><aff id="aff1"><addr-line>null</addr-line></aff><author-notes><corresp id="cor1">* E-mail:<email>1194867850@qq.com(韩勇)</email>;</corresp></author-notes><pub-date pub-type="epub"><day>12</day><month>09</month><year>2016</year></pub-date><volume>06</volume><issue>03</issue><fpage>113</fpage><lpage>120</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   通过对USB2.0及1394接口数据传输的优缺点比较，结合角膜地形图仪图像采集传输的要求，设计了面阵CCD的驱动及USB2.0数据采集传输系统。在该系统中，选用Sony公司IXC445ALA面阵CCD作为系统图像采集的传感器，根据ICX445ALA的驱动时序要求，利用AD模数转换和CPLD的时序框架及单片机时序控制，实现了驱动电路的设计。针对单片机的USB2.0固件驱动，完成了USB2.0的数据输出。通过控制单片机的I/O口，实现了LED背光源的开闭、左右眼的自动判别及角膜图像的获取。最终检测表明，所获得的角膜图像清晰，USB2.0数据传输快速稳定，单片机辅助功能工作正常。较好地实现了角膜地形图仪中图像采集传输的要求。 Through comparing the data transmission advantages and disadvantages of USB2.0 and 1394 in-terface, and combining the data acquisition and transmission requirement of corneal topography, the array CCD driver and USB2.0 data acquisition and transmission system was designed. In the system, Sony ICX445ALA array CCD was chosen as image sensor, according to the ICX445ALA drive timing characters requirements, using CPLD and AD timing framework and MCU timing control, the drivering circuit design was realized. According to MCU’s USB2.0 firmware driver, USB2.0 data output was completed. By controlling the I/O port of the MCU, the open and close of the LED backlight, the automatic discrimination of the left and right eyes and the acquisition of the corneal image were realized. The final test shows that the obtained corneal image is clear; the USB2.0 data transmission is fast and stable. The MCU auxiliary function is effective. It can achieve the requirements of image acquisition and transmission well in corneal topography.
    
  
 
</p></abstract><kwd-group><kwd>角膜地形图仪，图像采集传输，USB2.0，ICX445ALA，CPLD, Corneal Topography</kwd><kwd> Image Acquisition and Transmission</kwd><kwd> USB2.0</kwd><kwd> ICX445ALA</kwd><kwd> CPLD</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>角膜地形图仪中基于USB2.0传输方式的成像系统设计与实现<sup> </sup></title><p>隋成华<sup>*</sup>，韩勇浩，徐丹阳</p><p>浙江工业大学理学院，浙江 杭州</p><disp-formula id="hanspub.18514-formula10"><graphic xlink:href="http://html.hanspub.org/file/1-2140098x7_hanspub.png"  xlink:type="simple"/></disp-formula><p>收稿日期：2016年8月20日；录用日期：2016年9月9日；发布日期：2016年9月12日</p><disp-formula id="hanspub.18514-formula11"><graphic xlink:href="http://html.hanspub.org/file/1-2140098x8_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>通过对USB2.0及1394接口数据传输的优缺点比较，结合角膜地形图仪图像采集传输的要求，设计了面阵CCD的驱动及USB2.0数据采集传输系统。在该系统中，选用Sony公司IXC445ALA面阵CCD作为系统图像采集的传感器，根据ICX445ALA的驱动时序要求，利用AD模数转换和CPLD的时序框架及单片机时序控制，实现了驱动电路的设计。针对单片机的USB2.0固件驱动，完成了USB2.0的数据输出。通过控制单片机的I/O口，实现了LED背光源的开闭、左右眼的自动判别及角膜图像的获取。最终检测表明，所获得的角膜图像清晰，USB2.0数据传输快速稳定，单片机辅助功能工作正常。较好地实现了角膜地形图仪中图像采集传输的要求。</p><p>关键词 :角膜地形图仪，图像采集传输，USB2.0，ICX445ALA，CPLD</p><disp-formula id="hanspub.18514-formula12"><graphic xlink:href="http://html.hanspub.org/file/1-2140098x9_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s3"><title>1. 引言</title><p>角膜地形图仪是检测人眼角膜表面形态的重要视光学测量仪器，通过采集人眼角膜表面形貌的图像，并将所采集到的图像传给上位机图像处理软件进行相应的处理，得到人眼角膜表面形貌的信息，为眼科医生测量角膜表面形貌及之后的角膜屈光校正或手术治疗提供了有力的检测手段 [<xref ref-type="bibr" rid="hanspub.18514-ref1">1</xref>] - [<xref ref-type="bibr" rid="hanspub.18514-ref3">3</xref>] 。因此，角膜地形图仪中图像采集及数据传输系统是整个设备的重要部分。目前市场上存在着多种型号的角膜地形图仪，其原理大都是由CCD将Placido盘反射的图像采集下来 [<xref ref-type="bibr" rid="hanspub.18514-ref4">4</xref>] [<xref ref-type="bibr" rid="hanspub.18514-ref5">5</xref>] ，根据模型实现人眼角膜形貌的重构。而现有仪器的数据传输一般都采用的1394卡，相比于1394卡传输，USB2.0数据传输具有易用性、稳定性及未来可持续升级等特点。现今PC机上都带有多个USB接口，并用于各种数据传输，且传输速率足以满足角膜地形图仪中对图像快速传输的要求。较要将1394卡安装到台式PC机上进行图像快速传输的适用性更加强。利用USB数据传输是现今社会的主流，且USB接口协议正在不断升级，USB3.0正在成为新一代电脑和电子产品的标准配置，越来越多的平板也支持USB数据传输，并可为以后角膜地形图仪的小型化及易用性的打下了坚实的基础。</p><p>根据角膜地形图仪成像系统对光谱响应 [<xref ref-type="bibr" rid="hanspub.18514-ref6">6</xref>] 、传输帧频、分辨率及数据传输的要求，选择面阵CCD传感器ICX445ALA作为图像采集设备。设计了AD和CPLD的时序框架 [<xref ref-type="bibr" rid="hanspub.18514-ref7">7</xref>] - [<xref ref-type="bibr" rid="hanspub.18514-ref10">10</xref>] 及单片机STM32的时序控制，实现了驱动电路的设计。利用USB2.0的固件驱动 [<xref ref-type="bibr" rid="hanspub.18514-ref11">11</xref>] [<xref ref-type="bibr" rid="hanspub.18514-ref12">12</xref>] ，完成了USB2.0的数据输出。控制单片机的I/O口，实现了LED背光源的开闭、左右眼的判别及图像的自动获取。最终检测表明，CCD图像清晰，USB2.0数据传输快速稳定，单片机辅助功能工作正常。</p></sec><sec id="s4"><title>2. 角膜地形图仪成像系统工作原理</title><p>图1所示为角膜地形图仪图像采集系统原理结构图。由环形阵列LED光源发出的光经漫反射后，照亮在一定距离外的眼球，并将Placido盘上的黑白条纹投射到角膜上，在人眼角膜上形成黑白条纹的像，经角膜反射后由透镜成像系统聚焦成像到CCD传感器上。由CCD传感器采集到的电信号经过驱动脉冲</p><p>图1. 角膜地形图仪成像系统原理图</p><p>作用下转移输出，并通过USB2.0传输到上位机，经过软件处理实现人眼角膜表面形貌的重构及各种数据处理。</p></sec><sec id="s5"><title>3. CCD驱动设计及USB2.0数据传输</title><p>选用SONY公司生产的ICX445ALA面阵CCD芯片作为角膜地形图仪中图像采集的传感器。CCD芯片中信号电荷的转移以及信号电荷的输出必须在驱动脉冲的作用下才能完成。利用单片机STM32、AD9949A及CPLD芯片实现CCD的驱动及数字信号采集，AD9949A与CPLD之间通过垂直同步、水平同步和基准时钟实现同步。通过配置AD内部寄存器，实现图像数字信号的采集，利用USB2.0的固件驱动结合单片机的控制实现与PC机之间的数据通信，满足了系统设计要求。</p><sec id="s5_1"><title>3.1. CCD驱动电路设计</title><p>采集系统中CCD驱动电路框图如图2所示。CCD的水平时钟信号和复位时钟信号由AD9949A提供，CPLD提供CCD的垂直时钟信号和选通信号，AD9949A和CPLD间的同步分别由垂直同步、水平同步和基准时钟实现。选用Altera公司的EPM240T100C5N CPLD芯片产生的时序电平不能满足面阵CCD传感器中的垂直移位寄存器的驱动电压(不为+5 V)，因此需要外加垂直时钟驱动芯片CXD3400n与之相匹配，将原本为TTL电平的XSG1、XSG2、VΦ1A、VΦ1B、VΦ2A、VΦ2B、VΦ3A、VΦ3B、VΦ4A、VΦ4B和ΦSUB信号转变成具有−8 V/0 V/+15 V三个等级的信号。其中XSG1、XSG2时序信号实现感光阵列中的电荷信号转移。由单片机STM32与AD9949A实现数字信号的获取，并通过STM32配置传输给USB2.0进行采集输出。</p></sec><sec id="s5_2"><title>3.2. CPLD时序仿真实现</title><p>CPLD采用硬件描述语言VERILOG来实现芯片ICX445ALA垂直时钟驱动时序和同步时钟驱动时序。这些时序信号为：XSG1、XSG2、VΦ1A、VΦ1B、VΦ2A、VΦ2B、VΦ3A、VΦ3B、VΦ4A、VΦ4B和ΦSUB。其中VΦ1A、VΦ1B、VΦ2A、VΦ2B、VΦ3A、VΦ3B、VΦ4A、VΦ4B是CCD中垂直寄存器转移时钟，控制垂直移位寄存器中的电荷信号移动。同时为了实现与AD间同步，添加同步信号VD、HD及时钟基准信号CLK。</p><p>图2. 采集系统中CCD驱动电路框图</p><p>应用Verilog硬件描述语言完成驱动时序的逻辑设计，采用QuartusⅡ软件系统进行了驱动时序发生器的功能仿真，仿真效果如图3所示。</p></sec><sec id="s5_3"><title>3.3. USB2.0数据传输</title><p>STM32提供了USB2.0全速接口模块，可支持最大传输速率12 Mb/s。针对该系列微控制器的USB2.0全速模块为其提供了一个完整的固件库和软件包USB-FS-Device开发套件。</p><p>USB2.0的固件库分别由内核层和应用接口层两部分组成，该固件库结构框图如图4所示。其中内核层管理应用USB标准协议与USB IP硬件实现两者间通信。在USB内核层中，可以使用构造函数指针的办法调用回调函数，通过该方式将USB内核层与应用接口层连接起来。应用接口层为用户提供了内核和最终应用之间的完整接口，对于不同设计方案可以对该层进行更改。通过对设备描述符、配置描述符、接口描述符和端点描述符及设备复位函数修改，添加相应的端点传输中断服务程序。实现本系统中USB2.0的数据采集。</p></sec></sec><sec id="s6"><title>4. 辅助控制电路设计</title><p>为了满足角膜地形图仪采集系统中CCD成像要求，获取清晰的Placido盘在人眼角膜上的像，图像采集工作更容易进行，设计了LED背光源及左右眼判别等辅助控制电路。并通过控制单片机的I/O口，实现LED背光源的开闭、左右眼的自动判别及图像采集状态的控制。</p><sec id="s6_1"><title>4.1. LED背光源照明及控制电路的设计</title><p>为满足CCD成像系统获得清晰明亮黑白相间的图像，在Placido盘的后表面提供灯光照明。光源采用60颗红色LED灯，排列成内圈6颗，中间14颗，外圈40颗的三组同心环形作为光源发光元件。红色LED具有高亮度、高发光效率、高单色性及寿命长等特点 [<xref ref-type="bibr" rid="hanspub.18514-ref13">13</xref>] [<xref ref-type="bibr" rid="hanspub.18514-ref14">14</xref>] ，同时满足CCD的光谱敏感要求，且对人的眼睛不会产生伤害。为实现LED照明亮度的稳定性，设计了一款开关稳压供电电路，该供电电路不仅能为LED供电，而且能够通过单片机的I/O口实现LED灯的开闭，既能够保护LED灯的使用寿命，又能节省电能。开关稳压供电电路原理图如图5所示。</p><p>整个电路由两部分组成，基于CS5173控制芯片的单端初级电感转换器(SEPIC)电路与开关控制电路。SEPIC电路用来实现对输入电压升降转变，开关控制电路控制LED灯的供电。</p></sec><sec id="s6_2"><title>4.2. 左右眼判断电路设计</title><p>角膜地形图仪对人眼进行测量时，由于人左右眼在结构及病理上的不同，在实际测量中要进行左右眼的标注，因此设计左右眼的判断电路就变得非常重要。其电路原理如图6所示。</p><p>图3. CCD驱动时序仿真图</p><p>图4. USB固件应用框图</p><p>红外LED发光管D1发出的光由反射面(由黑白两色组成，正中间是一块10*15 cm的白色区域，其余部分为黑色)。反射后被集成芯片IS471F接收。IS471F具有内置信号处理电路的光调制系统的光检测器件，该芯片对不同颜色的反射面反射光强差异产生不一样的电压值，白色为0 V，黑色为3 V。根据芯片IS471F接收的高低电平，从而获得左右区域的信息，然后将电平高低信号经过输入输出口存储在寄存器中，通过读取寄存器值就可以进行左右眼的识别。</p></sec></sec><sec id="s7"><title>5. 结论</title><p>本文在分析面阵CCD传感器ICX445ALA驱动时序的基础上，由AD提供CCD的水平驱动信号，CPLD提供垂直驱动信号，实现了ICX445ALA的驱动设计，利用USB2.0的固件驱动结合单片机的控制实现与PC机之间的数据通信。并根据角膜地形图仪对图像采集的要求，设计外部辅助控制电路。验证表明，该设计能够实现角膜地形图仪的图像采集、数据传输及辅助控制。通过搭建整个角膜地形图仪系统，如图7所示，采集到的模拟眼及真实人眼图像如图8、图9所示，较好地实现了角膜地形图仪中图像采集传输的要求。</p><p>图5. LED背光源控制电路图</p><p>图6. 左右眼判别电路原理图</p><p>图7. 角膜地形图仪系统</p><p>图8. 模拟眼图像</p><p>图9. 真实人眼图像</p></sec><sec id="s8"><title>基金项目</title><p>浙江省重大科技专项资助项目(2011C11048)。</p></sec><sec id="s9"><title>文章引用</title><p>隋成华,韩勇浩,徐丹阳. 角膜地形图仪中基于USB2.0传输方式的成像系统设计与实现 Design and Implementation of Image System Based on USB2.0 Transmission Mode in Corneal Topography[J]. 光电子, 2016, 06(03): 113-120. http://dx.doi.org/10.12677/OE.2016.63016</p></sec><sec id="s10"><title>参考文献 (References)</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.18514-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">陈晓科, 隋成华, 童建平, 等. 角膜图像采集系统中的CCD驱动设计[J]. 仪表技术与传感器, 2012(6): 98-100.</mixed-citation></ref><ref id="hanspub.18514-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">郑浩, 隋成华, 王河林, 等. 角膜地形图仪中调焦函数的选取及搜索方法[J]. 光学仪器, 2013, 35(3): 25-31.</mixed-citation></ref><ref id="hanspub.18514-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">马徽冠, 谢培英, 唐琰. 角膜地形图仪分析的数学模型分类及其在圆锥角膜中的意义[J]. 眼视光学, 2008, 10(6): 477-480.</mixed-citation></ref><ref id="hanspub.18514-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">袁敏杰, 陈骥. 激光位移传感器中线阵CCD驱动方法的设计[J]. 光电子, 2015(4): 23-31.</mixed-citation></ref><ref id="hanspub.18514-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">王庆有. CCD应用技术[M]. 天津: 天津大学出版社, 2000.</mixed-citation></ref><ref id="hanspub.18514-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">邹自立, 隋成华, 陈晓明. 基于线阵CCD的色度学测量系统的构建及其算法[J]. 应用物理, 2013(3): 141-148.</mixed-citation></ref><ref id="hanspub.18514-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">李晓杰, 任建伟, 刘洪兴, 等. 面阵CCD光谱响应测试及不确定度评估[J]. 中国激光, 2014.</mixed-citation></ref><ref id="hanspub.18514-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">顾一, 叶炜, 许煜. 基于CPLD的面阵CCD驱动时序发生器设计[J]. 光学仪器, 2008: 30-36.</mixed-citation></ref><ref id="hanspub.18514-ref9"><label>9</label><mixed-citation publication-type="other" xlink:type="simple">冉晓强, 汶德胜, 郑培云, 等. 基于CPLD的空间面阵CCD相机驱动时序发生器的设计与硬件实现[J]. 光子学报, 2007, 36(2): 364-367.</mixed-citation></ref><ref id="hanspub.18514-ref10"><label>10</label><mixed-citation publication-type="other" xlink:type="simple">王磊, 童子权. 基于CPLD的面阵CCD驱动电路的设计[J]. 仪表技术与传感器, 66-68, 82.</mixed-citation></ref><ref id="hanspub.18514-ref11"><label>11</label><mixed-citation publication-type="other" xlink:type="simple">罗朝霞, 高书莉. CPLD/FPGA设计及应用[M]. 北京: 人民邮电出版社, 2007.</mixed-citation></ref><ref id="hanspub.18514-ref12"><label>12</label><mixed-citation publication-type="other" xlink:type="simple">李虹, 常丹华, 黄震. 基于USB接口的CCD数据采集系统[J]. 仪表技术与传感器, 2005(8): 56-58.</mixed-citation></ref><ref id="hanspub.18514-ref13"><label>13</label><mixed-citation publication-type="other" xlink:type="simple">Streubel, K., Linder, N., Wirth, R., et al. (2002) High Brightness AlGaInP Light-Emitting Diodes. Journal of Selected Topics in Quantum Electonics, 8, 321-332. http://dx.doi.org/10.1109/2944.999187</mixed-citation></ref><ref id="hanspub.18514-ref14"><label>14</label><mixed-citation publication-type="other" xlink:type="simple">Ball, C.P., Levick, A.P., et al. (2013) Effect of Polytetrafluoroethylene (PTEE) Phase Transition at 19˚C on the Use of Spectralon as a Reference Standard for Reflectance. Applied Optics, 52, 4806-4812.</mixed-citation></ref></ref-list></back></article>