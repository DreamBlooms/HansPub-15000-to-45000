<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">SA</journal-id><journal-title-group><journal-title>Statistics and Application</journal-title></journal-title-group><issn pub-type="epub">2325-2251</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/SA.2019.82034</article-id><article-id pub-id-type="publisher-id">SA-29721</article-id><article-categories><subj-group subj-group-type="heading"><subject>SA20190200000_63510794.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>数学与物理</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于条件随机场的量化选股模型
   Quantitative Stock Picking Model Based on Conditional Random Fields
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>张</surname><given-names>宇思</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>梁</surname><given-names>满发</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib></contrib-group><aff id="aff2"><addr-line>华南理工大学数学学院，广东 广州</addr-line></aff><aff id="aff1"><addr-line>null</addr-line></aff><pub-date pub-type="epub"><day>29</day><month>03</month><year>2019</year></pub-date><volume>08</volume><issue>02</issue><fpage>296</fpage><lpage>302</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   作为特殊的条件随机场模型的隐马尔可夫模型是大奖章基金辉煌业绩背后的秘密武器之一，本文从金融程的角度出发，将隐马尔可夫模型引入到投资领域来预测个股未来的涨跌情况。假设涨和跌的股票各自都存在一种明确的模式，都分别可由一个HMM模型来描述，那么如果一个股票在表征上涨模式的HMM模型上的观测条件概率越大，说明该股票实际上涨的概率也越大。基于HMM模型构建了个股的HMM因子，并在沪深300成分股中通过在2016年到2018年历史回测的实证分析取得了不错的超额收益，从而说明条件随机场引入到量化选股中具有一定的预测能力。 As a special Conditional Random Field model, the Hidden Markov Model is one of the secret weapons behind the brilliant performance of the medallion fund. From the perspective of financial engineering, this paper introduces the Hidden Markov Model into the investment field to predict the future rising and falling situation of individual stocks. Assuming that each of the ups and downs has a clear pattern, which can be described by an HMM model, if the probability of a stock's observation on the HMM model characterizing the rising pattern is greater, the probability that the stock actually rises is also the bigger. Based on the HMM model, the HMM factor of individual stocks was constructed, and the empirical analysis of the historical back testing of the Shanghai and Shenzhen 300 constituent stocks from 2016 to 2018 achieved a good excess return, which indicated that the conditional random field introduced into the quantitative stock selection has a predictive ability. 
  
 
</p></abstract><kwd-group><kwd>条件随机场，金融工程，隐马尔可夫模型，上涨模式,  Conditional Random Field</kwd><kwd> Financial En-gineering</kwd><kwd> HMM</kwd><kwd> Rising Pattern</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于条件随机场的量化选股模型<sup> </sup></title><p>张宇思，梁满发</p><p>华南理工大学数学学院，广东 广州</p><p><img src="//html.hanspub.org/file/12-2580476x1_hanspub.png" /></p><p>收稿日期：2019年3月25日；录用日期：2019年4月9日；发布日期：2019年4月16日</p><disp-formula id="hanspub.29721-formula8"><graphic xlink:href="//html.hanspub.org/file/12-2580476x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>作为特殊的条件随机场模型的隐马尔可夫模型是大奖章基金辉煌业绩背后的秘密武器之一，本文从金融程的角度出发，将隐马尔可夫模型引入到投资领域来预测个股未来的涨跌情况。假设涨和跌的股票各自都存在一种明确的模式，都分别可由一个HMM模型来描述，那么如果一个股票在表征上涨模式的HMM模型上的观测条件概率越大，说明该股票实际上涨的概率也越大。基于HMM模型构建了个股的HMM因子，并在沪深300成分股中通过在2016年到2018年历史回测的实证分析取得了不错的超额收益，从而说明条件随机场引入到量化选股中具有一定的预测能力。</p><p>关键词 :条件随机场，金融工程，隐马尔可夫模型，上涨模式</p><disp-formula id="hanspub.29721-formula9"><graphic xlink:href="//html.hanspub.org/file/12-2580476x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2019 by authors and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/12-2580476x7_hanspub.png" /> <img src="//html.hanspub.org/file/12-2580476x8_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>股票市场的不确定性和不稳定性产生了庞大而且复杂的股票数据，其背后隐藏着众多有效的股票信息，挖掘出背后的价值能够帮助企业在分析企业的相关情况后有效地改变策略来提升竞争力，获得更好的形象特征。本文将统计中的条件随机场模型引入到投资中，从而构建出基于统计模型的量化投资策略。</p><p>文献 [<xref ref-type="bibr" rid="hanspub.29721-ref1">1</xref>] 提出了一种近似的组合技术方法构建混合模型，通过数据简约，竞争学习以及改进的期望最大化算法估计模型中的参数，利用贝叶斯规则将象元分到适当的区域中，从而完成分割。文献 [<xref ref-type="bibr" rid="hanspub.29721-ref2">2</xref>] 探讨了结合高斯有限混合模型与期望法，取得了很好的分割效果。郭松涛等人 [<xref ref-type="bibr" rid="hanspub.29721-ref3">3</xref>] 提出一种改进的小波域隐马尔可夫树模型，用于分割遥感图像，该法在降低了算法的时间复杂度的同时，也取得了很好的分割结果。文献 [<xref ref-type="bibr" rid="hanspub.29721-ref4">4</xref>] 提出了一种基于广义模糊Gibbs随机场模型理论，并将高阶邻域空问约束信息引入其中，为图像分割提供了一种新的思路。Lei Zhang，Qiang Ji [<xref ref-type="bibr" rid="hanspub.29721-ref5">5</xref>] 使用统一概率图模型来分割图像，将贝叶斯网络和条件随机场模型通过因子图组合成一个分割整体框架，取得了比较好的分割结果，为图像分割提供了一个新途径。同时 [<xref ref-type="bibr" rid="hanspub.29721-ref6">6</xref>] 使用贝叶斯网络自动和交互的分割图像，当面对比较复杂的图像时，使用自动分割效果，如果不理想，可以使用交互的方式对分割目标进一步分割，直至满意为止。</p><p>本文将语音识别的技术引入到股票涨跌预测中。假设上涨和下跌的股票各自都存在一种明确的模式，都分别可由一个HMM模型来描述。我们选择沪深300成分股的换手率、股价1日涨跌幅等6个价量指标作为模型观测值，选择股票池内上涨与下跌的样本训练表征上涨与下跌模式的HMM模型，通过构造出“上涨”条件因子进行选取，通过历史回测，取得了不错的投资效果。</p></sec><sec id="s4"><title>2. 隐马尔可夫模型</title><sec id="s4_1"><title>2.1. 基本假设</title><p>由于马尔可夫模型在许多应用中有局限，人们通过扩展提出了更有代表性的模型，叫做隐马尔可夫模型(HMM)。在HMM中，我们并不知道什么产生观测序列的。状态的数目，转移概率以及产生观测的状态是未知的。HMM的每一个状态与概率函数联系而不是将每一个状态与确定的输出结合。在时刻 t ，一个观察 o t 由概率函数 b j ( o t ) 产生，它与状态 j 有关，产生概率为：</p><p>b j ( o t ) = P ( o t | X t = j ) (1)</p><p>一个HMM包含5个元组： { S , K , Π , A , B } ：</p><p>1) S = { 1 , ⋯ , N } 为状态集合，在时刻 t 的状态定义为 s t ，</p><p>2) K = { k 1 , ⋯ , k M } 为输出字母，在离散的观测密度下， M 是观测可选择的数目，</p><p>3) 初始状态分布 Π = { π i } , i ∈ S 。 π i 定义为</p><p>π i = P ( s 1 = i ) (2)</p><p>4) 状态转移概率分布 A = { a i j } ,   i , j ∈ S</p><p>a i j = P ( s t + 1 = j | s t = i ) , 1 ≤ i , j ≤ N (3)</p><p>5) 观测符号概率分布 B = b j ( o t ) , j ∈ S 。对于每一个状态 j 产生观测的概率函数为：</p><p>b j ( o t ) = P ( o t | s t = j ) (4)</p><p>用HMM对问题进行建模后，并假设HMM通过生成了一组数据，我们能够计算观察序列的概率和可能的潜在状态序列。我们也可以根据观测数据来训练模型参数并获得更加精确的模型，然后用训练的模型来预测未知数据。</p></sec><sec id="s4_2"><title>2.2. 前向算法</title><p>给定一个模型 μ = ( A , B , Π ) 以及观测序列 O = ( o 1 , ⋯ , o T ) ，我们怎样有效计算给定模型中观测序列的概率，即 P ( O | μ ) 。</p><p>定义前向变量 α i ( t ) 为：</p><p>α i ( t ) = P ( o 1 o 2 ⋯ o t − 1 , s t = i | μ ) (5)</p><p>α i ( t ) 保存在给定观测序列 o 1 ⋯ o t − 1 时刻 t 状态为 i 的总概率。它是通过对网格节点处所有传入弧的概率求和来计算的。在每一个时刻 t 的前向变量能够通过归纳法计算，流程如下：</p><p>1) 初始化：</p><p>α i ( 1 ) = π i , 1 ≤ i ≤ N (6)</p><p>2) 归纳：</p><p>α j ( t + 1 ) = ∑ i = 1 N α i ( t ) a i j b j ( o t ) , 1 ≤ t ≤ T , 1 ≤ j ≤ N (7)</p><p>3) 更新时间 t = t + 1 ；如果 t &lt; T 返回第2步；否则终止算法。</p><p>4) 计算：</p><p>P ( O | μ ) = ∑ i = 1 N α i ( T ) (8)</p><p>这个前向算法需要 N ( N + 1 ) ( T − 1 ) + N 次乘法以及 N ( N − 1 ) ( T − 1 ) 次加法。复杂度为 O ( T N 2 ) 。</p></sec><sec id="s4_3"><title>2.3. Viterbi算法</title><p>Viterbi算法被研究用来寻找在给定观测序列 O = ( o 1 , o 2 , ⋯ , o T ) 最可能的状态序列 S ′ = ( s 1 , s 2 , ⋯ , s T ) arg max S ′ P ( S ′ | O , μ ) ；对于固定的观测序列最大化 arg max S ′ P ( S ′ , O | μ ) 就足够了。</p><p>定义变量</p><p>δ j ( t ) = max s 1 ⋯ s t − 1 P ( s 1 ⋯ s t − 1 , o 1 ⋯ o t , s t = j | μ ) (9)</p><p>完整的Viterbi算法如下：</p><p>1) 初始化</p><p>δ i ( 1 ) = π i b i ( o 1 ) , 1 ≤ i ≤ N (10)</p><p>ψ i ( 1 ) = 0 , 1 ≤ i ≤ N (11)</p><p>2) 归纳</p><p>δ j ( t ) = b j ( o t ) max 1 ≤ i ≤ N δ i ( t − 1 ) a i j (12)</p><p>ψ j ( t ) = arg max 1 ≤ i ≤ N [ δ i ( t − 1 ) a i j ] (13)</p><p>3) 更新时间</p><p>t = t + 1 (14)</p><p>如果 t ≤ T 返回第2步，否则结束算法。</p><p>4) 结束</p><p>P * = max 1 ≤ i ≤ N [ δ i ( T ) ] (15)</p><p>s T * = arg max 1 ≤ i ≤ N [ δ i ( T ) ] (16)</p><p>5) 路径回读</p><p>s t * = ψ t + 1 ( s t + 1 * ) (17)</p><p>当通过Viterbi算法有多条路径产生时，我们选择任意一条或选择最好的 n 步。</p></sec><sec id="s4_4"><title>2.4. Baum-Welch算法</title><p>为了迭代得出最佳模型 μ = ( A , B , π ) ，我们需要定义一些中间变量。定义 p t ( i , j ) , 1 ≤ t ≤ T , 1 ≤ i , j ≤ N 如下：</p><p>p t ( i , j ) = P ( s t = i , s t + 1 = j | O , μ ) (18)</p><p>这得出的是在给定模型 μ 以及观测序列 O 时，在时刻 t 状态为 i 以及时刻 t + 1 状态为 j 的概率。然后定义在给定模型 μ 以及观测序列 O 时，在时刻 t 状态为 i 的概率为 γ i ( t ) ：</p><p>γ i ( t ) = P ( s t = i | O , μ ) = ∑ j = 1 N P ( s t = i , s t + 1 = j | O , μ ) = ∑ j = 1 N p t ( i , j ) (19)</p><p>完整Baum-Welch算法的如下：</p><p>1) 初始化：随机选择 a i j ( 0 ) ， b j ( 0 ) ( k ) ， π i ( 0 ) ，得到模型 μ ( 0 ) = ( A ( 0 ) , B ( 0 ) , π ( 0 ) ) 。</p><p>2) 归纳</p><p>a i j ( n + 1 ) = ( ∑ t = 1 T p t ( i , j ) ) / ( ∑ t = 1 T γ i ( t ) ) (20)</p><p>b i ( n + 1 ) ( k ) = ( ∑ t : o t = k , 1 ≤ t ≤ T γ i ( t ) ) / ( ∑ t = 1 T γ i ( t ) ) (21)</p><p>π i = γ i ( 1 ) (22)</p><p>3) 更新：</p><p>n = n + 1 (23)</p><p>如果 ‖ μ ( n + 1 ) − μ ( n ) ‖ ≥ ε ( ε 为初定的阈值)返回第2步；否则终止算法；</p><p>4) 结束：得出模型的最终参数为 μ ( n + 1 ) = ( A ( n + 1 ) , B ( n + 1 ) , π ( n + 1 ) ) 。</p></sec></sec><sec id="s5"><title>3. 实证分析</title><p>本章将HMM的思想引入到预测股票的趋势中，然后根据预测指标来构造有效的投资策略。根据股票价格趋势的动量性与持续性，股价走势在一段时间内，涨和跌的股票各自都存在一种明确的模式与其对应，都分别可由一个HMM模型来描述；同时股票的行情数据以及基本面数据表现例如换手率、收益率、股票市值可由有限个服从马尔可夫过程的隐状态所决定，且满足齐次马尔可夫假设和观测独立性假设。因此金融中引入HMM模型是有效的。</p><sec id="s5_1"><title>3.1. HMM训练过程</title><p>通过隐马尔可夫模型来预测个股未来一段时间股价的涨跌。假设对于个股的持仓周期为 m 天，在交易日 t ，通过构造模型去预测 t + m 日个股股价相对于时刻 t 的涨跌。具体步骤如下：</p><p>1) 选取数据：假设观测序列长度为 k ，那么将每个股票的技术面信息以及基本面信息切分成日频的观测序列，每一日的信息向量作为特征向量对应HMM语音识别模型中的每一个观测值向量，取 t − k + 1 到 t 日的特征向量，获得长度为 k 的观测序列，对应HMM模型中的每一个观测序列。</p><p>2) 训练样本：对数据样本进行上涨与下跌模型样本的分割。在模型训练时，我们选择 t + m 日股价相对 t 日上涨的股票作为上涨模型的训练样本，根据多观测序列的训练算法训练出上涨模型的连续观测序列HMM参数；选择 t + m 日股价相对于 t 日下跌的股票作为下跌模型的训练样本，根据多观测序列的训练算法训练出下跌模型的连续观测序列HMM参数；</p><p>3) 模型预测：在进行实际预测时，在 t 日，我们分别将每个股票在 t − k + 1 到 t 日的信息向量即特征向量作为特征输入训练好的上涨模型和下跌模型中，计算出不同模型下观测到该观测序列的概率p(上涨)与 p ( 下 跌 ) 。如果p(上涨) &gt; p(下跌)，则说明该观测序列由上涨模型生成的概率更大，该股票在 t + m 日相对于 t 日上涨的概率大于下跌的概率；反之，则认为该股票下跌的概率大于上涨的概率。</p></sec><sec id="s5_2"><title>3.2. 策略设计及结果</title><p>本文选取了沪深300成分股的日频数据进行建模然后构建量化策略来实证分析。根据影响股票收益率的特征当中从技术面指标中选取的数据包括沪深300成分股的收盘价序列、开盘价序列、最高价序列、最低价序列；同时从基本面指标中选取的数据包括沪深300成分股的日换手率序列、日收盘时的流通市值序列。时间范围为2016.1.1~2018.8.30；</p><p>根据个股“上涨”模式与“下跌”模式的概率可以设计个股在模式下的条件概率，即“上涨”条件概率，它的思想是个股在未来一段时间的表明会上涨的概率。所以设计出对应的“上涨”条件因子：HMM = p(上涨) &#247; (p(上涨) + p(下跌))；</p><p>在沪深300成分股中，基于HMM模型选股策略即“上涨”条件因子策略过程如下：</p><p>1) 在调仓日 t 时，计算出当日沪深300成分股全部个股的“上涨”条件因子；</p><p>2) 选股时去除ST、PT股，去除停牌股票，去除上市未满一年股票，去除每股收益小于0股票；</p><p>3) 采取行业中性按照行业进行选股，根据“上涨”条件因子数据从大到小排名对成分股进行选取，从而挑选出排名前20%的股票进行投资；</p><p>4) 根据成分股的比例计算出每一个行业的占比 m i ；</p><p>5) 行业的股票等资金投入，第 i 个行业有 K 只股票投资，则行业的每只个股投入资金比例为 m i / K ；</p><p>6) 根据资金情况以及个股收盘价计算出调仓日个股买入的仓位数量。</p><p>7) 计算日收益率、基准收益率；然后计算年化收益率、最大回撤、夏普比、最长修复时间等指标策略净值图如图1所示。</p><p>图1. 基于HMM模型选股策略不对冲净值图</p><table-wrap id="table1" ><label><xref ref-type="table" rid="table1">Table 1</xref></label><caption><title> The indicator of “Up” conditional factor selection strategy based on HMM mode</title></caption><table><tbody><thead><tr><th align="center" valign="middle" ></th><th align="center" valign="middle" >年化收益率</th><th align="center" valign="middle" >夏普比</th><th align="center" valign="middle" >最大回撤</th></tr></thead><tr><td align="center" valign="middle" >HMM策略</td><td align="center" valign="middle" >7.86%</td><td align="center" valign="middle" >0.23</td><td align="center" valign="middle" >18.61%</td></tr><tr><td align="center" valign="middle" >沪深300指数</td><td align="center" valign="middle" >−1.33%</td><td align="center" valign="middle" >-0.30</td><td align="center" valign="middle" >26.43%</td></tr></tbody></table></table-wrap><p>表1. HMM模型“上涨”条件因子选股策略指标</p></sec></sec><sec id="s6"><title>4. 结论</title><p>HMM的思想引入到预测股票的趋势中，根据预测指标来构造一些有效的投资策略。根据股票价格趋势的动量性与持续性，股价走势在一段时间内，涨和跌的股票各自都存在一种明确的模式与其对应，都分别可由一个HMM模型来描述；同时股票的行情数据以及基本面数据表现例如换手率、收益率、股票市值可由有限个服从马尔可夫过程的隐状态所决定，且满足齐次马尔可夫假设和观测独立性假设。根据表1所示，运用HMM模型构造出的“上涨”条件因子进行选股策略中年化收益率为8.94%，最大回撤为8.61%，而指数年化收益为−1.33%，最大回撤为26.43%，策略的夏普比远远大于指数投资的夏普比，效果远远超过指数。用HMM模型进行选股更能促使策略抓住一致性趋势，给策略更好的抓准投资的时机，补充策略的缺陷与单一性。</p></sec><sec id="s7"><title>文章引用</title><p>张宇思,梁满发. 基于条件随机场的量化选股模型 Quantitative Stock Picking Model Based on Conditional Random Fields[J]. 统计学与应用, 2019, 08(02): 296-302. https://doi.org/10.12677/SA.2019.82034</p></sec><sec id="s8"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.29721-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">郭平. 贝叶斯概率图像分割中混合模型参数高效计算的研究[J]. 计算机科学, 2002, 29(8): 101-103.</mixed-citation></ref><ref id="hanspub.29721-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">郭平, 卢汉清. 贝叶斯概率图像自动分割研究[J]. 光学学报, 2002, 22(12): 1479-1483.</mixed-citation></ref><ref id="hanspub.29721-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">郭松涛, 孙强, 等. 基于改进小波域隐马尔可夫模型的遥感图像分割[J]. 电子与信息报, 2005, 27(2): 286-289.</mixed-citation></ref><ref id="hanspub.29721-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">林亚忠. 基于Gibbs随机场模型的医学图像分割新算法研究[D]: [博士学位论文]. 广州: 第一军医大学, 2004.</mixed-citation></ref><ref id="hanspub.29721-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">Zhang, L. and Ji, Q. (2010) Image Segmentation with a Unified Graphical Model. IEEE Transactions on Pattern Analysis and Machine In-telligence, 32, 1406-1425. &lt;br&gt;https://doi.org/10.1109/TPAMI.2009.145</mixed-citation></ref><ref id="hanspub.29721-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">Zhang, L. and Ji, Q. (2011) A Bayesian Network for Automatic and Interactive Image Segmentation. IEEE Transaction on Image Processing, 20, 2582-2593.&lt;br&gt; https://doi.org/10.1109/TIP.2011.2121080</mixed-citation></ref></ref-list></back></article>