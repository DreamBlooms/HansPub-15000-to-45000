<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">MOS</journal-id><journal-title-group><journal-title>Modeling and Simulation</journal-title></journal-title-group><issn pub-type="epub">2324-8696</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/MOS.2016.53010</article-id><article-id pub-id-type="publisher-id">MOS-18177</article-id><article-categories><subj-group subj-group-type="heading"><subject>MOS20160300000_64600931.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject><subject> 工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  交通控制硬件在环仿真系统设计与实现
  Simulation System Design and Implementation of Traffic Control Hardware-in-the-Loop
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>李</surname><given-names>发达</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>何</surname><given-names>坚</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>韩</surname><given-names>毅</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib></contrib-group><aff id="aff2"><addr-line>北京工业大学软件学院，北京</addr-line></aff><aff id="aff3"><addr-line>中福彩技术研究中心，北京</addr-line></aff><aff id="aff1"><addr-line>null</addr-line></aff><author-notes><corresp id="cor1">* E-mail:<email>jianhee@163.com(何坚)</email>;</corresp></author-notes><pub-date pub-type="epub"><day>08</day><month>08</month><year>2016</year></pub-date><volume>05</volume><issue>03</issue><fpage>73</fpage><lpage>80</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  针对交通控制策略仿真困难的问题，本文在分析硬件在环仿真原理的基础上，提出交通控制硬件在环仿真系统架构。其中，仿真控制软件作为整个系统的核心，负责仿真过程的控制、管理；交通控制机完成控制策略的发布与感应控制；微观仿真软件完成对控制策略的仿真评价；信号转换设备实现数字信号到模拟信号的转换，完成交通控制机与微观仿真软件之间的通信。最后本文以汉世通HST-3000交通控制机和VISSIM微观仿真软件为基础，开发了仿真控制软件，构建交通控制硬件在环仿真系统。实验证明该系统可以实现对交通控制策略的有效仿真，验证了仿真系统的有效性。
   Aiming at the difficulty of current traffic control strategies simulation, this paper proposes simu-lation system architecture of traffic control strategies hardware-in-the-loop after analyzing the principle of hardware-in-the-loop simulation. The simulation control software as the core of the whole system is responsible for simulation process control and management; the traffic controller completes traffic control strategies release and induction control; the microscopic simulation software completes the simulation and evaluation of traffic control strategies; the signal converter achieves digital signal to analog signal conversion and allows the communication between the traffic controller and microscopic simulation software. Finally, the simulation control software is developed and simulation system of traffic control strategies hardware-in-the-loop is built based on HST-3000 traffic controller and VISSIM microscopic simulation software. Experiments show that the system can achieve effective simulation of the traffic control strategies and verify the effectiveness of the simulation system.
 
</p></abstract><kwd-group><kwd>硬件在环，交通控制，交通仿真, Hardware-in-the-Loop</kwd><kwd> Traffic Control</kwd><kwd> Traffic Simulation</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>交通控制硬件在环仿真系统设计与实现<sup> </sup></title><p>李发达<sup>1</sup>，何坚<sup>1</sup>，韩毅<sup>2</sup></p><p><sup>1</sup>北京工业大学软件学院，北京</p><p><sup>2</sup>中福彩技术研究中心，北京</p><disp-formula id="hanspub.18177-formula151"><graphic xlink:href="http://html.hanspub.org/file/2-2570097x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>收稿日期：2016年7月17日；录用日期：2016年8月5日；发布日期：2016年8月8日</p><disp-formula id="hanspub.18177-formula152"><graphic xlink:href="http://html.hanspub.org/file/2-2570097x7_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>针对交通控制策略仿真困难的问题，本文在分析硬件在环仿真原理的基础上，提出交通控制硬件在环仿真系统架构。其中，仿真控制软件作为整个系统的核心，负责仿真过程的控制、管理；交通控制机完成控制策略的发布与感应控制；微观仿真软件完成对控制策略的仿真评价；信号转换设备实现数字信号到模拟信号的转换，完成交通控制机与微观仿真软件之间的通信。最后本文以汉世通HST-3000交通控制机和VISSIM微观仿真软件为基础，开发了仿真控制软件，构建交通控制硬件在环仿真系统。实验证明该系统可以实现对交通控制策略的有效仿真，验证了仿真系统的有效性。</p><p>关键词 :硬件在环，交通控制，交通仿真</p><disp-formula id="hanspub.18177-formula153"><graphic xlink:href="http://html.hanspub.org/file/2-2570097x8_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s3"><title>1. 引言</title><p>随着我国经济的发展，汽车数量不断增加，城市交通拥堵问题日益严重，信号交叉口是交通拥堵的主要因素之一 [<xref ref-type="bibr" rid="hanspub.18177-ref1">1</xref>] 。因此，对信号交叉口的交通控制策略进行优化是提高车辆通行效率、减少车辆延误的有效方法，并成为交通控制研究领域的热门课题。</p><p>交通控制硬件在环作为一种研究交通控制策略的方法，被广泛应用。硬件在环是一种实际控制器结合虚拟对象的半实物仿真方法，交通控制硬件在环是指实际的交通控制机和专业的仿真软件有机地结合在一起，形成仿真回路。</p><p>交通控制硬件在环最早是1995年Louisiana大学提出的，首次应用在交通仿真中 [<xref ref-type="bibr" rid="hanspub.18177-ref2">2</xref>] 。2000年D. Bullock提出了微观交通软件和交通控制机相结合的方法，实现对信号控制策略的准确评价 [<xref ref-type="bibr" rid="hanspub.18177-ref3">3</xref>] 。2007年美国Virginia大学首次将硬件在环应用在自适应控制系统评价研究，实现仿真系统对自适应控制交叉口的仿真评价 [<xref ref-type="bibr" rid="hanspub.18177-ref4">4</xref>] 。2011年Michael P. Hunter进一步将硬件在环应用在多路口的自适应控制系统评价研究 [<xref ref-type="bibr" rid="hanspub.18177-ref5">5</xref>] 。</p><p>国内硬件在环系统首先应用在汽车安全驾驶领域，2004年王建强等人首次开发了安全车距保持技术硬件在环仿真试验系统，用于车辆碰撞预警及性能分析 [<xref ref-type="bibr" rid="hanspub.18177-ref6">6</xref>] 。直到2009年硬件在环技术才应用到交通工程领域，于泉等人提出交通控制硬件在环仿真平台的设计方案 [<xref ref-type="bibr" rid="hanspub.18177-ref7">7</xref>] 。</p><p>综合国内外研究可以发现，国外相关的大学、科研机构从事交通控制硬件在环仿真系统研究，取得了一定的成绩，但在国内使用硬件在环技术对交通控制策略进行仿真评价的比较少。本文采用硬件在环的设计方法，以汉世通控制机和VISSIM仿真软件为基础，搭建交通控制硬件在环仿真系统。该系统可以实现对交通控制策略的仿真评价，对信号交叉口控制策略的应用及科研教学具有重要意义。</p></sec><sec id="s4"><title>2. 交通控制硬件在环仿真原理</title><p>交通控制硬件在环仿真系统主要由三部分组成：交通控制机、信号转换设备、微观交通仿真软件。其特点是把实际的控制器作为仿真系统的一部分，通过信号转换设备将交通控制机与专业仿真软件构成闭合回路，如图1所示。</p><p>图1. 硬件在环仿真系统组成</p><sec id="s4_1"><title>2.1. 交通控制机</title><p>交通控制机是控制策略的提供者，是整个硬件在环仿真系统的基础，控制策略的优化和实施最后都要反映到交通控制机。</p><p>交通控制机具备交通信号灯状态输出接口和检测器信息输入接口，控制策略在交通控制机内部设定好之后可以通过信号灯状态输出接口以串口的形式输出，检测器信息输入接口可以实时获取检测到的车辆信息，通过车辆检测信息触发交通控制机内部的控制算法实时变化控制策略，达到交通控制的目的。</p></sec><sec id="s4_2"><title>2.2. 信号转换设备</title><p>信号转换设备是硬件在环仿真系统的关键，是交通控制机和微观仿真软件联系的纽带 [<xref ref-type="bibr" rid="hanspub.18177-ref8">8</xref>] 。信号转换设备一般有两种接口：车辆检测信息转换接口和交通信号灯状态传输接口，其中信号灯状态传输接口可以设计在信号转换设备上，也可以设计在上位机控制软件中。</p><p>微观仿真软件的虚拟检测器以0/1数字的方式输出车辆检测信息，其中1表示检测器在单位时间内检测到车辆到达，0表示没有检测到车辆到达。车辆检测信息转换接口将数字信号转化成模拟信号，以高低电平信号形式传送到交通控制机，其中低电平表示有车辆到达，高电平表示无车辆到达。信号灯态传输接口主要是依据交通信号控制机的通信协议，开发嵌入式通信程序，对数据包进行解析、检验、传输，传输方式采用串口通信。</p></sec><sec id="s4_3"><title>2.3. 微观仿真软件</title><p>微观仿真软件是专业的交通仿真软件，通过仿真模型进行交通流的仿真。</p><p>微观仿真软件能够再现每个车辆的运动状态，如车辆的变道、直行、超车、转弯等，能够表现现实中的复杂的交通状况，并且提供虚拟车辆检测器，检测车辆到达状况。仿真软件能够对交通信号控制策略进行有效的评价，依据反馈的评价结果，通过重复试验可得到理想的交通信号控制策略 [<xref ref-type="bibr" rid="hanspub.18177-ref9">9</xref>] 。</p></sec><sec id="s4_4"><title>2.4. 硬件在环数据通道</title><p>交通控制硬件在环仿真系统中，有两条数据通道，一条为控制策略数据通道，另一条为车辆检测信息数据通道。控制策略数据通道是以交通控制机作为起点，交通控制机通过信号灯状态输出接口与信号转换设备相连，传递控制策略；信号转换设备又通过交通信号灯状态传输接口与仿真软件相连，传递控制策略。</p><p>车辆检测信息数据通道，以仿真软件为起点，车辆检测数据通过信号转换设备的车辆检测器信息转换接口传递给交通控制机。</p><p>本文在分析硬件在环仿真原理的基础上，提出一种新的系统架构，其中控制策略数据通道设计在上位机控制软件端，车辆检测信息数据通道设计在信号转换设备上，实现交通控制硬件在环仿真系统，使用户更加方便地实施交通控制策略的仿真评价。</p></sec></sec><sec id="s5"><title>3. 系统的总体设计</title><p>交通控制硬件在环仿真系统主要由仿真控制软件、交通控制机、信号转换设备、VISSIM微观仿真软件四部分组成，总体架构如图2所示。</p><sec id="s5_1"><title>3.1. 交通控制机</title><p>本文采用汉世通HST-3000交通控制机，汉世通控制机具有交通信号灯状态输出接口和车辆检测器信息输入接口。交通控制机内部配时方案控制算法可依据实际道路交叉口的交通状况自行设计不同的交通控制策略，车辆检测器信息的输入接口可使交通控制机具有感应控制功能。</p></sec><sec id="s5_2"><title>3.2. 仿真控制软件</title><p>仿真控制软件是直接与用户交互，负责整个仿真过程的控制、管理，是整个硬件在环仿真系统的核心。仿真控制软件功能设计包括：策略控制、仿真设置、通信设置、仿真评价。</p><sec id="s5_2_1"><title>3.2.1. 策略控制模块</title><p>策略控制模块主要是根据通信协议完成对交通控制机控制策略的监控及控制，能够使用户直接设置交通控制机的控制策略，如相位设置、相序设置、固定配时设置、感应配时设置、日时方案设置。</p></sec><sec id="s5_2_2"><title>3.2.2. 仿真设置模块</title><p>仿真设置模块实现的是仿真之前需要进行的一系列的基本设置，包括串口通信设置，如串口号、波特率、校验码、停止位；时钟校准，设置系统时间和交通控制机时间的一致性，保证仿真结果的准确性；仿真底图的设置，如加载绘制好的路网模型文件；仿真参数的设置，如车流量、车辆构成、仿真速度、精度、周期。</p><p>图2. 硬件在环仿真系统架构</p></sec><sec id="s5_2_3"><title>3.2.3. 通信模块</title><p>通信模块主要通过相位匹配和虚拟检测器信息匹配，完成交通控制机、信号转换设备、VISSIM仿真软件之间的数据通信。相位匹配指交通控制机信号灯状态与VISSIM仿真模型信号灯组的匹配，虚拟检测器信息匹配指虚拟检测器与交通控制机输入接口的匹配。数据通信的方向为交通控制机的控制策略上传到VISSIM仿真软件，VSSIM仿真软件的虚拟检测信息下传到信号转换设备，再由信号转换设备经过数模转换后下传到交通控制机。</p></sec><sec id="s5_2_4"><title>3.2.4. 仿真评价模块</title><p>仿真评价模块完成仿真评价结果的输出，以图形的方式展示，评价指标包括车辆的平均旅行时间、平均排队长度、平均延误时间等。</p></sec></sec><sec id="s5_3"><title>3.3. VISSIM</title><p>仿真软件采用德国PTV公司的VISSIM，VISSIM是一种基于时间间隔的和驾驶行为的仿真工具，广泛应用于城市交通仿真建模。VISSIM具有COM接口，允许开发者调用内部API，构建基于VISSIM的仿真应用程序。</p></sec><sec id="s5_4"><title>3.4. 信号转换设备</title><p>信号转换设备采用单片机技术进行设计，只具备车辆检测器信息转换接口，交通信号灯状态传输接口没有设计在信号转换设备上，设计在仿真控制软件中。信号转换设备由单片机、通讯接口、电源组成，单片机可实现数字信号到模拟信号的转换，再由单片机内置的I/O将转换后的模拟信号输出到交通控制机。</p></sec></sec><sec id="s6"><title>4. 仿真控制软件的设计与实现</title><p>仿真控制软件是整个硬件在环仿真系统的核心，用户可以直接在仿真控制软件中实施控制策略的仿真与评价。</p><p>软件开发工具采用的Microsoft Visual Studio 2012，Microsoft Visual Studio是微软推出的软件开发工具，基于组件的开发技术，适用可视化应用程序的开发，开发语言采用C#。仿真控制软件开发依赖于交通控制机通信协议与VISSIM仿真软件。</p><sec id="s6_1"><title>4.1. 基于通信协议的软件模块实现</title><p>论文本文中采用的汉世通HST-3000交通控制机，其协议是基于NTCIP协议框架，是一种交谈式通讯传输，错误侦知采用LRC纵向冗余校验。策略控制模块、通信模块中交通控制机和VISSIM之间的数据通信是通过交谈式通讯算法完成，其步骤可总结如下：</p><p>1) 仿真控制软件将通讯指令进行LRC编码；</p><p>2) 将编码后的指令以串口通讯的形式发送到交通控制机；</p><p>3) 交通信号控制机收到通讯指令首先检测指令有无错误；</p><p>4) 若正确立即以正认知码框回报仿真控制软件，并立即回报结果，结束交谈试通讯；</p><p>5) 若有误则以负认知码框回报仿真控制软件，并返回步骤1)重新发送通讯指令。</p></sec><sec id="s6_2"><title>4.2. 基于VISSIM的软件模块实现</title><p>VISSIM仿真软件提供COM接口，允许外部应用程序通过组件对象模型调用VISSIM的内部仿真功能。仿真控制软件应用到的组件对象模型，如图3所示。</p><p>仿真设置模块中RouteDecision对象用于设置北、东、南、西四个方向的左转、直行、右转的车流量数据。VehicleInput对象用于设置北、东、南、西四个方向的总车流量数据，如北向的总的车流量=北向的左转车流量+北向的直行车流量+北向的右转车流量。TrafficComposition对象用于设置仿真环境中车辆的构成，本文中设置了四种车辆分别是大车、中车、小车、公交车。Speed、Period、Resolution对象是分别设置仿真速度、仿真周期、仿真精度。</p><p>通讯模块中Detector对象可用来接收虚拟检测器检测到的车辆到达信息，1表示有车经过，0表示没有车辆经过，设置多个检测器可以定义成数组的形式。SignalGroup对象设置仿真软件信号灯组的灯色，可用来实现交通控制机灯态和仿真软件显示灯态的一致性，每一个SignalGroup代表一个灯态。</p><p>仿真评价模块中Evaluation对象为仿真评价指标，能够完成评价指标的设定，比如车辆的平均延误时间，车辆平均旅行时间，车辆的平均排队长度。AnalyzerEvaluation对象为仿真评价结果输出，仿真结束后可将评价结果保存为离线文件，比如set_AttValue (“FILE”, true)。</p></sec></sec><sec id="s7"><title>5. 系统实验</title><p>本仿真控制软件，具有良好的用户交互界面，使用方便。软件运行的主界面如图4所示。</p><sec id="s7_1"><title>5.1. 交通控制策略验证</title><p>本文测试采用的控制策略描述如下：相序为两相位的控制策略，其中第一相位为南北方向的绿灯，</p><p>图3. VISSIM组件对象模型</p><p>图4. 仿真控制软件主界面</p><p>东西方向的红灯，第二相位为东西方向的绿灯，南北方向的红灯，两相位的绿灯时间均为25秒，黄灯时间为3秒，红灯时间为2秒。仿真运行时信号灯状态的输出结果如图5所示。</p><p>从仿真运行信号灯状态输出结果图中可以看出信号灯组SG 5-SG8为第一相位，SG 1-SG84为第二相位，绿灯时间为25秒，黄灯时间为3秒，红灯时间为2秒，仿真结果输出的信号灯状态与交通控制机的控制策略完全吻合。说明系统能够真实地反映交通控制机的控制策略。</p></sec><sec id="s7_2"><title>5.2. 交通控制策略评价</title><p>在不同的车流量条件下，进行多次仿真实验，选取车辆的平均延误时间、车辆的平均排队长度为评价指标，得到平均延误时间变化图及车辆平均排队长度变化图，如图6、图7所示。</p><p>从图6可以看出，车辆的平均延误时间随着车流量的增大而增大，并且在车流量较小的时候，感应控制效果较好；从图7可以看出，车辆的平均排队长度随着车流量的增大而增大，并且在车流量较大的时候感应控制效果较好。综合来看，车辆的平均延误时间及平均排队长度与车流量呈正相关，符合交通流感应控制理论。说明系统能够真实地反映信号控制的实际效果，达到仿真评价的目的。</p><p>图5. VISSIM信号灯状态输出结果</p><p>图6. 车辆平均延误时间变化图</p><p>图7. 车辆平均排队长度变化图</p></sec></sec><sec id="s8"><title>6. 结论</title><p>交通控制硬件在环仿真系统，以仿真控制软件为核心，通过信号转换设备将交通控制机与专业的微观仿真软件联系起来，借助专业的交通仿真软件完成对实际交通控制策略的仿真与评价，由于引入了实际的交通控制机，有效解决了实际交通控制策略仿真困难的难题，为交通控制领域提供了良好的教学和科研工具。</p></sec><sec id="s9"><title>基金项目</title><p>北京市科委科技计划项目(Z131100004513002)。</p></sec><sec id="s10"><title>文章引用</title><p>李发达,何坚,韩毅. 交通控制硬件在环仿真系统设计与实现Simulation System Design and Implementation of Traffic Control Hardware-in-the-Loop[J]. 建模与仿真, 2016, 05(03): 73-80. http://dx.doi.org/10.12677/MOS.2016.53010</p></sec><sec id="s11"><title>参考文献 (References)</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.18177-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">余贵珍, 任毅龙, 王云鹏, 等. 多路口交通信号控制硬件在环仿真系统[J]. 公路交通科技, 2013, 30(1): 110-125.</mixed-citation></ref><ref id="hanspub.18177-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">Urbanik, T. and Venglar, S. (1995) Advanced Technology Application: The “Smart” Diamond. Proceedings of Institute of Transportation Engineers 65th Annual Meeting, Washington DC, August 1995, 164-168.</mixed-citation></ref><ref id="hanspub.18177-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">Bullock, D. and Urbanik, T. (2000) Hard-ware-in-the-Loop Evaluation of Traffic Signal Systems. Proceedings of the 10th International Conference on Road Transport Infor-mation and Control, April 2000, Commonwealth Institute, London, 177-181. &lt;br&gt;http://dx.doi.org/10.1049/cp:20000128</mixed-citation></ref><ref id="hanspub.18177-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">Yun, I., Best, M. and Park, B. (2007) Evaluation of Adaptive Maximum Feature in Actuated Traffic Controller: Hardware-in-the-Loop Simulation. American Journal of Science, 43, 134-140. &lt;br&gt;http://dx.doi.org/10.3141/2035-15</mixed-citation></ref><ref id="hanspub.18177-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">Hunter, M.P., Roe, M. and Wu, S.K. (2010) Hardware-in-the-Loop Simulation Evaluation of Adaptive Signal Control. Transportation Research Record, 2192, 167-176. &lt;br&gt;http://dx.doi.org/10.3141/2192-16</mixed-citation></ref><ref id="hanspub.18177-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">王建强, 李克强, 高锋, 等. 安全车距保持技术硬件在环仿真试验系统[J]. 汽车工程, 2004, 26(5): 577-580.</mixed-citation></ref><ref id="hanspub.18177-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">于泉, 荣建. 交通控制硬件在环实时仿真平台设计[J]. 重庆工学院学报: 自然科学版, 2009, 23(10): 57-60.</mixed-citation></ref><ref id="hanspub.18177-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">王浩, 唐棠, 王玲, 等. 交通控制硬件在环仿真综述[J]. 交通标准化, 2013(1): 89-91.</mixed-citation></ref><ref id="hanspub.18177-ref9"><label>9</label><mixed-citation publication-type="other" xlink:type="simple">宋竹, 秦志光, 邓伟伟, 等. 微观交通仿真系统的近邻查询算法[J]. 计算机应用, 2015, 35(2): 572-577.</mixed-citation></ref></ref-list></back></article>