<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">CSA</journal-id><journal-title-group><journal-title>Computer Science and Application</journal-title></journal-title-group><issn pub-type="epub">2161-8801</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/CSA.2019.910220</article-id><article-id pub-id-type="publisher-id">CSA-32739</article-id><article-categories><subj-group subj-group-type="heading"><subject>CSA20191000000_98854775.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject></subj-group></article-categories><title-group><article-title>
 
 
  一种基于单片机的新型绿色节能LED台灯设计
  New Green Energy-Saving LED Lamp Design Based on MCU
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>彭</surname><given-names>龑</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>张</surname><given-names>景扩</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>任</surname><given-names>爽</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><addr-line>null</addr-line></aff><aff id="aff2"><addr-line>四川轻化工大学计算机学院，四川 自贡</addr-line></aff><pub-date pub-type="epub"><day>30</day><month>09</month><year>2019</year></pub-date><volume>09</volume><issue>10</issue><fpage>1960</fpage><lpage>1968</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   论文融合计算机技术、移动平台开发技术、绿色照明系统技术等，设计一种基于单片机的新型绿色节能LED台灯。该系统下位机通过与热释电传感器、光敏电阻传感器和蓝牙传输等硬件相结合来达到手动调节和自动感应调节功能，系统上位机利用安卓平台对LED台灯进行手动控制和语音控制。 This paper integrates computer technology, mobile platform development technology and green lighting system technology, designs a type of LED desk lamp based on 51 MCU. The lower system achieves the functions of manual adjustment and automatic adjustment incorporated pyroelectric sensor, LDR (light dependent resistor) and bluetooth transmitter, the upper system makes the led desk lamp get functions of manual control and speech control based on android platform. 
  
 
</p></abstract><kwd-group><kwd>LED台灯，单片机，安卓平台，PWM调光，语音控制, Led Desk Lamp</kwd><kwd> Mcu</kwd><kwd> Android Platform</kwd><kwd> Pwm Lighting Control</kwd><kwd> Speech Control</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>一种基于单片机的新型绿色节能LED 台灯设计<sup> </sup></title><p>彭龑，张景扩，任爽</p><p>四川轻化工大学计算机学院，四川 自贡</p><p><img src="//html.hanspub.org/file/18-1541534x1_hanspub.png" /></p><p>收稿日期：2019年10月8日；录用日期：2019年10月23日；发布日期：2019年10月30日</p><disp-formula id="hanspub.32739-formula38"><graphic xlink:href="//html.hanspub.org/file/18-1541534x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>论文融合计算机技术、移动平台开发技术、绿色照明系统技术等，设计一种基于单片机的新型绿色节能LED台灯。该系统下位机通过与热释电传感器、光敏电阻传感器和蓝牙传输等硬件相结合来达到手动调节和自动感应调节功能，系统上位机利用安卓平台对LED台灯进行手动控制和语音控制。</p><p>关键词 :LED台灯，单片机，安卓平台，PWM调光，语音控制</p><disp-formula id="hanspub.32739-formula39"><graphic xlink:href="//html.hanspub.org/file/18-1541534x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2019 by author(s) and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/18-1541534x7_hanspub.png" /> <img src="//html.hanspub.org/file/18-1541534x8_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>全球能源短缺忧虑的背景下，节约能源是我们面临的重要问题。LED光源具有产品颜色一致性好、节能、环保、寿命长等特点，其应用代表节能绿色照明趋势。本设计基于LED光源，加上外部环境感应模块以及蓝牙传输模块，并利用安卓设备对其控制，实现选择最合适的LED台灯亮度状态，达到满足人们生活品质要求和节能目的。</p></sec><sec id="s4"><title>2. LED设计原理及技术路线</title><p>论文融合计算机技术、移动平台开发技术、绿色照明系统技术等，设计一种基于51单片机的新型绿色节能LED台灯。LED台灯下位机融合光线感应和热释电模块，结合脉宽宽度调制(Pulse Width Modulation，PWM)技术和驱动电路设计，并通过热释电传感器与光敏电阻传感器、蓝牙传输等硬件相结合实现手动和自动感应调节功能。上位机利用安卓平台对新型绿色节能LED台灯进行手动控制和语音控制。设计原理如图1。</p><p>图1. 新型节能LED台灯设计原理</p></sec><sec id="s5"><title>3. LED台灯下位机的设计</title><sec id="s5_1"><title>3.1. LED台灯下位机整体设计</title><p>考虑设计的LED台灯具备智能性和低功耗性，其下位机以STC89C51RC单片机为控制芯片，整体电路设计原理如图2，包括按键、复位、晶振、光敏、蓝牙通信、热释电、LED驱动等模块。</p><p>软件设计采用模块化结构，编程语言为C语言，开发环境为Keil，通过STC_ISP将程序下载到单片机内 [<xref ref-type="bibr" rid="hanspub.32739-ref1">1</xref>]。下位机软件工作流程如图3。</p></sec><sec id="s5_2"><title>3.2. PWM调光和驱动电路设计</title><p>本设计根据脉宽宽度调制(PWM)原理 [<xref ref-type="bibr" rid="hanspub.32739-ref2">2</xref>]，将每一个脉冲看成是均匀分布的32份高低电平组成，每1份对应的时间为0.5 ms，定义变量PWM来计算定时器中断的次数，利用PWM的计数值作为高电平输出时间参考值，从而产生需要的占空比。设计使用S9012 (NPN)三极管，其硬件设计如图4，将其基极连接至单片机的P3.5端口。当单片机发送低电平至基极将会让LED电路导通并起到放大作用，保证设计中16个并联的LED灯能够正常工作。相反，当基极接收到高电平，整个三极管驱动电路动作在截止状态，使得LED进入熄灭状态。相比于传统的采用改变正向电流调光技术，设计能提供更大的调光范围和更好的线性度，且颜色一致性好、亮度级别高、LED驱动器转换效率高等特点。</p><p>图2. LED台灯模块组成</p><p>图3. LED台灯上位机软件工作流程图</p><p>图4. 三极管放大电路</p></sec><sec id="s5_3"><title>3.3. 外界特征感应设计</title><p>当外界环境变亮，灯自动变暗至熄灭，反之亦然。为达到该要求，设计采用光敏电阻。光敏阻值变化与电阻分压，需通过模拟信号模数转换，以及可调电阻光线限值的调节，最终将信号给单片机处理。根据ADC0832的时序反复调试，保证LED调至合适状态。光线感应电路如图5。</p><p>图5. 光线感应电路</p><p>外界特征感应采用HC-SR501热释电红外线传感器探测人体信号。但热释电红外传感器输出的信号较弱(毫伏级)，单片机难以识别(伏级别)。为此，设计通过采用信号处理芯片BISS0001对热释电红外传感器输出的信号进行放大、滤波后得到伏级别的电压信号，单片机根据得到伏级的电压信号做出相应的判断 [<xref ref-type="bibr" rid="hanspub.32739-ref3">3</xref>]。为热释电电路如图6。</p><p>图6. 基于HC-SR501热释电电路设计原理</p></sec><sec id="s5_4"><title>3.4. 蓝牙信号传输设计</title><p>通信模块采用HC-05系列芯片，设计原理如图7。首先进行时钟、定时器等初始化，然后进行蓝牙交互，即本地蓝牙从设备等待对方发送建链请求，并同意建立连接句柄后进行数据交换。蓝牙交互传输完成的数据提取出来进行相应操作。</p><p>图7. 基于蓝牙信号传输电路设计原理</p></sec></sec><sec id="s6"><title>4. LED台灯上位机软件与算法设计</title><sec id="s6_1"><title>4.1. LED台灯上位机软件设计</title><p>上位软件设计采用Java语言，开发环境为Eclipse。首先进行上位机Activity的配置、监听事件等初始化，之后需判断是否和下位机HC-05蓝牙设备保证正常的通讯。当建立正常通讯后进入操作界面，选择操作方式进入下一步执行状态。若点击back按钮，则会进入模式选择界面，然后重新执行上一步 [<xref ref-type="bibr" rid="hanspub.32739-ref4">4</xref>]。上位机软件流程如图8。</p><p>图8. LED台灯上位机软件设计流程</p></sec><sec id="s6_2"><title>4.2. 语音识别算法设计</title><p>语音信号处理流程如图9。包括语音信号预处理、语音端点检测、语音特征提取、语音模型库选择、语音模式匹配。</p><p>图9. 语音信号处理流程</p><sec id="s6_2_1"><title>4.2.1. 预处理</title><p>语音信号随时间变化而变化，每个音频之间存在不连续性。在较短时间段内，话音信号可近似其特性基本保持不变(即话音信号的“瞬时平稳性”)。为强化话音信号抽样附近的波形，弱化其余波形部分，则需对信号进行加窗处理 [<xref ref-type="bibr" rid="hanspub.32739-ref5">5</xref>]。常用窗函数有矩形窗、海宁窗和汉明窗。矩形窗主瓣较窄，具有较高的频率分辨率，但有较高的旁瓣，相邻谐波会因能量泄漏而导致互相叠加或抵消等比较严重的干化。与矩形窗相比，汉明窗加窗处理后可得到的相对纯净的频谱，为此设计选用汉明窗。</p></sec><sec id="s6_2_2"><title>4.2.2. 信号去噪</title><p>信号中存在的噪声在信号检测中不可避免，而最大程度的减少噪声的干扰成为信号检测中关键的一步。设计采用谱减法去噪，即在假定加性噪声与短时平稳的语言信号相互独立的情况下，从带噪语音的功率谱中去除噪声获得较纯净的语音 [<xref ref-type="bibr" rid="hanspub.32739-ref6">6</xref>]。谱减法基本处理过程如图10。</p><p>图10. 基本谱减法原理</p><p>假设带噪语音 y ( t ) ，纯净语音 s ( t ) ，噪声信号 n ( t ) ，则有：</p><p>y ( t ) = s ( t ) + n ( t ) (1)</p><p>用 Y ( ω ) 、<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/18-1541534x24_hanspub.png" xlink:type="simple"/></inline-formula>、 N ( ω ) 分别表示 y ( t ) 、 s ( t ) 、 n ( t ) 的傅里叶变换，则可得：</p><p>Y ( ω ) = S ( ω ) + N ( ω ) (2)</p><p>因假定信号与加性噪声为相互独立，则有：</p><p>| Y ( ω ) | = | S ( ω ) | + | N ( ω ) | (3)</p><p>如果用 P y ( ω ) 、 P s ( ω ) 、 P n ( ω ) 分别表示<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/18-1541534x34_hanspub.png" xlink:type="simple"/></inline-formula>、 s ( t ) 、 n ( t ) 的功率谱，则有：</p><p>P y ( ω ) = P s ( ω ) + P n ( ω ) (4)</p><p>由于平稳噪声的功率谱在发声前和发声期间可认为基本不变，则功率谱 P n ( ω ) ：</p><disp-formula id="hanspub.32739-formula40"><label>(5)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/18-1541534x39_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s6_2_3"><title>4.2.3. 端点检测</title><p>语音信号一般分为浊音段、无声段和清音段。浊音段是声带振动发出对应的语音信号段，无声段是背景噪声段，清音段是空气在口腔中的冲击、摩擦发出的语音信号段。清音段和无声段的波形特点明显不同，清音段信号在幅度上变化剧烈，穿越零电平次数也多，无声段信号变化较为缓慢。端点检测指首先判断有声还是无声。如果有声，则需判断是清音还是浊音。论文根据过零率和短时能量两个特征进行端点检测 [<xref ref-type="bibr" rid="hanspub.32739-ref7">7</xref>]。</p><p>定义语音信号<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/18-1541534x40_hanspub.png" xlink:type="simple"/></inline-formula>分帧后得到第i帧语音信号为 y i ( n ) 。则第i帧语音信号 y i ( n ) 的短时能量：</p><p>E ( i ) = ∑ n = 0 L − 1 y i 2 ( n ) , 1 | n | f n (6)</p><p>过零率是指样本数值改变符号的次数。同样定义语音信号 x ( n ) 分帧后得到第i帧语音信号 y i ( n ) 。其过零率为：</p><p>Z ( i ) = ∑ n = 0 L − 1 | s g n [ y i ( n ) ] − s g n [ y i ( n − 1 ) ] | , 1 ≤ i ≤ f (7)</p><p>式中 s g n [ ] 是符号函数</p><p>s g n [ x ] = { 1           x &gt; 0 − 1       x &lt; 0 (8)</p></sec><sec id="s6_2_4"><title>4.2.4. 特征参数提取</title><p>语音识别用语音特征梅尔倒谱系数(Mel-Frequency Cepstral Coefficients, MFCC)。该参数相比基于声道模型的LPCC (Linear Prediction Cepstral Coefficients)具有更好的鲁邦性，且当信噪比降低时具有较好的识别性能。MFCC特征参数提取原理如图11 [<xref ref-type="bibr" rid="hanspub.32739-ref8">8</xref>]。</p><p>图11. MFCC特征参数提取原理</p><p>(1) 对输入语音信号进行分帧、加窗以及离散傅立叶变换获得频谱分布信息。设语音信号的离散傅里叶变换为：</p><disp-formula id="hanspub.32739-formula41"><label>(9)</label><graphic position="anchor" xlink:href="//html.scirp.org/file/18-1541534x66_hanspub.png"  xlink:type="simple"/></disp-formula><p>式中 x ( n ) 为输入的语音信号，N为傅立叶变换的点数。</p><p>(2) 求能量谱(频谱幅度的平方)。</p><p>(3) 利用三角形滤波器组(见图12)分析上述步骤获得的能量谱。</p><p>图12. Mel 频率滤波器组</p><p>定义一个有M个滤波器的滤波器组(滤波器的个数和临界带的个数相近) [<xref ref-type="bibr" rid="hanspub.32739-ref9">9</xref>]，中心频率为 f ( m , m = 1 , 2 , ⋯ , M ) ，设计取 M = 24 。各 f ( m ) 之间的间隔随着m值减小而缩小，随着m值增大而增宽。三角滤波器的频率响应为：</p><p>H m ( k ) = { 0 , k &lt; f ( m − 1 ) 2 ( k − f ( m − 1 ) ) ( f ( m + 1 ) − f ( m − 1 ) ) ( f ( m ) − f ( m − 1 ) ) , f ( m − 1 ) ≤ k ≤ f ( m ) 2 ( f ( m + 1 ) − k ) ( f ( m + 1 ) − f ( m − 1 ) ) ( f ( m + 1 ) − f ( m ) ) , f ( m ) ≤ k ≤ f ( m + 1 ) 0 , k ≥ f ( m + 1 ) (10)</p><p>其中 ∑ m = 0 M − 1 H m ( k ) = 1 。</p><p>(4) 计算每个滤波器组输出的对数能量：</p><disp-formula id="hanspub.32739-formula42"><label>(11)</label><graphic position="anchor" xlink:href="//html.scirp.org/file/18-1541534x64_hanspub.png"  xlink:type="simple"/></disp-formula><p>(5) 经离散余弦变换(DCT)得到MFCC系数：</p><disp-formula id="hanspub.32739-formula43"><label>(12)</label><graphic position="anchor" xlink:href="//html.scirp.org/file/18-1541534x65_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s6_2_5"><title>4.2.5. 语音信号匹配</title><p>在时间序列中，若语音信号波形长度相等则语音较容易匹配(如图13，a点对应b点)。但匹配过程中，语音识别领域表现为不同人的语速不同(如图14)。因为语音信号具有随机性，传统的欧几里得测距无法有效地求出两个时间序列之间的距离，如图14实线的“a”点对应虚点线的“b”点才是正确的。论文采用DTW (Dynamic Time Warping)找到这两个波形对齐的点，并正确计算它们的距离。</p><p>图13. 动态匹配示意图(长度相等)</p><p>DTW是将距离测度和时间规整计算相结合的一种非线性规整技术 [<xref ref-type="bibr" rid="hanspub.32739-ref10">10</xref>]，它寻找一个规整函数 i m = Φ ( i n ) ，将测试矢量的时间轴n非线性地映射到参考模板的时间轴m上，并使规整函数满足：</p><p>D = min Φ ( i n ) ∑ i n = 1 N d ( T ( i n ) , R ( Φ ( i n ) ) ) (13)</p><p>D为最优时间规整下的两矢量距离。因DTW不断地计算两矢量的距离以寻找最优的匹配路径，故求出的是两矢量匹配时累积距离最小所对应的规整函数，从而保证了它们之间存在的最大声学相似性，并避免时长不同而可能引入的误差。</p><p>图14. 动态匹配示意图(长度不相等)</p></sec></sec></sec><sec id="s7"><title>5. 结论</title><p>本文所设计的新型绿色节能LED台灯，照明控制实现了手动控制和自动感应控制。下位机通过与热释电传感器、光敏电阻传感器和蓝牙传输器等硬件相结合来达到手动调节和自动感应调节功能。上位机通过安卓平台对LED台灯进行手动控制和语音控制。该LED台灯提供更宽的调光范围和更好的线性度，具有省电、亮度高、LED驱动器转换效率高等特点。</p></sec><sec id="s8"><title>基金项目</title><p>本研究由自贡市科技局科技计划(2018CXJD04)提供资助。</p></sec><sec id="s9"><title>文章引用</title><p>彭 龑,张景扩,任 爽. 一种基于单片机的新型绿色节能LED台灯设计New Green Energy-Saving LED Lamp Design Based on MCU[J]. 计算机科学与应用, 2019, 09(10): 1960-1968. https://doi.org/10.12677/CSA.2019.910220</p></sec><sec id="s10"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.32739-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">孙少杰, 裴玖玲. 基于PWM技术的LED线性调光电路的设计[J]. 电子制作, 2016(13): 24-25.</mixed-citation></ref><ref id="hanspub.32739-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">柴远波, 贾宇飞, 单坡. 基于单片机的LED自适应调光系统[J]. 电子设计工程, 2015(12): 187-190.</mixed-citation></ref><ref id="hanspub.32739-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">赵巧妮. 基于单片机热释电红外安防报警器的设计[J]. 科技广场, 2016(2): 71-73.</mixed-citation></ref><ref id="hanspub.32739-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">胡越, 周腾鹤, 梁东升. 基于蓝牙的安卓平台智能灯控制系统设计与实现[J]. 物联网技术, 2016, 6(5): 14-16.</mixed-citation></ref><ref id="hanspub.32739-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">宋知用. MATLAB在语音信号分析与合成中的应用[M]. 北京: 北京航空航天大学出版社, 2013.</mixed-citation></ref><ref id="hanspub.32739-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">孙一鸣, 吴杨扬, 李平. 基于改进双门限法的语音端点检测研究[J]. 长春理工大学学报(自然科学版), 2016(1): 92-95.</mixed-citation></ref><ref id="hanspub.32739-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">骆俊. 基于FPGA的语音单字识别系统的设计和研究[D]: [硕士学位论文]. 沈阳: 东北大学, 2012.</mixed-citation></ref><ref id="hanspub.32739-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">单燕燕. 基于LPC和MFCC得分融合的说话人辨认[J]. 计算机技术与发展, 2016(1): 39-42.</mixed-citation></ref><ref id="hanspub.32739-ref9"><label>9</label><mixed-citation publication-type="other" xlink:type="simple">张芝旖, 姚恩涛, 石玉. 小波分析和MFCC融合的声音信号端点检测算法[J]. 电子测量技术, 2016, 39(7): 62-66.</mixed-citation></ref><ref id="hanspub.32739-ref10"><label>10</label><mixed-citation publication-type="other" xlink:type="simple">王君伟. 基于DTW的红外自动乘客计算方法研究[D]: [硕士学位论文]. 上海: 上海交通大学, 2008.</mixed-citation></ref></ref-list></back></article>