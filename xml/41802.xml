<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">GST</journal-id><journal-title-group><journal-title>Geomatics Science and Technology</journal-title></journal-title-group><issn pub-type="epub">2329-549X</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/GST.2021.92006</article-id><article-id pub-id-type="publisher-id">GST-41802</article-id><article-categories><subj-group subj-group-type="heading"><subject>GST20210200000_32335338.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  全站仪数据后处理解算碎部点研究
  Research on Solution Detail Point for Data Post-Processing of Total Station
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>王</surname><given-names>立伟</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>韩</surname><given-names>易</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><addr-line>天津市测绘院有限公司，天津</addr-line></aff><aff id="aff2"><addr-line>null</addr-line></aff><pub-date pub-type="epub"><day>23</day><month>04</month><year>2021</year></pub-date><volume>09</volume><issue>02</issue><fpage>52</fpage><lpage>58</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  随着网络RTK技术的普及，测量作业可采用RTK的形式布设图根控制点，传统方法会将WGS-84坐标通过网络平台转为地方坐标，然后手动输入全站仪进行摆站测绘地物点坐标。针对全站仪数据后处理问题，以南方测绘NTS-391R全站仪数据为例，本文提出一种基于Fortran语言的后处理解算碎部点方法，该方法利用Fortran语言开发了一套软件，该软件仅由外业输入虚拟控制点坐标代号，就可通过内业后处理的方式解算碎部点坐标。实验表明，该方法大大节省了外业作业时间，提高了工作效率，同时减少了人为出错的可能，为全站仪数据后处理提供了一种新思路。&lt;br/&gt;With the popularization of network RTK technology, RTK can be used to arrange mapping root control points in survey operation. The traditional method will transform WGS-84 coordinates into local coordinates through the network platform. Then the total station is inputted manually to survey the coordinates of the ground objects. Aiming at the problem of data post-processing of total station, taking the data of NTS-391R total station of southern surveying and mapping as an example, this paper proposes a method of post-processing calculating the detail points based on Fortran language. This method uses Fortran language to develop a set of software. The software only inputs the coordinate code of virtual control point by field work, and then solves the coordinates of detail points by post-processing by interior work. The experiment shows that this method can save field work time, improve work efficiency, reduce the possibility of human error, and provide a new idea for data post-processing of total station.
 
</p></abstract><kwd-group><kwd>网络RTK，全站仪，数据后处理，NTS-391R，Fortran, Network RTK</kwd><kwd> Total Station</kwd><kwd> Data Post-Processing</kwd><kwd> NTS-391R</kwd><kwd> Fortran</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>摘要</title><p>随着网络RTK技术的普及，测量作业可采用RTK的形式布设图根控制点，传统方法会将WGS-84坐标通过网络平台转为地方坐标，然后手动输入全站仪进行摆站测绘地物点坐标。针对全站仪数据后处理问题，以南方测绘NTS-391R全站仪数据为例，本文提出一种基于Fortran语言的后处理解算碎部点方法，该方法利用Fortran语言开发了一套软件，该软件仅由外业输入虚拟控制点坐标代号，就可通过内业后处理的方式解算碎部点坐标。实验表明，该方法大大节省了外业作业时间，提高了工作效率，同时减少了人为出错的可能，为全站仪数据后处理提供了一种新思路。</p></sec><sec id="s2"><title>关键词</title><p>网络RTK，全站仪，数据后处理，NTS-391R，Fortran</p></sec><sec id="s3"><title>Research on Solution Detail Point for Data Post-Processing of Total Station<sup> </sup></title><p>Liwei Wang, Yi Han</p><p>Tianjin Surveying and Mapping Institute Co., Ltd, Tianjin</p><p><img src="//html.hanspub.org/file/2-2840300x4_hanspub.png" /></p><p>Received: Feb. 18<sup>th</sup>, 2021; accepted: Apr. 13<sup>th</sup>, 2021; published: Apr. 23<sup>rd</sup>, 2021</p><p><img src="//html.hanspub.org/file/2-2840300x5_hanspub.png" /></p></sec><sec id="s4"><title>ABSTRACT</title><p>With the popularization of network RTK technology, RTK can be used to arrange mapping root control points in survey operation. The traditional method will transform WGS-84 coordinates into local coordinates through the network platform. Then the total station is inputted manually to survey the coordinates of the ground objects. Aiming at the problem of data post-processing of total station, taking the data of NTS-391R total station of southern surveying and mapping as an example, this paper proposes a method of post-processing calculating the detail points based on Fortran language. This method uses Fortran language to develop a set of software. The software only inputs the coordinate code of virtual control point by field work, and then solves the coordinates of detail points by post-processing by interior work. The experiment shows that this method can save field work time, improve work efficiency, reduce the possibility of human error, and provide a new idea for data post-processing of total station.</p><p>Keywords:Network RTK, Total Station, Data Post-Processing, NTS-391R, Fortran</p><disp-formula id="hanspub.41802-formula107"><graphic xlink:href="//html.hanspub.org/file/2-2840300x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2021 by author(s) and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY 4.0).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/2-2840300x7_hanspub.png" /> <img src="//html.hanspub.org/file/2-2840300x8_hanspub.png" /></p></sec><sec id="s5"><title>1. 引言</title><p>全站仪作为集光、机、电为一体的高技术测量仪器，在测绘行业中具有极为重要的应用，可以直接测量出测站点至目标点的水平角、垂直角、斜距、平距以及高差。</p><p>随着网络RTK技术的普及，在几分钟甚至更短时间内即可获得图根控制点的WGS84坐标，为了测量碎部点的坐标，传统的作业思路是：首先需要将WGS-84坐标转为地方坐标，然后手动输入全站仪进行摆站测绘地物点坐标。</p><p>然而，上述作业流程存在两个明显的缺点，一是需要等待坐标转换完成后才可以进行全站仪作业，大大增加了外业作业时间；二是每一次摆站都需要手工输入或导入控制点和后视点的地方坐标系坐标，极大增加了外业观测的繁琐程度和出错可能 [<xref ref-type="bibr" rid="hanspub.41802-ref1">1</xref>]。针对以上存在的问题，本文通过数据后处理的方式通过内业解算所有地物碎部点的坐标，全站仪外业测量过程中只需输入控制点的代号即可，不需要输入准确的控制点坐标，控制测量和碎步测量得以同步进行 [<xref ref-type="bibr" rid="hanspub.41802-ref2">2</xref>]，简化了外业操作步骤，缩短测量时间，减少了人为出错的可能。传统方法与本文方法外业流程对比如图1所示。</p><p>图1. 传统方法与本文方法外业流程对比</p></sec><sec id="s6"><title>2. 南方测绘NTS-391R全站仪数据简介</title><p>本模板仅针对采用A4纸型的论文版式。请务必确保您的论文采用A4幅面(21厘米 &#215; 28.5厘米)进行排版。从全站仪中导出的原始数据为txt文本的形式，里面含有基本的作业信息，另外还含有摆站点坐标、后视点坐标以及至目标点的角度、距离等信息，具体数据格式如表1所示。</p><table-wrap id="table1" ><label><xref ref-type="table" rid="table1">Table 1</xref></label><caption><title> NTS-391R raw data forma</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >标注符</th><th align="center" valign="middle" >标识符中含有的信息</th></tr></thead><tr><td align="center" valign="middle" >JOB</td><td align="center" valign="middle" >工作名，文件保存路径的描述</td></tr><tr><td align="center" valign="middle" >DATA</td><td align="center" valign="middle" >日期，时间</td></tr><tr><td align="center" valign="middle" >NAME</td><td align="center" valign="middle" >测量员姓名</td></tr><tr><td align="center" valign="middle" >INST</td><td align="center" valign="middle" >仪器型号标识</td></tr><tr><td align="center" valign="middle" >UNITS</td><td align="center" valign="middle" >(单位)米/英尺，度、哥恩、密尔</td></tr><tr><td align="center" valign="middle" >SCALE</td><td align="center" valign="middle" >格网因子，比例因子，高程</td></tr><tr><td align="center" valign="middle" >ATMOS</td><td align="center" valign="middle" >温度(℃)，气压(hPa)</td></tr><tr><td align="center" valign="middle" >STN</td><td align="center" valign="middle" >点号，仪器高，测站点标识符</td></tr><tr><td align="center" valign="middle" >XYZ</td><td align="center" valign="middle" >X (东坐标)，Y (北坐标)，Z (高程)</td></tr><tr><td align="center" valign="middle" >BKB</td><td align="center" valign="middle" >点名，后视方位角，后视角度</td></tr><tr><td align="center" valign="middle" >BS</td><td align="center" valign="middle" >点号[，目标高]</td></tr><tr><td align="center" valign="middle" >FS</td><td align="center" valign="middle" >点号，目标高，点号编码[，串号]</td></tr><tr><td align="center" valign="middle" >SS</td><td align="center" valign="middle" >点号，目标高，点号编码[，串号]</td></tr><tr><td align="center" valign="middle" >SD</td><td align="center" valign="middle" >HA (水平角)，VA (垂直角)，SD (斜距)</td></tr></tbody></table></table-wrap><p>表1. NTS-391R原始数据格式</p><p>计算碎部点三维坐标，主要依据的是极坐标原理和三角高程原理，用到的参数是表一中的STN、XYZ、BKB、SS、SD五个参数，这五个参数依次代表测站点代号、测站点和后视点坐标、后视点代号、碎部点代号及目标高、测站点到后视点的水平角、垂直角及斜距。</p></sec><sec id="s7"><title>3. 坐标计算原理</title><p>图2. 极坐标原理示意图</p><p>如图2所示，为了计算碎部点C的平面坐标，首先需要计算出 A B → 的坐标方位角 α A B ，如式(1)所示 [<xref ref-type="bibr" rid="hanspub.41802-ref3">3</xref>] (为了公式表达的简洁性，本文所有公式均忽略π以及弧度和度之间的相互转换)。</p><p>α A B = α tan y B − y A x B − x A (1)</p><p>根据 A B → 所在象限的不同，编写程序时需要分多种情况进行判断，具体情况见表2。</p><table-wrap id="table2" ><label><xref ref-type="table" rid="table2">Table 2</xref></label><caption><title> Azimuth calculatio</title></caption><table><tbody><thead><tr><th align="center" valign="middle"  colspan="2"  >A、B坐标关系</th><th align="center" valign="middle" >α A B</th></tr></thead><tr><td align="center" valign="middle"  rowspan="3"  >x A &lt; x B</td><td align="center" valign="middle" >y A &lt; y B</td><td align="center" valign="middle" >α A B = α tan | y B − y A | | x B − x A |</td></tr><tr><td align="center" valign="middle" >y A = y B</td><td align="center" valign="middle" >0</td></tr><tr><td align="center" valign="middle" >y A &gt; y B</td><td align="center" valign="middle" >α A B = 360 − α tan | y B − y A | | x B − x A |</td></tr><tr><td align="center" valign="middle"  rowspan="3"  >x A = x B</td><td align="center" valign="middle" >y A &lt; y B</td><td align="center" valign="middle" >90</td></tr><tr><td align="center" valign="middle" >y A = y B</td><td align="center" valign="middle" >任意值(程序忽略此种情况)</td></tr><tr><td align="center" valign="middle" >y A &gt; y B</td><td align="center" valign="middle" >270</td></tr><tr><td align="center" valign="middle"  rowspan="3"  >x A &gt; x B</td><td align="center" valign="middle" >y A &lt; y B</td><td align="center" valign="middle" >α A B = 180 − α tan | y B − y A | | x B − x A |</td></tr><tr><td align="center" valign="middle" >y A = y B</td><td align="center" valign="middle" >180</td></tr><tr><td align="center" valign="middle" >y A &gt; y B</td><td align="center" valign="middle" >α A B = 180 + α tan | y B − y A | | x B − x A |</td></tr></tbody></table></table-wrap><p>表2. 方位角计算</p><p>方位角计算程序：</p><p>function azimuth(x1，y1，x2，y2)</p><p>implicitnone</p><p>real(8) ：： x1，y1，x2，y2</p><p>real(8) ：：azimuth</p><p>real(8)，parameter ：：pi=3.1415926</p><p>if (x1==x2) then</p><p>if (y1</p><p>azimuth=90</p><p>else if (y1&gt;y2) then</p><p>azimuth=270</p><p>end if</p><p>else if (x1</p><p>if (y1</p><p>azimuth=atan2(abs(y2-y1)，abs(x2-x1))</p><p>azimuth=180*azimuth/pi</p><p>else if (y1==y2) then</p><p>azimuth=0</p><p>else if (y1&gt;y2) then</p><p>azimuth=atan2(abs(y2-y1)，abs(x2-x1))</p><p>azimuth=360-180*azimuth/pi</p><p>end if</p><p>else if (x1&gt;x2) then</p><p>if (y1</p><p>azimuth=atan2(abs(y2-y1)，abs(x2-x1))</p><p>azimuth=180-180*azimuth/pi</p><p>else if (y1==y2) then</p><p>azimuth=180</p><p>else if (y1&gt;y2) then</p><p>azimuth=atan2(abs(y2-y1)，abs(x2-x1))</p><p>azimuth=180+180*azimuth/pi</p><p>end if</p><p>end if</p><p>end</p><p>原始数据中直接给出的是A、C之间斜距SD，此时需要根据A、C之间的垂直角VA计算得到A、C之间的平距SP，如式(2)所式：</p><p>S P = sin ( V A ) ∗ S D (2)</p><p>设A、C在X方向的坐标增量为dx，在Y方向的坐标增量为dy，则坐标增量的计算需要分以下几种情况进行考虑，具体如表3所示。</p><table-wrap id="table3" ><label><xref ref-type="table" rid="table3">Table 3</xref></label><caption><title> Calculation of coordinate increment of broken point</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >碎部点方位角 α A B + θ</th><th align="center" valign="middle" >碎部点坐标增量dx、dy</th></tr></thead><tr><td align="center" valign="middle" >0 ≤ α A B + θ ≤ 90 or 0 ≤ α A B + θ − 360 ≤ 90</td><td align="center" valign="middle" >d x = S P ∗ | cos ( α A B + θ ) | d y = S P ∗ | sin ( α A B + θ ) |</td></tr><tr><td align="center" valign="middle" >90 &lt; α A B + θ ≤ 180 or 90 &lt; α A B + θ − 360 ≤ 180</td><td align="center" valign="middle" >d x = − 1 ∗ S P ∗ | cos ( α A B + θ ) | d y = S P ∗ | sin ( α A B + θ ) |</td></tr><tr><td align="center" valign="middle" >180 &lt; α A B + θ ≤ 270 or 180 &lt; α A B + θ − 360 ≤ 270</td><td align="center" valign="middle" >d x = − 1 ∗ S P ∗ | cos ( α A B + θ ) | d y = − 1 ∗ S P ∗ | sin ( α A B + θ ) |</td></tr><tr><td align="center" valign="middle" >270 &lt; α A B + θ ≤ 360 or 270 &lt; α A B + θ − 360 ≤ 360</td><td align="center" valign="middle" >d x = S P ∗ | cos ( α A B + θ ) | d y = − 1 ∗ S P ∗ | sin ( α A B + θ ) |</td></tr></tbody></table></table-wrap><p>表3. 碎部点坐标增量计算</p><p>根据坐标增量此时可按式(3)计算得到碎部点C的平面坐标：</p><p>x C = x A + d x y C = y A + d y (3)</p><p>依据三角高程原理，如图3所示，碎部点C的高程计算式为 [<xref ref-type="bibr" rid="hanspub.41802-ref3">3</xref>] [<xref ref-type="bibr" rid="hanspub.41802-ref4">4</xref>]：</p><p>H C = H A + h A C = H A + S ⋅ tan α + i − ν (4)</p><p>式中： A C 、 H C 分别代表A点和C点高程，S代表A、C两点间水平距离， h A C 代表A、C两点间高差，i代表仪器高， ν 代表目标高。</p><p>图3. 三角高程原理示意图</p></sec><sec id="s8"><title>4. 实例应用</title><p>外业在某测区内采用网络RTK模式测得两个控制点坐标KZ1，KZ2，然后分别以KZ2和KZ1作为摆站点和后视点，量取仪器高随便输入两个虚拟的三维坐标后开始测量，分别测量一个房角点FJ和一个支点Z1；然后在Z1上摆站，以KZ2作为后视，量取仪器高再次随便输入两个虚拟的三维坐标，测量一个围墙点WQ。</p><p>内业处理数据时，首先利用解算平台将KZ1、KZ2的WGS84坐标解算为地方平面坐标系坐标，然后直接运行软件调用程序所在文件夹内的控制点坐标文件，即可直接解算出所有碎部点坐标。由于Fortran语言是面向数值计算和工程计算领域的高级语言 [<xref ref-type="bibr" rid="hanspub.41802-ref5">5</xref>]，本文没有在混合界面的开发上花费大量时间，而是采用VS2015平台将其编译为Release形式的可运行程序，只要将EXE程序、控制点坐标文件、全站仪原始文件放在一个文件夹下，双击运行即可直接输出结果。</p><p>图4显示的是原始数据以及程序运行后所输出的过程检查文件，图5是最终输出的成果文件。</p><p>图4. 全站仪导出的部分原始文件及程序输出的过程检查文件</p><p>图5. 标准试验系统结果曲线</p></sec><sec id="s9"><title>5. 结语</title><p>城市测量用的最多的仪器就是全站仪，全站仪在建筑工程施工等领域都有着不可替代的应用。本文使得在外业没有已知点坐标的情况下虚拟观测成为可能，全站仪外业测量主要是记录保存必要的边、角信息，而把坐标的解算留到内业处理，极大地提高了外业测量的效率，减少了人为出错的可能，为全站仪数据后处理提供了一种新思路。</p></sec><sec id="s10"><title>文章引用</title><p>王立伟,韩 易. 全站仪数据后处理解算碎部点研究Research on Solution Detail Point for Data Post-Processing of Total Station[J]. 测绘科学技术, 2021, 09(02): 52-58. https://doi.org/10.12677/GST.2021.92006</p></sec><sec id="s11"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.41802-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">言龙, 戴陶, 等. 全站仪与RTK碎部点比测精度分析[J]. 城市勘测, 2011, 8(4): 111-113.</mixed-citation></ref><ref id="hanspub.41802-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">陈劲林, 何婵军, 许浩烈. 全站仪碎部点观测数据后处理[J]. 地理空间信息, 2012, 10(2): 144-147.</mixed-citation></ref><ref id="hanspub.41802-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">潘正风, 杨正尧, 等. 数字测图原理与方法[M]. 武汉: 武汉大学出版社, 2004.</mixed-citation></ref><ref id="hanspub.41802-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">高开强, 徐泮林, 丁鹏文. 全站仪三角高程测量方法及精度分析[J]. 测绘与空间地理信息, 2018, 41(12): 201-204+207.</mixed-citation></ref><ref id="hanspub.41802-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">Chapma, S.J. Fortran95/2003程序设计[M]. 北京: 中国电力出版社, 2009.</mixed-citation></ref></ref-list></back></article>