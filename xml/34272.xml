<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">CSA</journal-id><journal-title-group><journal-title>Computer Science and Application</journal-title></journal-title-group><issn pub-type="epub">2161-8801</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/CSA.2020.102033</article-id><article-id pub-id-type="publisher-id">CSA-34272</article-id><article-categories><subj-group subj-group-type="heading"><subject>CSA20200200000_61058779.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于天空区域分割的单幅图像去雾方法
  Single Image Dehazing Method Based on Sky Region Segmentation
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>梁</surname><given-names>腾飞</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>张</surname><given-names>延华</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib></contrib-group><aff id="aff2"><addr-line>沈阳化工大学信息工程学院，辽宁 沈阳</addr-line></aff><aff id="aff1"><addr-line>null</addr-line></aff><pub-date pub-type="epub"><day>31</day><month>01</month><year>2020</year></pub-date><volume>10</volume><issue>02</issue><fpage>325</fpage><lpage>333</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   对于暗通道先验不适合天空区域，导致透射率偏小使复原的无雾图像色彩变暗问题。提出对天空区域精准割据，按不同的区域分别估计大气光强度去雾处理。改进了阈值分割方法使区分天空域与非天空域更加准确。将分割后产生的白边用融合方法处理，减少了分界处白边效应，使得图片去雾后更加自然。试验结果表明，分割速度较快，能够达到良好的去雾效果且对于天空区域没有明显的色块，去雾后图像更加自然清晰。 For the dark channel, a priori is not suitable for the sky area, resulting in a small transmittance and darkening the color of the restored fog-free image. Based on the segmentation of the sky re-gion, it is proposed to separately estimate the atmospheric intensity defogging process according to different regions. Improved threshold segmentation method makes it more accurate to distinguish sky domain from non-sky domain. The white edge generated after segmentation is processed by the fusion method, which reduces the white edge effect at the boundary and makes the picture more natural after defogging. The experimental results show that the segmentation speed is fast, can achieve a good defogging effect and has no obvious color patches for the sky area, and the image is more natural and clear after defogging. 
  
 
</p></abstract><kwd-group><kwd>去雾，暗原色先验，阈值分割优化，导向滤波, Defog</kwd><kwd> Dark Channel Prior</kwd><kwd> Threshold Segmentation Optimization</kwd><kwd> Guided Image Filtering</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于天空区域分割的单幅图像去雾方法<sup> </sup></title><p>梁腾飞，张延华</p><p>沈阳化工大学信息工程学院，辽宁 沈阳</p><p>收稿日期：2020年2月2日；录用日期：2020年2月17日；发布日期：2020年2月24日</p><disp-formula id="hanspub.34272-formula43"><graphic xlink:href="//html.hanspub.org/file/15-1541659x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>对于暗通道先验不适合天空区域，导致透射率偏小使复原的无雾图像色彩变暗问题。提出对天空区域精准割据，按不同的区域分别估计大气光强度去雾处理。改进了阈值分割方法使区分天空域与非天空域更加准确。将分割后产生的白边用融合方法处理，减少了分界处白边效应，使得图片去雾后更加自然。试验结果表明，分割速度较快，能够达到良好的去雾效果且对于天空区域没有明显的色块，去雾后图像更加自然清晰。</p><p>关键词 :去雾，暗原色先验，阈值分割优化，导向滤波</p><disp-formula id="hanspub.34272-formula44"><graphic xlink:href="//html.hanspub.org/file/15-1541659x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2020 by author(s) and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY 4.0).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/15-1541659x7_hanspub.png" /> <img src="//html.hanspub.org/file/15-1541659x8_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>计算机视觉系统在雾霾天气进行工作时，由于空气中的颗粒导致光线散射，颗粒对光线的吸收导致光线的衰减，大量信息丢失，使得系统不能正常的工作。这也使图像处理算法无法正常的处理，因此对雾天图像清晰化和减少设备对环境的依赖具有较高的研究意义。</p><p>对于雾天清晰化处理的图像去雾方法主要可分为以下两类：一类是对图像进行增强：包括全局、局部化增强。这两种增强都是基于直方图均衡化算法：将图中像素总个数少的像素进行灰度压缩，使图像中像素总个数多的灰度进行拉宽，再把这种非线性拉伸后的灰度级通过直方图均匀分布以达到去雾的效果 [<xref ref-type="bibr" rid="hanspub.34272-ref1">1</xref>]。一类是图像复原：包括偏微分方程方法，先验信息方法，深度关系方法。先验信息方法研究人员取得了很好的成果 [<xref ref-type="bibr" rid="hanspub.34272-ref2">2</xref>] [<xref ref-type="bibr" rid="hanspub.34272-ref3">3</xref>] [<xref ref-type="bibr" rid="hanspub.34272-ref4">4</xref>]，包括Tan等通过基于晴朗天气下和有雾天气下大气光的变化基于目标和视觉系统的距离建立物理模型，提高有雾图像的局部对比度，在一定程度上达到将有雾图像恢复到原图像 [<xref ref-type="bibr" rid="hanspub.34272-ref5">5</xref>]。Fattal等假定约束条件为：透射率和表面投影与介质局部统计无关，利用独立成分分析和马尔可夫随机场进行图像复原 [<xref ref-type="bibr" rid="hanspub.34272-ref6">6</xref>] [<xref ref-type="bibr" rid="hanspub.34272-ref7">7</xref>]。He等是对户外无雾图像大量的研究与统计，提出了暗通道算法达到去雾效果，即这些图像都会存在一些像素值很低的像素，取得了很好的去雾效果，但图像中有大面积明亮区域时得到的大气光强度A不准确导致恢复图像有问题 [<xref ref-type="bibr" rid="hanspub.34272-ref8">8</xref>]。</p><p>本文研究基于先验信息方法中He提出的暗原色先验原理进行改进。提出对天空区域进行割据的算法：基于最大类间方差法进行形态学膨胀的改进对天空区域和非天空区域准确分割，然后对不同区域采用不同的方法获取大气光强度A，通过导向滤波算法获取细化的透射率，最后采用融合方式将处理后的天空域与非天空域进行白边消除。</p></sec><sec id="s4"><title>2. 基于暗原色先验模型</title><sec id="s4_1"><title>2.1. 大气散射函数</title><p>不同的物体对光的反射能力具有不同的特性，与光在不同的介质穿过时散射作用也会增加 [<xref ref-type="bibr" rid="hanspub.34272-ref9">9</xref>] [<xref ref-type="bibr" rid="hanspub.34272-ref10">10</xref>]，描述有雾环境下图像的物理模型应该包括两个方面：1. 光的衰减项，2. 光透过大气的散射。衰减公式为：</p><p>E D ( d , λ ) = E 0 ( λ ) e − β ( λ ) d (式1-1)</p><p>其中d表示场景深度， E 0 表示光强度， E D ( d , λ ) 表示光衰减项， β ( λ ) 表示大气的散射系数。</p><p>散射公式为：</p><p>E A ( d , λ ) = E w ( λ ) ( 1 − e − β ( λ ) d ) (式1-2)</p><p>其中 E A ( d , λ ) 表示大气增强项， E w ( λ ) 表示原始大气光的总强度。</p><p>所以有雾环境下图像的物理模型为：</p><p>E ( d , λ ) = E D ( d , λ ) + E A ( d , λ ) (式1-5)</p><p>将式1-1，式1-2带入得:</p><p>E ( d , λ ) = E 0 ( λ ) e − β ( λ ) d + E w ( λ ) ( 1 − e − β ( λ ) d ) (式1-6)</p><p>令 I ( x ) = E ( d , λ ) ， t ( x ) = e − β ( λ ) d ， J ( x ) = E 0 ( λ ) ， A = E w ( λ ) 式得</p><p>I ( x ) = J ( x ) t ( x ) + A ( 1 − t ( x ) ) (式1-7)</p><p>这就是在机器视觉以及计算机图像处理领域的常用方程 [<xref ref-type="bibr" rid="hanspub.34272-ref11">11</xref>]。其中， I ( x ) 表示有雾的待处理图像， J ( x ) 表示无雾的目标图像，A表示大气光强度； t ( x ) 表示透射率。去雾简单地说就是从 I ( x ) 来推算出 J ( x ) 。从式1-7看出若假设估计出A和t，代入便可得到 J ( x ) 即去雾图像。</p></sec><sec id="s4_2"><title>2.2. 暗原色先验原理</title><p>He等 [<xref ref-type="bibr" rid="hanspub.34272-ref8">8</xref>] 基于对无雾图像的大量统计发现对于绝大多数非天空区域，至少存在一个颜色通道值很低的像素，且接近于0。提出暗通道先验模型，对于任何一个无雾图像J可以表示为：</p><p>J d a r k ( x ) = min y ∈ Ω ( x ) ( min c ∈ { r , g , b } ( J c ( y ) ) ) (式1-8)</p><p>其中， J c 表示表示彩色图像J的各个色彩(RGB)通道， Ω ( x ) 表示以x为中心的局部窗口邻域。且 J d a r k 接近于0。</p><p>这里假定大气光强度A已知，且在窗口邻域内的透射率 t ˜ ( x ) 为某一固定值。则公式1-8可以变形为：</p><p>I C ( x ) A C = t ˜ ( x ) J C ( x ) A C + 1 − t ˜ ( x ) (式1-9)</p><p>对式1-9最小化得：</p><p>min y ∈ Ω ( x ) ( min c ( I C ( y ) A C ) ) = t ˜ ( x ) min y ∈ Ω ( x ) ( min c ( J C ( y ) A C ) ) + 1 − t ˜ ( x ) (式1-10)</p><p>即：</p><p>t ˜ ( x ) = 1 − min y ∈ Ω ( x ) ( min c ( I C ( y ) A C ) ) 1 − min y ∈ Ω ( x ) ( min c ( J C ( y ) A C ) ) (式1-11)</p><p>由于 J d a r k 接近于0即</p><p>J d a r k ( x ) = min y ∈ Ω ( x ) ( min c ∈ { r , g , b } ( J c ( y ) ) ) = 0</p><p>所以式1-11得：</p><p>t ˜ ( x ) = 1 − w min y ∈ Ω ( x ) ( min c ( I C ( y ) A C ) ) (式1-12)</p><p>其中为保留图像深度感，有必要保留一定程度的雾，w系数为 0 &lt; w &lt; 1 ，一般值为0.95。</p><p>此时I、A和t都已知，即可求出J。公式为：</p><p>J ( x ) = I ( x ) − A t ˜ ( x ) + A (式1-13)</p><p>从式1-13看出当 t ˜ ( x ) 太小式，导致无雾图像J偏大所以 t ˜ ( x ) 将设置下限为 t 0 (程序中值取0.1)最终获取无雾图像公式为：</p><p>J ( x ) = I ( x ) − A max ( t ˜ ( x ) , t 0 ) + A 。 (式1-14)</p></sec></sec><sec id="s5"><title>3. 改进的去雾方法</title><sec id="s5_1"><title>3.1. 透射率的获取</title><p>采用He提出的导向滤波算法对粗透射率再次细化处理获取 [<xref ref-type="bibr" rid="hanspub.34272-ref12">12</xref>] ：将要处理的带雾图像作为引导图,先对透射率进行粗估计滤波处理,获取细节信息,以此再次优化透射率图来获取更好的去雾效果。</p><p>导向滤波模型公式：</p><p>q i = ∑ j w i j ( I ) p j (式2-1)</p><p>其中p，q为输入图像与输出图像，i，j代表像素的坐标位置，I是改滤波的引导图， w i j 是滤波核。</p><p>假设该滤波输出与引导图像为线性变化即：</p><p>q k = a k I i + b k , ∀ i ∈ w k (式2-2)</p><p>其中 w k 为局部窗口邻域，k为像素中心。</p><p>( a k , b k ) 是一对线性系数，若输入输出图像的差异最低则满足：</p><p>E ( a k , b k ) = ∑ i ∈ w k ( ( a k I i + b k − p i ) 2 + ε a k 2 ) (式2-3)</p><p>其中 ε 是正则化参数,</p><p>{ a k = 1 | w | ∑ i ∈ w k I i p i − μ k p k &#175; σ k 2 + ε b k = p k &#175; − a k μ k</p><p>得到滤波结果：</p><p>{ q i = 1 | w | ∑ i ∈ w k a k I i + b k q i = a i &#175; I i + b i &#175; a i &#175; = 1 | w | ∑ i ∈ w k a k b i &#175; = 1 | w | ∑ i ∈ w k b k (式2-5)</p><p>该滤波核系数为：</p><p>W i j ( J g ) = 1 | w | 2 ∑ k : ( i , j ) ∈ w k ( 1 + ( J i g − μ k ) ( J j g − μ k ) σ k 2 + ε ) (式2-6)</p><p>其中 J g 是引导图， σ 2 为 J g 在 w k 窗口的方差， J g 在 w k 窗口的均值为 μ k ， w k 窗口中的像素数目为 | w | 。</p><p>程序首先获取原估计透射率，将获取的原估计透射率作为引导图，利用导向滤波在此细化获取更加准确的透射率，最后将小于 t 0 下限的用 t 0 = 0.1 代替。</p></sec><sec id="s5_2"><title>3.2. 获取最优分割阈值及改进</title><p>这里基于图像的灰度直方图分类，将图像分为远景与背景，以类间的最大或类内的最小方差作为阈值的选取准则 [<xref ref-type="bibr" rid="hanspub.34272-ref13">13</xref>] [<xref ref-type="bibr" rid="hanspub.34272-ref14">14</xref>]，按照阈值对图像进行割据。</p><p>假定某副图像的灰度级为( 1 , 2 , 3 , ⋯ , L )，处在灰度级为i的像素点总个数为 n i ，像素点的总个数为N，</p><p>故 N = n 1 + n 2 + n 3 + ⋯ + n L 。同时灰度级为i在图中出现的概率<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x70_hanspub.png" xlink:type="simple"/></inline-formula>，则满足<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x71_hanspub.png" xlink:type="simple"/></inline-formula>，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x72_hanspub.png" xlink:type="simple"/></inline-formula>。按照阈</p><p>值k对图像进行分类则有：</p><p><inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x73_hanspub.png" xlink:type="simple"/></inline-formula>,</p><p><inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x74_hanspub.png" xlink:type="simple"/></inline-formula>。</p><p>这时两类灰度出现的概率为：</p><disp-formula id="hanspub.34272-formula45"><label>(式2-7)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x75_hanspub.png"  xlink:type="simple"/></disp-formula><disp-formula id="hanspub.34272-formula46"><label>(式2-8)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x76_hanspub.png"  xlink:type="simple"/></disp-formula><p>两类的灰度平均值为：</p><disp-formula id="hanspub.34272-formula47"><label>(式2-9)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x77_hanspub.png"  xlink:type="simple"/></disp-formula><disp-formula id="hanspub.34272-formula48"><label>(式2-10)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x78_hanspub.png"  xlink:type="simple"/></disp-formula><p>其中<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x79_hanspub.png" xlink:type="simple"/></inline-formula>，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x80_hanspub.png" xlink:type="simple"/></inline-formula>。对于任意k都有<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x81_hanspub.png" xlink:type="simple"/></inline-formula>，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x82_hanspub.png" xlink:type="simple"/></inline-formula>。</p><p>两类的灰度方差：</p><disp-formula id="hanspub.34272-formula49"><label>(式2-11)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x83_hanspub.png"  xlink:type="simple"/></disp-formula><disp-formula id="hanspub.34272-formula50"><label>(式2-12)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x84_hanspub.png"  xlink:type="simple"/></disp-formula><p>令<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x85_hanspub.png" xlink:type="simple"/></inline-formula>，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x86_hanspub.png" xlink:type="simple"/></inline-formula>，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x87_hanspub.png" xlink:type="simple"/></inline-formula>。分别表示总体，类内，类间方差。即：</p><disp-formula id="hanspub.34272-formula51"><label>(式2-12)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x88_hanspub.png"  xlink:type="simple"/></disp-formula><disp-formula id="hanspub.34272-formula52"><label>(式2-13)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x89_hanspub.png"  xlink:type="simple"/></disp-formula><disp-formula id="hanspub.34272-formula53"><label>(式2-14)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x90_hanspub.png"  xlink:type="simple"/></disp-formula><p>选取最优阈值k使得三个判定函数最大。由于<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x91_hanspub.png" xlink:type="simple"/></inline-formula>时有：</p><disp-formula id="hanspub.34272-formula54"><label>(式2-15)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x92_hanspub.png"  xlink:type="simple"/></disp-formula><disp-formula id="hanspub.34272-formula55"><label>(式2-16)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x93_hanspub.png"  xlink:type="simple"/></disp-formula><p>上面可以看出<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x94_hanspub.png" xlink:type="simple"/></inline-formula>，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x95_hanspub.png" xlink:type="simple"/></inline-formula>，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x96_hanspub.png" xlink:type="simple"/></inline-formula>单调性一致，又因为图像的总体方差为常量，与<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x97_hanspub.png" xlink:type="simple"/></inline-formula>无关，所以选择最简单的<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x98_hanspub.png" xlink:type="simple"/></inline-formula>最为判定函数可得：</p><disp-formula id="hanspub.34272-formula56"><label>(式2-18)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x99_hanspub.png"  xlink:type="simple"/></disp-formula><p>用类间方差作为分类性能的高低函数为：</p><disp-formula id="hanspub.34272-formula57"><label>(式2-19)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x100_hanspub.png"  xlink:type="simple"/></disp-formula><p>得出最佳阈值<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x101_hanspub.png" xlink:type="simple"/></inline-formula>满足：</p><disp-formula id="hanspub.34272-formula58"><label>(式2-20)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x102_hanspub.png"  xlink:type="simple"/></disp-formula><p>计算出最优分割阈值后对图像进行分割。避免交界处噪声对分割的影响，采用多次形态学膨胀操作，获得二值图像，从中提取出天空区域和非天空区域来对单一分割进行改进。具体方法为：</p><p>循环将上面分割的结果用最大值替代卷积求和，用加法替代卷积的乘积即 [<xref ref-type="bibr" rid="hanspub.34272-ref15">15</xref>] ：</p><disp-formula id="hanspub.34272-formula59"><label>(式2-21)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x103_hanspub.png"  xlink:type="simple"/></disp-formula><p>其中，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x104_hanspub.png" xlink:type="simple"/></inline-formula>表示图像f的定义域，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x105_hanspub.png" xlink:type="simple"/></inline-formula>表示结构元素b的定义域，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x106_hanspub.png" xlink:type="simple"/></inline-formula>都应满足图像f的定义域，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x107_hanspub.png" xlink:type="simple"/></inline-formula>应满足结构元素<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x108_hanspub.png" xlink:type="simple"/></inline-formula>的定义域内。当最小值大于0是将值赋值为1，其他为0，进行多次循环。程序中结构元素b为3 &#215; 3零矩阵，进行多次循环。</p><p>然后再将膨胀后的图像与有雾图像叠加运算，再将此时的天空区域按照式2-22判断：</p><disp-formula id="hanspub.34272-formula60"><label>(式2-22)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x109_hanspub.png"  xlink:type="simple"/></disp-formula><p>程序中将满足条件的天空取0，非天空区域的置1，最后得到准确分割后的天空区域与非天空区域。</p></sec><sec id="s5_3"><title>3.3. 大气强度A的获取</title><p>根据He提出的算法，对暗通道图的亮度值进行排序，取最大亮度值得前0.1%的像素，将这些像素在有雾的原始图像中的最大值作为A。避免A值受到白色亮点影响A的计算结果，采用以下算法：</p><p>1. 非天空区域：统计非天空区域最大亮度的1%像素的平均值为大气光强度A的值 [<xref ref-type="bibr" rid="hanspub.34272-ref16">16</xref>]。</p><p>2. 天空区域：将有雾图像按上述分割后天空区域均匀分成四块区域，计算平均值和标准值的最大差值与设定的阈值比较，大于阈值的继续均分成四块计算平均值和标准值的差值，当小于设定阈值时，计算选定区域的平均亮度值作为大气光强度的A值。<sup> </sup></p></sec><sec id="s5_4"><title>3.4. 优化白边效应</title><p>为了消除拼接后的分界处的白边效应公式为：</p><disp-formula id="hanspub.34272-formula61"><label>(式2-23)</label><graphic position="anchor" xlink:href="//html.hanspub.org/file/15-1541659x110_hanspub.png"  xlink:type="simple"/></disp-formula><p>其中<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x111_hanspub.png" xlink:type="simple"/></inline-formula>是按照上述非天空区域大气光强度进行暗原色先验处理后的图像，将天空区域设置0，<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x112_hanspub.png" xlink:type="simple"/></inline-formula>是经过上述改进后处理的天空区域，非天空区域设置成0，最后获取<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/15-1541659x113_hanspub.png" xlink:type="simple"/></inline-formula>为去雾图像。</p></sec></sec><sec id="s6"><title>4. 试验结果与分析</title><p>试验运行环境为win10家庭版，matlab版本为2014b，图像为选取带雾图片。</p><p>最大类间方差法进行单一阈值分割与阈值分割进行形态膨胀改进后的阈值分割图像对比，分割处理后的天空区域与非天空区域结果为图1。从图1的试验结果看出本文改进的阈值分割能够很好的分割出天空域与非天空域，验证了本文对阈值分割算法的改进。基于导向滤波的改进获取透射率结果为图2。从图2看出基于导向滤波改进后来获取的透射率更加细化，更符合实际。最后原图像与去雾后的图像对比结果为图3，试验图3结果表明还原后的图像在雾浓度较小时能够达到良好的去雾效果且对于天空区域没有明显的色块，去雾后图像更加自然清晰。</p><p>图1. 单一阈值分割与改进后阈值分割</p><p>图2. 原透射率与改进后的透射率</p><p>图3. 原图像与去雾后的图像</p></sec><sec id="s7"><title>5. 结语</title><p>通过对暗原色先验不适合用于天空域的去雾处理研究与分析，提出对天空区域进行割据的去雾算法：以最大类间方差法算法进行阈值分割图像，然后对其进行形态学膨胀处理，改进膨胀算法，能够更有效的分割出天空区域。通过对研究导向滤波，获取更加细致的透射率并提出给其设置下限使得复原的图像误差更低。但试验结果中选取图像中雾的浓度较大时，复原的图像出现日晕现象，复原图像效果不理想，这也是进一步研究的内容。</p></sec><sec id="s8"><title>文章引用</title><p>梁腾飞,张延华. 基于天空区域分割的单幅图像去雾方法Single Image Dehazing Method Based on Sky Region Segmentation[J]. 计算机科学与应用, 2020, 10(02): 325-333. https://doi.org/10.12677/CSA.2020.102033</p></sec><sec id="s9"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.34272-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">Kim, T.K., Paik, J.K. and Kang, B.S. (1998) Contrast Enhancement System Using Spatially Adaptive Histogram Equalization with Temporal Filtering. IEEE Transactions on Consumer Electronics, 44, 82-87.  
&lt;br&gt;https://doi.org/10.1109/30.663733</mixed-citation></ref><ref id="hanspub.34272-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">Xu, H., Guo, J., Liu, Q., et al. (2012) Fast Image Dehazing Using Im-proved Dark Channel Prior. 2012 International Conference on Information Science and Technology (ICIST), Hubei, 23-25 March 2012, 663-667.  
&lt;br&gt;https://doi.org/10.1109/ICIST.2012.6221729</mixed-citation></ref><ref id="hanspub.34272-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">Ullah, E., Nawaz, R. and Iqbal, J. (2013) Single Image Haze Removal Using Improved Dark Channel Prior. 2013 Proceedings of International Conference on Modelling, Identification &amp; Control (ICMIC), Cairo, 31 August-2 September 2013, 245-248.</mixed-citation></ref><ref id="hanspub.34272-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">Zhu, Q., Mai, J. and Shao, L. (2015) A Fast Single Image Haze Removal Algorithm Using Color Attenuation Prior. IEEE Transactions on Image Processing, 24, 3522-3533. &lt;br&gt;https://doi.org/10.1109/TIP.2015.2446191</mixed-citation></ref><ref id="hanspub.34272-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">Tan, R.T. (2008) Visibility in Bad Weather from a Single Image. CVPR 2008: Proceedings of the 2008 IEEE Conference on Computer Vision and Pattern Recognition, Anchorage, AK, 23-28 June 2008, 1-8.  
&lt;br&gt;https://doi.org/10.1109/CVPR.2008.4587643</mixed-citation></ref><ref id="hanspub.34272-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">Fattal, R. (2008) Single Image Dehazing. ACM Transactions on Graphics (TOG), 27, Article No. 72.  
&lt;br&gt;https://doi.org/10.1145/1360612.1360671</mixed-citation></ref><ref id="hanspub.34272-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">Yu, J., Xiao, C. and Li, D. (2010) Physics-Based Fast Single Image Fog Removal. 2010 IEEE 10th International Conference on Signal Processing (ICSP), Beijing, 24-28 October 2010, 1048-1052.  
&lt;br&gt;https://doi.org/10.1109/ICOSP.2010.5655901</mixed-citation></ref><ref id="hanspub.34272-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">He, K.M., Sun, J. and Tang, X.O. (2011) Single Image Haze Removal Using Dark Channel Prior. IEEE Transactions on Pattern Analysis and Machine Intelligence, 33, 2341-2353. &lt;br&gt;https://doi.org/10.1109/TPAMI.2010.168</mixed-citation></ref><ref id="hanspub.34272-ref9"><label>9</label><mixed-citation publication-type="other" xlink:type="simple">Scarr, S. and McCartney, K. (1983) How People Make Their Own Environments: A Theory of Genotype Environment Effects. Child Development, 54, 424-435.</mixed-citation></ref><ref id="hanspub.34272-ref10"><label>10</label><mixed-citation publication-type="other" xlink:type="simple">Wahl, S.M., Hunt, D.A., Wakefield, L.M., et al. (1987) Transforming Growth Factor Type Beta Induces Monocyte Chemotaxis and Growth Factor Production. Proceedings of the National Academy of Sciences of the United States of America, 84, 5788-5792. &lt;br&gt;https://doi.org/10.1073/pnas.84.16.5788</mixed-citation></ref><ref id="hanspub.34272-ref11"><label>11</label><mixed-citation publication-type="other" xlink:type="simple">Narasimhan, S.G. and Nayar, S.K. (2003) Contrast Restoration of Weather Degraded Images. IEEE Transactions on Pattern Analysis and Machine Intelligence, 25, 713-724. &lt;br&gt;https://doi.org/10.1109/TPAMI.2003.1201821</mixed-citation></ref><ref id="hanspub.34272-ref12"><label>12</label><mixed-citation publication-type="other" xlink:type="simple">He, K.M., Sun, J. and Tang, X.O. (2012) Guided Image Filtering. IEEE Transactions on Pattern Analysis and Machine Intelligence, 35, 1397-1409. &lt;br&gt;https://doi.org/10.1109/TPAMI.2012.213</mixed-citation></ref><ref id="hanspub.34272-ref13"><label>13</label><mixed-citation publication-type="other" xlink:type="simple">Otsu, N. (1975) A Threshold Selection Method from Gray-Level Histograms. Automatica, 11, 23-27.</mixed-citation></ref><ref id="hanspub.34272-ref14"><label>14</label><mixed-citation publication-type="other" xlink:type="simple">徐长新, 彭国华. 二维Otsu阈值法的快速算法[J]. 计算机应用, 2012, 32(5): 1258-1260.</mixed-citation></ref><ref id="hanspub.34272-ref15"><label>15</label><mixed-citation publication-type="other" xlink:type="simple">徐振轩. 基于天空区域分割的单幅图像去雾方法研究[D]: [硕士学位论文]. 绵阳: 西南科技大学, 2017.</mixed-citation></ref><ref id="hanspub.34272-ref16"><label>16</label><mixed-citation publication-type="other" xlink:type="simple">程炜, 汤红忠, 朱玲, 王翔, 李骁, 郭雪峰. 图像去雾中的大气光强度自适应恢复算法研究[J]. 计算技术与自动化, 2017, 36(1): 103-107.</mixed-citation></ref></ref-list></back></article>