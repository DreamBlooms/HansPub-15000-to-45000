<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">CSA</journal-id><journal-title-group><journal-title>Computer Science and Application</journal-title></journal-title-group><issn pub-type="epub">2161-8801</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/CSA.2020.105098</article-id><article-id pub-id-type="publisher-id">CSA-35587</article-id><article-categories><subj-group subj-group-type="heading"><subject>CSA20200500000_43859641.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于C#的智慧院落监管系统的设计与实现
  Design and Implementation of a Smart Courtyard Supervision System Based on C#
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>胡</surname><given-names>芳</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>王</surname><given-names>成品</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib></contrib-group><aff id="aff3"><addr-line>四川慧龙科技有限责任公司，四川 成都</addr-line></aff><aff id="aff2"><addr-line>四川科技职工大学信息工程系，四川 成都</addr-line></aff><aff id="aff1"><addr-line>null</addr-line></aff><pub-date pub-type="epub"><day>29</day><month>04</month><year>2020</year></pub-date><volume>10</volume><issue>05</issue><fpage>950</fpage><lpage>959</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   社区院落是社会的基本单元，是巩固党的执政基础的重要基石。为推动社区院落群众文化生活繁荣兴盛，在基层群众娱乐中进一步加强基层社区治理和文化建设，强化党政方针政策在基层的宣传，基于C#语言开发了智慧院落监管系统。系统采用C/S技术架构，依托SQL Server2008R2进行数据库设计，实现了社区院落宣传播放任务的编排、智能终端的控制和监视，实现通讯服务器与智能终端之间的流畅通讯。为方便社区管理人员远程监控社区各院落智能终端的工作状况及播放内容，实现了监管端APP。介绍了系统开发的主要方案及软件工作流程，阐述了系统主要业务实现过程，如：文件和版块管理、节目单的编排及控制、智能终端工作状态查询等，描述了系统设计的关键类及关键算法流程、主要数据表的结构及表间关系。经实际应用，系统稳定可靠，对丰富社区群众文化活动及强化政策宣讲起到了推动作用。 Community courtyards are the basic unit of society, cozy space for people to live in harmony, and an important cornerstone to consolidate our party’s governing foundation. In order to promote the prosperity of cultural life in community courtyards, further strengthen grassroots community governance and culture construction, and enhance the promotion of our party and government’s poli-cies at the grassroots level, we developed a smart courtyard supervision system based on C# language. The system adopts C/S structure, which enables the publicity and broadcasting tasks in community courtyards, the control and monitoring of intelligent terminals, and the smooth communication between communication servers and intelligent terminals. The database is designed based on SQL Server 2008R2. In order to facilitate the community management personnel to remotely monitor the working status and playback content of the smart terminals in various courtyards, a supervision APP has been implemented as well. This article introduces the main program and software workflow of the system, and describes the main business implementation of the system such as: file and plate management, program schedule and control, intelligent terminal work status query, etc. Additionally, this paper also demonstrates the key classes and algorithms of the system, the structure of the main data tables, and the relationships between the tables. The practical application shows that the system is stable and reliable. It has promoted the enrichment of community cultural activities and strengthened policy promotion. 
  
 
</p></abstract><kwd-group><kwd>C#，C/S架构，SQL Server，智能终端，智慧院落监管, C#</kwd><kwd> C/S Architecture</kwd><kwd> SQL Server</kwd><kwd> Smart Terminal</kwd><kwd> Smart Courtyard Supervision</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于C#的智慧院落监管系统的设计与实现<sup> </sup></title><p>胡芳<sup>1</sup>，王成品<sup>2*</sup></p><p><sup>1</sup>四川科技职工大学信息工程系，四川 成都</p><p><sup>2</sup>四川慧龙科技有限责任公司，四川 成都</p><disp-formula id="hanspub.35587-formula39"><graphic xlink:href="//html.hanspub.org/file/15-1541760x5_hanspub.png"  xlink:type="simple"/></disp-formula><p>收稿日期：2020年4月27日；录用日期：2020年5月8日；发布日期：2020年5月15日</p><disp-formula id="hanspub.35587-formula40"><graphic xlink:href="//html.hanspub.org/file/15-1541760x6_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>社区院落是社会的基本单元，是巩固党的执政基础的重要基石。为推动社区院落群众文化生活繁荣兴盛，在基层群众娱乐中进一步加强基层社区治理和文化建设，强化党政方针政策在基层的宣传，基于C#语言开发了智慧院落监管系统。系统采用C/S技术架构，依托SQL Server2008R2进行数据库设计，实现了社区院落宣传播放任务的编排、智能终端的控制和监视，实现通讯服务器与智能终端之间的流畅通讯。为方便社区管理人员远程监控社区各院落智能终端的工作状况及播放内容，实现了监管端APP。介绍了系统开发的主要方案及软件工作流程，阐述了系统主要业务实现过程，如：文件和版块管理、节目单的编排及控制、智能终端工作状态查询等，描述了系统设计的关键类及关键算法流程、主要数据表的结构及表间关系。经实际应用，系统稳定可靠，对丰富社区群众文化活动及强化政策宣讲起到了推动作用。</p><p>关键词 :C#，C/S架构，SQL Server，智能终端，智慧院落监管</p><disp-formula id="hanspub.35587-formula41"><graphic xlink:href="//html.hanspub.org/file/15-1541760x7_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2020 by author(s) and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY 4.0).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/15-1541760x8_hanspub.png" /> <img src="//html.hanspub.org/file/15-1541760x9_hanspub.png" /></p></sec><sec id="s3"><title>1. 系统结构设计</title><p>智慧院落监管系统的实现，是媒体播放、数据推送、数据库、通讯技术、远程控制以及嵌入式等技术的综合运用。该系统利用智能终端将各类媒体信息在社区院落的显示设备上展现(如：电视机)，比如播放各种政务信息、在线直播电视节目。智能终端向上通过IP网络与系统相连并实现数据交换，向下与显示终端相连。</p><p>系统由三大模块组成，a) 智慧院落监管操作平台：负责与操作员的接口，操作员通过这个平台完成系统配置、播放任务的编排以及终端工作状态监控等。b) 通讯平台：负责与智能终端的通讯，并负责与“监管操作平台”完成数据交互。c) 智能终端，观看电视直播，后台线程实现与“通讯平台”的通讯，实现各类节目无缝切换。为方便社区管理人员远程管理，开发了远程监管移动APP。社区管理人员利用APP，可在手机上查看各院落智能终端的状态以及正在播放的节目等信息。</p><p>系统逻辑结构示意如图1所示。</p></sec><sec id="s4"><title>2. 相关技术</title><p>系统采用C/S [<xref ref-type="bibr" rid="hanspub.35587-ref1">1</xref>] [<xref ref-type="bibr" rid="hanspub.35587-ref2">2</xref>] [<xref ref-type="bibr" rid="hanspub.35587-ref3">3</xref>] 技术架构。C/S架构优点是系统响应快、用户体验好、能充分利用客户机资源(如打印机、数据缓存)等。利用跨平台开发框架Xamarin.Mobile [<xref ref-type="bibr" rid="hanspub.35587-ref4">4</xref>] [<xref ref-type="bibr" rid="hanspub.35587-ref5">5</xref>] [<xref ref-type="bibr" rid="hanspub.35587-ref6">6</xref>] 开发移动APP。Xamarin Studio是一个用C#语言开发跨平台应用的集成开发环境，它和iOS以及Android SDK紧密整合。采用SQLServer2008R2进行数据管理。为保证数据库服务器和数据库的高可用性和数据的高安全性，部署数据库故障转移集群 [<xref ref-type="bibr" rid="hanspub.35587-ref7">7</xref>] [<xref ref-type="bibr" rid="hanspub.35587-ref8">8</xref>] [<xref ref-type="bibr" rid="hanspub.35587-ref9">9</xref>] [<xref ref-type="bibr" rid="hanspub.35587-ref10">10</xref>]。搭建SVN (Subversion，一个自由开源的版本控制系统)服务器进行版本管理，辅助以RDLC、JS框架库等丰富数据呈现效果 [<xref ref-type="bibr" rid="hanspub.35587-ref11">11</xref>]。开发环境选择Visual Studio 2012，开发语言为C#。</p><p>图1. 系统逻辑结构示意图</p></sec><sec id="s5"><title>3. 系统数据库设计</title><p>按系统功能需求，共设计了4类表。以下列出系统主要表的详细信息。</p><p>1) 系统管理参数类，供系统管理和调度用</p><p>系统信息表，表结构如表1所示。</p><table-wrap id="table1" ><label><xref ref-type="table" rid="table1">Table 1</xref></label><caption><title> System information tabl</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >名称</th><th align="center" valign="middle" >类型</th><th align="center" valign="middle" >允许空</th><th align="center" valign="middle" >长度</th><th align="center" valign="middle" >默认值</th><th align="center" valign="middle" >自增长</th><th align="center" valign="middle" >定义</th></tr></thead><tr><td align="center" valign="middle" >db_ver</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >1</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >数据库版本(key)</td></tr><tr><td align="center" valign="middle" >stb_pw_on_time</td><td align="center" valign="middle" >smallint</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >2</td><td align="center" valign="middle" >540</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >智能终端开机时间</td></tr><tr><td align="center" valign="middle" >stb_pw_off_time</td><td align="center" valign="middle" >smallint</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >2</td><td align="center" valign="middle" >1320</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >智能终端关机时间</td></tr><tr><td align="center" valign="middle" >live_prog_ver</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >直播节目列表版本</td></tr><tr><td align="center" valign="middle" >infoChangedVar</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >节目列表版本</td></tr><tr><td align="center" valign="middle" >ServerIp</td><td align="center" valign="middle" >Nchar</td><td align="center" valign="middle" >Y</td><td align="center" valign="middle" >15</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >服务器IP</td></tr><tr><td align="center" valign="middle" >ServerPort</td><td align="center" valign="middle" >int</td><td align="center" valign="middle" >Y</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >服务器端口</td></tr><tr><td align="center" valign="middle" >En_mode</td><td align="center" valign="middle" >int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >0-正常模式，1-应急模式</td></tr><tr><td align="center" valign="middle" >En_ver</td><td align="center" valign="middle" >int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >应急数据变化版本</td></tr><tr><td align="center" valign="middle" >Ntp_server</td><td align="center" valign="middle" >nvarchar</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >50</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >Stb获取时间的服务器地址</td></tr></tbody></table></table-wrap><p>表1. 系统信息表</p><p>2) 电视直播相关表</p><p>a. 智能终端信息表，表结构如表2所示。</p><p>索引：mac_addr (唯一), courtyard _id</p><table-wrap id="table2" ><label><xref ref-type="table" rid="table2">Table 2</xref></label><caption><title> Intelligent terminal information tabl</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >名称</th><th align="center" valign="middle" >类型</th><th align="center" valign="middle" >允许空</th><th align="center" valign="middle" >长度</th><th align="center" valign="middle" >默认值</th><th align="center" valign="middle" >自增长</th><th align="center" valign="middle" >定义</th></tr></thead><tr><td align="center" valign="middle" >stb_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >智能终端ID (key)</td></tr><tr><td align="center" valign="middle" >number</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >智能终端编号</td></tr><tr><td align="center" valign="middle" >mac_addr</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >12</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >智能终端MAC地址</td></tr><tr><td align="center" valign="middle" >courtyard _id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >智能终端所属院落ID</td></tr><tr><td align="center" valign="middle" >on_line</td><td align="center" valign="middle" >bit</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >1</td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >智能终端是否在线</td></tr><tr><td align="center" valign="middle" >play_file_name</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >128</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >智能终端播放节目名称</td></tr><tr><td align="center" valign="middle" >play_file_time</td><td align="center" valign="middle" >datetime</td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >8</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >智能终端播放节目开始时间</td></tr></tbody></table></table-wrap><p>表2. 智能终端信息表</p><p>b. 直播节目信息表，表结构如表3所示。</p><p>索引：name (唯一)</p><p>关系：live_program _id -&gt;live_program_addr :live_program _id</p><table-wrap id="table3" ><label><xref ref-type="table" rid="table3">Table 3</xref></label><caption><title> Live program information tabl</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >名称</th><th align="center" valign="middle" >类型</th><th align="center" valign="middle" >允许空</th><th align="center" valign="middle" >长度</th><th align="center" valign="middle" >默认值</th><th align="center" valign="middle" >自增长</th><th align="center" valign="middle" >定义</th></tr></thead><tr><td align="center" valign="middle" >live_program _id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >直播节目ID (key)</td></tr><tr><td align="center" valign="middle" >name</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >50</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >直播节目名称</td></tr><tr><td align="center" valign="middle" >order_number</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >直播节目顺序</td></tr></tbody></table></table-wrap><p>表3. 直播节目信息表</p><p>c. 播放任务清单，表结构如表4所示。</p><p>索引：community_id, play_task_timeId</p><p>关系：play_list_id-&gt;play_plate_list :play_list_id</p><table-wrap id="table4" ><label><xref ref-type="table" rid="table4">Table 4</xref></label><caption><title> Play task lis</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >名称</th><th align="center" valign="middle" >类型</th><th align="center" valign="middle" >允许空</th><th align="center" valign="middle" >长度</th><th align="center" valign="middle" >默认值</th><th align="center" valign="middle" >自增长</th><th align="center" valign="middle" >定义</th></tr></thead><tr><td align="center" valign="middle" >play_task_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >播放列表ID (key)</td></tr><tr><td align="center" valign="middle" >play_task_timeId</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >1</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >播放时段ID</td></tr><tr><td align="center" valign="middle" >community_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >所属社区ID</td></tr><tr><td align="center" valign="middle" >Repeat_type</td><td align="center" valign="middle" >tinyint</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >1</td><td align="center" valign="middle" >1</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >重复播放类型</td></tr><tr><td align="center" valign="middle" >AddTaskMark</td><td align="center" valign="middle" >tinyint</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >1</td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td></tr></tbody></table></table-wrap><p>表4. 播放任务清单</p><p>d. 播放版块列表，表结构如表5所示。</p><p>索引：play_ task _id, plate_id</p><table-wrap id="table5" ><label><xref ref-type="table" rid="table5">Table 5</xref></label><caption><title> Play section lis</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >名称</th><th align="center" valign="middle" >类型</th><th align="center" valign="middle" >允许空</th><th align="center" valign="middle" >长度</th><th align="center" valign="middle" >默认值</th><th align="center" valign="middle" >自增长</th><th align="center" valign="middle" >定义</th></tr></thead><tr><td align="center" valign="middle" >play_plate _id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >播放列表ID (key)</td></tr><tr><td align="center" valign="middle" >play_ task _id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >文件ID</td></tr><tr><td align="center" valign="middle" >plate_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >文件类型</td></tr><tr><td align="center" valign="middle" >number</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >播放序号</td></tr></tbody></table></table-wrap><p>表5. 播放版块列表</p><p>3) 操作员权限相关表</p><p>用户账户信息表，表结构如表6所示。</p><p>索引：account (唯一)</p><table-wrap id="table6" ><label><xref ref-type="table" rid="table6">Table 6</xref></label><caption><title> User account information tabl</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >名称</th><th align="center" valign="middle" >类型</th><th align="center" valign="middle" >允许空</th><th align="center" valign="middle" >长度</th><th align="center" valign="middle" >默认值</th><th align="center" valign="middle" >自增长</th><th align="center" valign="middle" >定义</th></tr></thead><tr><td align="center" valign="middle" >user_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >用户ID (key)</td></tr><tr><td align="center" valign="middle" >account</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >20</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >用户账号</td></tr><tr><td align="center" valign="middle" >Pwd</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >50</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >用户账号密码</td></tr><tr><td align="center" valign="middle" >name</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >20</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >用户名称</td></tr><tr><td align="center" valign="middle" >access</td><td align="center" valign="middle" >tinyint</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >1</td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >用户访问权限</td></tr><tr><td align="center" valign="middle" >mac_addr</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >12</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >绑定MAC</td></tr></tbody></table></table-wrap><p>表6. 用户账户信息表</p><p>4) 文件播放业务的相关表</p><p>a. 文件信息表，表结构如表7所示。</p><p>索引：name (唯一), sha1, user_id</p><p>关系：file_id-&gt;plate_file_list: file _id</p><table-wrap id="table7" ><label><xref ref-type="table" rid="table7">Table 7</xref></label><caption><title> File information tabl</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >名称</th><th align="center" valign="middle" >类型</th><th align="center" valign="middle" >允许空</th><th align="center" valign="middle" >长度</th><th align="center" valign="middle" >默认值</th><th align="center" valign="middle" >自增长</th><th align="center" valign="middle" >定义</th></tr></thead><tr><td align="center" valign="middle" >file_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >文件ID (key)</td></tr><tr><td align="center" valign="middle" >name</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >128</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >文件名称</td></tr><tr><td align="center" valign="middle" >locaPath</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >128</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >本地文件名</td></tr><tr><td align="center" valign="middle" >path</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" >NULL</td><td align="center" valign="middle" >512</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >服务器文件路径</td></tr><tr><td align="center" valign="middle" >format</td><td align="center" valign="middle" >Tinyint</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >1</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >文件格式</td></tr><tr><td align="center" valign="middle" >file_size</td><td align="center" valign="middle" >Bigint</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >8</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >文件长度</td></tr><tr><td align="center" valign="middle" >File_image</td><td align="center" valign="middle" >image</td><td align="center" valign="middle" >NULL</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >图片缩略图，用于显示</td></tr><tr><td align="center" valign="middle" >sha1</td><td align="center" valign="middle" >varchar</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >20</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >文件SHA1值</td></tr><tr><td align="center" valign="middle" >total_time</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >文件时间长度</td></tr><tr><td align="center" valign="middle" >user_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >上传用户编号</td></tr><tr><td align="center" valign="middle" >up_time</td><td align="center" valign="middle" >Datetime</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >8</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >上传时间</td></tr><tr><td align="center" valign="middle" >upStatus</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >-1</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >上传状态</td></tr><tr><td align="center" valign="middle" >upErrorCode</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >上传错误</td></tr></tbody></table></table-wrap><p>表7. 文件信息表</p><p>b. 版块文件列表，表结构如表8所示。</p><p>索引：plate_id, file _id</p><table-wrap id="table8" ><label><xref ref-type="table" rid="table8">Table 8</xref></label><caption><title> Section file lis</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >名称</th><th align="center" valign="middle" >类型</th><th align="center" valign="middle" >允许空</th><th align="center" valign="middle" >长度</th><th align="center" valign="middle" >默认值</th><th align="center" valign="middle" >自增长</th><th align="center" valign="middle" >定义</th></tr></thead><tr><td align="center" valign="middle" >Plate_file _id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >是</td><td align="center" valign="middle" >版块文件ID(key)</td></tr><tr><td align="center" valign="middle" >plate_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >版块ID</td></tr><tr><td align="center" valign="middle" >file_id</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" ></td><td align="center" valign="middle" ></td><td align="center" valign="middle" >文件ID</td></tr><tr><td align="center" valign="middle" >play_number</td><td align="center" valign="middle" >Int</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >0</td><td align="center" valign="middle" ></td><td align="center" valign="middle" >播放序号</td></tr></tbody></table></table-wrap><p>表8. 版块文件列表</p></sec><sec id="s6"><title>4. 系统功能设计与实现</title><p>系统功能设计如图2所示。系统功能主要由文件与板块管理、播放节目编排、系统管理三大模块构成。关键业务涉及文件与版块管理、播放节目控制两部分。</p><sec id="s6_1"><title>4.1. 文件和板块管理</title><sec id="s6_1_1"><title>4.1.1. 数据传输</title><p>监管系统将文件(安排播放的图片、音频、视频等)上传至通讯平台服务器，通讯平台接收并保存。通讯平台服务器与智能终端交互，文件下载至智能终端。</p><p>智能终端每隔一段时间(数十秒到几分钟)与通讯平台进行“心跳”通讯，“心跳”通讯时“通讯平台”告知智能终端文件有变，需要进行额外的数据通讯，此时智能终端可以发起数据通讯，以完成数据的下载或者更新。图3所示为系统数据通讯示意图。</p><p>图2. 系统功能示意图</p><p>图3. 数据通讯示意图</p><p>以下列出部分通讯数据包格式。</p><p>1) 心跳数据包(通讯服务器&#223;&#224;智能终端)</p><disp-formula id="hanspub.35587-formula42"><graphic xlink:href="//html.hanspub.org/file/15-1541760x13_hanspub.png"  xlink:type="simple"/></disp-formula><p>2) 文件上传数据包 (监管系统&#224;通讯服务器)</p><disp-formula id="hanspub.35587-formula43"><graphic xlink:href="//html.hanspub.org/file/15-1541760x14_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s6_1_2"><title>4.1.2. 主要类描述</title><p>文件信息管理类Form_file_info：</p><p>显示已有的文件详细信息，包括文件名称、状态、文件大小等，当点击名文件是，通过鼠标右键，可弹出下列菜单：以供用户选择操作，这些操作至少应该包括：新增，修改文件信息，删除文件。在退出本功能时：判断是否有未上传的文件，如果有，则提示是否立即启动文件上传，文件上传由Form_FileToServerMoni类实现。</p><p>文件上传监视Form_FileToServerMoni类：</p><p>负责显示上传文件的进度以及上传行为的控制(取消上传或者继续上传)。实现文件上传的调度、上传进度的刷新显示、上传过程的控制以及接收来自文件上传类CfileUpToServerMain的消息并进行显示和处理。一旦收到所有文件上传成功完成的消息，则界面上显示全部上传完成。</p><p>开始上传时，调用CfileUpToServerMain类，通过传入文件file列表，实现文件的批量上传。在上传过程中，通过消息机制发送每个文件的进度给Form_FileToServerMonis类，或者发送上传过程中的出错消息。</p><p>Form_FileToServerMoni、CfileUpToServerMain、CfileUpToServer 3个类之间的关系如图4所示：</p><p>图4. 三个类之间的关系</p><p>CfileUpToServerMain类通过多线程机制分别启动单个文件的上传，单个文件的上传由类CfileUpToServer实现。</p><p>类CfileUpToServer封装数据包，与下位机进行文件传输，算法如下：</p><p>1) 打开要传送的文件。</p><p>2) 连接到下位机，发送请求包，接收应答包。</p><p>3) 解析应答包：确定开始发送的位置(断点续传)。</p><p>4) 定位到要开始发送文件的位置。</p><p>5) 读取本次发送的数据长度，发送File_up_data_packetHead包，如收到“准备好”应答，则执行6)。</p><p>6) 读文件数据，封装数据并发送，重复6)直到文件数据全部发送完成。</p><p>7) 关闭文件。向CfileUpToServerMain发送文件成功传输消息。</p><p>在以上步骤中，如出现错误，则中断发送，并向CfileUpToServerMain发送错误消息。</p></sec></sec><sec id="s6_2"><title>4.2. 播放节目控制</title><p>该模块主要功能是完成节目单的编排，在节假日智能终端将不会遵从节目单设定的要求，因此用户在设定的节假日内，智能终端不受节目单的控制。在非节假日，智能终端的工作模式将按照节目单进行。在特定时期，可能需要紧急启动播放某个宣传片，因此通过“应急播放”可以“立即”让智能终端切换到需要播放的宣传片。终端状态的功能是查看所有终端设备的工作状态、正在播放的节目信息等。</p><p>主要实现如下功能：</p><p>1) 节目编排：显示时段表，以及时段播放的版块；修改或者设置某时段要播放的版块列表；调整版块列表中版块的播放顺序；选择某个时段，显示该时点播放的所有节目顺序。运行界面如图5所示。</p><p>2) 假日预约：设定假日时间段，包括假日名称、开始和结束时间。可以设置多个假日时段。</p><p>3) 应急播放：设定在进行应急播放时要播放的节目，可以是视频或者图片文件。</p><p>4) 查看智能终端状态：显示所有智能终端的信息和当前状态信息。运行效果见图6。</p><p>图5. 节目编排界面</p><p>图6. 智能终端状态</p></sec></sec><sec id="s7"><title>5. 结束语</title><p>本文阐述了基于C#的智慧院落监管系统的开发过程，分析了系统中主要实体的属性和相互关系；利用SQL Server 2008 R2设计了数据库；简要阐明了在系统开发中的关键业务、业务实现中设计的关键类及算法流程。系统现已交付使用，在近2年的上线运行中，系统运行正确、稳定，对当地社区文化建设、思想建设及丰富社区群众文化生活起到了较好的促进作用。</p></sec><sec id="s8"><title>文章引用</title><p>胡 芳,王成品. 基于C#的智慧院落监管系统的设计与实现Design and Implementation of a Smart Courtyard Supervision System Based on C#[J]. 计算机科学与应用, 2020, 10(05): 950-959. https://doi.org/10.12677/CSA.2020.105098</p></sec><sec id="s9"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.35587-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">盛智勇, 安颀, 曲洪权, 等. 基于C/S架构的光纤智能预警系统的软件设计[J]. 吉首大学学报(自然科学版), 2017, 38(5): 34-39.</mixed-citation></ref><ref id="hanspub.35587-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">徐磊. 基于C/S结构的卫生人才库系统的设计与开发[C]//中华医学会医学工程学分会第十五次全国学术年会, 2015.</mixed-citation></ref><ref id="hanspub.35587-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">赵晓东, 李亚静, 申欢欢. 基于B/S和C/S的棉花仓储监控平台架构设计[J]. 河北企业, 2014(5): 141.</mixed-citation></ref><ref id="hanspub.35587-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">Tratnik, G. (2015) Development of Cross Platform Mobile Application Using Xamarin Forms. University of Ljubljana, Ljubljana.</mixed-citation></ref><ref id="hanspub.35587-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">El-Kassas, W.S., Abdullah, B.A., Yousef, A.H., et al. (2016) Enhanced Code Conversion Approach for the Integrated Cross-Platform Mobile Development (ICPMD). IEEE Transactions on Software Engineering, 42, 1036-1053.   
&lt;br&gt;https://doi.org/10.1109/tse.2016.2543223</mixed-citation></ref><ref id="hanspub.35587-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">Peppers, J. (2014) Xamarin Cross-Platform Application Develop-ment Develop Production-Ready Applications for iOS and Android Using Xamarin. Packt Publishing, Birmingham.</mixed-citation></ref><ref id="hanspub.35587-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">刘建军. Windows2008下Sqlserver2008数据库故障转移集群部署方案探析[J]. 长春大学学报, 2013, 23(10): 1252-1254, 1258.</mixed-citation></ref><ref id="hanspub.35587-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">孙立威, 张晓莉, 王淑江. 精通Windows server2008系统管理与群集[M]. 北京: 中国铁道出版社, 2009.</mixed-citation></ref><ref id="hanspub.35587-ref9"><label>9</label><mixed-citation publication-type="other" xlink:type="simple">史文路. 双机热备份系统的研究与设计[D]: [硕士学位论文]. 南京: 南京工业大学, 2006.</mixed-citation></ref><ref id="hanspub.35587-ref10"><label>10</label><mixed-citation publication-type="other" xlink:type="simple">梁耀, 黄华, 权金虎, 张君. 核电监督性监测系统数据库双机热备设计[J]. 核电子学与探测技术, 2017, 37(12): 1184-1187.</mixed-citation></ref><ref id="hanspub.35587-ref11"><label>11</label><mixed-citation publication-type="other" xlink:type="simple">马会. 公安机关案件管理系统的设计与实现[D]: [硕士学位论文]. 成都: 电子科技大学, 2013.</mixed-citation></ref></ref-list></back></article>