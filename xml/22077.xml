<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">OJCS</journal-id><journal-title-group><journal-title>Open Journal of Circuits and Systems</journal-title></journal-title-group><issn pub-type="epub">2327-0853</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/OJCS.2017.63011</article-id><article-id pub-id-type="publisher-id">OJCS-22077</article-id><article-categories><subj-group subj-group-type="heading"><subject>OJCS20170300000_65311615.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject><subject> 工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  GPS定位的公交语音报站系统的设计与实现
  Design and Realization of Bus Station Voice Report System Base on the GPS
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>杨</surname><given-names>桃香</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>张</surname><given-names>锋</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><addr-line>曲靖师范学院物理与电子工程学院，云南 曲靖</addr-line></aff><aff id="aff2"><addr-line>null</addr-line></aff><author-notes><corresp id="cor1">* E-mail:<email>yy7-yy7@126.com(杨桃)</email>;</corresp></author-notes><pub-date pub-type="epub"><day>05</day><month>09</month><year>2017</year></pub-date><volume>06</volume><issue>03</issue><fpage>87</fpage><lpage>95</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   本文设计了一种基于GPS定位的公交车自动报站系统，它利用GPS接收单元接收卫星发送的信号，通过接收数据确认车辆的动态位置(经度、纬度)、时建、状态等信息，与公交线路信息库中存储的车站信息进行比较，根据预先设定的信息和规则向乘客通报车站和线路信息，以及语音温磬提示等多项服务。它可以彻底改变传统公交车语音报站必须由司机操控才能工作的落后方式，完全不需要人工介入，实现公交车报站的完全智能化。该系统是以GPS定位技术为基础来实现自动定位，从而提供自动报站服务。 The paper designs a kind of automatic bus stops system based on GPS. It uses GPS receiving unit to receive signals transmitted by satellite, and then to confirm the vehicle dynamic location (longitude, latitude), time, status and other information by it. And compared with the information stored in the library, it is based on the predetermined set of information to remind passengers the stations and line information, and voice cozy tip or many other services. It can completely change the backward mode that the traditional bus auto-reporter-calling stop must be made by the driver controls to work, and completely do not need artificial intervention, and then realize the bus stop reporting completely intelligent. In order to provide automatic station reporting service, the system is based on GPS technology as the foundation to realize automatic positioning. 
  
 
</p></abstract><kwd-group><kwd>GPS，语音报站，STC89C52RC，LED显示, GPS</kwd><kwd> Voice Announcement</kwd><kwd> STC89C52RC</kwd><kwd> LED Display</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>GPS定位的公交语音报站系统的设计与实现<sup> </sup></title><p>杨桃香，张 锋</p><p>曲靖师范学院物理与电子工程学院，云南 曲靖</p><p>收稿日期：2017年8月26日；录用日期：2017年9月8日；发布日期：2017年9月15日</p><disp-formula id="hanspub.22077-formula1"><graphic xlink:href="http://html.hanspub.org/file/3-2780100x5_hanspub.png"  xlink:type="simple"/></disp-formula><p>摘 要</p><p>本文设计了一种基于GPS定位的公交车自动报站系统，它利用GPS接收单元接收卫星发送的信号，通过接收数据确认车辆的动态位置(经度、纬度)、时建、状态等信息，与公交线路信息库中存储的车站信息进行比较，根据预先设定的信息和规则向乘客通报车站和线路信息，以及语音温磬提示等多项服务。它可以彻底改变传统公交车语音报站必须由司机操控才能工作的落后方式，完全不需要人工介入，实现公交车报站的完全智能化。该系统是以GPS定位技术为基础来实现自动定位，从而提供自动报站服务。</p><p>关键词 :GPS，语音报站，STC 89C 52RC，LED显示</p><disp-formula id="hanspub.22077-formula2"><graphic xlink:href="http://html.hanspub.org/file/3-2780100x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2017 by authors and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="http://image.hanspub.org:8080\Html/htmlimages\1-2890033x\e70a10f1-7c93-45ea-9603-062237856e4b.png" /><img src="http://image.hanspub.org:8080\Html\htmlimages\1-2890033x\e898c85e-ffc4-45c9-b817-14224a4d6960.png" /></p></sec><sec id="s2"><title>1. 引言</title><p>从1831英国人沃尔特&#183;汉考克制造出世界上第一辆装有发动机的公共汽车起，公交车已经历经了将近200年的发展过程。从最初的“闷罐头”到如今配套的空调系统；从专人售票到无人售票；从人工报站到半自动语音报站，公交车向着越来越人性化的方向发展。可是目前仍存在一个问题，半自动语音报站系统需要由司机在机车进出公交站的时候人工操作，而这两个时间点往往是路面情况较复杂的时刻，因此也给行驶中的车辆带来了安全隐患。本设计的目标就是彻底摒弃人工操作，实现公交车进出站时的全自动语音报站，并且伴有语音提示和LED显示屏显示等信息。</p><p>本文利用GPS模块实现站台的自动识别，通过单片机对LED模块及语音模块的综合控制实现全自动语音报站和显示站台信息的功能。</p></sec><sec id="s3"><title>2. 硬件系统设计</title><sec id="s3_1"><title>2.1. 系统设计</title><p>本系统实现自动播报站名且兼有LED同步显示信息的功能。系统主要由五大部分组成：主控制核心单片机、GPS定位信息采集模块、按键模块、语音模块和LED显示模块(如图1)。设计的整体思路是：通过按键电路和GPS定位系统采集地段信息并传给单片机，单片机获取信号后进行数据处理，在LED显示屏上显示当前和下一站站名信息，同时通过语音芯片输出放大后的语音信息 [<xref ref-type="bibr" rid="hanspub.22077-ref1">1</xref>] [<xref ref-type="bibr" rid="hanspub.22077-ref2">2</xref>] 。</p></sec><sec id="s3_2"><title>2.2. 系统的工作原理</title><p>设备通电运行后，处理器会把FlashROM中保存的各站点经纬度数据读入内存，启动GPS模块工作，</p><p>图1. 系统工作原理图</p><p>实时捕获车辆行驶过程中地理位置数据，然后与站点地理数据比较，确定车辆的具体行驶位置。处理器根据车辆的不同状态，调用经纬度信息，并启动语音文件播放器，同时调用FlashROM中对应的显示字库内容，传输到LED显示屏显示，从而实现了自动语音报站和文字信息同步显示。且在途中运行阶段，LED显示屏会持续滚动显示下一站的站名，方便乘客及时掌握车辆行驶状态。</p></sec><sec id="s3_3"><title>2.3. 主控系统</title><p>主控系统处理器MCU采用的是宏晶公司STC89系列的STC 89C 52RC。STC 89C 52RC是宏晶科技推出的新一代超强抗干扰/高速/低功耗的单片机，指令代码完全兼容传统8051单片机，12时钟/机器周期和6时钟/机器周期可任意选择 [<xref ref-type="bibr" rid="hanspub.22077-ref3">3</xref>] 。</p></sec><sec id="s3_4"><title>2.4. GPS定位</title><p>该系统是通过GPS接收单元接收卫星发送的信号确认车辆的动态位置(经度、纬度)、时间、状态等信息，与公交线路信息库中存储的车站的位置信息进行比较，根据预先设定的信息和规则向乘客通报车站和线路的语音信息。GPS选用微型12通道GPS接收器，可以同时接收12颗卫星信号(只要能观测到4颗卫星，就能得到观测点的三维坐标)。美国取消SA政策以后，一般微型GPS接收机的即时定位精度在10~20 m之间，完全满足自动报站系统的需要 [<xref ref-type="bibr" rid="hanspub.22077-ref4">4</xref>] 。</p></sec><sec id="s3_5"><title>2.5. 语音播放</title><p>WTV 170系列语音芯片是广州唯创电子有限公司推出的一款语音芯片，其性能优越，价格实惠，能为用户提供很高的性价比 [<xref ref-type="bibr" rid="hanspub.22077-ref5">5</xref>] 。本设计采用的是三线制控制方式，其具体硬件电路如图2所示：</p><p>图2. 语音播报硬件电路</p></sec><sec id="s3_6"><title>2.6. LED显示屏文字播放</title><p>LED显示屏具有屏幕大、亮度高、视觉好、节能环保、寿命长、易于数字化控制以及价位低的特点，与LCD显示屏比较，更适合在公交车上使用 [<xref ref-type="bibr" rid="hanspub.22077-ref6">6</xref>] 。</p><p>本设计中使用的LED显示屏为64 &#215; 16点阵的单色屏体。为了保证显示内容与显示屏体大小无关，设计中显示方式采用跑马道的形式显示信息。</p></sec><sec id="s3_7"><title>2.7. 按键电路</title><p>本系统兼有按键操作功能，键盘上的每一个键都有一个编号，CPU采用中断方式获取有无键输入的信息，并判断是哪个键按下，然后通过相应的键转移指令执行该键的功能程序。其具体电路如图3所示。</p></sec></sec><sec id="s4"><title>3. 系统软件设计</title><sec id="s4_1"><title>3.1. 主程序流程(见图4)</title></sec><sec id="s4_2"><title>3.2. GPS模块程序设计</title><p>GPS一次接收数据流程(见图5)： [<xref ref-type="bibr" rid="hanspub.22077-ref7">7</xref>] [<xref ref-type="bibr" rid="hanspub.22077-ref8">8</xref>] 。</p></sec><sec id="s4_3"><title>3.3. 语音设计</title><p>为保证语音与文字同步，应用程序在调用语音播放的同时，把AT 29C 020 (256 KB的FLASH空间)中对应内容送给LED显示屏上滚动显示。语音程序流程，见图6。</p></sec><sec id="s4_4"><title>3.4. LED屏显示控制的软件实现</title><p>扫描显示是利用人的视觉暂停原理，分时分行显示，由于每行重复显示时间间隔足够小，以至于人眼根本不能分辨，最终达到整屏点亮的效果。</p><p>(1) LED显示屏系统总体构架(见图7)。</p><p>图3. 按键电路</p><p>图4. 主程序流程图</p><p>图5. GPS一次接收数据流程</p><p>图6. 语音程序流程图</p><p>图7. LED显示屏系统总体构架</p><p>(2) LED显示软件流程(见图8)。</p></sec></sec><sec id="s5"><title>4. 调试</title><sec id="s5_1"><title>4.1. 最小系统调试</title><p>(1) 在电路设计时，先测试晶振的好坏，再把晶振尽可能的接近单片机的18、19脚。</p><p>(2) 程序下载不进去的时候，有可能是因为MAX232烧毁。</p><p>(3) 程序下载时内部扩展AUX-RAM必须选禁止访问，不然单片机访问片内的RAM，导致数据出错。</p><p>(4) ISP下载：赋值ISP_CONTR = 0x60。</p></sec><sec id="s5_2"><title>4.2. 语音模块调试</title><p>按照WTV系列语音的经典电路连接，其中需要注意的几个问题。</p><p>图8. LED显示程序流程图</p><p>(1) 振荡电路：R = 270 K，C = 101的无极性电容可以适当改变。R的值可调整语音播放的速度，阻值变小则语音速度变快，改动区间为：250 K~290 K。调节R5(反馈电阻)的大小可以改变音量，电阻的可调范围为0~50 KΩ，阻值越大，音量越大。</p><p>(2) 芯片的供电为3.3 V。</p><p>(3) 布线时VCC端的电容C1，要尽量靠近VCC管脚，同时，震荡电阻R2也要靠近R-FREQ管脚，以增强WTV系列语音芯片的抗干扰能力。</p><p>(4) 在单片机+5 V供电，语音芯片3.3 V供电的情呀下，需要在IO口上串接上470 Ω的电阻。</p><p>(5) 芯片控制方式分为按键、并口和串口模式，其中串口模式又分为一线串口和三线串口模式，在设计之前就要考虑好。语音内容和芯片控制方式需要合适，一般播放的内容较少可以选择一线式比较方便，但内容相对多的时候需要选用三线式，这些都需要设计电路之前就考虑好。</p></sec><sec id="s5_3"><title>4.3. 显示调试</title><p>本文采用显示单元板为1/16扫描驱动电路，设计中送列数据之后的行扫描需要控制好时间，另外在程序调试过程中应特别注意：</p><p>(1) 如果行扫描信号停止，只会看到一行数据；</p><p>(2) 如果行扫描速度过低会看到数据在一行到另一行之间跳动；</p><p>(3) 如果行扫描速度过高会看到整屏都是红屏；</p><p>设计中根据标准的LED显示屏标准设计程序，调试的过程中刚开始显示屏显示暗红，主要是因为LED的消影开关设置反了的原因。</p></sec><sec id="s5_4"><title>4.4. 按键调试</title><p>本设计测试过程中采用两种方法判断按键按下：</p><p>(1) 第一种是中断的方式。系统中设计了6个按键，使用了两个74HC08，将按键全部“与”起来接到单片机的外部中断输入口，接上拉电阻，这样情况下不管哪一个按键按下都会触发中断，然后就到中断中把按键标志置高。然后单片机判断到标志后处理相应的按键程序；</p><p>(2) 第二是采用查询的方式。单片机不断的查询是否有按键按下，如果有按键按下的执行相应的按键程序，否则的话继续查询。</p><p>采用查询方式比较占用时间，体统中需要判断的地方比较多，容易导致程序运行速度降低，所以本设计采用了中断的方式判断按键。</p></sec></sec><sec id="s6"><title>5. 结论</title><p>本次设计基本达到了预先的要求，实现了公交语音报站以及LED显示功能。但在GPS定位自动控制报站器方面功能还需要完善，主要因为GPS接收到的是字符数据，要实现设计最初与预设值进行比较然后判断位置的目的，需要的是具体的经纬度数据信息，但精确经纬度信息的获取比较困难。</p></sec><sec id="s7"><title>资助信息</title><p>本文工作获云南省教育厅项目(2015C085Y)和曲靖师范学院(YZKC027)等项目支持。</p></sec><sec id="s8"><title>文章引用</title><p>杨桃香,张 锋. GPS定位的公交语音报站系统的设计与实现Design and Realization of Bus Station Voice Report System Base on the GPS[J]. 电路与系统, 2017, 06(03): 87-95. http://dx.doi.org/10.12677/OJCS.2017.63011</p></sec><sec id="s9"><title>参考文献 (References)</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.22077-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">邓兴成. 单片机原理与实践指导[M]. 北京: 机械工业出版社, 2009.</mixed-citation></ref><ref id="hanspub.22077-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">冯建华, 赵亮. 单片机应用系统设计与产品开发[M]. 北京: 人民邮电出版社, 2004.</mixed-citation></ref><ref id="hanspub.22077-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">宏晶科技有限公司. STC宏晶单片机使用手册[EB/OL].  
http://www.stcmcu.com/datasheet/stc/STC-AD-PDF/STC89C51RC-RD+_GUIDE-CHINESE.pdf, 2017-09-12.</mixed-citation></ref><ref id="hanspub.22077-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">鼎天国际. REB-3571LP GPS模块使用手册[EB/OL].  
https://wenku.baidu.com/view/8da0a81cc5da50e2524d7ffc.html, 2017-09-12.</mixed-citation></ref><ref id="hanspub.22077-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">唯创电子有限公司. WTV系列语言芯片资料[EB/OL]. 
http://wenku.baidu.com/view/35eb9d3610661ed9ad51f3c3.html, 2017-09-12.</mixed-citation></ref><ref id="hanspub.22077-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">赵明富, 张先富, 张松飞. 公交站牌报站屏的设计[J]. 电子技术应用, 2008, 24(10): 19-25.</mixed-citation></ref><ref id="hanspub.22077-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">刘鲁玉, 吴旭光, 张竞凯, 乔晶. 基于GPS 的公交调度系统智能报站器的设计与实现[J]. 电子测量技术, 2008，31(2): 9-13.</mixed-citation></ref><ref id="hanspub.22077-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">何玉松. 单片机多任务系统实现方法[J]. 国外电子元器件, 2007, 12(4): 7-11.</mixed-citation></ref></ref-list></back></article>