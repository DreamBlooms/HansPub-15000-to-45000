<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">OJCS</journal-id><journal-title-group><journal-title>Open Journal of Circuits and Systems</journal-title></journal-title-group><issn pub-type="epub">2327-0853</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/OJCS.2020.92002</article-id><article-id pub-id-type="publisher-id">OJCS-35919</article-id><article-categories><subj-group subj-group-type="heading"><subject>OJCS20200200000_36524553.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject><subject> 工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于升压，升降压的高压LED驱动芯片设计
  Design of a High Voltage LED Driver Based on Boost or Buck-Boost Converter
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>骆</surname><given-names>妙艺</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>吴</surname><given-names>超</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff3"><addr-line>厦门矽恩微电子有限公司，福建 厦门</addr-line></aff><aff id="aff2"><addr-line>null</addr-line></aff><aff id="aff1"><addr-line>厦门工学院，福建 厦门 ；厦门矽恩微电子有限公司，福建 厦门</addr-line></aff><pub-date pub-type="epub"><day>03</day><month>06</month><year>2020</year></pub-date><volume>09</volume><issue>02</issue><fpage>9</fpage><lpage>17</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  设计了一款根据外围应用电路的不同可以实现升压以及升降压型的宽输入电压范围的恒流LED驱动芯片，该芯片输入电压高达35 V，输出电压不限。驱动电流可由外接电阻设置，可以驱动高达48 W的大功率LED灯，工作的开关频率可由外部电阻设置，调节范围100 KHz~1 MHz。该款芯片具有丰富的调光功能，包括模拟，数字转模拟以及数字调光，内部自带软启动、过温保护、欠压，过压等保护功能。采用HHNEC PMU350，5V/40V工艺完成芯片的设计，转换效率可达85％以上，采用TSSOP-16的封装，外围应用电路简单，无需大电感，是目前推向市场的一款功能丰富的升降压型芯片。
   A Boost/Buck-Boost Topology constant current LED driver IC was proposed, of which the input voltage is up to 35 V, and output voltage is unlimited. This IC regulates the LED current by setting the external resistor, and can drive up to 48 W high power LED lighting. The operating frequency also can be set up by external resistor, ranging from 100 KHz to 1 MHz. The IC has rich dimming functions, including analog, digital to analog and digital dimming, with built-in soft start, over-temperature protection, undervoltage, overvoltage and other protection functions. The IC is de-signed and fabricated in HHNEC PMU350, 5V/40V process, with a power conversion efficiency up to 85%, available in TSSOP-16 package, without large inductance, and has simple application circuit. This IC is a powerful DC-DC converter pushing to the market.
 
</p></abstract><kwd-group><kwd>升压结构，升降压结构，高低端检测，斜波补偿, Boost Topology</kwd><kwd> Buck-Boost Topology</kwd><kwd> High to Low Voltage Detection</kwd><kwd> Slope Compensation</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于升压，升降压的高压LED驱动芯片设计<sup> </sup></title><p>骆妙艺<sup>1,2</sup>，吴超<sup>2</sup></p><p><sup>1</sup>厦门工学院，福建 厦门</p><p><sup>2</sup>厦门矽恩微电子有限公司，福建 厦门</p><p>收稿日期：2020年5月13日；录用日期：2020年5月27日；发布日期：2020年6月3日</p><disp-formula id="hanspub.35919-formula11"><graphic xlink:href="//html.hanspub.org/file/1-2780164x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>设计了一款根据外围应用电路的不同可以实现升压以及升降压型的宽输入电压范围的恒流LED驱动芯片，该芯片输入电压高达35 V，输出电压不限。驱动电流可由外接电阻设置，可以驱动高达48 W的大功率LED灯，工作的开关频率可由外部电阻设置，调节范围100 KHz~1 MHz。该款芯片具有丰富的调光功能，包括模拟，数字转模拟以及数字调光，内部自带软启动、过温保护、欠压，过压等保护功能。采用HHNEC PMU350，5V/40V工艺完成芯片的设计，转换效率可达85％以上，采用TSSOP-16的封装，外围应用电路简单，无需大电感，是目前推向市场的一款功能丰富的升降压型芯片。</p><p>关键词 :升压结构，升降压结构，高低端检测，斜波补偿</p><disp-formula id="hanspub.35919-formula12"><graphic xlink:href="//html.hanspub.org/file/1-2780164x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2020 by author(s) and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY 4.0).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/1-2780164x7_hanspub.png" /> <img src="//html.hanspub.org/file/1-2780164x8_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>该款芯片用于升压/升降压拓扑结构的高压高亮度的LED驱动器。该器件具有较宽的电压输入范围，工作时输入电压可以承受峰值电压达35 V，输出根据外围LED灯的个数设定，电压值不限。根据应用电路不同可以同时具有高端和低端电流检测功能，实现BOOST/BUCK-BOOST两种拓扑结构自动判别。芯片包括过温、过压、欠压等保护功能，并有故障检测输出引脚FAULT。调光精度良好，输出电流由外部电阻设定，内部设计修正模块，使得电流精度高达&#177;2.5%，该款芯片是发挥现在LED寿命长等优势设计的一款高效率、可靠的LED驱动芯片，这也是LED照明的关键。</p></sec><sec id="s4"><title>2. 芯片应用电路 [<xref ref-type="bibr" rid="hanspub.35919-ref1">1</xref>]</title><p>图1、图2所示电路分别为该款芯片应用于升压以及升降压模式的应用电路图。该方案可用于商用LED照明，路灯，手机背光灯等等。当输出需要很多个LED灯串联时可采用BOOST方案1，当输出灯数并不多，可以采用BUCK-BOOST方案2，根据灯数目多少输入电压变化时芯片自动升降压。该款芯片采用峰值电流控制模式，CS用于检测电感电流值，COMP为环路外部补偿引脚。芯片可通过LD引脚输入0~2.5 V直流电平实现模拟调光的功能，直接控制采样电阻Rs的端电压来调节输出LED电流。如果LD引脚外接电容时，可以通过PWM端口实现外部输入数字脉冲信号转内部模拟调光，将外部PWM信号的占空比在芯片内部滤波成一等效的直流电压值，从而通过此电压控制RS两端电压来实现模拟调光。而不接电容时就是单纯数字调光方案的应用，外部PWM信号送入芯片通过Fault引脚，直接控制外部MOS开关来调节输出LED串的亮灭，其中Fault是芯片自带的错误功能输出引脚，控制外部LED灯串的开关，此种调光方案PWM信号与Fault引脚复用。也就是说LED电流通过ISP与ISN引脚之间的检测电阻Rs设置，模拟调光就是改变ISP与ISN检测电压，而数字调光是对LED主回路直接进行调光，数字调光方案响应速度非常快，流过LED灯的电流不变，调光光源质量好，但是调光频率太低会落入人耳能够听的噪声范围，两种方案可供客户自由选择。Fset引脚用于设定芯片工作频率，调节范围为100 KHz~1 MHz。该芯片还设计了齐全的保护环节，具有软启动，过温保护，过压保护，输入欠压保护等，当芯片出现上述异常，会通过Fault引脚输出，客户可以直观接收错误故障信息。EN是使能信号，当不使用该芯片时可通过EN进入睡眠模式，大大减小静态功耗。此外，这是一款外置NMOS的驱动器，栅极驱动电压为12 V，其他具体参数可参考产品说明书。</p><p>图1. 升压模式应用图</p><p>图2. 升降压模式应用图</p></sec><sec id="s5"><title>3. 驱动芯片结构</title><p>图3为驱动芯片内部结构框图，通过ISP与ISN引脚检测外部电压差值与误差放大器的参考电压进行比较，该电路还设计了BUCK/BUCK-BOOST模式自动切换电路，通过判断外围电路应用时ISN引脚接地还是接输入端VIN，当ISN接地时，ISP直接与误差放大器参考电压比较，而接高端VIN时，则利用两个引脚ISP与ISN做差再与误差放大器比较。同时还设计了由采样电阻，电流检测模块等构成的峰值电流反馈环路，以及斜波补偿，调光，芯片保护等功能。</p><p>图3. 芯片内部框图</p><p>该芯片工作原理如下：当通过LED电流增大时，检测到ISP与ISN引脚之间电压增大，误差放大器输出电压COMP下降，此时由于外部电流增加，通过CS检测到的外部电感电流镜像进入采样电阻时，由于流过的电流增加，芯片内部采样电阻上压降增大，从而使得PWM的比较器提前翻转，占空比下降，</p><p>从而调节输出电压使其下降，由于LED灯的电流<inline-formula><inline-graphic xlink:href="//html.hanspub.org/file/1-2780164x12_hanspub.png" xlink:type="simple"/></inline-formula>；通过调整输出电压达到流过LED电流</p><p>恒定，内部通过TRIM电路来修调LED电流精度，使其高达&#177;2.5%。</p></sec><sec id="s6"><title>4. 主要模块设计</title><p>这款基于BOOST/BUCK-BOOST的高压大功率LED恒流驱动芯片，内部集成了粗略基准源，带隙基准源、内部5 V LDO、驱动外部MOS的12 V LDO、偏置电流产生电路、模拟和数字调光部分、环路控制电路，电感电流检测电路、高端转低端检电路、斜波补偿电路、过温、欠压、过压等保护电路、外部工作频率设置电路，时钟电路，逻辑控制电路和输出管驱动电路等。芯片内部模块较多这里要提的是在设计要特别注意的是由于该款芯片输入电压高达35 V，而内部电压通常工作在低压5 V电压下。因此输入电压不能够直接给芯片供电，需要由外部电压通过粗略基准源产生一个粗略的低电压基准为内部带隙基准电压电路以及5V LDO电源供电。结构示意如图4所示，粗略基准源产生电路内部管子耐压必须为40 V的高压管，其栅极用MOS管作为二极管连接的方式来接，将电压钳位住，使得高压管的栅极不会看到高压，输出端可以得到一个粗略的低压基准源 [<xref ref-type="bibr" rid="hanspub.35919-ref2">2</xref>]。</p><p>由于整个芯片较为复杂，在此对自动判别两种拓扑结构的高端到低端检测电路以及斜波补偿电路这2个重要的子模块电路的设计做了重点研究，通过Cadence的hspice软件对子电路和系统的各项参数进行了仿真和优化。</p><p>图4. 电源内部结构示意图</p><sec id="s6_1"><title>4.1. 高端到低端电压检测电路</title><p>该款芯片用于BOOST结构，电流检测电阻RIS串联到地，直接检测RIS电阻两端电压与误差放大器做比较即可(图1)，而应用于buck-boost结构时高端的检流电阻RIS串联到高压输入端VIN (图2)。因此需要一个高端到低端电压检测电路，该电路可在高达40 V的共模输入电压下检测ISP-ISN的电压(高压)，并产生一个跟它成比例的、以地为参考点的电压输出，并且要求该输出具有较高的精度。</p><p>图5. 高端转低端检测电路</p><p>图5为高端到低端电压电路框图。输出电压ISP-ISN与检流电阻RIS的关系式为：(IR1 + IRSen) * R1 = IIS * RIS + IR2 * R2。这里要求内部R1，R2电阻一致且版图布版时特别注意匹配，由于IR1 = IR2，R1 = R2因此可得IRSen * R1 = IIS * RIS由于误差放大器检测到的VREF电压就是我们希望的与RIS上面的高端检测电压ISP-ISN成比例的电压输出。</p><p>Vref = IRSen * RSen = (IIS*RIS) * Rsen/R1 = VISP-ISN * RSen/R1，因此只要内部电路RSen与R1的比例关系确定，该检测电压值Vref就确定。当然为了达到高精度同样需要修调电路调整电流值。</p></sec><sec id="s6_2"><title>4.2. 斜波补偿模块 [<xref ref-type="bibr" rid="hanspub.35919-ref3">3</xref>]</title><p>由于电流模式控制的BOOST芯片在连续导通模式下，如图6(a)为占空比小于和大于50%的斜波补偿示意图，由图可以看出当占空比大于50%时，电感电流上一外加的扰动信号产生的误差会被放大，导致最终电感电流输出出现不稳定现象。而占空比小于50%时系统能够自动调回。对此在占空比大于50%情况下可以给予负的谐波补偿如图6(b)，使得PWM脉冲提前关断，也就是误差放大器输出的控制电压加上这个斜波补偿的电压形成新的控制电压输入到PWM比较器的一端，与检测到的电流反馈电压比较来形成新的占空比将误差调整回来。图示m1是电感电流上升斜率，m2是电感电流下降斜率。</p><p>图6. 斜波补偿示意图</p><p>由该图可以证明经过N个周期后，加入的斜波补偿斜率称为mc，电流I1在扰动信号ΔI1影响下会引起的电流误差为 Δ I 2 = Δ I 1 [ − ( m 2 − mc ) / ( m 1 + mc ) ] 。因此要想使得系统稳定的条件是下一个周期电流比上一个周期电流扰动更小，也就是 α = ( m 2 − mc ) / ( m 1 + mc ) &lt; 1 ，整理后我们可以得到结果mc &gt;= 1/2 * m2，也就是补偿斜率大于电感电流斜率下降的一半。在很多芯片中直接采用通过计算的结果，在最差情况下的斜率m2，对该斜率进行一次线性补偿，这种方法电路实现简单，但是会带来严重的过补偿，这种特别是工作频率外部还可以调整时，容易出现某些工作频率下大占空比要么补偿不够仍然出现震荡或者有些频率下过补偿太多，带载能力下降甚至使得电路从电流模式进入电压模。该芯片内部采用分段线性补偿可以解决上述问题。</p><p>分段线性补偿的思想是根据斜波产生电路产生的斜波信号与若干个不同占空比时的电压点相比较控制不同占空比下补偿电流的大小不同，而针对不同工作频率所需要的补偿量不同，则可通过Fset引脚设定工作频率时，是根据其流过外部电阻的电流大小对电容充放电，其充放电电流大小不同所设定的工作频率不同。因此可以利用这个电流的比例来控制斜波补偿电流的比例。</p><p>该电路内部可以根据计算出的补偿量调节在锯齿波信号在40%时开始进行斜率补偿，40%到60%一个较小斜率，60%到70%另外一个斜率，70%到80%，80%以上各一档电流。对应的参考电压来控制不同的电流。让其在这之间开始引入电流。而引入电流的大小量由尾电流控制。电流结构框图和效果图7如下所示。</p><p>图7. 斜波补偿电路和波形示意图</p><p>当斜波电压升高到40%占空比时，最左边管子开始有电流流过，而当锯齿波电压升高到最大占空比时，几乎所有的尾电流全部流过。为了节省芯片内部功耗，以及比较器误翻转，在控制外部功率管的PWM翻转时及时将这部分电流关闭。这种分段线性补偿电流波形。随着占空比增大，补偿电流增大，其对应的斜率也增加。通过芯片最终的验证这种分段斜波补偿效果还是很有效的。</p></sec></sec><sec id="s7"><title>5. 芯片版图布局布线以及电路测试结果</title><p>该芯片的版图布局如图8所示，芯片面积为1180 μm &#215; 1330 μm。采用HHNEC公司的PMU350 40 V工艺进行流片。版图布局在整个芯片设计中非常重要。不仅要做到为了节约成本考虑布线宽度还要估计数字信号和模拟信号的布线，latch up等问题要将高压和低压管尽可能隔开，所以首先要布置好整体floor plan。版图细节设计要考虑好模块布局布线，以及模拟地和数字地的布线，大电流模块流经的电流大小和版图线宽以及干扰信号尽量避开基准电源等模块，器件的匹配对电流精度的影响等 [<xref ref-type="bibr" rid="hanspub.35919-ref4">4</xref>]。</p><p>系统的仿真采用Candence的Hspice仿真，仿真时不仅要考虑到输入电压线性调整率、负载调整率、转换效率、纹波大小以及各种保护功能、调光功能等，还要充分考虑电源、地的干扰，可以在仿真中加入合理的寄生电感等进一步确保流片成功。图9所示为在芯片输入电压为12 V，输出接10个灯35 V，电流设定300 mA，工作频率250 KHz时，工作在boost模式下示波器所测电感电流波形。</p><p>图8. 芯片整体版图</p><p>图9. 示波器输出稳定电感电流波形</p><p>该芯片测试结果表明，芯片 [<xref ref-type="bibr" rid="hanspub.35919-ref5">5</xref>] 能够根据外围电路自动判别是升压还是升降压型芯片，并能达到输出电流高精度，且输入电压范围广、数字模拟调光精确、保护功能齐全，芯片此时输出功率为48 V，应用条件为外接10个白光LED，输出电流为1.35 A时，芯片在实验室的测试图，芯片的转换效率可达85%以上。</p></sec><sec id="s8"><title>文章引用</title><p>骆妙艺,吴 超. 基于升压，升降压的高压LED驱动芯片设计Design of a High Voltage LED Driver Based on Boost or Buck-Boost Converter[J]. 电路与系统, 2020, 09(02): 9-17. https://doi.org/10.12677/OJCS.2020.92002</p></sec><sec id="s9"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.35919-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">魏智. DC-DC转换器设计[J]. 国外电子元器件, 2001, 8(12): 65-67.</mixed-citation></ref><ref id="hanspub.35919-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">张彦科, 鲍嘉明. 一种基于升压DC-DC变换器的白光LED驱动芯片[J]. 微电子学, 2011, 41(4): 525-527, 535.</mixed-citation></ref><ref id="hanspub.35919-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">Anunciada, A.V. and Silva, M.M. (1992) On the Stability and Subharmonic Susceptibility of Current-Mode Controlled Converters. 23rd Annual IEEE Power Electronics Specialists Conference, Toledo, 29 June-3 July 1992, 345-353.  
&lt;br&gt;https://doi.org/10.1109/pesc.1992.254653</mixed-citation></ref><ref id="hanspub.35919-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">陈传虞, 刘明, 陈家桢. LED驱动芯片工作原理与电路设计[M]. 北京: 人民邮电出版社, 2011.</mixed-citation></ref><ref id="hanspub.35919-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">张占松, 蔡宣三. 开关电源的原理与设计(修订版) [M]. 北京: 电子工业出版社, 2004: 7-16.</mixed-citation></ref></ref-list></back></article>