<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">OJCS</journal-id><journal-title-group><journal-title>Open Journal of Circuits and Systems</journal-title></journal-title-group><issn pub-type="epub">2327-0853</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/OJCS.2017.62004</article-id><article-id pub-id-type="publisher-id">OJCS-20891</article-id><article-categories><subj-group subj-group-type="heading"><subject>OJCS20170200000_57495998.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject><subject> 工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  光谱传感物联网节点的无线通信接口设计
  Design of Wireless Communication Interface Used in Spectral Sensing IOT Node
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>王</surname><given-names>绪泉</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>黄</surname><given-names>松垒</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>于</surname><given-names>月华</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>叶</surname><given-names>捷敏</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>邵</surname><given-names>秀梅</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>方</surname><given-names>家熊</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><addr-line>中国科学院上海技术物理研究所，传感技术联合国家重点实验室，上海；中国科学院上海技术物理研究所，中国科学院红外成像材料与器件重点实验室，上海</addr-line></aff><aff id="aff2"><addr-line>null</addr-line></aff><author-notes><corresp id="cor1">* E-mail:<email>wangxq@mail.sitp.ac.cn(王绪)</email>;</corresp></author-notes><pub-date pub-type="epub"><day>07</day><month>06</month><year>2017</year></pub-date><volume>06</volume><issue>02</issue><fpage>33</fpage><lpage>39</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   根据近红外光谱数据的格式和特点，设计一种光谱传感物联网节点的无线通信接口，实现近红外光谱数据从物联网节点到电脑上位机的无线传输。主要进行了无线通信接口的硬件电路和软件程序设计，使用C#语言编写了接收端上位机，并借助单色仪进行了功能验证。实验结果表明，该无线通信接口的传输速率和通信距离可以满足物联网节点的近红外光谱数据传输应用需求，物联网节点一帧光谱数据的采集和传输时间小于1秒，总体功耗小于300 mW，最大通信距离大于150米，具有微型化和低功耗的特点。 Communication interface is vital constituent part in IOT node and it should be designed based on data types and data structures. Wireless communication is playing a more and more important role in many occasions for its mobility, flexibility, easy extension and low cost. We present here our latest work in developing a wireless communication interface used in spectral sensing IOT node. The near-infrared spectral data can be acquired from a node to the computer spectral software using wireless transmission mode. The spectral software can save the spectral data and draw spectral curve on the screen, which is designed using C language. An automatic grating monochromator was used to test and verify the function of this wireless communication interface. The experimental results show that the transmission speed and the communication distance of wireless communication interface meet the requirements of spectral sensing IOT application. 
  
 
</p></abstract><kwd-group><kwd>物联网，近红外，无线通信，微型化, IOT</kwd><kwd> Near-Infrared</kwd><kwd> Wireless Communication</kwd><kwd> Miniaturization</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>光谱传感物联网节点的无线通信接口设计<sup> </sup></title><p>王绪泉<sup>1,2</sup>，黄松垒<sup>1,2</sup>，于月华<sup>1,2</sup>，叶捷敏<sup>1,2</sup>，邵秀梅<sup>1,2</sup>，方家熊<sup>1,2</sup></p><p><sup>1</sup>中国科学院上海技术物理研究所，传感技术联合国家重点实验室，上海</p><p><sup>2</sup>中国科学院上海技术物理研究所，中国科学院红外成像材料与器件重点实验室，上海</p><p>收稿日期：2017年5月16日；录用日期：2017年6月4日；发布日期：2017年6月7日</p><disp-formula id="hanspub.20891-formula25"><graphic xlink:href="http://html.hanspub.org/file/1-2780087x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>根据近红外光谱数据的格式和特点，设计一种光谱传感物联网节点的无线通信接口，实现近红外光谱数据从物联网节点到电脑上位机的无线传输。主要进行了无线通信接口的硬件电路和软件程序设计，使用C#语言编写了接收端上位机，并借助单色仪进行了功能验证。实验结果表明，该无线通信接口的传输速率和通信距离可以满足物联网节点的近红外光谱数据传输应用需求，物联网节点一帧光谱数据的采集和传输时间小于1秒，总体功耗小于300 mW，最大通信距离大于150米，具有微型化和低功耗的特点。</p><p>关键词 :物联网，近红外，无线通信，微型化</p><disp-formula id="hanspub.20891-formula26"><graphic xlink:href="http://html.hanspub.org/file/1-2780087x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2017 by authors and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="http://image.hanspub.org:8080\Html/htmlimages\1-2890033x\e70a10f1-7c93-45ea-9603-062237856e4b.png" /><img src="http://image.hanspub.org:8080\Html\htmlimages\1-2890033x\e898c85e-ffc4-45c9-b817-14224a4d6960.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>物联网是物品间通过信息传感技术和通信网络进行信息处理、交换的一种网络概念，从技术架构上可分为感知层、网络层和应用层三层 [<xref ref-type="bibr" rid="hanspub.20891-ref1">1</xref>] 。感知层由各式各样的传感器节点构成，其主要功能是完成各种类型的信息获取和数据采集。典型的物联网节点系统包括数据采集模块、数据处理和控制模块、通信模块和能量供应模块四部分 [<xref ref-type="bibr" rid="hanspub.20891-ref2">2</xref>] 。通信接口作为数据传输和信息交换的核心模块，必须根据节点的数据类型合理选择设计方案。物联网的网络层可以分为有线通信网络和无线通信网络两大类，无线通信网络的移动性强，覆盖面积大，可以给予传感器节点最大的位置自由度 [<xref ref-type="bibr" rid="hanspub.20891-ref3">3</xref>] 。</p><p>近年来，近红外光谱分析技术在农业、食品安全和环境监测等领域取得飞速发展，凭借测试速度、成本和分析效率等优势成为工农业生产过程中质量检测的重要分析手段 [<xref ref-type="bibr" rid="hanspub.20891-ref4">4</xref>] [<xref ref-type="bibr" rid="hanspub.20891-ref5">5</xref>] 。将近红外光谱分析与物联网相结合，通过网络化管理，可实现校正模型共享，达到效益的最大化 [<xref ref-type="bibr" rid="hanspub.20891-ref6">6</xref>] 。本文根据近红外光谱数据的特点，提出一种应用于光谱传感物联网节点的无线通信接口的设计，实现了近红外光谱数据从物联网节点到电脑上位机的无线传输。文章重点介绍了无线通信接口的软硬件设计和近红外光谱数据传输实验，实验结果表明，该接口的传输速率和通信距离可以满足物联网节点的光谱数据传输应用需求，具有微型化和低功耗的特点，可以为物联网向近红外光谱分析领域扩展提供技术支持。</p></sec><sec id="s4"><title>2. 硬件设计</title><p>光谱传感物联网节点的硬件结构如图1所示，光谱传感器是一款耦合线性渐变滤光片的256元线列InGaAs焦平面组件，FPGA用来产生光谱传感器的驱动脉冲和数据采集电路的控制信号，无线通信接口基于nRF905射频芯片设计，利用超低功耗的MSP430F149型单片机完成芯片的工作模式配置和无线传输控制 [<xref ref-type="bibr" rid="hanspub.20891-ref7">7</xref>] [<xref ref-type="bibr" rid="hanspub.20891-ref8">8</xref>] 。采用的nRF905型射频芯片，是NORDIC公司面向低功耗市场推出的无线传输芯片，内置功率放大器、频率合成器和调制器等功能模块，工作于433 MHz、868 MHz和915 MHz的ISM频段，传输速率50 kbps，非常适合物联网的数据传输应用。无线通信接口的关键信号如图2所示。</p><p>图1. 节点系统硬件结构</p><p>图2. 无线通信接口关键信号</p><p>FPGA采集的十四位精度光谱数据通过数据总线DATA[13:0]与MSP430单片机的通用IO相连，FPGA产生CS信号作为单片机的中断触发信号，单片机在中断程序内对数据采集电路的十四位光谱数据进行缓存。MSP430单片机和nRF905芯片的接口主要有使能信号、状态指示信号和SPI配置接口三部分。使能信号包括PWR-UP、TRX-CE和TXEN，PWR-UP为芯片上电使能信号，TRX-CE为数据发射和接收使能，TXEN用来设置具体工作状态，高电平选择发射状态，低电平选择接收状态，三信号配合控制，即可合理切换nRF905芯片的工作状态。状态指示信号包括载波检测信号CD、地址匹配信号AM和接收发送完成信号DR，主要作用是将芯片的工作状态实时告知控制器。SPI控制接口包括SCK、MISO、MOSI和CSN，单片机通过标准的SPI协议操作nRF905片内的多个寄存器，完成芯片的初始化及工作模式配置，包括设定中心频率、地址位长度、数据位长度以及是否需要自动重发等。远距离接收端通信接口与此类似，并通过串口连接电脑上位机。</p></sec><sec id="s5"><title>3. 程序设计</title><sec id="s5_1"><title>3.1. MSP430单片机程序设计</title><p>MSP430单片机程序的主要功能是配合FPGA产生的触发信号CS对光谱数据进行缓存，以及配置nRF905芯片完成光谱数据的无线传输。程序使用C语言设计，程序流程如图3所示。单片机上电后，首先进行时钟初始化和nRF905芯片的初始化，之后通过SPI接口配置nRF905的工作模式，选择中心频率433 MHz，发射功率10 dBm，有效数据位长度32字节。设置完成后打开中断，在CS信号上升沿的触发下进入中断程序进行各像元的光谱数据缓存，待一帧光谱数据采集完成后启动无线发送程序，完成光谱数据传输。</p><p>光谱传感器为256元线列焦平面组件，光谱数据的模数转换精度为十四位，每一像元的光谱信号要</p><p>分成高八位和低六位两个字节进行传输，一帧完整的光谱数据最少为512字节。nRF905芯片的数据包最大长度为32字节，预留出数据包头、包尾、节点号、数据包编号和校验位，设定每个数据包传输26字节的有效数据，将一帧512字节光谱数据分为二十个数据包发送。</p><p>设置接收端nRF905芯片的工作频率、地址与发送端相匹配，即可实时接收相应节点发送的光谱数据，切换接收端的工作频率和地址，可以实现对多个终端节点光谱数据的接收。</p></sec><sec id="s5_2"><title>3.2. 电脑上位机软件设计</title><p>接收端通过串口将光谱数据上传至电脑的数据采集上位机软件，上位机采用C#语言开发设计，主要功能是保存接收端的光谱数据并进行光谱曲线的绘制。上位机软件界面如图4所示，主要包括串口接收、光谱图绘制和数据保存三个部分。串口接收部分基于Serial Port类进行设计，包括端口选择、波特率设置、校验位选择、是否十六进制显示和是否自动换行等功能，数据按照设置格式实时显示在数据缓存区的文本框内。光谱图绘制操作在点击“解析”按钮之后执行，在文本框的原始数据中去除包头、包尾、节点号、数据包编号和校验位，并将得到的光谱数据与预标定的波长数据相对应，绘制一帧完整的光谱曲线。数据保存操作在点击“保存”按钮之后执行，将光谱数据以TXT文件格式保存在默认路径下，以便进行后续的数据处理和近红外光谱分析应用。</p><p>图3. 单片机程序流程框图</p><p>图4. 光谱数据采集软件</p></sec></sec><sec id="s6"><title>4. 实验测试</title><p>利用光谱传感节点测试HORIBA公司iHR550型单色仪发出的单色光，进行节点的无线传输功能验证。实验测试装置如图5所示，将光谱传感物联网节点放置于单色仪的准直出光口，选择单色仪光栅为950线，入口狭缝宽度和出口狭缝宽度均为4 nm，光谱传感节点设定传感器积分时间5 ms，nRF905芯片的发射功率为10 dBm，发送与接收模块距离15米。</p><p>实验设定单色仪发出1500 nm波长的单色光，利用光谱传感节点进行数据采集，数据通过nRF905无线通信模块传输后，在电脑上位机接收存储。传输前后光谱数据一致，光谱峰值附近像元的标定波长和相对响应强度如表1所示。将保存后的光谱数据进行归一化处理，拟合后得到图6所示光谱曲线，测试结果显示峰值波长为1501.1 nm，误差1.1 nm，误差值在光谱传感节点的测量误差范围之内。</p><p>光谱传感物联网节点整体功耗小于300 mW，主体体积约为7 cm &#215; 5 cm &#215; 5 cm。多次实验测量表明，一帧完整光谱数据的采集和传输时间小于1秒，无线通信接口工作状况稳定，数据传输准确。为了测试节点的无线通信距离，在无高大遮蔽物的环境下进行室外传输实验，增大通信距离到150米，无丢包现象出现。利用节点测试一款红外光源，所得谱线如图7所示，结果表明节点对950~1700 nm波段的近红外光均有响应，波长范围符合InGaAs焦平面传感器的器件特性。</p><table-wrap id="table1" ><label><xref ref-type="table" rid="table1">Table 1</xref></label><caption><title> Calibration wavelength and relative response nearby the peak wavefor</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >像元</th><th align="center" valign="middle" >标定波长/nm</th><th align="center" valign="middle" >相对光谱响应/a.u.</th></tr></thead><tr><td align="center" valign="middle" >150</td><td align="center" valign="middle" >1495.27</td><td align="center" valign="middle" >1375</td></tr><tr><td align="center" valign="middle" >151</td><td align="center" valign="middle" >1498.88</td><td align="center" valign="middle" >2213</td></tr><tr><td align="center" valign="middle" >152</td><td align="center" valign="middle" >1502.60</td><td align="center" valign="middle" >2286</td></tr><tr><td align="center" valign="middle" >153</td><td align="center" valign="middle" >1506.23</td><td align="center" valign="middle" >1487</td></tr><tr><td align="center" valign="middle" >154</td><td align="center" valign="middle" >1509.90</td><td align="center" valign="middle" >903</td></tr></tbody></table></table-wrap><p>表1. 峰值处各像元的标定波长及相对光谱响应</p><p>图5. 实验测试装置</p><p>图6. 1500 nm单色光响应曲线</p><p>图7. 节点波长范围测试</p></sec><sec id="s7"><title>5. 总结</title><p>根据近红外光谱数据的特点，提出一种光谱传感物联网节点的无线通信接口，并利用其实现了光谱数据从物联网节点到电脑上位机的无线传输。借助单色仪进行了无线传输功能验证，实验结果表明无线通信接口工作状况稳定，数据传输准确，通信距离大于150米，可以满足物联网节点的光谱数据传输应用需求，为近红外光谱分析与物联网相结合奠定技术基础。</p></sec><sec id="s8"><title>基金项目</title><p>感谢国家自然科学基金面上项目(61376052)对本论文工作的支持。</p></sec><sec id="s9"><title>文章引用</title><p>王绪泉,黄松垒,于月华,叶捷敏,邵秀梅,方家熊. 光谱传感物联网节点的无线通信接口设计Design of Wireless Communication Interface Used in Spectral Sensing IOT Node[J]. 电路与系统, 2017, 06(02): 33-39. http://dx.doi.org/10.12677/OJCS.2017.62004</p></sec><sec id="s10"><title>参考文献 (References)</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.20891-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">孙其博, 刘杰, 黎羴. 物联网: 概念, 架构与关键技术研究综述[J]. 北京邮电大学学报, 2010, 33(3): 1-9.</mixed-citation></ref><ref id="hanspub.20891-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">暴建民. 物联网技术与应用导论[M]. 北京: 人民邮电出版社, 2011: 2-20.</mixed-citation></ref><ref id="hanspub.20891-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">鄢林. 物联网中有线与无线通信接入选择研究[D]: [硕士学位论文]. 成都: 电子科技大学, 2008.</mixed-citation></ref><ref id="hanspub.20891-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">刘建学. 实用近红外光谱分析技术[M]. 北京: 科学出版社, 2008: 1-12.</mixed-citation></ref><ref id="hanspub.20891-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">褚小立, 陆婉珍. 近五年我国近红外光谱分析技术研究与应用进展[J]. 光谱学与光谱分析, 2014, 34(10): 2595- 2605.</mixed-citation></ref><ref id="hanspub.20891-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">褚小立. 近红外光谱分析技术实用手册[M]. 北京: 机械工业出版社, 2016: 8-12.</mixed-citation></ref><ref id="hanspub.20891-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">黄张成, 黄松垒. 基于单片机的红外焦平面驱动电路研究[J]. 光学学报, 2009, 29(s1): 32-335.</mixed-citation></ref><ref id="hanspub.20891-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">黄张成, 黄松垒. 基于复杂可编程逻辑器件的读出电路驱动脉冲设计[J]. 光学学报, 2009, 29(s1): 340-343.</mixed-citation></ref></ref-list></back></article>