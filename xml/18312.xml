<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">CSA</journal-id><journal-title-group><journal-title>Computer Science and Application</journal-title></journal-title-group><issn pub-type="epub">2161-8801</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/CSA.2016.68056</article-id><article-id pub-id-type="publisher-id">CSA-18312</article-id><article-categories><subj-group subj-group-type="heading"><subject>CSA20160800000_19307921.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject></subj-group></article-categories><title-group><article-title>
 
 
  电涡流式传感器液面测量控制系统
  Control System of Liquid Level Measurement Based on Eddy Current Sensor
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>李</surname><given-names>阳</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>迟</surname><given-names>宗涛</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib></contrib-group><aff id="aff2"><addr-line>null</addr-line></aff><aff id="aff1"><addr-line>青岛大学，山东 青岛</addr-line></aff><author-notes><corresp id="cor1">* E-mail:<email>liyang007700@163.com(李阳)</email>;</corresp></author-notes><pub-date pub-type="epub"><day>17</day><month>08</month><year>2016</year></pub-date><volume>06</volume><issue>08</issue><fpage>459</fpage><lpage>464</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  随着微电子技术的不断发展，智能化程度的日益加深，以及国家相关政策支持力度的不断加大，其在测量领域发挥的作用也日见显著。在工业生产与日常生活中，经常需要进行液面高度测量，采用微电子技术作为控制系统具有小型化、低功耗、可靠性高的优点。文中介绍了一种电涡流式位移传感器，是一以单片机为核心的液面高度测量电子控制系统。本控制系统以单片机为核心，控制液面高度数据的采集、管理以及远程通讯，具有体积小、维护容易、可靠性高、实时测量并显示液面高度值、记录历史数据、远程传输等优点。本文综合应用了传感器、微控制器等领域的知识，详细介绍了液面高度测量电子控制系统的整体结构及控制方法。本文的研究实现了液面测量电子控制系统的小型化，智能化，并基于接触式测量方法进一步确保了测量的精准度，从而降低了测量装置的复杂性，节约了材料，具有重要的现实意义和显著的社会效益。
   With the development of microelectronics technology, increasingly intelligent and relevant national policies and support growing, its role in the measurement region has become more significant. In industrial production and daily life, it is often necessary for liquid level measurement, of which microelectronic technology is adopted as the control system, having advantages of miniaturization, low power consumption, and high reliability. Eddy current type displacement sensor is introduced in this paper, based on the single chip microcomputer electronic control system of liquid height measurement. This system uses single-chip microcomputer as the core control system, and controls liquid level data collection, management, and telecommunications. Small size, easy maintenance, high reliability, real time measurement and displaying the liquid height value, recording historical data remote transmission and so on are advantages of this system. This paper comprehensively applies knowledge in the areas of sensors, micro-controller, and introduces in detail the overall structure and control methods of electronic control system of liquid height measurement. This study implements the miniaturization and intelligentization of electronic control system of liquid level measurement, and based on contact measuring method ensures the measurement accuracy, which can reduce the complexity of measuring devices, save material, having important practical significance and significant social benefits.
 
</p></abstract><kwd-group><kwd>电涡流式传感器，单片机，液面测量, Eddy Current Sensor</kwd><kwd> Single-Chip Microcomputer</kwd><kwd> Liquid Level Measurement</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>电涡流式传感器液面测量控制系统<sup> </sup></title><p>李阳，迟宗涛</p><p>青岛大学，山东 青岛</p><disp-formula id="hanspub.18312-formula25"><graphic xlink:href="http://html.hanspub.org/file/1-1540614x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>收稿日期：2016年7月25日；录用日期：2016年8月11日；发布日期：2016年8月17日</p><disp-formula id="hanspub.18312-formula26"><graphic xlink:href="http://html.hanspub.org/file/1-1540614x7_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>随着微电子技术的不断发展，智能化程度的日益加深，以及国家相关政策支持力度的不断加大，其在测量领域发挥的作用也日见显著。在工业生产与日常生活中，经常需要进行液面高度测量，采用微电子技术作为控制系统具有小型化、低功耗、可靠性高的优点。文中介绍了一种电涡流式位移传感器，是一以单片机为核心的液面高度测量电子控制系统。本控制系统以单片机为核心，控制液面高度数据的采集、管理以及远程通讯，具有体积小、维护容易、可靠性高、实时测量并显示液面高度值、记录历史数据、远程传输等优点。本文综合应用了传感器、微控制器等领域的知识，详细介绍了液面高度测量电子控制系统的整体结构及控制方法。本文的研究实现了液面测量电子控制系统的小型化，智能化，并基于接触式测量方法进一步确保了测量的精准度，从而降低了测量装置的复杂性，节约了材料，具有重要的现实意义和显著的社会效益。</p><p>关键词 :电涡流式传感器，单片机，液面测量</p><disp-formula id="hanspub.18312-formula27"><graphic xlink:href="http://html.hanspub.org/file/1-1540614x8_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s3"><title>1. 引言</title><p>在工业控制中，现场的液位检测是十分常见的环节，同时是工业现代化建设中需要经常改进提升的领域。在我国政府相关部门的关注和支持下，各计量企事业单位在此领域提出了一系列的方案与产品。随着近些年来，石油石化产业的蓬勃发展，中石油，中石化等大型企业由于市场需求的不断扩大，自身规模也在逐步发展，进而其燃油储备也在增长。然而，作为燃油罐中非常重要的实际液位测量部分，仍然采用电容法，液压法，直读法，超声波法等相对传统的方法 [<xref ref-type="bibr" rid="hanspub.18312-ref1">1</xref>] 。存在着许多的不足，以电容法为例：该方法将电容极板置于油罐中，不但占用了储油罐容积，并且极大的浪费了极板材料；超声波法：超声波液位测量是利用超声波在气体、液体和固体介质中传播的回声测距原理进行测量的，然而由于探头上存在余振，导致了测量盲区的存在，使其使用范围有限 [<xref ref-type="bibr" rid="hanspub.18312-ref2">2</xref>] 。为了克服上述方法存在的不足，我们在目前比较成熟的浮子式测量方法的基础上，研发电涡流式位移传感器的液面测量装置，具有以下特点：</p><p>1) 单片机为控制核心的数字化测量系统，以方便和适应现代化的信息管理模式。</p><p>2) 使用浮子式测量方法，通过机械传动装置，将液面位置物理量与电涡流式位移传感器测量的微小距离相关联，传感器采集到的液面位置物理量被转化为一个4 mA~20 mA的电流信号，下级信号处理单元完成信号采集与计算工作。</p><p>3) 装置整体设计结构简单，抗干扰能力强。</p></sec><sec id="s4"><title>2. 控制系统原理及总体设计</title><p>电涡流传感器是以电涡流的相互效应为原理的非接触式装置，可对进入其测量范围内的金属物体及铁磁性材料的运动参数进行精密地有效地非接触测量。该类型传感器由于其特殊的测试原理，适用于在恶劣工作环境中工作 [<xref ref-type="bibr" rid="hanspub.18312-ref3">3</xref>] 。</p><p>当导体置于交变磁场或在磁场中运动时，导体上引起感生电流ie，此电流在到体内闭合，为涡流。涡流大小与导体电阻率ρ、磁导率μ、以及产生交变磁场的线圈与被测体之间距离x，线圈激励电流的频率f有关。显然磁场变化频率越高，涡流的集肤效应越明显，即涡流的穿透深度越小，其穿透深度h可用下式表 [<xref ref-type="bibr" rid="hanspub.18312-ref4">4</xref>] ：</p><disp-formula id="hanspub.18312-formula28"><graphic xlink:href="http://html.hanspub.org/file/1-1540614x9_hanspub.png"  xlink:type="simple"/></disp-formula><p>式中</p><p><inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/1-1540614x10_hanspub.png" xlink:type="simple"/></inline-formula>——导体电阻率；</p><p><inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/1-1540614x11_hanspub.png" xlink:type="simple"/></inline-formula>——导体相对磁导率；</p><p><inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/1-1540614x12_hanspub.png" xlink:type="simple"/></inline-formula>——交变磁场频率(Hz)。</p><p>由上式可知涡流穿透深度h和激励电流的频率f有关，所以涡流传感器根据激励频率高低，可以分为高频反射式以及低频透射式两大类。</p><p>本设计选用的Waycon IC18-08传感器属于高频反射型。传感器线圈由高频信号激励，使其产生一个高频交变磁场ie，而此电涡流又将产生一个交变磁场，当被测导体靠近线圈的时候，在磁场作用范围的导体表层，产生了与此磁场相交链的电涡流ie，而此电涡流又将产生一个交变磁场，阻碍外磁场的变化。从能量角度来看，在被测导体内存在着电涡流损耗(当频率较高的时候，忽略磁损耗)。能量损耗使传感器的Q值和等效阻抗Z降低，因此当被测体与传感器之间距离d改变的时候，传感器的Q值和等效阻抗Z、电感L均发生变化，于是把位移传感器换转换为电量，这便是电涡流传感器的基本原理。</p><p>结构框图如图1所示。距离测量部分采用电涡流式位移传感器，传感器将距离信号转换为电信号传递给后级信号处理单元。</p><p>测量装置整体上分为机械传动以及信号测量两部分，本文主要研究信号测量部分。机械传动部分将液面位置物理量，传递给电涡流式位移传感器，传感器输出电流信号与传感器探头以及极板成正比。电流信号具有很强的抗干扰能力，经过远距离传输接入本控制系统。控制系统中，使用高精度检流电阻将接入电流值转换为电压值，单片机内部的模数转换模块采集此电压值并换算成液面高度。单片机内部的</p><p>图1. 液面测量装置控制系统结构框图</p><p>Flash可以存储一段时间内的液面高度值。液晶显示屏通过SPI异步串行接口与单片机通讯，实时显示单片机传递的液面高度等信息。单片机程序扫描键盘电路，用户通过键盘实现对系统的交互。单片机预留通讯接口，方便数据的远程传输。</p><p>机械部分可采用浮球漂浮在液面上，通过垂直杆与杠杆一端相连，杠杆另一端接电涡流式传感器的可动金属基板。电涡流式传感器金属基板与探头的距离变化与液面高度变化成一定函数关系，且整个装置机械部分受液面等周围环境振动影响较小。</p><p>信号检测电路由集成式的电涡流式位移传感器构成，经杠杆传递过来的距离信号产生变化的时候，探头线圈的测量电路测到正比于间隙变化的4 mA~20 mA电流信号。电流信号与电压信号相比，一个显著地优点就是不会因为传输线而引入干扰。主控系统，使用高精度检流电阻将电流信号转换为电压量。单片机内置的模-数转换单元，将此电压量采集并计算，得到液面高度值。</p><p>高性能低功耗MSP430单片机作为整个系统的控制核心，内置模-数转换单元实时采集电涡流式位移传感器输出的电信号，计算出高度值，与时间数据等一起写入Flash存储。驱动液晶屏，显示当前液面高度以及系统其他信息。单片机I/O口与按键电路相连，系统通过显示屏与按键电路实现了人机交互界面的搭建。当人工查询数据时，可通过键盘选择要查询的参数并在显示器上显示出来。可随时调出各项数据信息。单片机可通过RS485总线与上位机相连，从而能够实现数据远距离传输。</p></sec><sec id="s5"><title>3. 系统软件设计</title><p>对于微控制器嵌入式系统，软件设计是其时序和逻辑控制的灵魂。具有协调系统各部分正常工作，实现底层的数据采集，存储以及顶层的人机接口，数据联网传输等功能。MSP430单片机为RISC架构，即为精简指令集，只有27条正交汇编指令。与传统的CISC (复杂指令集)相比，运行更快。与此同时，精简指令集使得汇编语言编写程序变得异常困难。实际上，RISC处理器基本上就是为了高级语言而设计，当代的编译器(如IAR，CCS等)可以生成效率可以媲美汇编程序效率的C代码。故本设计的软件使用C语言进行设计 [<xref ref-type="bibr" rid="hanspub.18312-ref5">5</xref>] (如图2所示)。</p><p>根据现代软件工程学的规定，系统的程序划分为几个C文件，按照功能划分为模拟量采集模块，串口收发模块，按键检测模块，液晶屏显示驱动模块，定时休眠唤醒模块。主函数控制程序的流程，底层子模块实现具体的功能。一般的，微控制器程序为一个大循环，程序功能顺序执行。这样的程序结构有一个明显的缺点，就是程序总是在执行，单片机的功耗比较高。在超低功耗单片机系统中，最常见也是首选的结构是事件触发程序结构。这种结构的特点是：大部分时间CPU都在休眠状态，主函数几乎不执行任何事件，只在子模块，也就是“前台”程序中响应事件并处理。本设计中(如图3所示)，响应的外部事件有三个，SD16模块采集模拟量中断，按键中断，上位机串口数据指令中断。在系统运行中，绝大多数</p><p>图2. 软件模块组成框图</p><p>图3. 程序流程图</p><p>时间CPU处于休眠状态，串口收发模块，模拟量采集模块等定时开启工作，平均功耗非常低。系统上电复位之后，开始系统配置，完成液晶屏显示初始化，寄存器配置等配置之后，立即进入休眠。此时系统的主时钟MCLK (CPU时钟)以及SMCLK (片上模块时钟)关闭，ACLK (辅助时钟)开启。Basic Timer设置为每秒唤醒CPU一次，进行电压采样以及处理工作，采样前开启基准源，采样后关闭基准源。采集到检流电阻电压后，经过换算刷新液晶屏液面高度数据，并且将高度数据经串口RS-485总线发送给上位机。系统在休眠中，I/O口按键中断和上位机的串口指令中断也可以唤醒CPU执行用户的一些命令，为了保护模数转换过程的完整性，我们定义模数转换过程为临界代码。这样的软件结构有别于传统的软件流程图，我们将其定义为事件触发式结构，每秒的模拟量采集是确定的事件，用户的按键或者远程的指令是随机的事件。</p></sec><sec id="s6"><title>4. 误差分析</title><p>本测量系统工作在环境条件复杂的工业现场，由于周围环境引入的干扰，以及系统本身的设计局限性，会引入一些误差，主要有一下几类：</p><p>1) 传感器输出电信号在传输过程中引入的信道误差。由于在空间中存在着各种各样的电磁波。特别是在工业现场，电机、变频器以及其他强电设备会引入各种各样的干扰，传输回路在这样的环境中，相当于天线，处理不当，会在传输的电信号中叠加噪声，使信号失真。本设计中，首先选用电流型信号传输，电流信号在传输过程中不存在衰减的问题，相比于电压信号，抗干扰能力大大提高。传输线选用带有屏蔽层的线缆，这样也会使干扰到达传输线之前衰减。经过以上措施，可以将因信道引起的误差控制在可以允许的范围内。</p><p>2) 模数转换器采集检流电阻电压产生的随机误差。这样的误差由两方面引起：一方面，电阻由于温湿度等环境因素，以及随时间老化阻值会发生漂移。克服这方面的误差，我们需要选用专用的低漂移，一致性好的电阻，以降低误差。模数转换过程也有可能因为随机误差而采集到错误的电压值，MSP430F4272的SD16模数转换器具有过采样技术，每次转换采集256个数据，经过内部的算法，最后得到精确的数据。这样，也会大大降低此类误差。</p><p>3) 人为误差：工业现场或者远程上位机数据记录的误差，这个需要成熟的管理制度来克服。</p></sec><sec id="s7"><title>5. 总结</title><p>本设计研制的主要目的是在原有的浮子式结构测量方式基础上，进一步提高测量的精确度，降低装置复杂性，降低成本，降低测量系统的功耗，为新型液面测量系统投入使用，创造价值进行探索。最后总结，本测量系统的主要特点：</p><p>1) 使用了新型的电涡流式位移传感器，能够连续测量位移量，具有较高的可靠性。传感器体积小，便于运输和安装，电气约束简单，为设备的安装和推广提供了便利。功耗也进一步降低，可以做到很高的防护等级，受周围环境影响小，寿命和可靠性得到了进一步的提高。</p><p>2) 主控系统选用了MSP430专用的电信号计量微控制器。MSP430在功耗控制方面十分出色，软件设置可以做到使电池的寿命超过电子设备的使用寿命。整个系统的低功耗不但简化了系统，并且提高了整体的安全性。微控制器内部的SD16高性能模数转换器为精确地信号采集提供了保障。基本上实现了一片微控制器完成大多数功能，系统的集成度和体积进一步减小。</p><p>3) 低成本：本设计选用了高性能，低成本，市场上主流的MCU以及接口器件，整体造价低。并且MCU内部自带模数转换器等模块，使得电路板上的器件进一步减少，不但节约了物料成本，也节约了电路板面积，这同样会降低系统的成本。</p><p>4) 可扩展性：本系统采用RS485总线和上位机进行通讯，目前可以实现数据远程传输，并在上位机远程传输指令。以后可以根据需求进一步实现程序在线升级等功能。</p></sec><sec id="s8"><title>文章引用</title><p>李阳,迟宗涛. 电涡流式传感器液面测量控制系统Control System of Liquid Level Measurement Based on Eddy Current Sensor[J]. 计算机科学与应用, 2016, 06(08): 459-464. http://dx.doi.org/10.12677/CSA.2016.68056</p></sec><sec id="s9"><title>参考文献 (References)</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.18312-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">张朝晖, 弓志谦. 采油井动态液面测量技术研究[J]. 传感技术学报, 2007, 20(5): 1180-1183.</mixed-citation></ref><ref id="hanspub.18312-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">卢超. 基于无线收发的超声波液位测量仪[J]. 压电与声光, 2014, 36(1): 150-155.</mixed-citation></ref><ref id="hanspub.18312-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">王化祥, 张淑英. 传感器原理及应用[M]. 第七版. 天津: 天津大学出版社, 2011.</mixed-citation></ref><ref id="hanspub.18312-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">刘迎春, 叶湘滨. 传感器原理设计与应用[M]. 第三版. 长沙: 国防科技大学出版社, 2004.</mixed-citation></ref><ref id="hanspub.18312-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">谢楷, 赵建. MSP430系列单片机系统工程设计与实践[M]. 北京: 机械工业出版社, 2011.</mixed-citation></ref></ref-list></back></article>