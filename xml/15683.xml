<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">JSTA</journal-id><journal-title-group><journal-title>Journal of Sensor Technology and Application</journal-title></journal-title-group><issn pub-type="epub">2331-0235</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/JSTA.2015.33008</article-id><article-id pub-id-type="publisher-id">JSTA-15683</article-id><article-categories><subj-group subj-group-type="heading"><subject>JSTA20150300000_70228164.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于对焦深度法的自动调焦方案设计与实验验证
  The Scheme Design and Test Verification of Automatic Focusing Based on Depth from Focus Method
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>邹</surname><given-names>昌帆</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>汪</surname><given-names>向阳</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>陈</surname><given-names>佐龙</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>周</surname><given-names>磊</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>孙</surname><given-names>明</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>张</surname><given-names>昌雷</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><addr-line>军械工程学院电子与光学工程系，河北 石家庄 总装驻扬州地区军代室，江苏 扬州</addr-line></aff><aff id="aff3"><addr-line>63861部队，吉林 白城</addr-line></aff><aff id="aff2"><addr-line>null</addr-line></aff><author-notes><corresp id="cor1">* E-mail:<email>zcfoptics@163.com(邹昌)</email>;</corresp></author-notes><pub-date pub-type="epub"><day>14</day><month>07</month><year>2015</year></pub-date><volume>03</volume><issue>03</issue><fpage>62</fpage><lpage>68</lpage><history><date date-type="received"><day>May</day>	<month>27th,</month>	<year>2013</year></date><date date-type="rev-recd"><day>Jun.</day>	<month>29th,</month>	<year>2013</year>	</date><date date-type="accepted"><day>Jul.</day>	<month>10th,</month>	<year>2013</year></date></history><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  相比于传统自动调焦方法，基于图像处理的光电自动调焦技术具有智能化、速度快、准确性高、便于控制等优势，已成为自动调焦技术研究的主流方向。本文首先通过构建模型，详细阐述了基于图像处理的光电自动调焦原理和流程，并简要介绍了两种常用自动调焦方法；接着，基于对焦深度法给出了本文设计的自动调焦方案；最后，利用搭建的原理性样机开展了自动调焦实验，验证了本文方案的可行性。
   Compared with the traditional automatic focusing method, the photoelectric automatic focusing technology has become the main research direction due to its advantages, such as high intelligence, speediness, accuracy and convenient control. In this paper, the principle photoelectric automatic focusing based on imaging processing is stated in detail, and two common automatic focusing methods are introduced in brief. Then, this automatic focusing scheme is designed and put forward. At last, the automatic focusing test is carried out, and its feasibility is verified.
 
</p></abstract><kwd-group><kwd>自动调焦，对焦深度法，图像处理，调焦实验, Automatic Focusing</kwd><kwd> DFF Method</kwd><kwd> Image Processing</kwd><kwd> Focusing Test</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于对焦深度法的自动调焦方案设计与 实验验证<sup> </sup></title><p>邹昌帆<sup>1,2</sup>，汪向阳<sup>3</sup>，陈佐龙<sup>3</sup>，周磊<sup>3</sup>，孙明<sup>3</sup>，张昌雷<sup>3</sup></p><p><sup>1</sup>军械工程学院电子与光学工程系，河北 石家庄</p><p><sup>2</sup>总装驻扬州地区军代室，江苏 扬州</p><p><sup>3</sup>63861部队，吉林 白城</p><p>Email: zcfoptics@163.com</p><p>收稿日期：2015年6月20日；录用日期：2015年7月9日；发布日期：2015年7月16日</p><disp-formula id="hanspub.15683-formula5034"><graphic xlink:href="http://html.hanspub.org/file/5-2960021x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>相比于传统自动调焦方法，基于图像处理的光电自动调焦技术具有智能化、速度快、准确性高、便于控制等优势，已成为自动调焦技术研究的主流方向。本文首先通过构建模型，详细阐述了基于图像处理的光电自动调焦原理和流程，并简要介绍了两种常用自动调焦方法；接着，基于对焦深度法给出了本文设计的自动调焦方案；最后，利用搭建的原理性样机开展了自动调焦实验，验证了本文方案的可行性。</p><p>关键词 :自动调焦，对焦深度法，图像处理，调焦实验</p><disp-formula id="hanspub.15683-formula5035"><graphic xlink:href="http://html.hanspub.org/file/5-2960021x6_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s3"><title>1. 引言</title><p>近年来，光电成像系统逐步向智能化、自动化的发展，自动调焦技术也逐渐成熟起来。为拓展该技术的应用，国内外研究了多种调焦方法，常用方法可概括为三种 [<xref ref-type="bibr" rid="hanspub.15683-ref1">1</xref>] [<xref ref-type="bibr" rid="hanspub.15683-ref2">2</xref>] ：1) 测距法，该方法通过测量目标距离，利用目标距离与焦距之间的关系进行自动调焦。该方法原理简单，可靠性高，但对于“远、弱、小”物体拍摄效果不理想；2) 焦点检测法，该方法在光学镜头附近安装一自动对焦组件，以镜头焦点为探测对象，拍摄距离大，已在单反相机中广泛应用，但对运动目标、细条目标和低反差目标成像效果欠佳；3) 图像处理法，这是一种被动调焦方法，它是基于目标图像的清晰程度来自动调焦的。从发展趋势来看，基于图像处理的光电自动调焦方法具有智能化、快速准确、控制方便等优势 [<xref ref-type="bibr" rid="hanspub.15683-ref3">3</xref>] ，已逐步成为自动调焦技术发展的主要方向。本文设计的数字图像自动调焦方案，取窗准确，实时性好，可满足25 Hz实时采集的需求。</p></sec><sec id="s4"><title>2. 基于图像处理的光电自动调焦原理与方法</title><sec id="s4_1"><title>2.1. 自动调焦原理</title><p>原理上讲，基于图像处理的光电自动调焦技术以图像评价函数作为判定聚焦与否的指标，根据评价函数值控制图像传感器移动或者改变光学系统焦距，从而使景物在传感器面上清晰成像。由于图像传感器精密易损，而且轴向移动对成像质量影响较大，因此，对于高精度光电测量系统，通常采用“传感器固定、镜头移动”的自动调焦方案，利用电机控制光学系统中各组镜片间距，达到自动调焦的目的。</p><p>基于图像处理的光电自动调焦系统主要由四部分构成，包括变焦光学系统、图像传感器、图像处理模块、电机驱动模块，如图1所示。其中，变焦光学系统用于对三维场景成像，并在电机驱动控制下，实现光学系统中镜组之间的轴向移动，达到调焦的目的；图像传感器的功能是对目标成像，并将图像数据传送至后续处理模块进行清晰度评价；图像处理模块具有图像预处理、调焦窗口选取和图像清晰度评价等功能，该模块还将清晰度评价值转换为调焦量；电机驱动模块根据调焦量大小控制改变变焦光学系统各镜组之间的间隔，获取最佳焦距。</p><p>对比图1系统结构，图2给出了该系统的工作流程，对其简要表述为：首先，利用变焦光学系统和</p><p>图1. 基于图像处理的光电自动调焦系统结构示意图</p><p>图2. 系统工作流程</p><p>传感器获取序列图像数据；然后对图像做预处理，如图像降噪、增强与分割等；接着按照一定策略选择调焦窗口，并利用图像评价函数计算窗口图像的清晰度评价值；根据序列图像清晰度值特征，确定合适的调焦方向和调焦步长进行峰值搜索和调焦判断；通过改变镜组间距来进行调焦，依次反复，直至获取最清晰的场景图像。</p></sec><sec id="s4_2"><title>2.2. 常用自动调焦方法</title><p>不同于传统自动调焦法，基于图像处理的光电自动调焦方法利用图像处理技术对目标像进行成像质量分析，得出图像清晰度值或者离焦量，再驱动电机调整光学系统焦距，从而获取聚焦下的目标图像实现自动调焦。按照工作原理不同，又可分为 [<xref ref-type="bibr" rid="hanspub.15683-ref2">2</xref>] 对焦深度法和离焦深度法。</p><p>1) 离焦深度法</p><p>离焦深度法利用从离焦图像中获取的目标深度信息来进行自动调焦。该方法要求事先建立描述光电成像系统的数学模型，通过获取2副或者2副以上不同成像参数下的图像信息，再结合成像系统参数，求解成像目标离焦的深度信息，进而找到系统的最佳聚焦位置。离焦深度法只需采集不同成像参数下的几幅图像，便可结合图像分析实现自动调焦，极大减少了驱动电机、程序运行等时间，具有较快的运算速度，但由于计算所用信息量少，而且需建立精确的数学模型才能保证调焦效果，因此离焦深度法误差加大，适用于一些要求不高的场合。</p><p>离焦深度法又分为 [<xref ref-type="bibr" rid="hanspub.15683-ref4">4</xref>] [<xref ref-type="bibr" rid="hanspub.15683-ref5">5</xref>] 基于图像恢复的方法和基于模糊量估计的方法。第一种方法先利用部分特征性图像信息估算光学系统的点扩展函数PSF，然后再根据所建立的图像退化模型，对模糊图像进行恢复还原。第二种方法首先利用不同成像参数下采集的2~3幅图像，计算帧间相对模糊量，并结合图像分析得到图像的模糊程度；然后根据几何光学知识估算出光电成像系统的离焦量，进而驱动变焦光学系统或图像探测器实现准确聚焦。</p><p>2) 对焦深度法</p><p>对焦深度法是一种采用搜寻方式的调焦方法，它首先采集从模糊到清晰的序列图像，再选用适用的图像清晰度评价函数进行图像清晰度评价，同时利用电机控制镜头移动方向和步长，直至找到图像清晰度评价值最大的位置，实现自动调焦。图3给出了该方法实现的系统结构示意图。</p><p>结合图3，对对焦深度法工作过程作简要阐述：目标物经变焦镜头在图像传感器上形成图像，然后主控单元对采集到的图像数据进行预处理和分析，再根据评价结果控制驱动模块调整变焦镜头中镜组之间的间距，直到成像最清晰，然后由主控单元输出并存储清晰图像。通常情况下，对焦深度法往往需要搜索10幅~12幅图像才能保证调焦精度，所利用的图像数据越多，调焦效果也就越好，但速度会有所降低，另外，图像评价函数的选择也是影响算法速度的因素之一。</p></sec></sec><sec id="s5"><title>3. 本文自动调焦方案</title><p>对比两种常用自动调焦方法，对焦深度法充分利用了数字信号处理的硬件高速型和软件编程的灵活性，具有稳定性好、智能化程度高、适用范围广等优势，因此，本文在自动调焦方案设计中便采用了对焦深度法。</p><p>本文设计了基于PC机的自动调焦系统平台，如图4所示，硬件部分包括变焦镜头、图像传感器、监视器、驱动电机、PC机、图像采集卡和数据处理板等部分。其工作流程为：被观测物体出现在系统视场内时，图像传感器将采集到的视频信号分两路传送，一路送监视器实时显示，另一路被图像采集卡转换成数字信号，再由数据处理单元对每帧图像进行实时处理，判断物体是否清晰成像，即是否聚焦准确——若处于图像模糊不清，则根据反馈信号驱动电机改变变焦镜头中镜组之间的距离，如此反复直至完成自动调焦任务。</p><p>在方案设计中，图像清晰度评价、调焦窗口自动选择、峰值搜索是三项亟待关键技术问题。在图像清晰度评价函数选择中，本文根据被测物体特点，提出了一种基于多向最大梯度阈值的自动调焦评价函数，函数定义如下：</p><disp-formula id="hanspub.15683-formula5036"><label>(1)</label><graphic position="anchor" xlink:href="http://html.hanspub.org/file/5-2960021x9_hanspub.png"  xlink:type="simple"/></disp-formula><p>式中：<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x10_hanspub.png" xlink:type="simple"/></inline-formula>为图像中任意一点。</p><p>图3. 基于对焦深度法的光电自动调焦系统结构示意图</p><p>图4. 基于PC机的自动调焦系统总体结构框图</p><p>在调焦窗口设计时，本方案采用波门跟踪理论，提出了基于动态窗口预测的波门选择法。假定调焦窗口在第<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x13_hanspub.png" xlink:type="simple"/></inline-formula>帧和第<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x14_hanspub.png" xlink:type="simple"/></inline-formula>帧中的坐标位置<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x15_hanspub.png" xlink:type="simple"/></inline-formula>和<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x16_hanspub.png" xlink:type="simple"/></inline-formula>，则下一刻调焦窗口位置为：</p><disp-formula id="hanspub.15683-formula5037"><label>(2)</label><graphic position="anchor" xlink:href="http://html.hanspub.org/file/5-2960021x17_hanspub.png"  xlink:type="simple"/></disp-formula><p>式中：<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x18_hanspub.png" xlink:type="simple"/></inline-formula>和<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x19_hanspub.png" xlink:type="simple"/></inline-formula>为坐标偏移量，<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x20_hanspub.png" xlink:type="simple"/></inline-formula>，<inline-formula><inline-graphic xlink:href="http://html.hanspub.org/file/5-2960021x21_hanspub.png" xlink:type="simple"/></inline-formula>。</p><p>在峰值搜索算法中，本方案选用成熟的爬山搜索方法[<xref ref-type="bibr" rid="hanspub.15683-ref6">6</xref>] ，其原理如图5所示。驱动变焦镜头的点击从原点位置出发，走一步计算一次图像评价函数值。如果函数值逐渐变大，则调焦方向正确，急需调焦，否则，方向错误，反方向调焦。当函数值开始下降，说明镜头已经跨过最佳对焦点位置，此时驱动电机需要反向运转并减小步长，带动镜头反方向移动，回寻最佳对焦点位置。如此反复，直到电机步长减小至给定值，搜索结束。在图5中，(1)和(2)表示函数值刚减小的位置，(3)表示停止搜索的位置。</p></sec><sec id="s6"><title>4. 实验验证与结果分析</title><p>为验证本文方案，本节利用构建的原理性样机开展了自动调焦实验，图6为实验时采集的不同调焦状态的目标序列图像，图7为自动调焦过程中由模糊逐渐变清楚的目标图像，各图中的调焦窗口以矩形框标出，右上角为窗口放大图，表1对应给出了不同情况下调焦窗口的中心坐标和大小。</p><p>可以看出：1) 本方案实现了光电系统的自动调焦，准确获取了清晰图像；2) 本方案以局部图像区域为调焦窗口，计算量大为减少，实时性明显提高；3) 表1显示，本方案采取动态预测方法后，能很好预测并确定调焦窗口在序列帧间的坐标位置，最大坐标偏差不足8个像素，相邻帧间定位偏差更小，不足3个像素；4) 从实时性来看，在自动调焦过程中，整个调焦过程耗时(图像采集、处理、电机驱动等)在26 ms左右，完全可满足25 Hz图像实时采集工作的要求。</p><p>图5. 爬山搜索法原理示意图</p><p>图6. 调焦过程中采集的序列图像</p><p>图7. 本方案自动调焦效果</p><table-wrap id="table1" ><label><xref ref-type="table" rid="table1">Table 1</xref></label><caption><title> The focusing windows parameter obtained by the proposed schem</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >图像状态</th><th align="center" valign="middle" >窗口中心坐标(像素)</th><th align="center" valign="middle" >窗口大小(像素 &#215; 像素)</th></tr></thead><tr><td align="center" valign="middle" >离焦状态1</td><td align="center" valign="middle" >(267, 334)</td><td align="center" valign="middle" >32 &#215; 38</td></tr><tr><td align="center" valign="middle" >离焦状态2</td><td align="center" valign="middle" >(264, 331)</td><td align="center" valign="middle" >24 &#215; 48</td></tr><tr><td align="center" valign="middle" >聚焦状态</td><td align="center" valign="middle" >(262, 328)</td><td align="center" valign="middle" >26 &#215; 56</td></tr></tbody></table></table-wrap><p>表1. 本方案获取的调焦窗口参数</p></sec><sec id="s7"><title>5. 结论</title><p>基于图像处理的光电自动调焦方法以数字图像处理为基础，通过分析图像信息来评估光电成像系统的聚焦程度，进而实现自动对焦。因其无需额外设备，硬件结构少，现已在摄影摄像、实时监控、机器视觉等领域得到了工程化应用。本文先对基于图像处理的光电自动调焦技术做了原理阐述，介绍了两种常用自动调焦方法，接着基于对焦深度法提出了本文设计的自动调焦方案，最后实验验证了本文方案的可行性。本文所提方案对于后续系统工程化实现具有很强的指导意义。</p></sec><sec id="s8"><title>文章引用</title><p>邹昌帆,汪向阳,陈佐龙,周 磊,孙明,张昌雷, (2015) 基于对焦深度法的自动调焦方案设计与实验验证The Scheme Design and Test Verification of Automatic Focusing Based on Depth from Focus Method. 传感器技术与应用,03,62-68. doi: 10.12677/JSTA.2015.33008</p></sec><sec id="s9"><title>参考文献 (References)</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.15683-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">张来线, 孙华燕, 郭惠超, 等 (2013) 基于图像灰度梯度最大值累加的自动调焦算法. 光子学报, 5, 605-610.</mixed-citation></ref><ref id="hanspub.15683-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">尤玉虎, 刘通, 刘佳文 (2013) 基于图像处理的自动对焦技术综述. 激光与红外, 2, 132-136.</mixed-citation></ref><ref id="hanspub.15683-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">刘璞, 王春平, 付强, 等 (2013) 基于八面梯度均方差的跟踪系统自动调焦方法. 电视技术, 9, 183-186.</mixed-citation></ref><ref id="hanspub.15683-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">Kim, S.K. and Paik, J.K. (1998) Out-of-focus blur estimation and restoration for digital auto-focusing system. Electronics Letters, 12, 1217-1219. &lt;br&gt;http://dx.doi.org/10.1049/el:19980762</mixed-citation></ref><ref id="hanspub.15683-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">冯华君, 毛邦福, 李奇, 等 (2014) 一种用于数字成像的自动对焦系统. 光电工程, 10, 69-72.</mixed-citation></ref><ref id="hanspub.15683-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">郑玉珍 (2005) 自动对焦中的优化爬山搜索算法. 浙江科技学院学报, 3, 171-174.</mixed-citation></ref></ref-list></back></article>