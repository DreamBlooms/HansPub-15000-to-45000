<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">AIRR</journal-id><journal-title-group><journal-title>Artificial Intelligence and Robotics Research</journal-title></journal-title-group><issn pub-type="epub">2326-3415</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/AIRR.2019.84021</article-id><article-id pub-id-type="publisher-id">AIRR-32617</article-id><article-categories><subj-group subj-group-type="heading"><subject>AIRR20190400000_64911585.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>信息通讯</subject><subject> 工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于模版匹配的阵列特征高精度定位算法
  High-Precision Positioning Algorithm for Array Features Based on Template Matching
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>肖</surname><given-names>惟仁</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib></contrib-group><aff id="aff1"><label>1</label><addr-line>null</addr-line></aff><aff id="aff2"><label>1</label><addr-line>天津工业大学电气工程与自动化学院，天津</addr-line></aff><pub-date pub-type="epub"><day>18</day><month>09</month><year>2019</year></pub-date><volume>08</volume><issue>04</issue><fpage>190</fpage><lpage>196</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  
    结合实际的医用试纸生产中，存在着质检环节依靠人工肉眼检查，效率低下，误判率随工作时间推移而增加，并且还对生产工人有健康风险的现象，本文从硬件设备到软件算法上设计了一整套基于机器视觉的试纸自动质检系统，着重介绍改进传统的模板匹配算法，将模板匹配分为两个层级，使其在X、Y两个维度分级匹配搜索，并针对这一算法带来的计算量过大的副作用进行了搜索方法的优化，使得在较大视场(310 * 330 mm)的环境下，拥有较高的分辨精度(0.04 mm)，而且效率尚佳，从而在不增加产品的质检工序的时间上使得误判率显著降低。
    In combination with the actual medical test paper production, there is a phenomenon where the quality inspection link relies on manual visual inspection; the efficiency is low; the misjudgment rate increases with the working time, and there is also a health risk to the production workers. This article goes from hardware equipment to software algorithms. A set of automatic inspection system for test strip based on machine vision was designed. The traditional template matching algorithm was improved. The template matching was divided into two levels to make the matching search in the X and Y dimensions. The calculation method is optimized due to the excessive side effects of calculation, so that the resolution is high (0.04 mm) at the same time in a large field of view (310 * 330 mm), and the efficiency is still good, so that it does not increase. The time of the quality inspection process of the product significantly reduces the misjudgment rate. 
  
 
</p></abstract><kwd-group><kwd>机器视觉，模板匹配，高精度, Machine Vision</kwd><kwd> Template Matching</kwd><kwd> High Precision</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于模版匹配的阵列特征高精度定位算法<sup> </sup></title><p>肖惟仁</p><p>天津工业大学电气工程与自动化学院，天津</p><p><img src="//html.hanspub.org/file/2-2610170x1_hanspub.png" /></p><p>收稿日期：2019年10月8日；录用日期：2019年10月16日；发布日期：2019年10月23日</p><disp-formula id="hanspub.32617-formula23"><graphic xlink:href="//html.hanspub.org/file/2-2610170x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>结合实际的医用试纸生产中，存在着质检环节依靠人工肉眼检查，效率低下，误判率随工作时间推移而增加，并且还对生产工人有健康风险的现象，本文从硬件设备到软件算法上设计了一整套基于机器视觉的试纸自动质检系统，着重介绍改进传统的模板匹配算法，将模板匹配分为两个层级，使其在X、Y两个维度分级匹配搜索，并针对这一算法带来的计算量过大的副作用进行了搜索方法的优化，使得在较大视场(310 * 330 mm)的环境下，拥有较高的分辨精度(0.04 mm)，而且效率尚佳，从而在不增加产品的质检工序的时间上使得误判率显著降低。</p><p>关键词 :机器视觉，模板匹配，高精度</p><disp-formula id="hanspub.32617-formula24"><graphic xlink:href="//html.hanspub.org/file/2-2610170x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2019 by author(s) and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/2-2610170x7_hanspub.png" /> <img src="//html.hanspub.org/file/2-2610170x8_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>背景意义：</p><p>目前在精度要求较高的印刷行业与医用试纸生产中，产品的质量检测主要靠人眼分辨或手工测量，这种方式在劳动密集型产业中很容易实现，由于高精度的质量检测分类中需要很高的分辨力与适应性，生产工人也有很好的学习能力，在这两点人眼都可以满足，但是这种测量方式还存在着如下的问题：首先，效率低下，人眼在持续的分辨细小物体后效率会显著的下降，误判也会增加；其次，在高亮度状态下持续辨力会对人眼造成健康影响，比如视力下降、头痛等。</p><p>机器视觉是利用计算机对图像或视频进行处理，实现对二维或三维场景的识别、检测、感知和理解等功能 [<xref ref-type="bibr" rid="hanspub.32617-ref1">1</xref>]，随着该技术与计算机图像处理能力快速发展，在工业生产中，尤其是质检工序中，根据视觉与图像信息，可以对生产线的产品进行模式识别进而实现快速的分类乃至分拣，在血糖试纸印刷制造中，各类医疗检测试纸的药液位置与饱满程度决定了该试纸还原各类理化指标的可靠性，进而影响医疗诊断的结论。视觉检测技术尤其在质检方面已经具备相当的潜力，它具有如下优点：高效率，可靠与通用性良好；非接触，这点在卫生与精度要求都很高的医疗器械行业尤为重要。机器视觉在大批量、连续自动化生产流水线上具有很高的应用价值，能够对产品进行辨识和外形尺寸测量等 [<xref ref-type="bibr" rid="hanspub.32617-ref2">2</xref>]。</p><p>为了能在整版生产试纸的较大视场中分辨精度很高的药液饱满度，本文利用机器视觉与一系列图像处理方法设计了一套自动的质量检测系统，并着重介绍系统中图像处理算法部分。</p></sec><sec id="s4"><title>2. 总体方案</title><p>系统的质检对象为一张330 mm * 310 mm的胶印医用纸，如图1，纸上以50行10列分布着500个小的医用血糖测试纸，每个小试纸拥有独立的药物反应功能，上印刷有导液涂层，可视为一个单元。并且每个血糖试纸上有两个滴药液体区域A、B (如图2)。</p><p>如图3是未滴药的医用试纸与滴药且合格的试纸，质检要求是A区域药液饱满，而B区域存在药液，只有A、B区域的药液全部符合要求，血糖检测仪才能正常工作以显示可信赖的血糖指标。</p><p>由于被测物体较大，而需要分辨的精度有相当高，视场与最小分辨长度的比例较大，所以系统选用线扫相机以得到在相同视场范围内更高的像素数而成本又不至于过高。被测物体是一张轻薄的试纸，线扫描方案选择物体匀速移动而固定相机的方案，这样可以保证画面抖动更小进而可忽略。</p><p>图1. 医用试纸整体概况</p><p>图2. 试纸单元与滴药区域</p><p>图3. 滴药试纸与非滴药试纸对比</p><p>整个系统的算法框图如图4，通过搭建的底部匀速送纸机构、同轴光源与相机的固定与微调装置，以实现整张试纸的图像信息高精度采集，然后对图像进行基本的预处理操作，之后利用改进的模板匹配算法对滴药部位进行高精度的定位，进而判断该位置的药液是否满足质量要求。</p><p>图4. 算法框图</p></sec><sec id="s5"><title>3. 图像预处理部分</title><p>在初期试验环节，由于横向视场宽度太大，得知此分辨率的线扫描相机的不可避免的会出现两侧与中间曝光强度不一致的情况，这会对后续的图像处理带来不必要的麻烦 [<xref ref-type="bibr" rid="hanspub.32617-ref3">3</xref>]。为了使得后续标准的制定与动态调整，预处理需要对两侧暗部细节进行补偿，本系统针对这一问题运用的是*灰度映射*的方法，在原区间(0~255)内使对应的灰度映射到另一范围(0~230)伽马值为默认1，即灰度映射是线性映射，结合具体得到实际生产光照环境，使得试纸两侧的对比度增强，在不丢失暗部细节，边缘信息也不受到影响的情况下，将明亮部分增强，以获得与视场中间相似的曝光环境，从而使得后续算法可以在整张试纸上统一运行。如图5，图6，分别在空白区域与滴药区域中取得相同坐标位置的灰度信息，可以发现得到了灰度为255的背景色，这与视场中部的情况是一致的。证明此预处理方法有很好的调节曝光作用。</p><p>图5. 非滴药区域预处理前后对比</p><p>图6. 滴药区域预处理前后对比</p></sec><sec id="s6"><title>4. 定位算法</title><p>对于待检测滴药区域的定位，本系统运用的是模板匹配算法，在所有的图像匹配算法中模板匹配算法是最基本的一种 [<xref ref-type="bibr" rid="hanspub.32617-ref4">4</xref>]，模板匹配理论是按照相关策略，根据已知模块在搜索图像中寻找逼近模块匹配的过程，是一种简单有效、使用广泛的图像处理方法 [<xref ref-type="bibr" rid="hanspub.32617-ref5">5</xref>] - [<xref ref-type="bibr" rid="hanspub.32617-ref11">11</xref>]，它的基本方案是：</p><p>1) 首先，选定模板，它必须能区分每个阵列单元，拥有的特征需要与单元内有较高相关性而与单元外(单元间隙)有较低的相关性。</p><p>2) 计算模板与待匹配子图的相关性或差异性，通过在某一位置的邻域内寻找相关性最大或差异性最小的子图。</p><p>3) 遍历搜索整张图片后得到所有子图最佳的定位点。</p><p>模板匹配的核心就是考察模板(template)与子图(subgraph)的关系，本系统运用的是计算灰度值相关性的方法：将模板T(m, n)与子图S(i, j)的灰度矩阵处理成一维数组，计算每个相对应像素位置灰度值的平方差D(i, j)。</p><p>D ( i , j ) = ∑ m = 1 M ∑ N = 1 N [ S i j ( m , n ) − T ( m , n ) ] 2</p><p>最后进行归一化得到两图像的相关性cc(i, j) [<xref ref-type="bibr" rid="hanspub.32617-ref5">5</xref>]，公式如下</p><p>c c ( i , j ) = ∑ m = 1 M ∑ n = 1 N S i j ( m , n ) &#215; T ( m , n ) ∑ m = 1 M ∑ N = 1 N [ S i j ( m , n ) ] 2 ∑ m = 1 M ∑ N = 1 N [ T ( m , n ) ] 2</p><p>首先根据遍历搜索的方式，选取模板的特征应该与两个试纸单元间隙的子图特征有明显的差异，否则模板与阵列单元间的子图的相关性显著增高，造成局部峰值的选取混乱，进而影响到定位的效果。</p><p>由于在整张500个小试纸中，除了滴药液体的区域外，每个小的试纸的其他区域是高度相似的，所以可以采用在非滴药区域中选区具有分离特征的模板，再用这一模板如图7定位出每一个小试纸非滴药区域的精确位置。</p><p>图7. 选定的模板</p><p>用此模板沿着某一列Y方向比对搜索并计算该列每一位置与子图的cc值，并绘制定位位置-相关性的关系图如图8，可以看出cc值峰值(图中标注)明确，周围无干扰，并且呈周期性变化，这证明了这一模板也有效的预防了单元间之间的干扰。</p><p>图8. 沿Y方向定位位置与cc值的关系曲线</p><p>根据这一周期规律系统在搜索方式上可以进一步优化，跳跃式的搜索，即跳过与预设位置相差过远的地方，这样可以缩小计算量，提高整体的算法效率，如图9是跳跃式算法的定位位置-相关性图像，可以看到将跳跃的位置的图像相关系数置零，不但不影响其峰值的采集，还优化了效率，通过实验，这样的搜索方式可以把整体的算法时间缩减3~4秒。</p><p>图9. 跳跃式定位位置与cc值的关系曲线</p><p>如此在一列试纸中定位出50个试纸的Y坐标，但是横向的X坐标还是预设值，下一步就是确定500个试纸单元滴药位置的X坐标。针对每一个纵向位置坐标与每一列的预设定坐标，确定大致的感兴趣区域(ROI)，在这500个坐标的ROI中再选定一模板进行横向的二次匹配检索，在二次匹配的过程中，由于有了第一步的基础，所以选定的模板可以非常小，而且精度要求很高的前提下，搜索范围也可以很小，从而极大的降低了运算量。</p><p>在二次匹配中，由于仅是定位X方向的坐标，所选模板具备在横向的区分能力即可，所以在图中，仅划取高度为1，长度为40个像素的一条线，通过选取适当阈值，将滴药区域二值化如图10，屏蔽了药液印染溢出的影响，二值化的图像仅有滴药区域，得到了稳定的滴药区域模板匹配ROI (为图中划线部分标记)。</p><p>图10. 沿X向精确定位的ROI区域与模板</p><p>滴药区域宽度为14 pix，两个滴药区域A、B的间隙为6 pix，得到模板是为长度为34的向量。为了可以更加方便的优化精度，接着描述模板与子图的差异性，选取计算方差的方法来确定X轴的位置，最后根据计算出方差的具体数值结合实际情况配合一定参数对其定位信息进行补偿。</p></sec><sec id="s7"><title>5. 结论</title><p>根据试纸的生产节拍需求，每张试纸的检测时间控制在了10秒以内，在单一相机与镜头环境下，实现了大视场(310 * 330 mm)，与高精度(分辨力0.04 mm)，进而可以根据这一精确位置确定出整张试纸的500个滴药位置的纵坐标，针对滴药情况筛选出良品与次品，本文构建的系统相比于优化前的模板匹配算法有效的提高了精度，缩短了判定时间，降低了误判率。</p></sec><sec id="s8"><title>文章引用</title><p>肖惟仁. 基于模版匹配的阵列特征高精度定位算法High-Precision Positioning Algorithm for Array Features Based on Template Matching[J]. 人工智能与机器人研究, 2019, 08(04): 190-196. https://doi.org/10.12677/AIRR.2019.84021</p></sec><sec id="s9"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.32617-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">Wu, X.Y., Xu, W.D., Li, L.H., et al. (2011) An Interactive Segmentation Method Using Graph Cuts of Mammographic Masses. In-ternational Conference on Bioinformatics &amp; Biomedical Engineering, Wuhan, 10-12 May 2011, 1-4.  
https://doi.org/10.1109/icbbe.2011.5780190</mixed-citation></ref><ref id="hanspub.32617-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">李彬, 罗彪. 机器视觉在物体位姿检测中的应用[J]. 传感器与微系统, 2016, 35(2): 150 -153.</mixed-citation></ref><ref id="hanspub.32617-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">杨剑. 大尺寸视觉测量精度的理论和实验研究[D]: [博士学位论文]. 北京邮电大学, 2010.</mixed-citation></ref><ref id="hanspub.32617-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">王道威. 基于OpenCV的图像匹配算法及其靶标定位应用[D]: [硕士学位论文]. 华中科技大学, 2016.</mixed-citation></ref><ref id="hanspub.32617-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">党晓军, 尹俊文. 一种基于模板匹配的运动目标跟踪方法[J]. 计算机工程与应用, 2010, 46(5): 173-176.</mixed-citation></ref><ref id="hanspub.32617-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">邵文坤, 黄爱民, 韦庆. 动态场景下的运动目标跟踪方法研究[J]. 计算机仿真, 2006(5): 181-184.</mixed-citation></ref><ref id="hanspub.32617-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">张彦梅, 宋扬. 模板匹配方法在高速目标跟踪中的应用[J]. 北京理工大学学报, 2006(11): 1026-1029.</mixed-citation></ref><ref id="hanspub.32617-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">邹承明, 薛栋, 郭双双, 赵广辉. 一种改进的图像相似度算法[J]. 计算机科学, 2016, 43(6): 72-76.</mixed-citation></ref><ref id="hanspub.32617-ref9"><label>9</label><mixed-citation publication-type="other" xlink:type="simple">Vock, R., Dieckmann, A., Ochmann, S. and Klein, R. (2019) Fast Template Matching and Pose Estimation in 3D Point Clouds. Computers &amp; Graphics, 79, 36-45. https://doi.org/10.1016/j.cag.2018.12.007</mixed-citation></ref><ref id="hanspub.32617-ref10"><label>10</label><mixed-citation publication-type="other" xlink:type="simple">盛敏, 刘双庆, 王婕, 苏本跃. 基于改进模板匹配的智能下肢假肢运动意图实时识别[J/OL]. 控制与决策, 2019, 1-10 [2019-10-12]. https://doi.org/10.13195/j.kzyjc.2019.0070.</mixed-citation></ref><ref id="hanspub.32617-ref11"><label>11</label><mixed-citation publication-type="other" xlink:type="simple">荆鑫. 基于模板匹配的视觉分拣方法及应用研究[D]: [博士学位论文]. 哈尔滨工业大学, 2017.</mixed-citation></ref></ref-list></back></article>