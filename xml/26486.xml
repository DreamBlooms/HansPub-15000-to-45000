<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">MET</journal-id><journal-title-group><journal-title>Mechanical Engineering and Technology</journal-title></journal-title-group><issn pub-type="epub">2167-6631</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/MET.2018.74035</article-id><article-id pub-id-type="publisher-id">MET-26486</article-id><article-categories><subj-group subj-group-type="heading"><subject>MET20180400000_32847864.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于运动控制器的3D打印机控制系统设计
  Design of 3D Printer Control System Based on Motion Controller
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>何</surname><given-names>颖</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>潘</surname><given-names>盛湖</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>鲁</surname><given-names>豪杰</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>潘</surname><given-names>登</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>张</surname><given-names>婷</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib></contrib-group><aff id="aff2"><addr-line>西南石油大学机电工程学院，四川 成都</addr-line></aff><aff id="aff1"><addr-line>null</addr-line></aff><pub-date pub-type="epub"><day>30</day><month>07</month><year>2018</year></pub-date><volume>07</volume><issue>04</issue><fpage>285</fpage><lpage>289</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
  
    针对目前国内3D打印机数控系统发展缓慢，工程应用主要采用昂贵的进口数控系统等缺陷，本文采用PMAC运动控制器搭建开放式3D数控平台，介绍了3D打印机数控系统的实现过程，着重从硬件组成与软件设计方面给出系统的实现方法。
    In view of the slow development of 3D printer numerical control system in China at present, the engineering application is mainly used to import expensive imported CNC system. This paper uses PMAC motion controller to build open 3D CNC platform, introduces the realization process of 3D printer numerical control system, and emphasizes the realization method of the system of hard-ware components and software design. 
  
 
</p></abstract><kwd-group><kwd>3D打印机，PMAC，硬件设计，软件设计, 3D Printer</kwd><kwd> PMAC</kwd><kwd> Hardware Design</kwd><kwd> Software Design</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于运动控制器的3D打印机控制系统设计<sup> </sup></title><p>何颖，潘盛湖，鲁豪杰，潘登，张婷</p><p>西南石油大学机电工程学院，四川 成都</p><p><img src="//html.hanspub.org/file/6-2340528x1_hanspub.png" /></p><p>收稿日期：2018年7月22日；录用日期：2018年8月13日；发布日期：2018年8月20日</p><disp-formula id="hanspub.26486-formula62"><graphic xlink:href="//html.hanspub.org/file/6-2340528x5_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>针对目前国内3D打印机数控系统发展缓慢，工程应用主要采用昂贵的进口数控系统等缺陷，本文采用PMAC运动控制器搭建开放式3D数控平台，介绍了3D打印机数控系统的实现过程，着重从硬件组成与软件设计方面给出系统的实现方法。</p><p>关键词 :3D打印机，PMAC，硬件设计，软件设计</p><disp-formula id="hanspub.26486-formula63"><graphic xlink:href="//html.hanspub.org/file/6-2340528x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>Copyright &#169; 2018 by authors and Hans Publishers Inc.</p><p>This work is licensed under the Creative Commons Attribution International License (CC BY).</p><p>http://creativecommons.org/licenses/by/4.0/</p><p><img src="//html.hanspub.org/file/6-2340528x7_hanspub.png" /> <img src="//html.hanspub.org/file/6-2340528x8_hanspub.png" /></p></sec><sec id="s3"><title>1. 引言</title><p>目前，3D打印技术是国内制造业发展的一个潮流方向。虽然3D打印加工技术先进，操作简单，但是目前国内的3D打印系统存在打印数据处理缓慢、打印精度低、打印稳定性差的问题 [<xref ref-type="bibr" rid="hanspub.26486-ref1">1</xref>] 。特别是在数控系统性能等方面和国外相比还有很大的差距。目前，国内的一些3D打印厂家在核心技术和零部件生产上仍需借鉴国外的技术，或是直接购买进口产品。</p><p>在比较国内外同类3D打印机后发现：由于打印控制的复杂性，在打印高精度异型零件时，国外由于控制系统先进，控制经验丰富，加工精度好；而国内在控制系统性能、控制经验等方面较为落后，为保证一定的打印精度而不得不采取整机进口或购买国外数控系统设计来组装的方式。这样不仅价格昂贵，也使得国内3D打印产业整体处于被动地位 [<xref ref-type="bibr" rid="hanspub.26486-ref2">2</xref>] 。因此，开发一套具有自主知识产权的3D打印机数控系统，可以大大提高国产3D打印技术的竞争力。本文3D数控系统采用国际上较先进的开放式结构，以PMAC运动控制器为核心，以伺服电机为主驱动元件，目的在于全面提高该类3D打印机的控制效果。</p></sec><sec id="s4"><title>2. 数控系统的硬件设计</title><p>3D打印数控系统的硬件组成是保证系统精度、可靠性和实时性的重要因素 [<xref ref-type="bibr" rid="hanspub.26486-ref3">3</xref>] 。在本系统中，采用主从式控制体系结构，即“IPC + 运动控制器”结构的开放式数控系统结构，如图1所示。运动控制器通常以高速DSP作为CPU，具有很强的运动控制和PLC控制能力，它本身就是一个数控系统，可以单独使用。它开放的函数库可供用户在Windows平台下自行开发构造所需的控制系统。</p><p>图1. 系统结构框图</p><p>本系统硬件主要包括：工控机——研华610型工控机，运动控制卡——Clipper (Turbo PMAC2-Eth-Lite)运动控制卡、DTC-8B四通道转接接口板、PMAC附件ACC34 I/0板，伺服系统——松下A4系列交流伺服电机等 [<xref ref-type="bibr" rid="hanspub.26486-ref4">4</xref>] 。在运动控制卡的控制下，3D打印机识取三维模型数据并转换成自身系统的运动代码。然后控制进给驱动系统，以控制伺服电机工作状态的方式来控制3D打印平台的X、Y、Z轴的运动情况，再协同打印喷头完成打印工作。</p><p>根据3D系统的控制轴数，选PMAC2 Clipper运动控制器作为下位机，其主要功能及特点如下：</p><p>1) 标准的PID，优化PID和极点配置伺服算法。</p><p>2) 动态的多程序段的提前计算，可以达到任意速度下的精确轨迹，能够有效的提高3D打印效率。</p><p>3) 48位的浮点和整数计算 [<xref ref-type="bibr" rid="hanspub.26486-ref5">5</xref>] 。</p><p>4) 强大的倒退和原轨迹返回能力。</p><p>5) 二维和三维坐标系的转换，直角和极坐标系的旋转功能 [<xref ref-type="bibr" rid="hanspub.26486-ref6">6</xref>] 。</p><p>通过插补运算看出，打印喷头和X、Y、Z轴的运动加工实际为四轴插补。其运动控制精度直接影响了产品打印精度，幅值精度影响产品的尺寸误差，相位精度影响产品的形状误差。跟踪精度由伺服系统的动态特性决定，由于3D打印机机械传动部分的惯量很小，所以选用小惯量伺服电机就可以得到较好的控制效果。整个硬件系统控制连接如图2。</p></sec><sec id="s5"><title>3. 数控系统的软件设计</title><p>系统的软件是整个数控系统的核心，是关系到系统的精度、稳定性、可靠性和实时性的最重要的因素之一 [<xref ref-type="bibr" rid="hanspub.26486-ref7">7</xref>] [<xref ref-type="bibr" rid="hanspub.26486-ref8">8</xref>] 。因此，在设计中必须采用合理的开发平台和优化的算法来进行设计。以达到减少设计工作量、提高系统运行性能的目的，使系统具有开放性、多任务的特点，同时要有利于系统的升级换代。在本设计中，所采用的是基于Windows平台的VC++6.0开发环境，在VC++6.0中开发基于MFC的应用程序，具有开放性和多任务性，程序代码相对较少，运行可靠。限于篇幅，在这里仅对系统的软件结构进行介绍，如图3所示。</p><p>1) 文件管理：对零件打印程序进行编辑、程序导入、导出，以及STL文件转换成G代码程序等功能进行管理。</p><p>2) 参数设置：对打印参数进行管理与设置。包括打印速度参数、打印温度参数。</p><p>3) 机床设置：设置3D打印机打印时所需的参数数值。主要包括X、Y、Z轴运动速度、热床升降速度和打印喷头的走丝速度等。</p><p>4) 程序处理：对模型切片数据进行检错并翻译成运动控制卡能够直接识别和使用的代码。</p><p>图2. 硬件连接图</p><p>图3. 软件结构图</p><p>5) 系统调试：主要用于3D打印机的现场连接调试、性能测试等。</p><p>6) 系统管理：完成各种报警信号的清除。包括：伺服驱动器报警及各运动轴行程超出等情况处理。同时要对系统的紧急异常情况做出实时的处理，保证3D打印机和操作人员的安全。</p><p>7) 打印管理：对打印坐标进行实时显示，并以图形化形式实时显示打印路线。</p><p>8) 打印控制：读取打印程序信息与相关参数，输出信号控制各坐标轴完成打印工作，同时完成各PLC输出元件控制。</p><p>9) 故障与系统监控：对3D系统的运行状态进行实时监控，实时提取系统的错误信息和各种异常信息，便于系统的自我调整，保证产品打印精度和整个打印系统安全。</p><p>10) 电源控制：按照上位机软件设置好的脉冲电源参数传输给脉冲电源。在打印过程中，接收脉冲电源发送过来的间隙电压，从而判断打印过程中是否出现短路或者开路现象。</p><p>11) 通信程序：在硬件部分，PC与PMAC控制卡的连接是通过以太网来进行连接的 [<xref ref-type="bibr" rid="hanspub.26486-ref9">9</xref>] 。软件部分，系统软件与PMAC控制卡的通讯是在Pcomm32驱动软件的支持下，通过编写通讯程序，利用Pcomm32函数库所提供的通讯函数从而实现了软件与PMAC控制卡之间的信息通讯。以下为部分软件与PMAC的通讯程序：</p><p>//******初始化PMAC控制卡******</p><p>OpenRuntimeLink();</p><p>//默认0号设备</p><p>dwDevice =0;</p><p>if (dwDevice &gt;= 0 &amp;&amp; dwDevice &lt;= 7)</p><p>{</p><p>if (OpenPmacDevice(dwDevice))</p><p>{</p><p>m_bDriverOpen = 1;</p><p>}</p><p>}</p><table-wrap id="table1" ><label><xref ref-type="table" rid="table1">Table 1</xref></label><caption><title> The performance parameters of 3D printing syste</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >打印层厚</th><th align="center" valign="middle" >软件要求</th><th align="center" valign="middle" >喷嘴直径</th><th align="center" valign="middle" >线料种类</th><th align="center" valign="middle" >线料直径</th><th align="center" valign="middle" >打印精度</th></tr></thead><tr><td align="center" valign="middle" >0.1~0.2 mm</td><td align="center" valign="middle" >Cura</td><td align="center" valign="middle" >0.4 mm</td><td align="center" valign="middle" >PLA、ABS</td><td align="center" valign="middle" >1.75 mm</td><td align="center" valign="middle" >&gt;95%</td></tr></tbody></table></table-wrap><p>表1. 3D打印系统性能参数</p><table-wrap id="table2" ><label><xref ref-type="table" rid="table2">Table 2</xref></label><caption><title> Comparison of print data between two printing system</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >机型</th><th align="center" valign="middle" >打印时间</th><th align="center" valign="middle" >温度误差</th><th align="center" valign="middle" >打印精度</th><th align="center" valign="middle" >打印质量</th></tr></thead><tr><td align="center" valign="middle" >MicroMake</td><td align="center" valign="middle" >186 min</td><td align="center" valign="middle" >波动24℃</td><td align="center" valign="middle" >误差10%</td><td align="center" valign="middle" >一般</td></tr><tr><td align="center" valign="middle" >本系统</td><td align="center" valign="middle" >129 min</td><td align="center" valign="middle" >波动3℃</td><td align="center" valign="middle" >误差3%</td><td align="center" valign="middle" >高</td></tr></tbody></table></table-wrap><p>表2. 两种打印系统打印数据对比</p></sec><sec id="s6"><title>4. 3D打印系统整体性能参数</title><p>根据上述对3D打印系统硬件和软件的选择和调试，设计出一套3D打印系统，其各项性能参数如表1所示。</p></sec><sec id="s7"><title>5. 实验结果</title><p>为了验证该3D数控系统在性能上的优越性，实验将该系统与一台现在市场上常见的MicroMake打印机进行了打印对比，打印对象长 &#215; 宽 &#215; 高 = 3 cm &#215; 3 cm &#215; 6 cm的兔子模型。表2为两个系统打印数据的对比。</p><p>通过表格可以看出，本系统在打印过程中极大地缩短了打印时间，热床的温度波动幅度也降低为MicroMake的12.5%，模型的精度也提高到了MicroMake的三倍多，整体性能有了很大的提高。</p></sec><sec id="s8"><title>6. 总结</title><p>本文着重论述了具有高性能的3D打印机数控系统的设计方法，给出了在硬件和软件上的设计模型。经过连机调试，该系统达到了设计目的，符合现在3D打印市场的要求。在电子技术迅速发展的今天，运用嵌入式系统体系结构重新设计该系统，以求得更高精度、可靠性、实时性和更高性能的数控系统。</p></sec><sec id="s9"><title>文章引用</title><p>何 颖,潘盛湖,鲁豪杰,潘 登,张 婷. 基于运动控制器的3D打印机控制系统设计 Design of 3D Printer Control System Based on Motion Controller[J]. 机械工程与技术, 2018, 07(04): 285-289. https://doi.org/10.12677/MET.2018.74035</p></sec><sec id="s10"><title>参考文献</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.26486-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">王雪莹. 3D打印技术与产业的发展及前景分析[J]. 中国高新技术企业, 2012(26): 3-5.</mixed-citation></ref><ref id="hanspub.26486-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">王振华, 薛严冰, 许琳娜. 基于STM32的立体式3D打印机控制系统设计[J]. 自动化技术与应用, 2017, 36(3): 130-134.</mixed-citation></ref><ref id="hanspub.26486-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">谭秀腾, 郭小定. 基于ARM的桌面型3D打印机控制系统设计[J]. 应用科技, 2014, 41(5): 57-61.</mixed-citation></ref><ref id="hanspub.26486-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">丁承君, 张鹏. 平面型Hbot机构的运动控制算法[J]. 天津工业大学学报, 2017, 36(1): 77-82.</mixed-citation></ref><ref id="hanspub.26486-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">赵广林. 新型电源集成电路应用手册[M]. 北京: 电子工业出版社, 2006.</mixed-citation></ref><ref id="hanspub.26486-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">刘薇娜, 郭遵站, 杨立峰. 3D打印机控制系统的开发[J]. 机械工程师, 2014(12): 116-118.</mixed-citation></ref><ref id="hanspub.26486-ref7"><label>7</label><mixed-citation publication-type="other" xlink:type="simple">王苏洲, 舒志兵, 李俊, 等. 基于ARM的桌面型3D打印机控制系统的设计与优化[J]. 电子器件, 2017, 40(5): 1324-1328.</mixed-citation></ref><ref id="hanspub.26486-ref8"><label>8</label><mixed-citation publication-type="other" xlink:type="simple">梁菁. 结合Bresenham直线算法的运动模糊方向判断方法[J]. 制造业自动化, 2013, 35(5): 38-41.</mixed-citation></ref><ref id="hanspub.26486-ref9"><label>9</label><mixed-citation publication-type="other" xlink:type="simple">徐军, 王天伦. 3D打印机控制系统的设计[J]. 计算机测量与控制, 2017, 25(3): 51-54.</mixed-citation></ref></ref-list></back></article>