<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd"><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="3.0" xml:lang="en" article-type="research article"><front><journal-meta><journal-id journal-id-type="publisher-id">SEA</journal-id><journal-title-group><journal-title>Software Engineering and Applications</journal-title></journal-title-group><issn pub-type="epub">2325-2286</issn><publisher><publisher-name>Scientific Research Publishing</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.12677/SEA.2016.53022</article-id><article-id pub-id-type="publisher-id">SEA-17787</article-id><article-categories><subj-group subj-group-type="heading"><subject>SEA20160300000_58617215.pdf</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>工程技术</subject></subj-group></article-categories><title-group><article-title>
 
 
  基于TFS的分布式文件存储平台研究与实现
  Research and Implementation of Distributed File Storage System Based on TFS
 
</article-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>张</surname><given-names>海茹</given-names></name><xref ref-type="aff" rid="aff1"><sub>1</sub></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib></contrib-group><aff id="aff1"><label>1</label><addr-line>天津通联电气有限公司，天津</addr-line></aff><author-notes><corresp id="cor1">* E-mail:<email>2401079597@qq.com</email></corresp></author-notes><pub-date pub-type="epub"><day>07</day><month>06</month><year>2016</year></pub-date><volume>05</volume><issue>03</issue><fpage>198</fpage><lpage>203</lpage><permissions><copyright-statement>&#169; Copyright  2014 by authors and Scientific Research Publishing Inc. </copyright-statement><copyright-year>2014</copyright-year><license><license-p>This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/</license-p></license></permissions><abstract><p>
 
 
   
   随着互联网的迅猛发展，以文本、音频、图片等数据为代表的非结构化数据呈现爆炸式增长，分布式文件存储技术应运而生。论文设计高效的分布式存储体系，提出基于TFS (Taobao File System)的分布式文件存储方案，包括平台Web端、核心数据缓存集群、文件管理服务集群、数据库和TFS数据存储集群。 With the rapid development of Internet, the explosive growth of unstructured data such as text, audio, pictures and other data has caused the technology of distributed file storage to develop rapidly. The efficient distributed storage system is designed. And the distributed file storage scheme based on TFS (Taobao File System) is put forward, including the web platform, core data cache cluster, file management server cluster, database and TFS data storage cluster.
    
  
 
</p></abstract><kwd-group><kwd>分布式系统，文件存储，TFS, Distributed System</kwd><kwd> File Storage</kwd><kwd> TFS</kwd></kwd-group></article-meta></front><body><sec id="s1"><title>基于TFS的分布式文件存储平台研究与实现<sup> </sup></title><p>张海茹</p><p>天津通联电气有限公司，天津</p><disp-formula id="hanspub.17787-formula96"><graphic xlink:href="http://html.hanspub.org/file/3-2690213x6_hanspub.png"  xlink:type="simple"/></disp-formula><p>收稿日期：2016年5月28日；录用日期：2016年6月12日；发布日期：2016年6月15日</p><disp-formula id="hanspub.17787-formula97"><graphic xlink:href="http://html.hanspub.org/file/3-2690213x7_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s2"><title>摘 要</title><p>随着互联网的迅猛发展，以文本、音频、图片等数据为代表的非结构化数据呈现爆炸式增长，分布式文件存储技术应运而生。论文设计高效的分布式存储体系，提出基于TFS (Taobao File System)的分布式文件存储方案，包括平台Web端、核心数据缓存集群、文件管理服务集群、数据库和TFS数据存储集群。</p><p>关键词 :分布式系统，文件存储，TFS</p><disp-formula id="hanspub.17787-formula98"><graphic xlink:href="http://html.hanspub.org/file/3-2690213x8_hanspub.png"  xlink:type="simple"/></disp-formula></sec><sec id="s3"><title>1. 引言</title><p>随着互联网迅速发展，用户创造了大量的小文件，一般文件大小小于64 MB，这些文件如何存储，如何分析，成为当前一个重要问题。</p><p>Google设计了GFS (GoogleFile System)用于存储庞大数据，HDFS [<xref ref-type="bibr" rid="hanspub.17787-ref1">1</xref>] (Hadoop File System)是GFS的一个简化版实现，二者都采用单一主控机 + 多台工作机的模式，通过数据分块和复制来提供更高的可靠性和更高的性能。但是根据文献 [<xref ref-type="bibr" rid="hanspub.17787-ref2">2</xref>] [<xref ref-type="bibr" rid="hanspub.17787-ref3">3</xref>] 可知，访问大量小文件的速度远小于访问少量大文件的速度，效率较低。</p><p>淘宝自行研发文件的存储框架(TFS) [<xref ref-type="bibr" rid="hanspub.17787-ref4">4</xref>] ，其高效率、高容错性、高并发性使得它能够处理海量的小文件存储。但是对于中小企业来所，TFS搭建，存在浪费时间、金钱和精力的问题，不能适应现在高速发展的互联网行业。</p><p>为了更快的搭建分布式存储体系，提高小文件存储效率，本文研究并实现了基于TFS的文件存储平台，实现对文件的管理，主要包括：文件上传，文件下载，查看文件细节等，解决负载均衡的问题，同时保证了用户文件的安全性、保密性和隐私性。</p></sec><sec id="s4"><title>2. TFS文件存储技术</title><p>TFS的设计初衷是为了解决淘宝网站海量小文件的存储问题。TFS文件存储系统是一个分布式的文件系统，分为两部分NameSever节点和DataServer节点，可以运行在同一台服务器上，但是TFS一般搭建集群，由两个Nameserver节点和若干个DataServer节点组成，两个NameServer节点分别为一主一备，提高系统的安全性。TFS文件存储结构也采用了块的概念，TFS文件存储系统中的块的大小默认64 M，但是可以根据需求更改配置项更改块的大小。NameServer负责DataServer的状态管理，并维护块与DataServer的映射关系。NameServer不负责实际数据的读写，实际数据的读写由DataServer完成。</p><p>TFS能够完成用户自定义文件名存取小文件，但是仍然存在一些问题，TFS在执行读写操作时，读写文件低效；TFS的NameServer记录了所有块的信息，如果失效，则必须重建块信息和映射关系 [<xref ref-type="bibr" rid="hanspub.17787-ref5">5</xref>] 。为了克服这些问题，本文在TFS基础上，设计文件存储集群负责文件的基本操作，实现均衡负载，保证数据安全与一致性，并设置核心数据缓存集群，提高文件读写效率。</p></sec><sec id="s5"><title>3. 系统分析与设计</title><sec id="s5_1"><title>3.1. 系统分析</title><p>基于TFS的文件存储系统是针对中小文件的安全和一致性的读写，设计的轻量级的文件存储平台，主要实现对文件的管理，主要包括：文件上传，文件下载，查看文件细节等，解决负载均衡的问题，同时保证了用户文件的安全性、保密性和隐私性。</p><p>系统运行在普通计算机组成的集群上，而不是运行在高性能的专业服务器上，达到减低存储成本，同时便于系统扩展。该平台为程序开发者提供一个存储文件的服务，减少开发者工作量，同时减少开发者对文件安全性的担忧，减少开发者对文件的空间的担忧。</p></sec><sec id="s5_2"><title>3.2. 系统架构设计</title><p>基于TFS文件存储系统平台架构采用的是对等式结构，主要是文件存储服务器集群和TFS文件存储集群。文件存储集群负责文件的基本操作，并实现均衡负载，TFS文件存储集群主要是负责文件存储，TFS文件存储集群有多个TFS文件存储节点组成，一个节点可以由单台服务器也可以由多台服务器共同组成，其中TFS文件存储节点均有备份，同时各个节点互相独立，增强了系统的容错性和抗压能力。其整体结构如图1。</p><p>图1. 系统架构</p><p>系统组件主要有五个：平台Web端，核心数据缓存集群，文件管理服务集群，数据库，TFS数据存储集群。</p><p>1) 平台Web端</p><p>平台Web端采用HTML + CSS + JAVASCRIPT实现，主要用到java语言进行开发，采用SSH框架。平台Web端服务器主要是给平台注册的用户提供文件存储服务。平台Web的功能主要包括用户信息的管理，用户创建的应用的管理，各应用的文件管理，其中文件管理包括上传、下载、移动位置、删除等功能。</p><p>平台Web端是本系统的推广的关键所在，为了增强用户的体验效果，提高网站的速度，将文件管理服务分离，并添加缓存服务增强访问效果，同时web端采用了两台服务器共同搭建，负载均衡，从而提高效率。</p><p>2) 核心数据缓存集群</p><p>核心数据缓存集群服务 [<xref ref-type="bibr" rid="hanspub.17787-ref6">6</xref>] 是本系统的核心服务，采用Memcache缓存服务技术进行搭建。</p><p>Memcache缓存在业界内应用很广泛，是一个分布式的内存对象缓存系统，该系统在内存中维护一张Hash表，该Hash表中可以存储图片，视频，还有从数据库中检索的数据等。由上可见，其提高读取的速度，主要是将数据放到内存中，然后各个应用从内存中读取数据。Memcached采用的是守护程序的方式，并若干个服务器上运行，实时监测连接等操作。现在许多动态的网站常常为了缓解数据的压力，常常采用Memcached缓存技术，将常用的数据预先加载到内存，通过唯一标识符在缓存中获得数据，降低读取数据库的次数，从而提高网站的速度。</p><p>Memcache缓存服务集群主要是解决文件上传下载速度慢的问题，通过减少数据库的访问，提高获得文件上传下载的地址的速度。</p><p>3) 数据库服务</p><p>数据库服务由两台服务器搭建，一主一副，主数据库面向应用，副数据库与主服务器数据同步，作为主数据库的备份，同时数据库中的数据定期做冷备份。</p><p>数据服务主要采用Mysql数据库，主要是因为Mysql数据库是免费的数据库，没有Oracle和SqlServer数据库的版权问题；其次，Mysql数据库是一个快速的，多线程的、多用户和健壮的SQL数据库服务器。MySql服务器支持关键任务、重负载生产系统的使用；再次，Mysql是开源的，意味着任何人都可以使用和修改该软件，方便开发者根据项目需求更改Mysql底层代码的实现，从而更加高效的获取数据。</p><p>4) 文件管理服务集群</p><p>文件管理服务是本系统的核心，极有可能成为系统的瓶颈，因此采用多个服务器搭建集群，实现负载均衡，从而解决瓶颈问题。文件管理服务与三方面进行交互,分别是用户的Applications，核心缓存服务和TFS数据存储。文件管理服务给用户Applications提供文件操作所需要的接口，这些接口包括文件上传、文件下载、文件更改、文件删除等接口，从而能够很好的为用户Applications提供健全的文件存储服务；文件管理服务不与数据库进行直接接触，而是将需要保存的数据同步到缓存服务集群上，然后数据缓存服务定时将数据同步到数据服务上，从而达到异步存储的目的，减轻了文件管理服务的数据处理的压力。文件管理服务与TFS文件存储服务交互，将上传的文件存储到TFS文件存储服务中，这种设计将用户的Applications的文件操作与TFS文件存储服务隔离开，极大的保证了TFS文件存储的安全性。</p><p>5) TFS文件存储服务集群</p><p>TFS文件存储服务集群由多台TFS文件存储节点组成，采用TFS文件存储节点，主要是因为TFS的容错性高，抗压能力强，同时增大存储空间，搭建集群增加备份点，提高安全性。</p><table-wrap id="table1" ><label><xref ref-type="table" rid="table1">Table 1</xref></label><caption><title> Platform deployment pla</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >服务 名称</th><th align="center" valign="middle" >CPU (GHZ)</th><th align="center" valign="middle" >内存 (G)</th><th align="center" valign="middle" >硬盘 (G)</th><th align="center" valign="middle" >网卡 (Mps)</th><th align="center" valign="middle" >操作系统</th><th align="center" valign="middle" >服务器 数量</th></tr></thead><tr><td align="center" valign="middle" >Web端</td><td align="center" valign="middle" >2.7</td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >100</td><td align="center" valign="middle" >1000</td><td align="center" valign="middle" >Centos6.4</td><td align="center" valign="middle" >2</td></tr><tr><td align="center" valign="middle" >缓存服务</td><td align="center" valign="middle" >2.7</td><td align="center" valign="middle" >8</td><td align="center" valign="middle" >100</td><td align="center" valign="middle" >100</td><td align="center" valign="middle" >Centos6.4</td><td align="center" valign="middle" >2</td></tr><tr><td align="center" valign="middle" >数据库服务</td><td align="center" valign="middle" >2.7</td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >500</td><td align="center" valign="middle" >100</td><td align="center" valign="middle" >Centos6.4</td><td align="center" valign="middle" >2</td></tr><tr><td align="center" valign="middle" >文件管理服务</td><td align="center" valign="middle" >2.7</td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >100</td><td align="center" valign="middle" >1000</td><td align="center" valign="middle" >Centos6.4</td><td align="center" valign="middle" >3</td></tr><tr><td align="center" valign="middle" >TFS文件存储服务</td><td align="center" valign="middle" >2.7</td><td align="center" valign="middle" >4</td><td align="center" valign="middle" >1000</td><td align="center" valign="middle" >1000</td><td align="center" valign="middle" >RHEL 5</td><td align="center" valign="middle" >2</td></tr></tbody></table></table-wrap><p>表1. 平台部署方案</p><table-wrap id="table2" ><label><xref ref-type="table" rid="table2">Table 2</xref></label><caption><title> Latency of 100K file</title></caption><table><tbody><thead><tr><th align="center" valign="middle" >存储系统名称</th><th align="center" valign="middle" >读延迟/μs</th><th align="center" valign="middle" >写延迟/μs</th></tr></thead><tr><td align="center" valign="middle" >HDFS文件存储</td><td align="center" valign="middle" >9082</td><td align="center" valign="middle" >92,214</td></tr><tr><td align="center" valign="middle" >TFS文件存储</td><td align="center" valign="middle" >7876</td><td align="center" valign="middle" >72,865</td></tr><tr><td align="center" valign="middle" >本文件存储</td><td align="center" valign="middle" >2642</td><td align="center" valign="middle" >20,128</td></tr></tbody></table></table-wrap><p>表2. 10万个文件延迟对比</p></sec></sec><sec id="s6"><title>4. 平台部署与实验分析</title><p>文件存储平台部署比较复杂，需要部署五个服务，分别是Web端服务、缓存服务，数据库服务、文件管理服务和TFS文件存储系统服务。本平台涉及到的服务比较多，而且再部署的时候还要考虑到负载均衡和文件备份等，需要较多的服务器，为了完成平台的部署，采用某些虚拟服务器。系统的具体部署如表1。</p><p>由表1可以看到，各个服务的服务器配置有些许差异，这是根据每个服务的特点进行的配置。例如Web端、问价管理服务和TFS文件存储服务，对网络要求较高，所以网卡采用的是千兆网卡；缓存服务的承载量与其所在的服务器的内存成正比，所以分配的服务器的内存较高；数据库和TFS文件存储服务对硬盘要求比较高，硬盘存储量设定的较高。</p><p>平台搭建之后，在本科毕业设计管理系统中进行了实际应用，和之前的文件系统相比，如表2所示，能够较快的实现文件的上传、下载，运行效果良好。</p></sec><sec id="s7"><title>5. 结论</title><p>由于现在大部分文件存储服务不能够满足中小企业和许多网站的需求，但是自己搭建文件存储服务，对中小企业和许多网站是一个很大的负担。本文从需求和性能上考虑，研究并设计了分布式文件平台，包括了平台Web端，核心数据缓存集群，文件管理服务集群，数据库和TFS数据存储集群。实践证明，文件存储实现了均衡负载，保证数据安全与一致性，提高文件读写效率。</p></sec><sec id="s8"><title>文章引用</title><p>张海茹. 基于TFS的分布式文件存储平台研究与实现Research and Implementation of Distributed File Storage System Based on TFS[J]. 软件工程与应用, 2016, 05(03): 198-203. http://dx.doi.org/10.12677/SEA.2016.53022</p></sec><sec id="s9"><title>参考文献 (References)</title></sec></body><back><ref-list><title>References</title><ref id="hanspub.17787-ref1"><label>1</label><mixed-citation publication-type="other" xlink:type="simple">马登邑. 基于Hadoop存储的文件管理系统的研究与实现[D]: [硕士学位论文]. 武汉: 华中科技大学, 2013.</mixed-citation></ref><ref id="hanspub.17787-ref2"><label>2</label><mixed-citation publication-type="other" xlink:type="simple">王铃惠, 李小勇, 张轶彬. 海量小文件存储文件系统研究综述[J]. 计算机应用与软件, 2012, 29(8): 106-109.</mixed-citation></ref><ref id="hanspub.17787-ref3"><label>3</label><mixed-citation publication-type="other" xlink:type="simple">Dong, X.C. (2015) Hadoop HDFS. http://dongxicheng.org</mixed-citation></ref><ref id="hanspub.17787-ref4"><label>4</label><mixed-citation publication-type="other" xlink:type="simple">刘伯睿. 海量数据小文件分布式存储系统的设计与实现[D]: [硕士学位论文]. 长沙: 湖南大学, 2013.</mixed-citation></ref><ref id="hanspub.17787-ref5"><label>5</label><mixed-citation publication-type="other" xlink:type="simple">李洪奇, 朱丽萍, 孙国玉, 等. 面向海量小文件的分布式存储系统设计与实现[J]. 计算机工程与设计, 2016(1): 86-92.</mixed-citation></ref><ref id="hanspub.17787-ref6"><label>6</label><mixed-citation publication-type="other" xlink:type="simple">秦秀磊, 张文博, 魏峻, 等. 云计算环境下分布式缓存技术的现状与挑战[J]. 软件学报, 2013, 24(1): 50-66.</mixed-citation></ref></ref-list></back></article>