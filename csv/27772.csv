"文章分析了配网通信的特点，结合地区供电局的应用经验，研究了101、104协议应用于配网自动化时需要规范的内容。文章结合配网自动化通信检测需要，提出了101、104协议一致性测试的要求，同时分析了现有的通信协议测试系统的缺陷，并介绍了通信协议智能测试系统的开发要点。 关键词 :配电网通信，通信协议，101规约，104规约，一致性测试，错误定位 Copyright © 2018 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"配电网自动化系统是指利用计算机、通信、电力电子技术对配电网现场运行的设备进行远程监测和控制的自动化系统。配网自动化需对分布在配网线路各处的设备进行监控，被监控对象数量繁多，且地理位置分散、分布广泛，依赖于有效可靠的通信手段及协议。 目前国内城市建设配网自动化工程，使用的协议大多是IEC 60870-5-101和IEC 60870-5-104协议，其中载波通信采用101非平衡式协议，公网无线GPRS通信采用104和平衡式101协议。国内文献研究针对配电网的特点，详细研究了配网自动化通信单节点通信数据量低、通信通道数量相对较大等特点 [ 1 ] [ 2 ] [ 3 ] 。但在实际配网应用中，由于101、104协议提供给用户的可选项较多，可配置的参数太多，对于电力系统应用人员来说，反而不易把握参数的选配以及应用功能的选择。同时也会导致不同的应用人员根据自己的理解选取其中的应用功能选项和参数，实际上造成了各个不同的调度中心就有不同版本的101/104协议，各自动化设备厂家需针对每个调度中心开发相应版本的101/104协议通信程序 [ 4 ] [ 5 ] [ 6 ] 。因此，为解决规约一致性问题，需对规约的互操作性进行深入研究，开发出一套适用于配网通信协议的测试软件，对配网设备的通信协议程序进行一致性测试，有效支持配网自动化系统应用。"
"因104规约是101规约为基础的基于TCP/IP协议的网络通信规约，该规约作为采用标准传输协议子集的101规约的网络访问，其应用层ASDU与101规约基本一致 [ 7 ] 。104协议架构是建立ISO-OSI开放式系统互联模型的基础上的，由图1中可知，104协议是101协议和TCP/IP的网络传输功能的集合，让IEC 60870-5-101可以在X.25、ATM、ISDN、帧中继等多种网络场景中应用。 图1. 101、104协议架构 101、104规约中除了对链路地址、公共地址、对象体地址、传送原因等字段长度进行了规定以外，考虑到配网无线通信是租赁模式，必须兼顾通信资费和通信效率的双重要求，均对无线通信中使用到的101平衡式协议内容进行了细化，主要针对可能造成无线传输流量增加的内容进一步规定。如组号分配问题，第1组~第8组为遥信；第9组~第12组为遥测。此外，还需要形成一套完整的通信策略，来规定通信双方由于链路问题的各种等待重发时间和重发次数。表1为广东电网公司推荐采用的重发参数配置，可保证厂站端的信息能被调度共享，减少维护工作量，提高工作效率，须将其进行扩展，以适应调度、运行维护的需要。 Table 1 重发参数 预设值 推荐范围 重发参数 预设值 推荐范围 X1 10 5~255 X10 10 5~255 X2 3 3~10 X11 11 3~10 X3 60 10~600 X12 0 0~255 X4 60 10~600 X13 5 1~15 X5 3 3~10 X14 10% 1%~100% X6 10 5~255 X15 10 5~255 X7 15 5~255 X16 3 3~15 X8 10 5~255 X17 60 10~255 X9 3 3~10 X18 65 10~255 表1. 广东电网101、104规约通信策略重发参数表(单位：秒) 协议实施细则还应该规定针对无线通信终端的远程维护功能，以解决无线通信终端远程故障恢复和参数更改的问题。另外，由于终端厂家众多，也需要规定监控终端的简单的远程维护功能，使得终端可以脱离厂家的维护软件而进行参数维护功能。"
"目前行业内存在若干版本的101、104及其他通信规约的测试软件，在这些软件中，至少有两方面的不足 [ 8 ] 。一是在测试功能上，现有的测试软件不能满足对测试参数的灵活修改，同时只能对正常的通信流程和应用服务数据单元结构进行解释和测试，缺乏对故障通信情况下规约的健康性测试。二是测试方式上，欠缺对错误报文的准确定位及错误原因分析。所以在实际的测试过程中，不能给测试人员提供辅助性的错误提示。 为了更好地协助测试人员进行通信协议一致性测试，测试系统需要具备以下特性： 1) 灵活的协议参数配置和测试项配置； 2) 错误报文跟踪分析； 3) 自动和手动相结合的测试分析手段。 本文通过在对广东电网设备入网检测中积累了丰富的测试经验，开发出一套针对配网101、104通信协议的测试系统，并在实际应用中进行了评估。 101、104协议的一致性测试是指借助通信协议测试系统，根据正式颁布的配网通信协议实施细则，对主站和终端之间的报文交互过程进行分析和判定，寻找出主站和终端使用的通信协议与协议实施细则不一致之处，并进行评分。对主站协议的测试，是通过模拟终端测试软件进行；对终端协议的测试，是通过模拟主站测试软件进行。测试过程一般分为两阶段，一是对正常通信过程的测试，二是对错误通信过程的测试。 正常通信过程的测试，主要是测试在正常通信过程下，链路建立过程、初始化过程、总召唤过程、三遥过程、对时过程等过程中的报文字段的正确性，是通信协议实施细则的基本要求；错误通信过程的测试，是通过测试系统模拟发出错误的报文，以测试主站或终端是否能够严格按实施细则的规定进行处理，这是通信协议实施细则的高级要求，但也是必不可少的部分。"
"配网自动化通信规约测试系统以面向对象为开发思想，采用模块化的结构设计，将功能分解为模块，模块功能的实现采用基于组件化的方式。可方便配置每种规约的协议参数，并很容易进行新规约的扩展。软件分解为主程序(exe)、规约模块(dll)、配置文件(xml)、测试结果文件四部分，每部分实现特定的功能，如图2所示。 图2. 软件结构图 主程序共有三种工作模式：自动测试、单步测试以及运行模式。 自动测试模式支持测试过程一键点击完成所选择的所有过程项及数据项的测试，一般作为整个测试过程的第一阶段，能够方便快速地对整个协议程序有一个全面的了解和评价，也作为单步测试阶段的基础。 单步测试模式支持分测试项逐个进行，由测试人员决定测试过程的启停。能够有针对性对某个报文交互过程进行详细地测试，分析其错误原因。 手动测试模式支持手动输入数据报文，并给测试人员提供发送数据帧模板。是对自动测试和单步测试模式的补充和扩展，由测试人员手动输入每个报文和被测试方进行交互，达到了灵活测试的目的。 三种测试模式工作流程如图3所示。 图3. 主控程序流程图 1) 首先进行模式选择，自动、单步(主站)以及运行态；如果已经处于某种模式下，提示用户将切换通道并初始化状态。 2) 判断通道是否已经运行，如果已经运行则先关闭通道；否则直接进入第4步。 3) 判断通道使能标志，如果初始化通道并使能；否则直接打开通道。 4) 判断通道标志，是否打开，如果未打开则打开通道。 5) 判断通道标志是否创建了协议组件，如果已创建，则初始化协议，否则首先创建组件，然后初始化协议。 6) 判断当前通道的协议组件对象是否已经初始化过，没有则初始化，有的话则启用组件。 7) 根据第一步中设置的模式，则通知协议对象进入到指定的模式状态下。 8) 如果进入自动测试模式，则组件会自动运行下去，不需要人工干预，这时候可以选择停止通道。当组件处理完毕或者认为处理完所有的测试项后，会向界面发送测试结束的通知，这时候界面会根据设置的标示信息，如果需要进入运行态，则自动转入运行态；如果需要弹出测试结果，则弹出测试结果信息。 9) 在模拟主站的时候，单步执行会一步一步的执行过程项；首先会执行第一个过程分项；当组件执行完后返回测试结束信息时，程序自动跳转到下一过程分项，等待用户再次点击按钮进行测试；当测试完成后；如上述第8所说的根据标示信息进行动作。 10) 如果进入运行模式，主站会保持链路，子站会及时回应主站的信息。 图4. 测试验证对比 通过现场测试验证，该测试系统可以提高测试效率和规约一致性，如图4所示，测试效率提高了50%，规约一致性提高至100%。"
"通信的问题是多年来制约配网自动化发展的一个重要因素，IEC61850提供的通信模型是配电网通信发展的方向，能够建立统一、完善、详细的功能和数据模型，提高通信效率；同时101、104通信协议仍将长期地应用于配电网通信，本次开发的配电网自动化通信协议测试系统功能完善、稳定，提高了测试效率和规约一致性，在对入网设备的通信协议检测方面将发挥重要的作用。"
