"本设计采用STM32单片机作为主控芯片，产生一路PWM波和双路互补的SPWM波，以全桥逆变电路为核心电路，实现单相不间断式UPS电源。采用以IR2103芯片和IR2110芯片为主的驱动电路驱动双向DC-DC电路和全桥逆变电路中的MOS管。电路使用高精度芯片AD637采集交流电压反馈至单片机通过PID算法调节PWM波输出的占空比。本电源输出电压较为稳定，负载调整率和电压调整率均在1%以下，且正弦波波形失真度在2%以下。本电源在交流供电时能够输出稳定30 V的交流电压，电流输出范围为1 A~2 A。直流供电时输出交流电压为30 V，电流在1 A左右，效率达到85%以上。"
"随着计算机、网络、通信技术的发展，国民经济、国防军工、政府部门的各个领域要保障计算机网络系统的安全、可靠运行，就离不开UPS不间断电源 [ 1 ]。由于市电供电存在不稳定、不可控等因素，因此，设计不间断式UPS电源供电，在市电停电时提供不间断供电电源 [ 2 ]，在许多领域都提供了很大的帮助。本设计选用STM32单片机为控制芯片，以单相全桥逆变电路为核心电路输出50 Hz正弦交流电。选择双向DC-DC电路作为辅助电路模块，用以控制全桥逆变电路的输入电压。并使用继电器和二极管控制交流电和直流电的同时接入，保证了供电的快速切换，提高了电路的输出效率。单片机提供PWM波和双路互补的SPWM波分别控制双向DC-DC电路和单相全桥逆变电路，同时对输出的交流电压采样，反馈至单片机控制双向DC-DC电路模块，最终控制电源输出正弦交流电压的稳定。"
"本电源设计由整流电路模块、双向DC-DC电路模块、全桥逆变电路模块、单片机控制模块、交流电压采样模块、辅助电源模块等部分组成。交流供电时，220 V市电经过自耦和隔离变压器输出29 V~43 V可变交流电，再经过整流滤波电路得到直流电，直流电经过双向DC-DC电路，通过单片机产生PWM波经过IR2103驱动两个MOS管得到稳定的升压直流输出电，升压直流电经过DC-AC全桥逆变电路，通过单片机产生两路反向互补的SPWM波接入IR2110芯片输出四路SPWM波，四路SPWM波推挽驱动全桥逆变结构中的四个MOS管的导通和截止得到正弦交流电 [ 3 ]。利用高精度芯片AD637作为采样芯片采集输出的交流电压反馈至单片机进行闭环控制，通过调节PWM波的输出占空比控制双向DC-DC电路的升压，稳定升压直流电，经过逆变最终输出稳定的50 Hz、30 V的正弦交流电。单片机内部使用PID算法，根据反馈的电压实时控制输出电压的稳定。通过OLED显示屏幕实时显示采集的电压值和输出的PWM波占空比。断开交流电时，单片机通过ADC采样整流之后的直流电压，进而控制继电器的关断，电路瞬间切换到24 V直流稳压电源供电，同时通过内部的PID算法快速调节输出电压，保证了UPS电源的效率和输出电压的稳定。系统总体设计如图1所示： 图1. 系统总体设计图"
"整流滤波电路由桥式整流电路和电解电容构成，桥式整流电路是通过二极管的单向导通特性将交流电转换为单向的直流电，经过电容滤波作为后级双向DC-DC电路输入。桥式整流滤波电路中，二极管截止时承受的最大反向电压 U r m = 2 U i ，其中U i 为交流输入电压，在本系统中，U i 输入范围为29 V~43 V，二极管承受最大反向电压约为60.8 V。整流二极管选用FR307，此二极管的各种参数均满足此次设计需求。其最大承受反向电压为1000 V，最大正向平均整流电流为3 A，但由于整流后的直流电其脉动成分较大，不便于后续使用，因此采用电容滤波，其特点为输出直流电压较高，纹波较小，但由于一级滤波效果较差，因此采用两个电解电容并联加强其滤波效果。  双向DC-DC电路采用BUCK-BOOST电路拓扑，具备升降压双向变换功能。当从U i 输入电压时，电路工作在BOOST模式下，实现升压功能。电感L的储能作用使U o 电压泵升，经过电容C2稳压之后，可使输出电压高于输入电压 [ 4 ]，即U o > U i 。MOS管选择IRFP250N，其漏源极击穿电压为200 V，漏源导通电阻仅为75 mΩ，其较高的击穿电压保证了MOS管的安全，较小的导通电阻可以减小MOS管的导通功耗，提高整个系统的效率。因为MOS管寄生电容的存在，在MOS管打开或关闭的时候，要对电容进行充电，瞬间电流较大。为减小MOS管开关时的损耗，在 极前串联一个10 Ω电阻，减小开关瞬时电 图2. 双向DC-DC电路图 流。此外还在GS极之间并联一个10 kΩ电阻，其一是为了是把G极拉低，这样使MOS管G极为低电平，不会造成开机时没PWM波输出情况下MOS管因G极悬空而导通。其二是作泄放电阻使用，使MOS管 G极上的电荷在开关周期内能迅速释放，起到加速关闭作用。双向DC-DC电路如图2所示。  逆变电路主要由全桥逆变电路和滤波电路组成。对于主电路MOS管的选择，考虑到效率，器件损耗程度，导通时间长短等问题，选择与上述双向DC-DC相同的IRFP250N MOS管。系统通过四路SPWM控制信号分别控制Q1、Q2、Q3、Q4四个MOS管，在一个周期内得到完整的正弦波输出。此外由于MOS管自身的寄生二极管耐压值和耐流值都不确定，需要在MOS管上再并联一个二极管，一方面可以防止源极电压过大烧坏MOS管，另一方面起到续流的作用，防止MOS管截止时产生的高压将其击穿。经过全桥逆变电路变换之后得到的波形并不是标准的正弦波，含有丰富的高频分量，需要设计合适的滤波电路。考虑到正弦波输出频率为50 Hz，因此我们使用LC滤波器为逆变器滤波，经测试，将电感分为两部分的滤波效果要明显好于单个电感。滤波器参数设计公式如下： f r = 1 2 π L C #(1) 其中f r 为截止频率，L和C分别为电感值和电容值，本电源的输出交流电压频率为50 Hz，因此将截止频率设为100 Hz左右。在实际设计中，由于实验器材的限制，选用10 uF的CBB电容和两个4 mH的电感，根据公式计算出截止频率大约为550 Hz。全桥逆变电路如图3所示。 图3. 全桥逆变电路图  由于单片机产生的PWM信号电流较小，不具备驱动功率开关管的能力，故额外加入驱动电路才能开启MOSFET的栅极电压 [ 5 ]。 采用IR2103驱动双向DC-DC电路，该芯片是一个半桥式MOSFET栅极驱动器，通过自举电容和二极管提供充电电压，同时该芯片具有固定的死区时间，避免了上下管同时导通导致短路 [ 6 ]。IR2103的Ho的输出信号是Hin、Lin两者相与的结果，Lo的输出信号是Hin、Lin两者或非的结果，因此将Hin和Lin相连并接入单片机的PWM信号，则输出信号Ho与PWM信号相同，输出信号Lo与PWM信号互补。 采用IR2110驱动全桥逆变电路，驱动原理与IR2103大致相同，采用自举电路和电平转换技术，使逻辑电路对功率器件的控制要求降低，每对MOSFET(上下管)可以共用一片IR2110 [ 7 ]。其输出信号Ho与输入信号Hin相同，输出信号Lo与输入信号Lin相同。即单片机给Hin和Lin一对互补波形，输出Ho与Lo也是一对互补波形。IR2110驱动电路如图4所示。 图4. IR2110驱动电路图  本系统需要做到闭环控制，及时采集输出电压到单片机调整PWM波占空比进而稳定输出，由于本 图5. AD637采样电路图 系统所用单片机只能采集直流电压，因此需要设计采样电路采集交流输出电压的有效值。输出交流电压经过电压互感器隔离降压后 [ 8 ]，再经过AD637芯片计算其有效值，最后通过单片机的A/D采样口采集。AD637是一块高精度单片TRMS/DC转换器，可计算正弦波的真有效值。在使用前进行偏移微调和比例因子微调，可以降低输出误差。同时在AD637前级加上放大电路，后级加上缓冲电路，降低前后级电路对采样的影响。采样电路如图5所示。"
"本设计采用STM32单片机作为不间断开关电源UPS的核心主控模块。STM32F103ZET6外设丰富，包含了112个的快速I/O端口、11个定时器、12位的A/D转换器和12位的D/A转换器，相比于其他单片机而言，它有低能耗、主频高、操作简单、调试方便、稳定性高等优点 [ 9 ]。STM32单片机能通过自带的定时器PWM波，并可以通过定时器的调整转变为SPWM波，将AD采样的值和设定的值相比较，通过调整前级PWM波的占空比对UPS电源进行闭环控制。 单相不间断式UPS电源的软件设计采用Keil5作为开发平台，本系统中的可调输出开关电源采用PWM方式进行调节 [ 10 ]，选用双极性SPWM正弦脉宽调制，运用面积等效原理调制正弦波，输出的SPWM波的基波就是调制需要输出的波形，且不含低次谐波。定时器8作为STM32单片机中的高级定时器，能够产生双向互补PWM波，拥有死区调节功能，然后用另一个定时器通过查表控制输出占空比的方式得到双极性调制的SPWM波，利用定时器4的中断对SPWM波进行频率和调制度的控制，最终得到互补SPWM波。定时器3产生PWM波，控制双向DC-DC电路的升压，通过改变定时器2的中断频率实现对ADC采样频率的控制。 采集输出电压时，利用滑动平均算法对采集的输出电压进行滤波。本设计采用双向DC-DC作为升压电路，通过固定SPWM波调制比，改变PWM波占空比的方式控制双向DC-DC电路的升压进而稳定UPS电源的输出。当输入电压由交流切换为直流时，通过对输入电压进行AD采样，STM32单片机接收到直流信号指令后，单片机端口输出高电平控制继电器导通，交流电压供电切换为直流电压供电 [ 11 ]。 PID控制是设计控制器时最常用、最经典的控制方式，在电气与自控领域有非常广泛的应用 [ 12 ]。本文使用的方法是增量型PID算法，当采样值大于系统设定的基准值时 [ 13 ]，增大PWM波输出的占空比，当采样值小于系统设定的基准值时，减小PWM波输出的占空比。增量型PID仅与最近三次的采样值有关，没有积分误差，在电压调节上较位置型更快且调节后所得的结果受前期误差影响小，提高了电压调节效率和精准度。系统软件控制流程图如图6所示。"
"进行交流电输入测试，输入29 V~43 V交流电，负载为500 Ω的可变功率电阻，使用功率分析仪测试输出的电压电流以及THD。由于系统在根据采样反馈实时调整输出电压，输出电压一直在波动，故下表记录的数据中，均取得波动范围内的平均值。 1) 输入交流电36 V，测试输出交流电流为1 A时，输出交流电压为29.988 V，频率f = 50 Hz，输出的正弦交流电失真度THD = 1.5%。 2) 输入正弦交流电为36 V，改变负载电阻，使输出电流从0.1 A~1 A变化，测试输出电压，测试结果如表1所示。 根据负载调整率计算公式： S I = | U o ( 0.1 A ) − U o ( 1 A ) | 30 #(2) 图6. 系统软件控制流程图 Table 1 交流输入电压/V 负载电流/A 电源输出电压/V 36 0.1 29.951 36 0.3 29.991 36 0.5 29.960 36 0.7 30.013 36 0.9 29.998 36 1.0 29.988 表1. 负载调整率测试记录 负载调整率根据测试记录表数据可得S I = 0.123%。 3) 保持负载30 Ω不变，稳定输出电流为1 A，改变交流输入电压，使电压在29 V~43 V之间变化，测试逆变输出电压，测试结果如表2所示： Table 2 交流输入电压/V 负载电流/A 电源输出电压/V 29 1 30.032 32 1 29.971 35 1 29.964 38 1 30.031 41 1 29.973 43 1 30.009 表2. 电压调整率测试记录 根据电压调整率计算公式： S U = | U o ( 43 V ) − U o ( 29 V ) | 30 #(3) 电压调整率根据测试记录表数据可得：S U = 0.077%。 4) 断开交流电，电源自动转换为直流电，同时测试输入功率和输出功率，计算输出效率，测试结果如表3所示： Table 3 直流输入电压/V 负载电流/A 电源输出电压/V 输入功率/W 输出功率/W 24 1 29.997 33.887 29.997 表3. 直流电输入测试记录 根据上表记录数据，计算输出的效率η = 88.52%。 单相不间断式UPS电源实物图如图7所示： 图7. 单相不间断式UPS电源实物图"
"本文设计了以STM32F103ZET6单片机为控制核心单相不间断式UPS电源，核心电路为全桥逆变电路。输出正弦交流电频率50 Hz，电压30 V。可由直流电和交流电同时供电，在交流电断电时，直流电能够及时供电，切换速度快，控制方法较先进。电源的负载调整率在0.5%左右，带载能力较强，电源效率在85%以上。不间断电源简称UPS，能够为负载安全可靠的提供高品质电能，被广泛运用于电能质量要求较高的用电场合 [ 14 ]。本电源可应用于医院管理系统、存储设备、数据服务器等设备，能够在市电断开时保证设备的正常运行 [ 15 ]。随着UPS电源技术逐渐成熟化 [ 16 ]，单相不间断式UPS电源也在不断地发展，未来应用将更加广泛、市场价值更高。"
