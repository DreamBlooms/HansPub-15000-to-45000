"针对LoRa低码率扩频通信，本文首先对无线通信的空间传输进行分析，分析其传输过程中传输距离的相关因素。首先分析在理想环境中，无线通信中收、发天线间距离D与发射器的发射功率、接收器的灵敏度、发射天线增益、接收天线增益、载波频率、基站发射天线的馈线插损、因环境带来的空中传播损耗的关系，从而理论分析传输距离的影响因素。分析LoRa扩频通信的基本原理，将其与FSK调制进行对比其性能特点。最终通过大量的试验测试，对传输距离、丢包率、信号质量、信噪比指标进行分析，得到实测与理论的对比结果。 关键词 :LoRa，FSK，扩频，丢包率，传输距离 Copyright © 2020 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY 4.0). http://creativecommons.org/licenses/by/4.0/"
"LoRa [ 1 ] 是一种基于扩频技术的远距离无线传输技术，其实也是诸多LPWAN通信技术中的一种，主要面向物联网 [ 2 ] (IoT)或者M2M等应用。为用户提供一种简单的能实现远距离、低功耗的无线通信手段。LoRa的优势在于长距离通信能力。单个网关或基站可以覆盖整个城市或数百平方公里范围。在一个给定的位置，距离在很大程度上取决于环境或障碍物，但LoRa有一个链路预算优于其他任何标准化的通信技术 [ 1 ]。 LoRa是物理层或无线调制用于建立长距离通信的链路。许多传统的无线系统使用频移键控(FSK)调制作为物理层 [ 3 ]，它是一种实现低功耗的非常有效的调制。LoRa是基于线性调频扩频调制，它保持了像FSK调制相同的低功耗特性，但明显地增加了通信距离。但是很多时候用户在使用过程中，与实际标称的传输距离差别很大。如理论上采用低码率传输，可以传输15 kM，但是受一些因素的影响，在工程应用中仅仅是5 KM左右。因此本文首先对无线通信的空间传输进行分析，通过链路预算在给定的环境中决定距离的主要因素。分析LoRa扩频通信的基本原理，将其与FSK调制进行对比其性能特点。最终通过大量的试验测试，对传输距离、丢包率、信号质量、信噪比指标进行分析，得到实测与理论的对比结果。"
"根据香农(C. E. Shannon)在信息论研究中总结出的信道容量公式，即香农公式： C = W ∗ log 2 ( 1 + S N ) (1) 式中：C——信息的传输速率； S——有用信号功率； W——频带宽度； N——噪声功率。 由式中可以看出： 为了提高信息的传输速率C，可以从两种途径实现，既加大带宽W或提高信噪比S/N。换句话说，当信号的传输速率C一定时，信号带宽W和信噪比S/N是可以互换的，即增加信号带宽可以降低对信噪比的要求，当带宽增加到一定程度，允许信噪比进一步降低，有用信号功率接近噪声功率甚至淹没在噪声之下也是可能的。扩频通信就是用宽带传输技术来换取信噪比上的好处，这就是扩频通信的基本思想和理论依据。 扩频通信系统由于在发送端扩展了信号频谱，在接收端解扩还原了信息，这样的系统带来的好处是大大提高了抗干扰容限。理论分析表明，各种扩频系统的抗干扰性能与信息频谱扩展后的扩频信号带宽比例有关。一般把扩频信号带宽W与信息带宽 Δ F 之比称为处理增益G P ，即： G P = W Δ F (2) 它表明了扩频系统信噪比改善的程度。除此之外，扩频系统的其他一些性能也大都与G P 有关。因此，处理增益是扩频系统的一个重要性能指标。系统的抗干扰容限M J 定义如下： M J = G P − [ ( S N ) + L S ] (3) 式中：(S/N) = 输出端的信噪比，L S = 系统损耗 由此可见，抗干扰容限M J 与扩频处理增益G P 成正比，扩频处理增益提高后，抗干扰容限大大提高，甚至信号在一定的噪声湮没下也能正常通信。通常的扩频设备总是将用户信息(待传输信息)的带宽扩展到数十倍、上百倍甚至千倍，以尽可能地提高处理增益。 频谱的扩展是用数字化方式实现的。在一个二进制码位的时段内用一组新的多位长的码型予以置换，新码型的码速率远远高出原码的码速率，由傅立叶分析可知新码型的带宽远远高出原码的带宽，从而将信号的带宽进行了扩展。这些新的码型也叫伪随机(PN)码，码位越长系统性能越高。  传输速率是系统设计中一个关键的可变因素，它将决定整个系统整体性能的很多属性。无线传输距离由接收机灵敏度和发射机输出功率共同决定，两者之间的差值我们称之为链路预算。输出功率受限于标准规范，所以只有通过提高灵敏度来增加距离，而灵敏度又受数据速率非常重要的影响。对所有的调制方式来说，越低的速率，接收机的带宽越窄，接收灵敏度就越高。在现今高性价比无线收发机中应用最广泛的调制方式是FSK或者GFSK。要进一步减小FSK系统的接收机带宽，唯一可行的办法就是提高参考晶体的精确度。虽未经检验过但可以预见，这很容易就会产生比接收机带宽更宽的频率偏差。低成本的晶体一般只有20 ppm的精度，这将限制使用载波频率为868 MHz或915 MHz系统的最大数据传输速率在20 kbps，灵敏度在−112 dBm。 扩频调制方式在其他领域应用了很多年，之前未使用于低成本的传感网络方案。在等同的数据速率条件下，商用的低成本扩频调制方式可以获得比传统FSK 调制方式高8~10 dB的灵敏度。升特(Semtech)公司将推出一款新的收发机，这款收发机集成了一种名为LoRa的扩频调制方式和传统的GFSK调制方式。 从公式(3)可知，提高接收灵敏度(即减小Pr的代数值)可以有效增加通信距离，LoRa基于此原理，具体的LoRa扩频通信原理如图1所示。 图1. LoRa扩频通信原理"
"LoRa扩频调制的示意图如上所示，用户数据的原始信号与扩展编码位流进行XOR (异或)运算，生成发送信号流，这样，提高了接收灵敏度。 以LoRa网关为例(BW = 125 kHz，FEC = 4/5)，提高SF带来的增益如下表。实例：SF12的灵敏度−142.5 dBm，相比SF7的灵敏度−130.0 dBm，提高了12.5 dB，通信距离将延长到原来的4.2倍。 接下来，我们基于“通信原理”来分析“长距离”的因素，重点是LoRa如何做到出类拔萃。尽管这会引入一点儿公式，幸运的是，只要具备“高中数字”的基础就可以理解。特别强调，此处的公式推导都是基于理想环境：在可视距离内，无电磁干扰。(专业术语称为：自由空间损耗，free space loss [ 4 ])在理想环境中，无线通信满足如下(4)公式： P t − P r + G t + G r = 20 log 4 π f d c + L c + L 0 (4) 式中，P t ——发射器的发射功率，单位dBm； P r ——接收器的灵敏度，单位dBm； G t ——发射天线增益，单位dB； G r ——接收天线增益，单位dB； f——载波频率，单位Hz； d——收、发天线间距离； c——光速(3 × 10 8 m/s)； L c ——基站发射天线的馈线插损，单位dB； L 0 ——因环境带来的空中传播损耗，单位dB。 其中，p和c都是常数，因此，公式(4)很容易转换成如下公式(5)： P t − P r + G t + G r = 20 log f + 20 log d + L c + L 0 − 147.56 ( dB ) (5) 我们的目标是d(距离)，为此，继续将公式(5)转换成公式(6)： d = 10 P t − P r + G t + G r − L c − L 0 − 20 log f + 147.56   dB 20 (6) 因此从公式可知，增加传输距离d的措施为，增大P t 、G t 、G r ，减少L c 、L 0 、f。即提高发射功率、提高发射天线增益、提高接收天线增益；降低基站馈线插损、降低空中传播损耗、降低载波频率。 如将LoRa网关模块 [ 5 ] 的发射功率P t 从13 dBm提高到19 dBm，增加6 dB，通信距离也将延长到原来的2倍。 将LoRa网关的发射天线增益G t 从3 dBi提高到9 dBi，增加了6 dB，通信距离将延长到原来的2倍。 如将LoRa网关模块的接收天线增益从1.5 dBi提高到7.5 dBi，增加了6 dB，通信距离将延长到原来的2倍。 如将射频印制板和馈线均严格按照50欧姆进行阻抗匹配(减少信号反射造成的损耗)，选用优质射频连接头，接口进行防水处理，尽可能缩短馈线的长度，选用损耗更低的馈线材料。这些措施都可以有效降低LoRa网关的馈线插损L c ，从而增加传输距离。 降低空中传播损耗(即减小L 0 的代数值)可以有效增加通信距离。如抢占“制高点”是有效的措施，即将 LoRa网关尽可能架设在楼顶或铁塔上，天线要与地面垂直，周围无遮挡为最佳。保证视距通信是有效措施，即调整LoRa网关模块天线位置，尽可以减少它与网关之间的障碍物。 降低载波频率(即减小f的代数值)可以有效增加通信距离。"
"为此，我们挑选了尽可能空旷的地区——跨武汉汉江，沿三环线进行测试，如图2所示。该地区没有太多高层建筑，是一个较理想的环境。 图2. LoRa终端与LoRawan网关的多点距离测量布置图 此次通信设备采用锐米通信设备的LoRa终端模块、LoRaWAN模块 [ 6 ] 进行相关的测试。采用的LoRa网关和Lora模块，其中带宽(BW) = 125 kHz；扩频因子(SF) = 12，纠错率(EC) = 4/6，运行频率486.3~487.7 MHz，其中LoRaWan网关的发射功率为23 dBm，LoRa终端的发射功率为20 dBm，其中LoRaWan网关的接收灵敏度为−140 dBm，LoRa终端的接收灵敏度为−137 dBm。 信噪比，为有用信号功率与噪声功率的比值。因此为幅度比的平方： SNR = P signal P noise = ( A signal A noise ) 2 (7) 单位一般采用分贝表示， SNR ( dB ) = 10 lg P signal P noise = 20 lg ( A signal A noise ) 2 (8) 其中， P signal 为信号功率(Power of signal) P noise 为噪声功率(Power of Noise) A signal 为信号幅度(Amplitude of signal) A noise 为噪声幅度(Amplitude of Noise) RSSI：Received Signal Strength Indication接收的信号强度指示，无线发送层的可选部分，用来判定链接质量，以及是否增大广播发送强度。 因为无线信号多为mW级别 [ 7 ]，所以对它进行了极化，转化为dBm而已，不表示信号是负的。1 mW就是0 dBm，小于1 mW就是负数的dBm数。接收的信号强度指示：RSSI只是信号强度的一个指示值。RSSI的值对应的单位是dBm。dbm (Decibel-milliwatts)：分贝毫瓦，表示某一功率与1 mW的相对关系，数值x (dBm)与功率P (mW)的具体计算公式如下， x ( dBm ) = 10 lg P ( mW ) 1 ( mW ) (9) 可以看出0.5毫瓦约为−3 dBm。所以RSSI并不是功率，dB是分贝，实际上常常用来表示信噪比的单位。上面的dBm是一个带用量纲(毫瓦)的两个功率的比值的表示方法。 其中图3~9是分别在1.4 km、3.0 km、4.2 km、4.8 km、5.2 km、5.7 km、6.0 km的LoRa终端设备和LoRaWAN在不同距离下的信噪比SNR和信号强度rssi，表1和表2分别为对应的测量平均值，从曲线上基本可以看出，不论是信噪比还是信号强度跟LoRa终端 [ 8 ] 基本上与距离有关，随着距离增大，其信噪比SNR减小，信号强度rssi也是减小。 图3. 1.4 Km点LoRa测试信噪比SNR和信号强度rssi 图4. 3.0 Km点LoRa测试信噪比SNR和信号强度rssi 图5. 4.2 Km点LoRa测试信噪比SNR和信号强度rssi 图6. 4.8 Km点LoRa测试信噪比SNR和信号强度rssi 图7. 5.2 Km点LoRa测试信噪比SNR和信号强度rssi 图8. 5.7 Km点LoRa测试信噪比SNR和信号强度rssi 图9. 6.0 Km点LoRa测试信噪比SNR和信号强度rssi Table 1 信噪比测量平均值SNR (单位dB) 1.4 km (dB) 3.0 km (dB) 4.2 km (dB) 4.8 km (dB) 5.2 km (dB) 5.7 km (dB) 6.0 km (dB) 终端节点LUD_Rx 7.4 0 0.4 7 6.4 −7.6 −9.4 网关设备LGW_Rx 3.6 −4.9 −7.7 −14.5 −17.2 −11.5 −9.3 表1. 信噪比测量平均值SNR Table 2 信噪比测量平均值SNR (单位dB) 1.4 km (dB) 3.0 km (dB) 4.2 km (dB) 4.8 km (dB) 5.2 km (dB) 5.7 km (dB) 6.0 km (dB) 终端节点LUD_Rx −2 −7.3 −9.6 −6.6 −6.3 −13.7 −13.2 网关设备LGW_Rx −124 −117 −124 −128 −130.2 −111.3 −131.3 表2. 信号强度测量平均值RSSI Table 3 信噪比测量平均值SNR (单位dB) 1.4 km (dB) 3.0 km (dB) 4.2 km (dB) 4.8 km (dB) 5.2 km (dB) 5.7 km (dB) 6.0 km (dB) 终端节点LUD_Rx 0 0 0 1.7 8.3 17.2 26.1 网关设备LGW_Rx 0 0 0 1.7 8.3 17.2 26.1 表3. 丢包率测量LOS 相比其他无线通信技术，LoRa最大的优势是长距离通信，因此，本次长距离距测试最远按照6公里进行。试验测试过程中LoRa在小于4.2 km的时候信号质量较好，根据表3的丢包率测量LOS，并且可知其丢包率基本为0，可以较好的完成通信。当通信大于4.5 km 在“4.8 km，天鸣工业园”处测试时发现：仅当LoRa终端天线调整到“90度”时，它才能与网关良好通信；其他3个角度(0，180，270)不理想。因此远距离通信过程中天线的角度也影响到通信的距离。 在5.7 km处测试时发现：部署在16层楼顶的1号LoRaWAN网管无法与LoRa终端进行通信，反而，部署在11层阳台的2号LoRaWAN能与LoRa终端通信，但是通信过程中丢包率较高，因此网关的位置不是越高越好，而是与环境、遮挡、干扰等因素密切相关，需要进行实地测试。 表1~3试验数据测试过程中，在5.2 km和5.7 km测试过程中，虽然5.2 km的信号强度rssi为−130.2 dBm，而5.7 km的信号强度−111.3 dBm，但是两者的数据丢包率却与之成相反的关系，5.2 km的丢包率是8.3%，而5.7 km的丢包率17.2%。因此表现上看5.7 km处的信号比5.2 km信号质量好，但是实际情况是前者丢包率明显低于后者。而用户在使用过程中，更关注的还是减少丢包率，信号质量仅仅是参考。"
"本文在分析理想环境中，无线通信中收、发天线间距离D与发射器的发射功率、接收器的灵敏度、发射天线增益、接收天线增益、载波频率、基站发射天线的馈线插损、因环境带来的空中传播损耗的关系，从而理论分析传输距离的影响因素。最终通过大量的试验测试，对传输距离、丢包率、信号质量、信噪比指标进行分析，特别是随着通信距离的增加，实际应用过程中因为环境、遮挡、干扰、天线角度等因素的影响，与实际理论距离差距较大，信号质量也不是反应通信质量的重要依据，最终还是要通过实际测试测量其丢包率。"
