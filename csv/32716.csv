"铸体薄片是分析孔喉结构最常用也最直接的方法，但目前多采用描述或半定量方法。为精细评价孔喉结构等特征，实现高效可靠的岩石分类，提出了基于Otsu方法与决策树自动拾取多个阈值和采用人工经验与计算机结合拾取目标像素域两种方法，分割铸体薄片图像提取不同岩石组分。采用吐哈盆地红台构造带的10幅铸体薄片图像对两种方法进行测试，并对比了从分割后的铸体薄片图像中所提取面孔率和铸体薄片实验提供数据。结果表明：两种方法可以有效区分铸体薄片中的不同组分，基于Otsu方法与决策树自动拾取多个阈值的方法可以高效的分割铸体薄片图像组分，但无法自动区分目标；采用人工经验与计算机结合的方法，在半自动化分割图像的基础上可自动提取目标，对目标定量化评价。 关键词 :数字图像处理，铸体薄片，Otsu方法，图像分割，定量分析 Copyright © 2019 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"低孔低渗储集层岩石的非均质性导致同一储集层段不同部位的产液性能产生较大的差异 [ 1 ] [ 2 ] [ 3 ] [ 4 ] [ 5 ]，即便对于孔隙度基本相同的储集层其渗透率差别仍很大。孔喉结构分布是影响储集层储集与渗流性能最主要的影响因素 [ 6 ]。为对孔隙结构进行有效分析，发展出了许多微观孔隙结构研究方法：光学和电子显微镜、铸体薄片分析、CT技术、氮气吸附法、细微成像技术、高压压汞法等 [ 6 ] [ 7 ]。 岩石薄片是分析孔喉结构常用方法之一，需要专业技术人士去判读，在实际工作中，同样的样品，因不同的人、环境等都可能得出不同的判定结果，从而直接导致有误差甚至错误的目测结果，即人为因素影响到鉴定人员对储层孔隙的观察 [ 8 ]，且耗时费力。为此，许多学者对薄片图像展开研究。程国建等 [ 9 ] [ 10 ] 采用图像分割结合神经网络实现孔隙自动识别，刘烨等 [ 11 ] 结合原始图像及其形态学梯度通过支持向量机方法构建特征空间与岩石图像类别的映射关系。SINGH等 [ 12 ] 利用岩石薄片图像提取27个参数。MARMO等 [ 13 ] 利用图像处理和神经网络识别碳酸盐岩纹理。GHIASI-FREEZ等 [ 14 ] 构建半自动化模型实现孔隙类别划分。MŁYNARCZUK等 [ 15 ] 结合数学形态学处理岩石图像实现岩石分类。然而目前的图像处理方法多存在原理复杂、算法求解速度慢的不足，在实际工作中使用不便。Otsu算法为解决这一问题提出了思路 [ 16 ]，该算法被认为是图像分割处理中阈值自动选取的最优方法 [ 17 ]，但不足的是经典的Otsu算法只能计算单阈值，区别单个目标和背景，笔者在Otsu算法的基础上提出了一种多阈值拾取的方法，该方法原理简单、求解速度快，可满足工作需求。同时为满足专业技术人员的需求，另提出一种人工经验与计算机结合的图像分割方法 [ 18 ]，应用效果较好。"
"铸体薄片是分析孔喉结构最常用也最直接的方法，在孔隙识别和求取、储层评价等方面具有直观、可视的技术优势。它能清晰地显示储层空间的微观结构特点及孔喉在储集层中的存在方式，揭示储层中油气分布与孔隙结构、构造之间的关系，为准确识别油气层提供可靠依据 [ 19 ]。 铸体薄片的原理是将染色(红色或蓝色)环氧树脂注入到被洗油和抽空的岩样孔隙内，待树脂凝固后，再将岩心切片(按需要的方位，定向或不定向)、制片放在显微镜下观察。铸体薄片中带色的树脂部分即代表岩石二维空间的孔隙结构状态。利用铸体薄片中孔喉被染色，孔喉与骨架在色彩空间距离差异较大的原理，结合图像分割技术可以有效地区分铸体薄片组分、分析孔喉特征。同时假设该图像共有像素N个，其中被染色区域像素个数为M个，P为面孔率，则由面孔率的定义可知 [ 20 ]： P = M / N (1) 式(1)中：P为面孔率，小数；M为图像被染色区域像素个数；N为图像像素总数。"
"Otsu法又称大津法或最大类间方差法。它是一种基于灰度直方图用最小二乘法原理推导出来的、具有统计意义上的最佳分割阈值的方法。基本原理为以最佳阈值将灰度直方图分割为目标和背景，使其类间方差最大，以达到最佳分割灰度图像的目的。 设X是一幅具有L灰度级的图像，其中第i级像素为N i 个，则： N = ∑ i = 0 L − 1 N i (2) P i = N i N (3) 式(2)、(3)中：N为图像像素总数；N i 为第i级像素个数；P i 为第i级像素出现概率，小数。 选定一个阈值k将所有的像素分为C 0 、C 1 两类。其中C 0 类的像素灰度级为0~k，C 1 类的像素灰度级为k + 1~L − 1。则图像总平均灰度级及C 0 、C 1 的平均灰度级为 [ 21 ]： μ T = ∑ i = 0 L − 1 i P i (4) μ 0 ( k ) = ∑ i = 0 k i P i (5) μ 1 ( k ) = ∑ i = k + 1 L − 1 i P i = μ T − μ 0 ( k ) (6) 式(4)、(5)、(6)中：i为像素灰度级；μ T 为图像总平均灰度级；μ 0 为C 0 类的平均灰度级；μ 1 为C 1 类的平均灰度级。 两部分图像所占面积比例分别为： ω 0 = ∑ i = 0 k P i (7) ω 1 = ∑ i = k + 1 L − 1 P i = 1 − ω 0 (8) 式(7)、(8)中：ω 0 为C 0 类图像所占比例，小数；ω 1 为C 1 类图像所占比例，小数。 令k从1~L − 2变化，使其类间方差 σ k 2 最大的k值即寻找的最佳阈值 [ 16 ]： σ k 2 = ω 0 ( μ 0 − μ T ) 2 + ω 1 ( μ 1 − μ T ) 2 (9) 式(9)中： σ k 2 为阈值为k下的类间方差。"
"Otsu方法可以有效将图像分割为两类，但实际图像常常存在多个目标，所以需要对图像进行多阈值分割。这里引入决策树或多级分类器的概念：决策树是模式识别中对于多类或多峰问题进行分类的有效方法，它采用分级问题使分类问题逐步得到解决 [ 22 ]。一般一个决策树由一个根节点N 1 ，一组非终止节点N i 和一些终止节点N j 组成，从而把特征空间分成若干个区域(如图1所示)。 图1. 决策树示意图 笔者采用二叉树(指除叶节点外，每个树的节点仅分为两个分支)的方式，在每个节点处利用Otsu方法确定的阈值作为每个节点的决策规则，将图像在灰度空间的像素值划分为两类。在该二叉树成型后，各节点处所取阈值即为最终图像分割所取阈值，可知阈值个数为(i + j)个，图像被分割为(i + j + 1)个部分。设分割后的图像为 C 1 , C 2 , ⋯ , C i + j + 1 ，可知对于任意两个图像 C m , C n ( m , n ∈ [ 1 , i + j + 1 ] ) 交集为空集，且 C 1 , C 2 , ⋯ , C i + j + 1 的并集为原始图像。 值得一提的是，利用此方法确定的多个阈值对于整个图像来说不一定是最优阈值，但各阈值是对应节点处Otsu准则下的最优分割阈值。  专业鉴定人员的孔喉判定经验是宝贵的，为充分利用其长期的经验，笔者借助matlab平台 [ 23 ] 采用人工经验和计算机结合的方式提取铸体薄片图像的不同组分。图像可以分割是因为各目标位于色彩空间中的不同区域，显然这些区域之间距离越大可分割性就越大。所以，对于目标与背景的色彩级有明显差别的图像，图像分割可以取得很好的效果。 铸体薄片图像中不仅因孔喉被染色而呈现出不同色彩，而且矿物骨架由于含有物、颜色、密度等不同其在图像色彩空间中也表现为不同的像素值。对于图像，同一个目标拥有相似的色彩，同时由于各目标非均匀，其在像素值表现为一个像素值区域，也就是说若能到得到各目标像素值上下限，即可实现对目标的提取。基于此，利用人工选取目标在色彩空间的特征，即像素值范围，介于该像素范围内的像素点即属于相应目标，采用像素扫描方式对图像分割、实现目标提取。"
"基于以上分析，采用图2所示流程图实现了图像分割。 图2. 图像分割实现流程图 图2所示流程可分为两条线路，其中左侧为基于Otsu方法和决策树拾取多个阈值实现图像分割的方式，右侧为人工经验与计算机结合实现图像分割的方式(为方便起见，后文统称左侧线路为方式一，右侧线路为方式二)。实现过程中，在输入图像后用户可选择实现图像分割的方式，对于方式一首先需要选择合适的灰度化方式 [ 24 ] 对图像进行预处理以提高后续处理效率(本文采用加权平均法实现灰度化)，同时在观察图像和分析实验资料基础上，确定图像中分布的几种主要岩石组分以输入阈值个数，采用4.1节所述原理对图像实现分割；对于方式二，则需要在观察图像的基础上，拾取各目标在色彩空间的特征，确定各目标像素值上下限后，采用像素扫描方式实现图像分割。  为验证两种方法的可靠性与有效性，笔者采用吐哈盆地红台构造带的10幅铸体薄片图像对两种方法进行测试，并对比了采用方式二分割后的铸体薄片图像所提取面孔率和实验提供数据。分析使用图片格式为JPG，颜色模式为RGB，使用计算机处理器为Intel(R) Core(TM) i5-7400 CPU@3.00GHz，四核，实现的基础平台为MATLAB系统。 表1给出了双阈值和双目标分割图像的耗时(其中方式二各目标输入特征为4个，人工输入时间不计入耗时)。图3给出了其中两张铸体薄片图像采用方式一的分割效果，图4给出了相同图像采用方式二分割后的铸体薄片图像，图5给出了10幅图像采用方式二分割的铸体薄片图像所提取面孔率与薄片实验数据的对比表。 Table 1 图片大小 耗时(s) otsu方法与决策树结合 人工经验与计算机结合 762*141*3 0.770996 1.590401 652*1204*3 0.587614 0.952892 768*1416*3 0.778709 1.635152 771*1419*3 0.746581 1.646929 767*1414*3 0.739085 1.603513 770*1415*3 0.743292 1.577627 769*1419*3 0.741107 1.578972 764*1419*3 0.741434 1.573107 768*1421*3 0.744957 1.577184 765*1418*3 0.732701 1.632375 表1. 10幅图像的耗时对比 由表1可知，两种方式分割铸体薄片图像的效率是极高的，同时基于Otsu方法和决策树拾取多个阈值下的分割效率优于人工经验与计算机结合的铸体薄片分割效率。 图3. 基于Otsu方法和决策树的多阈值铸体薄片分割效果 从图3可以看到，采用单阈值Otsu方法分割图像时可以将原始铸体薄片中像素差异大的目标和背景区分开来，由图3(b)~图3(d)、图3(f)~图3(h)可知将Otsu和决策树方法结合可对铸体薄片进行有效多重划分，随着阈值个数的增加，图像被分割的更加精细。不足的是，由于目标在各图像中的不一致性，且在该自动拾取阈值的过程中没有加入经验因素，使得该方法目前虽可以有效分割图像，但在分割过程中无法识别所要提取目标。 图4. 人工经验与计算机结合实现多目标图像分割效果 从图4可以看到，采用人工经验与计算机结合的方式分割图像可提取图像中感兴趣的目标(图4(b)，图4(c)，图4(e)，图4(f)中，黑色部分为铸体薄片中被染色的孔喉，图4(c)，图4(f)中，深灰色部分为铸体薄片中黑色矿物)。结果表明该方法可以有效分割图像、提取目标。同时在实现该过程中，只需拾取目标像素值(目标色彩空间的特征)，即可完成对图像的分割以及目标的提取，大大降低了对专业知识和经验的依赖程度。 图5. 分割图像提取面孔率与薄片实验数据对比 图5为分割图像提取的面孔率与薄片实验数据的对比，个别点偏移y = x较大，绝大部分点分布在y = x周围，说明此方法提取目标的结果可靠性受人为影响，但无疑这种方法是简单且可行的。"
"对于本文中提出的两种分割图像的方法，结合铸体薄片图像，得到如下结论与认识： ① 基于Otsu方法与决策树自动拾取多个阈值的方法可以高效的分割铸体薄片图像，将铸体薄片图像中岩石的不同组分区分开来，但无法自动区别目标。 ② 采用人工经验与计算机结合的方法可以半自动分割图像，提取目标分布特征，且该方法提取结果的可靠程度与经验有关，但大大降低了对经验的依赖程度并提高了工作效率。 ③ 基于Otsu方法与决策树自动拾取多个阈值和采用人工经验与计算机结合分割铸体薄片图像、分析孔喉特征的方法是可行且有效的。"
