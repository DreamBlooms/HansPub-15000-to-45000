"现代热水器总存在热水管内残留热水变冷后不便于使用而造成水资源浪费的问题。针对该问题文中提出了一种以STC89C51单片机为核心控制器，DS18B20芯片为温度感应器，五线四相步进电机为控制活塞转向的动力装置，通过单片机控制五线四相步进电机正反转(180˚)的运转，以达到控制水流分向的基于单片机的热水器用冷热分流水阀。通过Proteus进行电路的设计和仿真，仿真结果可以实现通过温度的变化来控制步进电机正反转的预期功能；实物化后，测试成功地实现预期目标。"
"随着人民生活质量的提高，热水器在生活中应用广泛，但大部分使用者每次在使用热水器时，水管内残存的冷水都会直接排出，任其流失。尤其是使用太阳能热水器的某些高层建筑的低层用户，水管从楼顶的太阳能热水器到住宅距离很长，因此每次使用完热水后水管内剩余的热水会更多，这一定程度上造成水资源的浪费 [ 1 ]。近年来有不少人提出了各种解决方案，但是大多数方案都存在成本过高、操作复杂或者效果不佳等问题，安装这些装置的成本远高于浪费的水的成本，所以大部分人宁愿浪费水也不愿安装这些装置 [ 2 ] [ 3 ] [ 4 ] [ 5 ] [ 6 ]。为解决以上问题，笔者基于单片机开发了一套可以将冷热水分离的系统，经过仿真和实物测试，系统具有低成本、易操作和高效率等特点，可实现将管道中残存的水收集再利用的预期目标，有利于普通居民逐渐参与到节水的行动中，形成节约资源的良好意识。"
"信息采集模块包括对水流信息和温度信息的采集。以水流信号作为单片机系统工作的总控制信号，当水滴感应器感应到水流后，壳外LED指示灯亮起，防水型温度感应器开始工作，检测水管内水流的温度。我们采用DS18B20数字温度传感器 [ 7 ] 对水温进行测量。DS18B20在使用时与单片机的P3.7引脚进行连接，其可测量的温度范围为−55℃~+125℃。  STC89C51是一种低功耗、高性能的微控制器 [ 8 ] [ 9 ]。其主要功能是将水流感应器和温度感应器所采集的水流信息进行处理。根据设定的温度阈值，对水温的高低做出判断，并输出相应的控制信号给ULN2003芯片，ULN2003芯片内是高压-高电流达灵顿晶体管阵列，用于驱动五线四相步进电机 [ 10 ] [ 11 ]。该芯片的1、2、3、4号引脚与单片机的P1.0、P1.1、P1.2、P1.3引脚相连，用于接收单片机的控制信号。9、13、14、15、16号引脚与步进电机相连控制步进电机的转动。信息采集模块与单片机模块的电路图如图1所示。 图1. 电路图  水流分流模块的主要功能是通过步进电机的转动改变冷水和热水的流向，来使其分流。 活塞为半球形，向一端开口，底部有一根延伸出去的轴，活塞主视图如图2所示，活塞侧视图如图3所示，活塞俯视图如图4所示。侧其底部的轴与五线四相步进电机的转轴相连，由于该电机的功率较小，所以我们直接使用ULN2003芯片来驱动电机。当步进电机转动时，带动活塞转动，根据活塞开口朝向不同，水流方向发生改变。 图2. 活塞结构主视图 图3. 活塞结构侧视图 图4. 活塞结构俯视图 整体结构示意图如图5所示，水从C端流入，当单片机判断水流温度低于预设温度时，活塞向左转动，水从A端流出；当水流温度高于预设温度时，活塞向右转动，水从B中流出。 图5. 整体结构示意图"
"首先水流感应器判断是否有水流动，并发送相应指令到单片机。若有水流动，则温度感应器开始工作并将温度信号传回到单片机，单片机接收到指令后对指令进行校验，然后判断温度是否高于设置值(50℃)。若温度高于设置值(50℃)，则单片机控制步进电机转动，从而使得活塞开口端面向水龙头，此时水龙头流出热水。否则，控制步进电机转动，活塞开口端背向水龙头，使温度低于设定值的水从另一端流出，水龙头不流水，程序框图如图6所示。 图6. 程序框图"
"软硬件系统搭建完成后，我们对该水阀进行了基础的功能测试与分析。 测试环境搭建： 1) 将我们的水阀竖直放置； 2) 在水阀入水口处放置一个温度计； 3) 在出水口右端添加一个可以控制开闭的活塞。 测试步骤： 1) 温度稳定至室温后，分次加入低于50摄氏的不同温度的水，并记录下水的温度，分别记录下关闭右端活塞后中间活塞是否转动。若转动，记录下其转动的角度，若无转动则无需记录转动角度，实验结果如表1所示。 Table 1加入水的温度 右端活塞关闭时中间活塞 是否转动 右端活塞开启时中间活塞 是否转动 活塞转动角度 0℃ 否 是 顺时针180˚ 5℃ 否 是 顺时针180˚ 10℃ 否 是 顺时针180˚ 15℃ 否 是 顺时针180˚ 20℃ 否 是 顺时针180˚ 25℃ 否 是 顺时针180˚ 30℃ 否 是 顺时针180˚ 35℃ 否 是 顺时针180˚ 40℃ 否 是 顺时针180˚ 45℃ 否 是 顺时针180˚ 表1. 实验1测量结果 2) 待恢复至室温后，分次加入高于50摄氏的不同温度的水，并记录下水的温度， 分别记录下关闭右端活塞后中间活塞是否转动。若转动，记录下其转动的角度，若无转动则无需记录转动角度，实验结果如表2所示。 Table 2加入水的温度 右端活塞关闭时中间活塞是否转动 右端活塞开启时中间活塞是否转动 60℃ 否 否 65℃ 否 否 70℃ 否 否 75℃ 否 否 80℃ 否 否 85℃ 否 否 90℃ 否 否 95℃ 否 否 表2. 实验2测量结果 注意：由于水的温度并不容易加热至100℃，所以我门仅采用0~95摄氏度的水来进行实验。 3) 待恢复至室温后，先加入0℃的水，当活塞转动后继续注入0℃的水让其保持若干秒，然后再注入95摄氏度的水，观察活塞转动情况。若活塞转动，记录活塞转动时的温度，并重复该实验10次，实验结果如表3所示。 Table 3活塞转动次数 中间活塞第一次转动的温度 第一次转动度数 第二次活塞转动时的温度 第二次转动度数 2 0.6 正时针180˚ 50.6 逆时针180˚ 2 0.5 正时针180˚ 50.3 逆时针180˚ 2 0.4 正时针180˚ 50.4 逆时针180˚ 2 0.3 正时针180˚ 50.3 逆时针180˚ 2 0.5 正时针180˚ 50.5 逆时针180˚ 2 0.4 正时针180˚ 50.4 逆时针180˚ 2 0.3 正时针180˚ 50.6 逆时针180˚ 2 0.5 正时针180˚ 50.3 逆时针180˚ 2 0.5 正时针180˚ 50.5 逆时针180˚ 2 0.6 正时针180˚ 50.3 逆时针180˚ 表3. 实验3测量结果 注意：由于正常情况下，热水管内的水都只会从冷水逐渐升温至热水(在这里为从低于50摄氏度变为高于50摄氏度)，所以我们实验三只考虑水温从低于50摄氏度上升为高于50摄氏度的情况。 结果分析：由实验1和实验2可知，当右端活塞未打开时，无论加入的水的温度是多少摄氏度，中间活塞均不旋转。只有当右端活塞打开而且注入水的温度低于50摄氏度时，活塞会产生第一次旋转。由实验3可知，只有当活塞产生了第一次旋转后，活塞在接触的水温高于50摄氏度之后才会产生第二次旋转，而且不管活塞旋转几次，每次旋转角度都为180˚。值得注意的是，我们在单片机内设置的温度值为50℃但是，我们在实验3中，活塞转动时的温度均大于50℃，主要原因是我们系统温度感应器从接受温度发送给单片机后，单片机根据接收到的温度做出相应指令有一定的延时，而水的温度上升的比较快，所以造成了一定的误差，但是误差相对较小，并不影响系统正常运作。"
"本文提出了一种基于STC89C51单片机的热水器用冷热分流水阀。在单片机系统控制下，水流传感器以及温度感应器以及步进电机精确地对是否有水流感应、温度是否跨越阀值做出相应的反应，实现了低成本、高效地解决热水器内残余冷水遗留的问题，有良好的市场前景。"
