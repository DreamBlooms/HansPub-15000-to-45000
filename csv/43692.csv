"煤炭中的含水量是个十分重要的指标，直接影响产品工艺和质量。因此设计一款含水量检测系统，根据测量物质不同，可以选择不同的模式，实现一键测量，并且可以通过人机交互界面实时绘制温度曲线，测量结束后可以通过热敏打印机将结果打印出来，方便科研人员记录实验结果。设计解决了恒流源易受温度干扰问题、PT100温度转换非线性等问题。该含水量检测系统加热部分是一个电阻炉，针对加热炉的滞后性和时变性，提出了一种新型控制方案，可在电阻炉数学模型不确定的情况下，通过被控温度的偏差和偏差的变化率的大小，选择不同的控制规则，使炉温快速达到设定温度。"
"在冶金制造、食品加工、矿业开采、地质化工、石油化工等诸多行业的质量检验或科研教学中，水分含量的测定都十分重要 [ 1 ] [ 2 ]。对于煤炭行业，煤的含水量如果过高，就会严重影响煤的质量和用途，对其贸易价格、运输方式、二次加工利用等都有很大的影响，所以水分的测定十分重要。但是，目前国内的含水量检测系统大多还处于国际下等水平，还存在自动化控制程度低、温度动态控制精度差、显示界面不友好、功能单一等问题。本文根据工程实际出发，设计了一款基于嵌入式的煤炭含水量检测系统，解决了测定仪工作时由单向升温大时滞和时变等造成的温度控制精度差的问题。针对系统的传递函数不确定的问题，系统运用了模糊控制理论，控制器经过模糊推理根据控制系统的实际响应情况，对系统的PID参数在线进行整定，可以加快系统的响应，增加系统的稳定性，而且超调量小，符合实际生产 [ 3 ] [ 4 ]。本系统还设计了友好的人机交互界面，可以通过上位机界面直接设置煤炭含水量检测系统的设定温度、PID参数、电机开关等参数，定时绘制当前温度曲线并显示，并能实时监测控制量。"
"煤炭含水量检测系统的控制系统结构如图1所示，本系统以电阻炉为主要控制对象，由PT100铂电阻测量被控对象的温度，由温度变换引起PT100阻值变化，将其两端电压通过调理、放大，送至16位积分型AD转换芯片，AD芯片通过内置增益放大器，将信号放大，再通过内置的滤波器滤掉工频的干扰，最后将采集回来的电压转换成对应的数字信号送入单片机主控制器，单片机根据AD芯片的特性，将输入的数字信号转换成电压信号进行线性修正，再转换成温度得到与设定值之间的偏差，单片机计算出相应的控制量，由DA运放转换成4~20 mA电流信号控制可控硅的导通角 [ 5 ]，从而控制电流，进而控制煤炭含水量检测系统的温度。单片机通过串口和485通信协议与外接设备通信，包括上位机、触摸屏、热敏打印机、电子称等设备。上位机软件能够随时在线修改参数，包括设定温度、PID参数、电机开关等，并且能根据下位机定时发送的数据，绘制出最新温度值和时间的曲线。 图1. 煤炭含水量检测系统控制系统原理图"
"煤炭含水量检测系统硬件系统主要由单片机最小系统、温度采集转换系统、温度控制系统、电源管理系统和人机交互系统五部分组成。模块化设计思路，由上至下层层设计，这种设计方法容易在设计初期发现问题并及时解决。  煤炭含水量检测系统内部的单片机、LM137、A/D、D/A、max232、SN75176均为5 V供电，热敏打印机、电子称、迪文工业触摸屏为15 V供电，而lm358运算放大器则需要24 V供电，多种类的供电需求给设计带来难度 [ 6 ]。根据实际情况出发为了减小设计的复杂性同时降低成本，系统采用双电源供电5 V、12 V输入。为了使系统能正常的工作，需要将电压升到24 V，考虑到升压的效率，系统选用了DCDC升压芯片LM2577，输入电压范围3.5~40 V输出最大电流3 A，转换效率达到70%以上，符合设计要求。在电源设计时需要注意，由于煤炭含水量检测系统的内部有精密微弱信号采集系统，所以电源的纹波的大小对信号能否正确采集有很大影响，为了减小纹波，在电源的输入端加上一个100 uF和100 nF的电容进行滤波，大电容相当蓄水池的作用，当瞬间电流过大可以补充电能，防止电压被拉下，小电容能滤掉电源里面的高次谐波，使电源更纯净。系统双电源地采取0欧电阻单点接地的方法，来减少“公共地阻抗耦合”和“低频地环路”。  温度传感器采用的是PT100热电阻传感器，Pt100是电阻式温度传感器，PT100的阻值随温度的变化而变化，所以测温的本质就是测量PT100的电阻，根据欧姆定律，设计引入一个恒流源通过PT100，再测量PT100两端的电压变化 [ 7 ]，这样通过计算便可得出当前温度值。电流通过导体会发热，电流如果过大PT100会发热影响测量精度，所以最后权衡测量电压的动态范围和发热影响，折中后选择400 uA恒流源。在设计恒流源时，设置参数的电阻直接影响输出电流精度，所以R1和R4都是用的千分之一精度的电阻，在串联多线圈精密电位器调整，使输出的电流更精确、更稳定。恒流源采用的是TI公司的LM137，采用零温度系数电流源方案如图2所示。 AD转换采用的是ADI公司的AD7705。它是完整16位、低成本、Σ-Δ型ADC，4个AD采集通道，可以接成两个全差分模拟输入通道，适合低速、高精度模数转换。AD7705正常工作需要外接12.4576M晶振及参考电压，根据以上特性，LM134输出的400 uA恒定电流通过一个6.25 K的精密电阻，将AD7705的参考电压输入引脚接在电阻两端，电流流过6.25 K的千分之一精度的电阻会产生一个2.5 V的差分电压，给AD7705提供一个参考电压，然后电流流经PT100再流经适配电阻R2汇入地线。这样通过一个恒流源将温度传感器和AD采集联系到了一起。为了消除外接干扰使测量更准确，在PT100上并联一个1 uF的电容，两个对地的10 uF电容。适配电阻R2的作用是将PT100两端的电位抬高，具有动态特性，这样才能和R5参考电阻配合使用。消除温漂和干扰。设计图如图3。 图2. 400 uA恒流源设计电路  煤炭含水量检测系统最终输出为4~20 mA的标准电流控制信号，然而单片机的输出只有电压信号。因此需要设计1~5 V到4~20 mA对应的转换电路，首先设计单片机输出1~5 V模拟信号，有两种设计方案。一种是由单片输出PWM占空比可调的方波，另一种是外接DA转换芯片直接输出电压信号。如果用单片机内部的PWM输出，虽然可以输出占空比可调，但是根据数据手册可知，STC15W4K32S4内部集成的是8位PWM输出，控温的范围是100~300度可调，那么8位的PWM相对于系统温度范围来说分辨率太低，很难调节达到稳定状态，因此选用第二种方案。AD5320是ADI公司推出的一款单电源供电、12位轨对轨满幅电压输出、低功耗数模转换芯片。AD5320的基准电压源取自供电电源输入端，能够提供最宽的动态输出范围。三线制SPI串行通信接口，与标准的SPI通信协议兼容，30M的时钟频率提供高速转换。该器件内部集成上电复位电路，保证上电D/A转换器的输出稳定在0V，符合本系统的设计要求，因此选用此设计方案。  煤炭含水量检测系统给矿石加热时，为了让炉内温度更均匀所以在炉膛内加了一个风扇，风扇是220 V单相交流电动机，通过继电器控制电机的旋转，当要测量温度时将风扇停止。另外加热炉的底部安放控制电路，温度过高会影响测量精度，所以在炉子下部装有4个风扇，系统根据控制电路温度控制风扇转动排热。由于单片的IO口输出电流能力有限，所以通过光耦隔离驱动达林顿管ULN2003来间接控制大功率风扇的状态。由于继电器吸合瞬间会产生大的电磁干扰，断开瞬间也可能会产生很大的反向电流，所以将单片机的控制IO通过光耦与ULN2003隔离开，每个继电器都并联一个反向二极管，以消除反向电流。 图3. 数模转换及消除温漂电路"
"上位机软件是基于LabVIEW2012设计的，在实际调试中，由于要频繁的更改算法参数，每次修改都要重新下载程序，很不方便。所以上位机软件要实现在线修改参数功能，并且能实时绘制出温度给定和时间的曲线 [ 8 ]。根据这些需求开始搭建软件调试平台。  系统要通过上位机直接设置煤炭含水量检测系统的设定温度、PID参数、电机开关等参数，因此人机交互界面的设计必须满足实用美观、操作简单等需求，上位机显示屏可以显示和绘制当前温度及曲线，并能实时监测控制量，上位机和下位机的通信方式是串口通信，由于要传输大量的数据，所以在串口通信的基础上，再加上定长的通信协议，下位机定时2 s更新向上位机发送一次数据，更新温度及控制量，上位机将更新的数据绘制成曲线，调试人员根据设定一个温度，即相当于对系统给定一个冲击，通过观测响应曲线，可以判断出系统状态，然后调整参数。  煤炭含水量检测系统控制单元要完成实验参数及模式设定、数据采集、数据处理、数据显示等功能。除了上文所述的必要硬件组件，还要有一个“大脑”——软件算法。煤炭含水量检测系统主程序结构图如图4所示，上电首先进行初始化，然后判断温度设定键是否被按下，根据设定情况决定是否进入工作状态，当完成温度设定后按下运行键使系统进入检测状态。 图4. 主程序结构图"
"系统的功能调试。此阶段是检验系统功能，发现潜在问题的重要阶段，直接决定系统最后表现出的性能，因此调试不仅需要大量的时间，而且还需要科学的方法进行调试。为了得到准确真实的数据，尽量保证测试时的基础条件是相同的，比如室内温度、炉内温度、设定温度、风扇的状态等，都要保持一致。 首先在炉内空载时进行控制恒温调试。由于四季温度变化幅度比较大，所以要实现控制炉内温度恒定为平均温度值25度。煤炭含水量检测系统中加热的电阻炉，一般都属于一阶对象和纯滞后的一阶对象 [ 9 ]，因此被控对象的传递函数可表示为： G ( s ) = K f 1 + T S e − τ s (1) 其中：K f ——被控对象的放大系数，T——被控对象的时间常数， τ ——纯滞后时间。 先假设被控对象为 G ( s ) = 1 1 + 100 s e − 20 s ，采样周期2.5 s。根据经验设置一组PID控制参数，让系统 自己控制加热，系统响应曲线如图5所示。 图5. 系统响应曲线 当空载调试稳定后，开始带上负载调试。被加热负载选用500 g的小煤块加入50 g的水，如图6所示。当加上实验负载后，由于系统的传递函数发生了变化，之前的得到的PID控制参数发生了变化，经过了大量的实验调试修改参数，得到响应曲线如图7所示。 图6. 实验用煤块 图7. 符合要求系统响应曲线 从图7可以很明显地看出系统有着良好的稳定性，和抗干扰能力。通过几个月的时间进行大量验证调试，证实了煤炭含水量检测系统能很好的满足工程实际中对煤炭中含水量恒温检测的需要。系统能快速稳定的达到期望值，并且在期望值附近的振幅很小，满足工程实际需要。"
"基于嵌入式的煤炭含水量检测系统相比于传统的水分测定设备，功能更加强大，测量精度更加准确，经过理论分析论证，本系统不仅能够用于煤炭中含水量的测量，还支持多种类矿石中含水量测量，如铁、铜、铝等矿石中水含量的测量，并且有两种测量模式——恒重法和恒时法。系统还具有较强的自适应能力和鲁棒性，能够适应多干扰、变参数和非线性控制过程的要求。本系统具有适用性强、精度高、稳定性高等特点，可广泛应用于各类矿石中含水量的测量。"
