"运载工具、大型机械设备的增多对企业的管理提出了挑战，需加强对生产过程中车辆实时监控管理。设计了一种针对大型运输车辆的实时监控系统，并根据系统需要设计了高精度电容式油位传感器，解决车辆熄火状态下的防盗油问题，系统采用STM32作为主控芯片，集信号采集、数据分析、信号处理、GPRS网络通讯一体，具有车辆状态实时监测、无线通信、智能调度等功能。 关键词 :电容式油位传感器，STM32，GPRS，实时监控系统"
"随着现代物流、矿山等行业的发展迅速，各种运载工具、大型机械设备越来越多，经常发生不按规定变更路线、超速、盗油等现象，严重威胁了企业的经济利益 [ 1 ] 。但这些车辆一般处于移动状态或偏远矿区，特别是车辆熄火后现有监控设备都将失去作用，目前市场上尚未存在有效防范方法。本论文设计一套带有燃油实时检测、GPS定位和GPRS无线传输功能的车载监控系统，能够实时掌握车辆位置、是否存在异常状况，从而提高运输效益。"
"系统由车载终端设备、GPRS网络以及控制中心组成，整体框图如图1所示。车载终端采集监测数据，将数据打包通过GPRS以TCP/IP协议发送到服务器 [ 2 ] 。服务器是一台具有公网固定IP地址的计算机，可将车载终端发来的数据包进行解析与储存。客户端是因特网上的一个数据终端，通过网络访问服务器获取数据，采用C/S结构，支持多台终端同时查看监控信息 [ 3 ] 。监控终端集各功能模块一体，系统实现油耗管理、GPS定位管理、驾驶员操作监控，满足现代企业的管理需求。 系统的工作原理为：油位传感器将采集的油位数据转换成电压信号，在监控终端经AD转换后实时采样，并对数据进行滤波、分析和处理，判断油箱内燃油状态(正常消耗、加油或盗油)。同时，采集GPS位置信息，最后通过GPRS无线通信网络将相关数据发送至服务器，存入数据库。"
"汽柴油是易燃易爆物体，需要无接触采样。电容式传感器可将非电量的变化转换为电容量变化。将传感部分设计为同轴的圆柱，燃油的高度变化将引起传感器壳体和感应电极之间电容量的变化 [ 4 ] 。设计的电容传感器采用差动脉冲宽度调制法测量电容，图2为电路原理图，图中C 1 为被测电容传感器，C 2 可调参考电容。A 1 、A 2 是两个比较器，Ur为参考电压 [ 5 ] 。 图中 与 ， 与 组成两个震荡电路，所产的频率分别为： 、 。将这两列信号。将 经过低通滤波后，就得到直流电压 为： 其中 、 为A和B两点的直流分量； 、 为电容 和 的充电时间， 、 图1. 系统整体框图 图2. 差动脉冲宽度调制电路原理图 ， 为触发器的输出的高电位， 为触发器的参考电压 [ 6 ] 。令 ，可得 。 即当被测电容发生改变时，其充电时间将发生弯化，使双稳态触发器产生不同的电压输出，从而得到燃油的容量。电路如图3所示，其中a为震荡信号产生部分，b为信号处理部分。"
"控制终端由电源模块、单片机控制单元、燃油传感器信号处理电路、GPS定位单元、GPRS无线通信单元以及扩展OBD接口等组成。电源模块将车载电瓶和备用电源电压12V转换为3.3 V和5 V供控制电路使用 [ 7 ] 。正常情况下，车载电瓶为系统供电，并给备用充电电池充电，当车载电瓶出现故障或未接入系统时，则由备用电源供电。车载终端硬件结构如图4所示。 GPS模块主要是采集车辆的经纬度，OBD接口读取车辆速度以及方向等数据，将采集的数据传送至STM32芯片进行处理，本系统采用U-blox的NEO-6M模块 [ 8 ] 。GPRS模块主要完成油量信息和GPS定位数据等信息的无线传输，同时还可远程下载服务器及控制中心的命令和信息。 断路检测电路设计 由于货运车辆的油箱外露，加装监测设备难免会有线路暴露在外，当线路因自然或人为破坏时，传感器将失去作用。断路报警检测电路，可检测电路是否正常，当出现断路情况时，及时报警 [ 9 ] ，电路图如图5所示。 图3. 电容测量电路 图4. 车载终端硬件结构图 图5中，U1为NE555芯片，其内部有两个比较器。将油量检测线路中的两个导线接到A、B两点作为检测探头。当电路为通路时即A、B两点闭合，3引脚输出高电平，继电器断开，报警器关闭；当出现断路时即A、B两点断开，3引脚输出低电平，继电器闭合，报警器工作。"
"监控终端的主要工作流程包括以下几个部分： 1) 各功能模块的系统初始化配置，其中包括串口、系统时钟、ADC、IO口、定时器、看门狗、中断等初始化程序。 2) 各功能模块初始化正常后采集所需信号、标准协议以及数据传输发送等系统程序。 3) 主控芯片将所接收的数据经过处理后由GPRS发送至监控中心。 软件流程图如图6所示。 图5. 断路检测电路 图6. 车载终端软件流程图  中转服务器设置在一台公网内有固定IP的计算机，它主要作用是接收、解析、储存来自车载终端通过GPRS发送来的数据包，并实时转发这些数据包至客户端。本系统数据量小，只需要一台普通电脑接入因特网，申请一个公网IP地址就可以改造成服务器 [ 10 ] 。基于VC编写的服务端工作软件界面设计如图7所示，主要由主菜单、连接信息列表栏、GPRS设备连接信息显示栏、以太网连接信息显示栏四部分组成。菜单“控制参数”栏设置自动回复心跳包时延，回复确认信息。连接信息列表栏的功能是显示所有上线的GPRS终端设备和所有登陆的上位机客户端，显示内容。  客户端是因特网上的一个数据终端，主要用于监测、显示、记录运输车辆的状态信息，总体设计结构如图8所示。 软件采用C/S结构，可以从服务器获取车辆的实时数据，实现车辆远程监测。该上位机客户端软件采用VC编写，支持多台终端同时查看监测信息。该软件的主要功能： 1) 用户登录管理。 2) 运输车辆数据获取。 3) 运输车辆数据文本、地图模式显示功能。 4) 运输车辆信息管理功能。 5) 报警设置及提示功能。 6) 系统参数修改。 图7. 中转服务端软件界面"
"在实验室模拟加油、正常行驶油耗、盗油三种状态，曲线如图9所示。在一段时间内，输出电压不断增大过程为加油状态，在加油结束后曲线有一段波动，这是由于加油结束后，液面稳定需要一定的时间 [ 11 ] ；燃油液位呈光滑曲线下降趋势为正常油耗过程；在盗油过程中，输出电压不断减小，当停止盗油后，电压渐渐恢复稳定。 由于燃油消耗是一个动态过程，精确太多没较大意义。本文所设计的电容式油位传感器在实验中运行良好，能够准确测量出汽车在燃油消耗、加油和盗油三种不同状态的电压变化情况，从而反映到客户端供用户分析。 图8. 客户端软件总体结构图 图9. 加油和盗油曲线图 图10. 客户端软件界面  打开客户端软件通过身份验证后，即可进入系统主界面。当服务器开启GPRS数据转发功能后，监控界面获取的车辆数据如图10所示。 图中车辆管理显示的是车辆ID，点击不同车辆，便出现相应车辆监控数据。显示模式可切换文本模式和地图模式，当选择地图模式时，将切换为Google地图显示车辆位置。当油量情况出现异常时，界面会闪动，并出现报警声音。"
"系统不仅可解决车辆在正常行驶状态时的监控，还解决了当车辆熄火时状态监控的难题，在紧急情况如车辆遭遇盗油、异常故障、遇劫、求助等情况发生时，可向管理中心发送报警信息，理论上满足了企业远程监控管理运输车辆，提高了企业的管理效率，有较高应用价值。目前本系统还在试验阶段，尚且存在能耗过高、GPS信号不稳定，数据收发滞后等不稳定情况需改善。今后还需针对系统增加车辆检测、维护、监督等功能，真正实现车辆监控与管理。"
