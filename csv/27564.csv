"风速测量的准确性对于海洋-大气界面的观测有着重要意义。本文简述了时间差超声波风速测量方法的优点，并运用时间差法的二维V型结构超声波测量原理，搭建了一种基于STM32F103ZET6的二维超声波风速测量系统。与传统的测风系统相比较，该设计引入希尔伯特黄变换对测量数据进行处理，能够保证风速测量的准确性。实验结果表明：该设计适应性较强，可实现较高精度的风速测量，在海气界面等复杂气象环境的观测中具有较高的参考价值和实用意义。 关键词 :海气界面，超声波，时差法，STM32F103ZET6，希尔伯特黄变换 Copyright © 2018 by author and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"目前，传统的风速测量仪大多是利用机械构件的转动来衡量风速 [ 1 ] 。与超声波风速仪相比，存在几点缺陷：1) 旋转部件会产生摩擦损耗；2) 存在启动风速，需要启动时间；3) 在海气界面中机械旋转构件的抗浸蚀性能较差 [ 2 ] 。 超声波风速仪与HHT算法相结合，不仅弥补了以上缺陷，而且在风速测量精度上有所提高、抗恶劣海况能力增强，成为当下的研究热点。本文简单介绍了一种基于微控制器STM32F103ZET6、运用时间差法设计的二维超声波测风仪，并引入HHT算法对测量数据进行处理。该系统测量精度高、体积小、频率快、稳定性强，十分适用于海洋大气界面等海洋环境的风速测量。"
"目前时间差法最为成熟，运用也最为广泛，同样也适用于在海洋环境下的风速测量。当波程一定时，分别在顺、逆风的情况下，超声波的输送有一个速率差，而这个速率差就对应一个时间差，两者之间是线性关系 [ 3 ] 。 本方法为：4个收发同体的超声波换能器分别放置在东西南北四个方位，两两间隔分别相等 [ 4 ] 。如图1所示，本设计采用V型安装位置，这样在缩小仪器体积的同时，固定了超声波的传播方向、扩大了超声波声程。 图1. V型测量原理图 当静风时，设超声波波速为c，真实风速为v [ 5 ] 。当有风时，顺、逆风向的时长 t 1 ， t 2 和一维风速v的关系为： 2 L t 1 = c + v sin θ (1) 2 L t 2 = c − v sin θ (2) v = L sin θ ( 1 t 1 − 1 t 2 ) (3) 在二维情况下，在一个平面的X和Y方位上垂向放置两对换能器 [ 6 ] 。 v x 和 v y 依次对应实际风速在X、Y方向上的分解(如图2所示)。 图2. 风速矢量图 假设顺风向时东西方向上的输送时长是 t 12 、逆风向时为 t 21 ，那么同样 t 34 和 t 43 分别为南北方向上输送的的顺、逆风时长 [ 6 ] 。 v x = L sin θ ( 1 t 12 − 1 t 21 ) (4) v y = L sin θ ( 1 t 34 − 1 t 43 ) (5) 实际风速为： v = L sin θ ( 1 t 34 − 1 t 43 ) 2 + ( 1 t 12 − 1 t 21 ) 2 (6) 时间差法的原理较为简单，在测量中不易受环境等因素的影响。不仅电路容易实现、具有稳定的性能，而且方便提高电路集成度，降低板上设计面积。"
"本方案以STM32F103ZET6为核心，通过产生时序信号来激励发生端工作 [ 7 ] 。如图3所示，整个系统由电源模块、超声波发射驱动模块、超声波接收模块、滤波放大模块、UART通信模块和A/D采样模块等组成 [ 8 ] 。 图3. 系统总体构成图   本设计用激励信号PWM波配合LC滤波来共同实现DAC输出 [ 9 ] (如图4所示)。 图4. 实际电路的典型PWM波形  LC选频电路如图5所示：左侧是一个74HC238D译码器，而右侧是发射、接收电路。1、2和3分别是由STM32F103ZET6控制的地址输入；K1、K2、K3和K4作为输出端。S1、S3与收、发兼具的声波探头相连接，CH1和CH3为收到的信号 [ 10 ] 。E1、E2、E3是译码器的势能点，连接控制器I/O口PB3与PB4。由S3侧的探头接收，测得CH3的回波信号数据并保存 [ 11 ] 。  本设计采用TI公司的ADS1298芯片用于多路信号的同时取样，整合了8通道同时采样的24位Delta-Sigma ADC、增益放大器(PGA)、reference voltage和oscillator [ 9 ] ，数据速率250 SPS到32 kSPS。特点是性能优越、取样精确。  为了更好地应对非线性或非平稳性数据的处理数据方法，Huang等人在1998年首次提出将希尔伯特变换(HT)和经验模态分解(EMD)相结合的方法，NASA称之为希尔伯特–黄变换(HHT)。该方法不需要对基函数预先设定，首先，通过经验模态分解，将任何繁复的信号分解成有限个IMF分量和一个剩余分量，能够反映各个时间尺度的变化；其次，对IMF分量运用希尔伯特变换，从而得出每个模态的瞬时频率。该频率能反映数据随时间的变化特性。 图5. 超声波接收模块 如图6所示，EMD基本步骤如下： 图6. HHT流程图 1) 基于原始信号 x ( t ) ，通过三次样条插值法处理极大值和极小值点，得到上、下包络线的平均值为： r 1 ( t ) = 1 2 ( α 1 ( t ) + α 2 ( t ) ) (7) 2) 计算原始信号 x ( t ) 与平均值 r 1 ( t ) 的差值： θ 1 ( t ) = x ( t ) − r 1 ( t ) (8) 3) 如果满足IMF条件，那么分解停止；如果不满足IMF条件，那么将上述步骤重复直到满足条件，令剩余分量为 r 1 ( t ) ： (9) 4) 用剩余分量作为新的信号反复以上的步骤，分离出来所有的IMF分量与剩余分量的关系如下： { r 1 − c 2 = r 2 M r n − 1 − c n = r n (10)"
"按照海滨观测规范中规定的观测和记录方法，分别在顺风向和逆风向的条件下，每3秒采集一次，记录到0.1 m/s，从4个不同测量点上分别选取一定的数据进行对比。如图7所示。 图7. 系统测试实物图 由实验数据分析可知，实验区域为0~3 m/s，每隔0.1 m/s选取一个点进行试验，总共30个测量点，各测量点符合在0~5 m/s的范围内，风速测量准确度在 ± 0.5 m/s的测量精度要求。将所得数据导入上位机进行滤波，图8为顺风向超声波接收信号波形图，图9为逆风向超声波接收信号波形图。  1) 在低风速情况下，采用时差法超声波测风原理能够分别测量出超声波换能器接收到的顺风和逆风时的超声波回波信号，从而测量出风速值； 2) 基于一定数量的试验，运用HHT算法进行数据处理，验证了本文设计的具有较高精确度和稳定性。已知空气中的波速340 m/s，本设计里两对换能器之间传输声程均是140 mm，可得传播时间间隔为0.41 ms [ 10 ] ；相比较而言，STM32F的最高时钟为72 MHz，可知时间精确度最高可达14 ns。 图8. 顺风向超声波接收信号波形图 图9. 逆风向超声波接收信号波形图  1) 受电路板面积的影响，实时的温度补偿电路并没有添加，而是将测得的外部环境温度写入程序中，从而将测量误差引入系统 [ 12 ] ； 2) 用时间差法测量出的低风速值精度基本满足要求。但是在中、高风速情况下，还需要进一步的验证测试 [ 13 ] 。"
"在海气界面的复杂天气中，由于传统仪器存在偏差大、保障难度大等问题，本文对超声波测风系统的原理和硬件设计进行了较为详细的介绍，整体设计电路简单，易于调试。本设计虽然实现了测量风速的基本功能，但在某些方面也需要改进： 1) 外界温湿度也会影响风速，可以添加温湿度补偿器来增强测风仪的性能； 2) 在数据处理方面引入新的算法来提高准确性。"
