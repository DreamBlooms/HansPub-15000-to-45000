"生产历史拟合和开发方案调整、优化是油藏开发过程的重要环节。通过历史拟合能够进一步明确储层和流体的各类静态参数，从而对油藏特征有更准确的认识。人工历史拟合工作过程繁琐、工作量大，对研究人员经验要求较高。本研究采用集合卡曼滤波方法辅助进行自动化历史拟合，极大降低了油藏工程人员的工作量，简化了历史拟合工作流程。油藏开发方案调整是在历史拟合获得的最佳模型基础上，通过改变注采关系、增加新井、调整射孔段等方法最大化开发效果或利润的过程。人工进行的开发方案优化主要是通过大量试算，逐个对各参数进行优化，过程繁琐且无法一次性获得全局最优解。本研究采用粒子群算法，同时对全部待优化参数进行统一优化，降低了工作量，获得了最佳的调整方案。本文首次将自动化历史拟合技术与开发方案智能调整优化技术结合，应用于实际油藏的生产研究当中。研究结果表明，本文采用的方法和技术流程是合理、高效的。为其他复杂油藏高效开发提供了技术基础和案例参考。 关键词 :自动历史拟合，集合卡曼滤波，开发方案优，化粒子群算法 Copyright © 2020 by author(s), Yangtze University and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY 4.0). http://creativecommons.org/licenses/by/4.0/"
"油藏生产历史的拟合和开发方案的优化、调整是油藏开发过程中的两项重要任务。目前我国油藏实际开发过程中，主要进行人工历史拟合和生产方案优化。人工生产历史拟合即油藏工程师根据有关资料(包括地质资料)和数据，结合经验，采用试错法，人为地调整某些可调参数，力图使模型计算的生产历史与真实生产历史吻合的过程；同样的，人工的生产方案优化指油藏工程师通过试算法设计或调整开发方案，使生产目标(累产油、累产气或净现值)最大化的过程。 但实际油藏模型中可变的参数个数通常较多，因此人工历史拟合和方案优化工作过程繁琐、工作量大，对研究人员经验要求较高，尤其在处理复杂问题和大规模问题时，工作量尤为繁琐、庞大。此外，人工方法无法得到拟合结果或优化结果的可信度区间。 而计算机辅助型的自动化历史拟合技术和开发方案优化技术可以简化拟合、优化的流程，极大降低了油藏工程人员的工作量，是未来油藏工程技术发展的方向。 自动化历史拟合与方案调整在数学上的表述类似，因为历史拟合过程也可以看成是使模型计算结果与真实结果之差最小化的过程。即历史拟合和方案调整在数学上都可以被看成是求极值问题。而目前极值问题的有效解决方法可以分为两类，即梯度算法和非梯度算法 [ 1 ]。 梯度算法的核心思想是计算目标函数对待调整参数的梯度，并沿着梯度方向(或与梯度方向反向)调整待优化参数，包括最速下降法、共轭梯度法等 [ 2 ]。梯度算法具有较高的计算效率、较强的可靠性、比较成熟等优点，是一类最重要的、应用最广泛的优化算法。但是，该类方法在处理油藏问题时有较大的局限性。主要由于：1) 目标函数(产量等)没有明确的解析表达；2) 目标函数为多峰函数，高度非线性；3)目标函数有多个，即多目标优化；4) 商业模拟器封装较完备，难以求取梯度。这些弱点使梯度优化算法的应用受到了限制。 非梯度算法主要是基于集合的优化方法，包括集合卡曼滤波和智能优化算法等。智能优化算法包括遗传算法、模拟退火算法、粒子群算法、蚁群算法等 [ 3 ] [ 4 ] [ 5 ] [ 6 ] [ 7 ]，一般都是建立在生物智能或物理现象基础上的随机搜索算法，目前在理论上还远不如传统的梯度算法完善，往往也不能确保解的最优性，因而常常被视为只是一些“启发式方法”(meta-heuristic)。但这类算法一般不要求目标函数和约束的连续性与凸性，甚至有时连有没有解析表达式都不要求，对计算中数据的不确定性也有很强的适应能力。 自动历史拟合算法与智能优化算法的数学理论均已相对完善，且分别在油气藏研究中得到了初步的应用 [ 1 ] [ 5 ] - [ 10 ]，但目前尚没有完整地将自动历史拟合与智能优化结合开展油藏研究的工作。本研究首次在实际油藏中将自动化历史拟合技术与开发方案智能调整优化技术衔接，即首先采用集合卡曼滤波方法进行油藏开发历史的自动化拟合，在拟合获得的拟合度最好的油藏模型基础上，采用粒子群算法进行开发方案调整。最终获得了最佳的调整方案，实现了自动化历史拟合和开发方案智能优化技术的一体化应用。 研究结果表明，本文采用的方法和技术流程是合理、高效的。为其他复杂油藏高效开发提供了技术基础和案例参考。"
"卡尔曼滤波是一种广泛应用的针对高斯线性问题的顺序数据拟合方法 [ 8 ]，其基本思想为计算预测值与观测值之间的误差协方差矩阵，逐步更新数值模型不确定参数，从而使预测值与观测值之间误差逐步减小。 考虑一个线性模型，定义状态向量S，S中包含模型的不确定参数、模型状态以及观测量。那么模型k时刻和k − 1时刻状态向量 S k 和 S k − 1 有以下关系。 S k = A k S k − 1 + e k − 1 (1) 其中e为模型误差。 k时刻观测值与模型状态间存在线性关系， d o b s , k = G S k + ε k (2) ε 为观测误差，它与模型误差一样都服从均值为0的高斯分布。G为一个算子，它可以从状态向量中获取观测量的值。 一般将卡尔曼滤波方法分为两个步骤，即预测步和同化步，下文中将以上标f和a来分别表示预测步和同化步。 在预测步中，根据(2)我们可以利用k − 1时刻的同化后的状态向量计算k时刻的状态向量的最优估计，即 S k f = A k S k − 1 a (3) 以及协方差的最优估计， C k f = A k C k − 1 a A k T (4) 在同化步中，根据(3)， p ( S k | D k ) = p ( S k | d o b s , k , D k − 1 ) ∝ p ( d o b s , k | S k , D k − 1 ) p ( S k | D k − 1 ) (5) 由于模型参数和观测误差满足高斯假设，那么(5)右边第一项为， p ( d o b s , k | S k , D k − 1 ) ∝ exp [ − 1 2 ( G S k − d o b s , k ) T ( C D , k ) − 1 ( G S k − d o b s , k ) ] (6) (5)右边第二项， p ( S k | D k − 1 ) ∝ exp [ − 1 2 ( S k − S k f ) T ( C k f ) − 1 ( S k − S k f ) ] (7) k时刻模型状态向量的最优估计为使(5)中后验概率 p ( S k | D k ) 最大的 S ^ k ，等价于求下述函数的最小值， J ( S ) = 1 2 ( G S k − d o b s , k ) T ( C D , k ) − 1 ( G S k − d o b s , k )     + 1 2 ( S k − S k f ) T ( C k f ) − 1 ( S k − S k f ) (8) 令(7)的导数等于零便可以求的上述最优化问题的解， S k a = S k f + K k ( d o b s , k − G S k f ) (9) 公式中K称为卡尔曼增益，它表示为， K k = C k f G T ( G C k f G T + C D , k ) − 1 (10) 数据同化之后，模型状态向量的协方差可以表示为， C k = C k f − C k f G T ( C D , k + G C k f G T ) − 1 G (11) 根据(11)计算得到的协方差可以用于分析数值模型的不确定性。卡尔曼滤波方法理论的推导都是基于数值模拟模型线性的假设，对非线性问题并不适用。然而，油藏数值模拟中控制方程大多为非线性方程，因此卡尔曼滤波方法在油藏数值模拟中不易应用。除此之外，在处理不确定参数较多的问题时，卡尔曼滤波计算协方差矩阵时需要消耗很大的计算量。 集合卡尔曼滤波方法是在卡尔曼滤波的基础上发展而来的 [ 9 ]，该方法借用了蒙特卡洛模拟的思想，同时更新所有实现的集合。集合卡尔曼滤波用样本的协方差代替卡尔曼滤波中的协方差矩阵，从而避免了卡尔曼滤波对协方差的更新和计算，因此集合卡尔曼滤波方法在处理大规模问题时较经典卡尔曼滤波更具优势。除此之外，集合卡尔曼滤波方法并未严格要求待矫正模型是线性的，因而它可以一定程度上用以处理非线性模型的数据同化任务。 集合卡尔曼滤波方法的技术流程如下： 首先根据先验概率分布生成一组状态向量的初始实现， S 0 = { S 0 , 1 , S 0 , 2 , ⋯ , S 0 , N s } (12) 其中， N s 为集合中实现的个数。 与卡尔曼滤波方法类似，集合卡尔曼滤波方法通常也分为预测步和同化步。 在预测步中，每个实现需要根据k-1时刻的同化后的状态向量预测估计k时刻的模型状态，即 S k , i f = f ( S k − 1 , i a ) , i = 1 , 2 , ⋯ , N s (13) 其中， f ( · ) 为数值模拟模型，上标f和a分别表示预测步和同化步。(13)与(3)最大的不同是在集合卡尔曼滤波需要对集合内所有实现进行正演模拟。 在同化步中，对k时刻获得的观测数据进行数据同化。集合卡尔曼滤波方法中数据同化的公式与卡尔曼滤波类似， S k , i a = S k , i f + K k ( d k , i − G S k , i f ) , i = 1 , 2 , ⋯ , N s (14) 其中，K为卡尔曼增益，G为从状态向量中提取观测量的算子。 这里，卡尔曼增益的计算方法与经典卡尔曼滤波方法中计算公式类似， K k = C k f G T ( G C k f G T + C D , k ) − 1 (15) 所不同的是，(15)中协方差矩阵 C k f 并不是直接显式计算得到，而是通过统计集合中所有实现得到， C k f ≈ 1 N s − 1 ∑ i = 1 N s { [ S k f , i − 〈 S k f 〉 ] [ S k f , i − 〈 S k f 〉 ] T } (16) 〈 S k f 〉 = 1 N s ∑ i = 1 N s S k , i f (17) 集合卡曼滤波方法的实施流程如图1所示，通过建立油藏模型，设定需要拟合的参数，基于集合卡曼滤波方法的使用生产动态数据进行油藏参数的反演，逐步优化油藏模拟，提高拟合精度。"
"粒子群优化算法(Particle swarm optimization, PSO)是一种进化计算技术。源于对鸟群捕食的行为研究。粒子群优化算法的基本思想是通过群体中个体之间的协作和信息共享来寻找最优解 [ 10 ]。 PSO先生成初始种群，即在可行解空间中随机初始化一群粒子，每个粒子都为优化问题的一个可行解，并由目标函数为之确定一个适应值(fitness value)。PSO不像其他进化算法那样对于个体使用进化算子，而是将每个个体看作是在n维搜索空间中的一个没有体积和重量的粒子，每个粒子将在解空间中运动，并由一个速度决定其方向和距离。通常粒子将追随当前的最优粒子而动，并经逐代搜索最后得到最优解。在每一代中，粒子将跟踪两个极值，一为粒子本身迄今找到的最优解pbest，另一为全种群迄今找到的最优解gbest。具体流程见图2。 粒子群算法的数学表述为 [ 5 ]：假设在D维搜索空间中，有m个粒子组成一群体，第i个粒子在D维空间中的位置表示为 x i = ( x i 1 , x i 2 , ⋯ , x i D ) ，其中 i = 1 , 2 , ⋯ , m ，第i个粒子经历过的最好位置(有最好的适应度)记为 p i = ( p i 1 , p i 2 , ⋯ , p i D ) ，每个粒子的飞行速度 v i = ( v i 1 , v i 2 , ⋯ , v i D ) 。在整个种群中，所有粒子经历过的最好位置为 p g = ( p g 1 , p g 2 , ⋯ , p g D ) ，每一代粒子根据下面的公式更新自己的速度和位置。 v i d = w v i d + c 1 r 1 ( p i d − x i d ) + c 2 r 2 ( p g d − x i d ) (18) x i d = x i d + v i d (19) 其中，w为惯性权重；c 1 和c 2 为学习因子；r 1 和r 2 是[0,1]之间的随机数。公式由三部分组成，第一部分是粒子先前的速度，说明了粒子目前的状态；第二部分是认知部分(Cognition Modal)，是从当前点指向此粒子自身最好点的一个矢量，表示粒子的动作来源于自身经验的部分；第三部分为社会部分(Social Modal)，是一个从当前点指向种群最好点的一个矢量，反映了粒子间的协同合作和知识的共享。三个部分共同决定了粒子的空间搜索能力。第一部分起到了平衡全局和局部搜索的能力。第二部分使粒子有了足够强的全局搜索能力，避免局部极小。第三部分体现了粒子间的信息共享。在这三部分的共同作用下粒子才能有效的到达最好位置。 更新过程中，粒子每一维的位置、速度都被限制在允许范围之内。如果当前对粒子的加速导致它在某维的速度V i 超过该维的最大速度V d ,max ，则该维的速度被限制为该维最大速度上限V d ,max 。一般来说，V d ,max 的选择不应超过的粒子宽度范围，如果V d ,max 太大，粒子可能飞过最优解的位置；如果太小，可能降低粒子的全局搜索能力。 图1. 集合卡曼滤波方法流程图 图2. 粒子群优化算法流程图"
"QH油田位于于渤海中部海域，是一个大型复杂河流相稠油油田，地层原油黏度为28~260 mPa∙s。该油田是在前第三纪古潜山(石臼坨凸起)背景上发育起来的被断层复杂化的大型低幅度披覆构造，储层为正韵律和复合韵律河道沉积砂体。油藏埋深中等(1.7~1.9 km)，储层胶结疏松，物性好(平均孔隙度18%，平均渗透率50 × 10 −3 μm 2 )；纵向上包含3套油层，并发育有大量泥岩隔夹层，含油层段多，油柱高度小(小于20 m)，油水关系复杂。 QH油藏共包含18口生产井，自2011年2月投产以来，衰竭开发至今。采用2011年2月到2016年7月的生产动态数据进行历史拟合，利用2016年7月以来的生产数据检验预测结果。在该拟合研究中，将历史产液量作为井的控制条件，拟合各井的产水量。 根据地质情况和测井数据建立的油藏地质模型共51个网格层、535,500个有效网格。在拟合过程中，选择可靠性较低且对模拟结果较敏感的基质孔隙度、渗透率、垂向渗透率比例、初始油水界面上的毛管力等四个参数作为待调整变量进行调整，根据地质背景和测井解释分析情况确定各参数的调整范围如表1所示。 Table 1 待拟合变量 最小值 最大值 孔隙度乘数 0.8 1.2 渗透率乘数 0.5 2.0 垂向渗透率与水平渗透率比值 0.02 0.1 初始油水界面上的毛管力 0 0.3 bar 表1. 待拟合参数的取值范围 在使用集合卡曼滤波方法进行历史拟合过程中，共设置20个实现，分4次进行数据同化。图3是拟合过程中所有实现的日产水与实际油藏日产水的对比曲线，其中蓝色细线为单个随机算例计算的结果，红圈是实际数据。可以看出随着同化的进行，各实现的计算结果迅速向真实结果靠拢，并在最后收敛到真实生产数据附近。在2016年7月开始的预测阶段(2000天以后)各实现的表现也于真实的产水基本吻合，验证了拟合的正确性。 图3. 拟合收敛过程 在拟合过程中，4个待调整参数也随着拟合的进行快速收敛，结果见图4。从图中可以看出，随历史拟合不断进行，各算例中需要调整的四个不确定性参数的变化情况，后期基本已经收敛到确定的值。对该油藏的地质模型而言，孔隙度乘数、渗透率乘数、初始油水界面上毛管力值收敛较好，说明敏感性极高。垂向渗透率收敛较差，表明该油藏由于隔层发育，纵向连通性差，流体的纵向流动比例较小，因此不敏感。 选择拟合结束后获得的最佳模型进行后续研究，图3中绿线是该模型计算结果与真实历史数据的对比，从中可以看出，该模型结果基本能够反映储层开发过程及渗流规律。 图5是最佳拟合模型计算结束后的储层压力和饱和度分布，总体而言该井区储层受岩性控制，砂体连通性差、非均质性强，各井生产规律差异较大。因此考虑采用生产井转注的方法调整开发模式和井网结构，提高油藏采收率。图6是转注后的井网结构。 图4. 待调整参数的收敛过程 图5. 最佳算例计算完成后获得的储层含水率分布 图6. 转注后的井网结构 为最大化的提高油藏采收率，采用粒子群算法对各注水井的注水量以及注水层段进行优化。在优化过程中，定全区日累积注水量为400方/天，5口注水井各自的注水量占累积注水量的比例为待优化参数；同时对各井可能的注入层段进行组合，由于储层共包括3个油层，因此共有7中组合方式，见表2。 Table 2 编号 1 2 3 4 5 6 7 注入层组合 1 2 3 1 + 2 1 + 3 2 + 3 1 + 2 + 3 表2. 注入井所有可能的注入层组合 因此，待拟合变量共10个，采用粒子群算法进行拟合。共设置40个粒子，各粒子的初始位置随机分布。优化过程中设置数模算例计算时间为5年，优化的目标函数设置为最终的全区累产油，演化次数为20。此外，计算过程中任一生产井含水率大于98%时，该井自动关闭。图7是演化过程中各粒子对应的目标函数(累产油)变化情况，使用粒子群算法对开发效果进行优化时目标函数的攀升过程(表明优化算法是有效的)。从图中可以看出，优化过程明显提高了各方案的累产油。最佳算例比随机设置初始参数的最好结果累产油高1.2万方，经济效益明显。 图7. 各粒子目标函数演化情况 图8是各粒子对应的待优化参数的演化情况，从图中可以看出各参数均收敛到一个最佳的值。计算结果表明，不同注入井的最佳注入层和注入量均不相同，而是取决于与周围生产井的位置关系和连通性。同时，所有的注入井均没有采用3层合注的生产模式(对应代号7)，而是均沿主力层注入。"
"1) 基于集合卡曼滤波的自动历史拟合方法，可以较好地刻画地层非均质性，是现阶段技术条件下能够用于油田实际的一种高效自动历史拟合技术。 2) 自动历史拟合方法省时省力，对工作人员的经验要求低，拟合效果好，是一种高效易操作的多参数调参技术。 图8. 各粒子对应的待优化参数的演化情况 3) 粒子群算法能够同时且高效地调整所有油藏生产中的带优化参数，最大化油藏的开发目标(累产油或净现值)，是一种有效的油藏开发方案设计、调整方法。 4) 本文首次将自动化历史拟合技术与开发方案智能调整优化技术结合，应用于实际油藏的生产研究当中。结果表明，本文采用的方法和技术流程是合理、高效的。为其他复杂油藏高效开发提供了技术基础和案例参考。"
