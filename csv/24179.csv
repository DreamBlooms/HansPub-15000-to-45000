"本文设计了一套基于KingView6.55的风光储微电网孤岛监控系统,通过智能模块和多种通信方式实现上位机和下位机的数据通信。能够实时监视风光储各支路电压、电流和功率因数等关键参数，并将重要参数存入数据库。用户可以通过SQL访问实时地、有效地查询历史数据。当系统中某些量的值超过或者低于所规定的界限时，组态王可以弹出报警画面并发出警报声音，同时通过短信模块给指定人员发送信息或者拨打电话。文章最大创新点是根据蓄电池BMS系统上传的SOC，设计了整个监控系统稳定可靠运行的能量管理算法。并且上位机不但能够监视系统的运行状态，还能下发指令控制下位机模块的动作，真正实现了监视和控制相结合的功能。并且开发了基于组态王的清晰、实用的人机交互界面。 关键词 :KingView6.55，数据通信，监控系统，电池BMS，报警 Copyright © 2018 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"随着能源问题和环境问题的日益突出，以新能源发电作为主要电源的微电网受到各国的重视。微电网技术是实现分布式发电系统大规模应用和电网智能化的关键技术之一 [ 1 ] [ 2 ] [ 3 ] 。微电网可以运行在并网和孤岛模式，微电网当并网运行时为大电网输送电能，当孤岛运行时为电源为本地负荷供电 [ 4 ] 。监控系统作为微电网中不可缺少的组成部分，其作用是保证微电网可靠、稳定运行。微电网的电源形式、组网结构不尽相同，所以监控系统的结构和具体功能也具有很大的差异。 文献 [ 5 ] [ 6 ] 设计了一套基于LabView的微电网监控系统，它对风、光、储模块进行了需求分析设计了能量管理系统，但是没有介绍历史数据的存储和查询；文献 [ 7 ] 利用Qt设计了上位机界面，利用基于STM32F103C8T6芯片的单片机作为下位机，分析了三相负载功率平衡、微电网并网及孤岛运行等几个问题；文献 [ 8 ] 利用CAN总线的通信方式实现上位机和下位机的通信，但是在能量管理和阈值报警方面没做介绍；文献 [ 9 ] 借鉴了智能变电站分层体系结构，提出了由设备层、管理层和优化层3个逻辑层构成的微电网监控与能量管理一体化系统，并在此基础上，设计了位于管理层的微电网监控系统和能量管理装置。 本文设计对象是一种典型微电网离网系统，分布式电源包括光伏发电、风力发电和蓄电池，负荷部分是无线充电的电动汽车。通信采用主从方式，通过接收的数据，上位机时刻监测系统的运行状态。并根据蓄电池BMS系统上传的SOC状态，上位机下发光伏侧、风机侧、负荷侧变流器的开停机指令。UPS从蓄电池取电给智能模块和监控一体机提供不间断供电。"
"图1中光伏发电、风力发电和蓄电池共同作为整个离网系统的电源，光伏和风机都采用MPPT控制。光伏发电经过DC/DC升压后接到400 V直流母线，风机内自身带有DC/AC模块，整流出来的电经过DC/DC升压后接到400 V直流母线，20 KWh的蓄电池用来储存电能并维持直流母线电压恒定，其出口标称电压为100 V同样经过DC/DC升压后接到400 V直流母线。通过无线充电的电动汽车作为整个系统 图1. 风光储微电网简化结构框图 的负荷，并在直流母线留有备用。UPS从蓄电池取电，逆变为220 V市电给监控一体机和二次侧设备供电。QF1、QF2、QF3、QF4、QF5为普通微型断路器，DKM1、DKM2、DKM3、DKM4、DKM5为带电操结构的直流断路器，能够实现远程监控进行分合闸操作功能；各个DC/DC能与上位机监控系统通信，在监控系统中实现开机和停机功能。"
"微电网监控系统的上位机开发软件选择北京亚控公司的Kingview6.55组态软件，组态软件又称组态监控系统软件，是指一些数据采集与过程控制的专用软件。Kingview6.55软件作为一种优秀的上位机监控软件，有着强大的界面显示功能，丰富的功能模块，强大的数据库功能和可编程的命令语言等特点。根据工作阶段划分，Kingview6.55软件可以分为开发环境和运行环境两大部分。用户在开发环境中可以搭建人机交互平台、实施控制方案和建立用户数据文件。在运行环境下，目标应用程序被装入计算机内存并投入实时运行。Kingview6.55软件还支持不退出运行环境的情况下可以直接进入开发环境修改组态，修改后的组态直接生效。Kingview6.55软件可以安装在操作系统是Windows 2000(sp4)/Windows XP(sp2)/Windows 7简体中文版的工控机中，内存要求至少128 MB，通信方式为RS-232C。整个软件系统围绕模块化设计思路，上下位机相互通信，结构化简图如图2。  微电网监控系统上位机采用类似于银行排号的触摸屏一体机，下位机的信号釆集采用智能模块。该系统采用的是一对多的通信连接形式,即现场多种智能化模块挂接在RS-485总线上,然后再由RS-232/485转换器转换后连接到上位机。另一种各支路变流器连接在同一个交换机上，然后通过网线连接到上位机。远程监控使用GPRS服务平台。各个硬件连接结构图如图3所示。  本系统中所有智能模块的通信分为两种通信方式，一种是采用Modbus RTU协议的串口通信，另一 图2. 微网监控系统软件框图 图3. 微网监控系硬件框图 种是采用Modbus TCP/IP协议的网口通信。两种不同的通信协议在数据帧组成和组态软件里设置都有所不同。但都使用了主从命令模式，即主机发送读或写命令给从机，然后从机对主机做出相关响应，回馈数据内容或者置位寄存器 [ 10 ] 。  Modbus TCP/IP通信协议标准在物理层、数据链路层使用以太网标准，在应用层上使用Modbus协议标准 [ 11 ] 。Modbus TCP/IP将Modbus帧通过封装嵌入到TCP帧中，实现Modbus报文在TCP/IP上传输。Modbus TCP/IP没有改变Modbus协议内容，为了适应工业监控实时性需求，改变了数据的传送方式，提高了通信速率。Modbus TCP/IP仍采用呼叫/应答模式，形式上仍为Modbus主从通信，提高了以太网通信的可靠性。Kingview6.55与基于Modbus TCP/IP协议的智能模块连接时地址格式应为:IP地址单元号。一般Modbus TCP/IP协议设备端口号是502。  Modbus RTU通信协议，是一种常用的工业通讯标准，被广泛运用于工业自动化控制领域。Modbus RTU通信协议主机查询模式下的数据帧格式见表1。 MAC-ID：从机设备地址，即为对智能模块的查询地址，1#模块定义为01，2#模块定义为02，3#模块定义为03，依次类推； FUN-ID：功能码是报文帧的第二个字节，主站通过功能码告诉从站执行什么操作，功能码取值为 Table 1 开始 设备地址 功能代码 数据地址 数据个数 校验方法 终止 T1-T2-T3 MAC-ID FUN-ID DATA-ADDR DATA-NUM CRC T1-T2-T3 表1. 数据帧格式 1~255，如03H代表读从站寄存器数据，06H代表写从站寄存器； DATA-ADDR：待查询数据起始地址，一般是从低地址到高地址依次查询，访问地址要求必须连续； DATA-NUM：待查询数据数量，从起始地址到终止地址存储数据的个数； CRC：循环冗余校验码，计算数据帧传输序列的CRC值，同传送序列中的CRC值比较，从而判断通信是否正确； T1-T2-T3：发送预备时间，当发送或接收数据时，预备时间 > 3.5个字符； Kingview6.55与基于Modbus RTU协议的智能模块通信时地址格式应为：Address [:Delay] [:Delay2] Address1~255表示设备地址 Delay 0~60,000表示发送每条命令帧后的延迟时间(毫秒) Delay2 0~100,000表示发送每条命令帧前的延迟时间(毫秒)"
"如图4用户登录界面所示，可以设定用户名和用户密码，并且可以设定各个用户的优先访问级和安全操作区域。Kingview6.55软件支持修改用户名和口令，其脚本程序如下： if(MenuIndex==0) { LogOn(); } if(MenuIndex==1) { LogOn(); ChangePassword(); LogOff(); } if(MenuIndex==2) { LogOff(); ShowPicture(登录界面); }  在系统正常运行时，下位机上传的一些重要参数需要在界面上显示出来。方便用户了解系统每个地方的运行参数及运行情况。如图5显示了支路1上的电压、电流、有功功率和该支路流过的电量。这样可以时刻监视现场设备的运行情况，模拟系统的工艺流程。根据上传的电压电流参数，可以形象直观的 模拟电压电流正弦波形图。 Kingview6.55运行系统中可以通过以下几种方式查询历史数据：报表、历史趋势曲线、WEB发布中的历史数据和历史曲线的浏览。本文通过使用历史报表函数查询历史数据。想要查询IO变量历史数据，必须对IO变量进行如图6“记录和安全区”选项卡设置，将数据变化记录的变化灵敏度设置为零。图7为本系统中对每日的光伏、风机发电量进行了记录。在“发电量统计”界面内点击报表查询按钮，可以设置查询的起始时间、结束时间、变量选择和时间间隔等。每日发电量统计可以用以下脚本实现。 图4. 用户登录界面 图5. 支路1参数界面 图6. IO变量数据变化设置 图7. 光伏每日发电量查询 /*每天电量历史查询表示*/ if(\\本站点\$时==0 &&\\本站点\$分==0 &&\\本站点\$秒==0) \\本站点\k1=\\本站点\光伏侧电量; if(\\本站点\$时==23 &&\\本站点\$分==59 &&\\本站点\$秒==59) { \\本站点\k2=\\本站点\光伏侧电量; \\本站点\光伏每日发电量=\\本站点\k2-\\本站点\k1; }  报警与事件画面，记录了系统运行时每个变量超限产生的故障报警和修复后是否恢复，为系统维护提供了强有力的保障。当微网监控系统中某些变量的值超过或低于规定的界限时，系统自动产生相应的告警信息，表明该变量的值非正常，提醒操作人员。如支路1中某处发生短路故障可能会使流过导线和变流器的电流增大，严重时可能会烧坏线路和损坏设备。有了报警就可以提示操作人员注意。Kingview6.55组态中调用PlaySound( aa, 1)函数，播放名字为“aa”的警报声音，有效提示在场的操作人员。在监控系统中，为了方便查看、记录和区别，可以将变量产生的报警信息归到不同的组中，即使变量的报警信息属于某个设定的报警组。同时系统自动将报警信息记录，方便用户查看历史报警。对目标IO变量的报警设置如图8所示，在改选项卡中可以设置该IO变量的报警组名和报警限。 当报警发生后，如果现场操作人员没有发现系统报警，本系统还增加了一个智能报警短息模块，这样报警发生的同时给指定操作人员发送报警信息。信息内容是之前输入到系统中的字符串，不同的报警情况对应不同的字符串。短信模块是基于AT指令的SIMCOM SIM900A。该模块同样是通过标准的Modbus RTU通信协议与上位机连接，连接成功后，如果报警条件成立，就执行发送短信命令。其命令如下： if(\\本站点\新报警==1) { \\本站点\电话号码=18222219869 \\本站点\发送内容=系统支路1 电压异常 \\本站点\发送=1; } 图8. 通用报警属性   当风、光、储、负荷和控制设备全部安装完成后，需要对系统上电联调，各个支路上电顺序非常重要。如果操作不当，可能会损坏设备甚至发生安全事故。经过多次讨论设计了系统首次合闸操作步骤， 1、系统首次运行时，首先手动对光伏支路、电池支路、风机支路和UPS支路侧进行合闸，即闭合QF1、QF2、QF3、QF4； 2、对所有的带通信的断路器进行合闸，由于电池接于斩波器的低压侧，电池上电后高压边与低压边的电压一致，建议上电顺序： 1) 先闭合DKM5给二次侧设备和监控一体机供电； 2) 储能支路供电，即闭合DKM3； 3) 依次对光伏、风机和负荷侧供电，即闭合DKM1、DKM2、DKM4； 3、系统内部控制步骤； 1) 对储能支路DC/DC下发高压边直流母线(400V)模式输出指令； 2) 分别对光伏、风机支路的DC/DC和DC/DC进行开机； 3) 对高频DC/AC进行开机； 当判断直流母线在360 V~420 V之间，随即计入能量管理算法逻辑；  参考文献中大多研究的并网系统，在并网系统中当没有负荷或者负荷不需要电能的时候，风机和光伏依然可以持续发电把剩余的电量送到大电网。当微电网发电量不够且负荷需要电能时，负荷电能可以由大电网提供。简单的说并网时，微源发出的能量由大电网作为支撑。由于没有强大的大电网，微电网孤岛运行时则需要设定有效的能量管理算法逻辑。本系统根据蓄电池BMS上传的SOC来管理光伏、风机和负荷侧变流器的开停机。根据实际运行情况，将SOC分为三个节点0.95、0.7和0.2进行能量管理。具体管理算法如下： 1、当上位机检测到SOC = 0.95为了防止蓄电池过充电，分两种情况： 1) 如果有电动汽车负荷用电，并且SOC持续上升到0.98，监控系统发出警报，并且下发指令自动对光伏侧和风机侧的DC/DC进行停机。 2) 如果没有电动汽车负荷用电，监控系统立即下发指令自动对光伏侧和风机侧的DC/DC进行停机。 2、当光伏和风机侧DC/DC都停机时，由于有负荷和UPS侧用电，SOC会逐渐下降，当监控系统检测到SOC = 0.7时，系统下发指令自动对光伏侧和风机侧的DC/DC进行开机。 3、正常天气下，系统会在步骤1和步骤2的情况下重复循环。但是当连续阴雨天，光伏和风机发电很少时，即使执行了步骤2，SOC仍会下降。为了保护蓄电池不过放电，当SOC = 0.2分两种情况： 1) 如果有电动汽车负荷用电，监控系统立即下发指令自动对电动汽车侧HF DC/AC进行停机。 2) 如果没有电动汽车负荷用电，因为有UPS侧用电，SOC仍会下降。当SOC = 0.15时，系统发出警报，并给指定号码打电话/发短信。并且为了保护蓄电池，自动断开由UPS供电的断路器DKM1、DKM2、DKM3、DKM4和风机、光伏、蓄电池侧的DC/DC。当SOC=0.14断开UPS侧断路器DKM5。整个系统停止运行。 4、当SOC = 0.14时，整个系统停止运行。由于之前已经短信通知操作人员系统停止工作，操作人员只需要适时的重合闸给蓄电池充电并重复首次合闸操作步骤。 Kingview6.55组态软件中，系统能量管理的算法程序如下： if(soc==0.95&&\\本站点\高频DCAC!=1) { \\本站点\风机DC/DC=0; \\本站点\光伏DC/DC=0; } if(soc==0.98&&\\本站点\高频DCAC==1) { PlaySound( aa, 1 ); \\本站点\风机DC/DC=0; \\本站点\光伏DC/DC=0; } if(soc==0.7) { \\本站点\风机DC/DC=1; \\本站点\光伏DC/DC=1; } if(soc==0.2&&\\本站点\高频DC/AC==1) { \\本站点\高频DC/AC=0; } if(soc==0.15) {PlaySound( aa,1 ); \\本站点\光伏DC/DC=0; \\本站点\风机DC/DC=0; \\本站点\电池DC/DC=0; \\本站点\高频DC/AC=0; \\本站点\DKM1=0; \\本站点\ DKM2=0; \\本站点\ DKM3=0; \\本站点\ DKM4=0; } if(soc<0.15) {\\本站点\ DKM5=0; }"
"示范工程主要内部平台和外部平台，内部平台主要有控制室和设备室，外部平台是光伏组件和无线充电的电动汽车。控制室存放整个示范工程的监控系统，设备室存放变流柜、蓄电池等设备。图9所示示范工程内部平台。 图10所示是6 kWp光伏阵列、0.8 kW的风机和无线充电的电动汽车。光伏阵列工作电压是182.04 V，工作电流是32.96 A。系统采取“六串四并”输入，即每六电池板串联，然后四路并联输入到光伏汇流箱。电动汽车蓄电池容量是13 kWh，出口电压是60 V，最大充电电流100 A。  图11显示的是2017年9月12日当天光伏的出力曲线。从实际记录的曲线图中可以看到光伏出力曲 图9. 示范工程内部平台 图10. 示范工程外部平台 图11. 光伏发电伏功率曲线 线基本呈现抛物线形状。早上和晚上光照很弱，光伏出力基本为零，在中午时候光照最强，光伏出力最大，最大功率约为5 kW。 图12是一天内蓄电池侧双向变流器的输入输出电压的历史记录曲线。图中红色曲线对应值约为200 V左右，即蓄电池的出口电压为200 V。绿色曲线对应值约为360 V左右，即高压母线电压为360 V。 图13(a)~(c)分别是一次实验中记录的光伏发电、蓄电池充/放电和电动汽车无线充电的历史功率曲线。曲线记录的区间是2017年12月9日14:00~14:30。14:00~14:08时，没有电动汽车用电。光伏发电 图12. 蓄电池侧DC/DC输入输出电压曲线记录 图13. 电动汽车一次充电试验结果曲线 功率是2.8 kW，光伏所发电能通过高压直流母线和蓄电池侧双向DC/DC给蓄电池充电。14:08~14:23时，电动汽车开始以4.4 kW功率充电。光伏发电功率是2.7 kW，光伏发电功率小于负荷用电功率，蓄电池开始以1.7 kW功率释放电能。14:23~14:30时，电动汽车停止充电。此时，光伏发电功率是2.6 kW，光伏所发电能通过高压直流母线和蓄电池侧双向DC/DC给蓄电池充电。"
"本文针对小型风光储微电网孤岛监控系统，经过整体分析，设计了合理的监控系统体系结构。采用智能模块的下位机采集装置和基于Kingview6.55的组态开发环境，通过多种通信方式结合实现上位机对下位机的监视和控制。本系统实际应用在天津市科技支撑计划项目中，经过实际调试和使用，证明该系统具有运行稳定、实时高效的特点。在微电网和智能电网监视和控制方面有着积极的作用。"
