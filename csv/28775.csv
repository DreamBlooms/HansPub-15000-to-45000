"本文以综合管廊的环控系统为研究对象，基于Niagara技术为该研究对象搭建了一套监控系统。本文将管廊环控系统分为温湿度监测与控制系统、排水控制系统和照明系统这三个子系统，并在Niagara软件上实现逻辑上的编程以及监控系统集成页面的设计。通过系统调试，证明所设计的系统能够稳定可靠地运行。 关键词 :环控系统，Niagara，监控系统 Copyright © 2019 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"自从德国提出工业4.0，各行各业的智能化和信息化水平都逐渐提高，各个国家对综合管廊的研究也加快了步伐 [ 1 ] [ 2 ] 。以前对综合管廊的研究大多集中在综合管廊前期的规划、设计和施工阶段，而对后期的运营管理研究较少。其实后期的运用管理也是一个非常重要的部分，因为管廊内各种管线密布，极易发生危险，所以在后期进行运营管理时，应更多地提高管理的智能化水平，以便发生危险时，能够及时提醒管廊内的工作人员，及时做出反应，避免人力、物力的损失。 本文旨在设计出一个基于Niagara技术的综合管廊环控系统管控平台，该系统主要是将综合管廊内的环控系统集成为一个相互关联和协调的控制系统，实现系统统一管理和信息共享。"
"Niagara软件平台 [ 3 ] [ 4 ] [ 5 ] 是Tridium公司所研发的用于解决设备连接应用的物联网开放式应用框架平台。应用框架是一个软件工程中的概念，不同于普通的软件，它是用于实现某一应用领域通用完备功能的底层服务，使用这种框架的编程人员可以在一个通用功能已经实现的基础上开始具体的产品和系统开发。应用框架强调的是软件的设计重用性和系统的可扩展性，以缩短各种应用软件开发的周期，提高开发的质量。 Niagara软件平台可以集成各种设备和系统到一个统一的平台，而不用考虑制造商或通信协议，通过该平台可以很容易使用标准的浏览器实现实时管理和控制，可以为企业创造极大的商业价值。目前，全球使用Niagara技术的例子已超过50万个，且还在持续增长当中。这些实例包含各行各业，有安防、工业生产、医疗设备、暖通空调等各个方面，具体如图1所示。"
"本系统以Niagara作为系统的集成平台，将设备层的数据收集并进行统一处理，生成控制指令传至各子系统，进而控制系统的整体运行，实现其相应的功能。其中，服务器与无线接入器AP通过AC核心交换机 [ 6 ] 相接，无线接入器AP与PLC的数据交换则通过Zigbee模块，而系统的最底层的各类传感器、探测器等设备与PLC主要通过电缆连接。系统的技术框架图如图2所示。  由图2可知，本系统所用的硬件主要有AC核心交换机，无线接入器AP，PLC以及末端各类传感器、探测器。下面将对AC核心交换机，无线接入器AP和PLC进行详细介绍。 图1. Niagara软件所应用的领域 图2. 系统技术架构图 1) AC核心交换机 AC核心交换机(Wireless Access Point Controller, AC)是一种网络设备，它是无线网络的核心部分。它的主要功能是将无线网络中所有的无线AP进行集中化控制与管理，其中对AP管理包括：下发配置、修改相关配置参数、射频智能管理、接入安全控制等。 本系统所用的AC核心交换机的型号是华为的AC6005系列产品，产品外形图如图3所示。该系列是华为推出的面向中小型企业的小型盒式宽带物联网无线接入控制器，最大可管理256个宽带物联网AP，可以集成千兆以太网交换机，实现有线无线一体化的接入方式。还具有良好的可扩展性，能够对无线接入点AP的数量进行灵活的设置。 图3. AC核心交换机外形图 2) 无线接入器AP AP (Access Point, AP)即无线接入器，它主要是与小型无线局域网进行连接以达到拓展的目的。当局域网内的无线网络用户数达到一定数量时，就将无线AP接入有线网络，以达到将无线网络连接到有线网络主干的目的。在无线工作站和有线主干之间，无线接入器AP起的是一个网桥的功能，将无线与有线进行了无缝集成。AP既允许无线工作站访问网络资源，同时又为有线网络增加了可用资源。本系统所用的无线接入器AP主要是华为的AP4050DN系列。设备外形如图4所示。 图4. 无线接入器AP外形图 3) PLC PLC (Programmable Logic Controller, PLC)即可编程逻辑控制器，本系统所用的PLC是将施耐德PLC内置了Zigbee模组，是种专门为工业环境下应用而设计的数字运算操作电子系统。对施耐德TM系列的PLC做了通信升级，使用2.4 G Mesh做无线通信，在保留PLC现场逻辑的同时，可以远程通过APP控制和查看现场设备。本产品采用AC电源、0.2 μs/布尔量的高速处理器，内置一路RS485通信口。PLC主要是用于连接各类电机、开关、感应器、传感器等，进行数字量、模拟量等信号采集。设备外形图如图5所示。 图5. PLC外形图"
"本系统的软件部分采用Niagara软件进行设计与调试。在Niagara软件平台上，能够对各子系统的设备以及行为进行抽象定义，使其成为既保留了Niagara对象的基本属性，又具有子系统本身的特点的虚拟对象。集成系统通过对子系统的虚拟对象进行编程来完成读写数据和指令操作 [ 7 ] [ 8 ] [ 9 ] 。本文所设计的综合管廊环控系统集成平台主要是对管廊内的环境和设备进行监测，将监测到的信息实时传送给集成平台，以便发生问题时能及时通知工作人员，工作人员就能及时排除故障，保障管廊的正常运行。环境与设备监控系统的子系统主要有温湿度监测与控制系统、排水控制系统和照明系统。  温湿度监测与控制系统的控制策略是先将设定的温度与实际测量的温度通过一定的对比，然后根据对比结果，通过算法对空调机组的水阀进行控制。 在进行温湿度的程序设计时，主要采用PID算法进行控制。设T为实际测量的温度值，Tset为设定温度值，H为实际测量的湿度值，Hset为设定的湿度值。程序设计的基本控制策略为：系统启动并且达到稳定状态后，首先计算机接收来自底层的温湿度传感器采集的数据，然后与程序设定的温湿度值进行比较。当实际温度T > 设定温度Tset时，需要对环境温度进行降温处理，以T-Tset为偏差信号，通过Niagara软件内的LoopPoint模块(LoopPoint模块的属性配置界面如图6所示)，也即PID模块进行PID算法调节，计算出表冷器水阀开度，进而进行温度的调节；当实际湿度H > 设定湿度Hset时，需要对环境湿度进行除湿处理，以H-Hset为偏差信号，通过LoopPoint模块进行PID算法调节，计算出水阀开度，进而进行湿度的调节。根据上述要求，温湿度控制系统的逻辑控制程序如图7所示。 本系统的温湿度控制利用的是PI算法，PI控制的增量型公式为： U ( k ) = U ( k − 1 ) + k p { T 0 T 1 e ( k ) + [ e ( k ) − e ( k − 1 ) ] } (1) 图6. LoopPoint模块属性配置界面 图7. 温湿度控制系统的逻辑控制程序 式中， U ( k ) 表示第 k 次输出的阀门开度； U ( k − 1 ) 表示第 k − 1 次输出的阀门的开度； k p 表示比例系数； T 0 表示采样周期； T 1 表示积分周期； e ( k ) 和 e ( k − 1 ) 分别表示第 k 次和第 k − 1 次采样时，实际温湿度与设定值的偏差，温度的具体取值为，夏季时为T-T set ，冬季时为T set -T，湿度的具体取值为，夏季时为H-H set ，冬季时为H set -H。 式1中，温度控制算法和湿度控制算法中的PI控制参数是不一样的，比例系数 k p 、积分时间 T 1 和采样周期 T 0 的值根据现场调试结果确定。  由于综合管廊内管道维修的放空，以及其他一些可能发生的泄漏等情况，将造成一定程度的沟内积水。根据《城市综合管廊工程技术规范》GB50838-2015 [ 10 ] 的要求，集水井处应设置用于启停泵控制及报警液位测量的水位检测装置；排水区间地势最低处应设置危险水位检测装置。通过排水系统前端的液位传感器监测到的水位情况，启动排水泵，抽取管廊内的积水。 在进行液位控制时，主要也是采用PID控制算法进行液位的控制，具体的逻辑控制程序图如图8所示。设L是实际测量的液位值，Lset是设定的液位值，设定的液位值有高液位和低液位两个设定值。当实际测量的液位值高于高液位值，水泵就会打开；当实际测量的液位低于低液位值，水泵就会关闭。 图8. 液位控制系统逻辑控制程序 在进行液位控制时，因为在实际液位低于低液位和高于高液位时，需要进行报警通知，所以需要在逻辑程序图里的实际液位控制模块即LiquidLevel模块里添加报警通知扩展。添加的报警通知扩展是Out Of Range Alarm Ext，具体的属性配置界面如图9所示。在High Limit选项框里填上高液位报警数值75，在Low Limit选项框里填上低液位报警数值20，在高限值文本里写上报警语句%alarmData.sourceName%>% alarmData.highLimit%!，在低限值文本里写上报警语句%alarmData.sourceName%<%alarmData.lowLimit%!，以此实现报警通知。 图9. Out Of Range Alarm Ext属性配置界面  综合管廊属于狭长型构筑物，又埋在地面下，综合管廊内的采光主要以电力照明为主。因此照明系统尤为重要。 在该系统中，照明控制方式有两种，一种是手动控制方式，一种是自动控制方式。手动控制方式是管廊管理人员自己选择打开或关闭灯光；自动控制方式是由照明系统与红外传感器配合使用，红外传感器检测到有人时，灯光就自动打开。在Niagara软件里，手自动控制方式的切换采用的是Numeric Switch模块，具体属性配置界面如图10所示，根据属性配置界面的In Switch行内的true或者false可以选择是自动控制还是手动控制方式。因为管廊内夜间有时没有工作人员，所以为了避免能源的浪费，设计了一个Boolean Schedule时间表，Boolean Schedule时间表的属性配置界面如图11所示。设定从早上6点到晚上9点，灯光开启，晚上9点到第二天早上6点，管廊内如若没有人，则关闭灯光。该时间表以周为单位设定时间程序，定时关闭灯光照明，以节约能源。根据上述要求，照明系统的逻辑控制程序如图12所示。"
"Niagara软件提供了优秀的图形化界面编辑工具，能够设计出友好的人机界面。本系统的界面设计图如图13所示。 图10. Numeric Switch模块属性配置界面 图11. Boolean Schedule时间表的属性配置界面 图12. 照明系统的逻辑控制程序图 图13. 系统界面设计图 在系统界面设计图中，有控制空调的开关，能够控制空调的启动与停止，还能实时显示温度、湿度、液位和灯光的状态，同时还有控制灯光的开关。界面设计图中还显示了排水控制系统中两个水泵的状态，能够实时显示水泵的工作情况。在系统运行期间，若发生温度、湿度或液位等状态值超过设定值的报警，可以通过红色字体和报警铃声进行提醒。"
"本文重点介绍了基于Niagara软件的管廊环控系统监控平台的设计，Niagara软件平台克服了行业中普遍存在的多种不兼容协议的障碍，允许来自不同制造商的设备在一个自动化系统中无缝地集成在一起。本文确定了系统的总体方案，并且详细描述了该监控系统在Niagara软件平台上的逻辑编程以及系统界面设计。经实验，该系统能够成功运行，从而验证了Niagara软件能够有效的建立楼宇自动化系统。该系统虽然已经能够有效地运行，但仍存在一些不足，例如本系统虽然已经能够实现对管廊内的各种环境参数进行实时监控，但因为管廊内环境比较复杂，参数之间会存在一定的影响，所以在参数监测方面会存在一定的误差。所以需要改进监测和控制方面的算法，以寻求更高的准确度和稳定性。"
