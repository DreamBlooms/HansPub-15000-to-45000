"数据采集单元DAU作为天气雷达的监控单元，在CINRAD/SA雷达调机和维修时故障定位中起到了重要的辅助作用。在新一代天气雷达面临技术升级和双偏振技术开发时，需要为其研制满足功能要求的DAU技术升级电路。文中介绍了基于FPGA作为控制核心的DAU技术方案，该设计不仅实现了原有基础上RDASC与DAU之间通信接口及雷达信号监控的功能，而且拓展了双偏振技术新增的功率监控和控制命令需求。新型的DAU电路板在功能上能够完全兼容替换旧型号的电路板，且新板电路布局和信号走线更加合理，单板性能的加强使得雷达系统的稳定性和可靠性得到进一步提升。新方案的DAU电路已经应用到SA，SB，CA，CB及X波段等多个型号的天气雷达中，通过详细的功能介绍希望能为相关领域的技术人员对雷达日常的使用和维护提供一定的借鉴和参考。 关键词 :DAU，FPGA，状态机，故障定位，可靠性 Copyright © 2018 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"中国新一代天气雷达网计划由216部雷达组成，建设现已接近尾声 [ 1 ] [ 2 ] 。新一代天气雷达在多年的应用中不断优化和改进，雷达的稳定性逐年提高，由雷达网建设初期的无故障运行时间设计标准为平均故障时间(Mean Time Between Failure, MTBF) 300 h，提高到实际统计为MTBF 1000 h以上 [ 3 ] 。我国的新一代天气雷达CINRAD/SA (WSR-98D)来源于美国下一代天气雷达NEXRAD (WSR-88D)的型号技术升级，它继承了美国88D雷达结构和设计理念 [ 4 ] ，同样实现了对台风、龙卷风等重大天气的监控和预警功能 [ 5 ] [ 6 ] [ 7 ] 。随着天气雷达双偏振技术的普及和推广，随着电子科学技术的不断向前发展，电子器件有了突飞猛进的发展，一方面先进的技术可以使雷达探测技术得以提升，另一方面原有一些基于88D设计初期的主流器件处于或濒临停产的现状，这些都促使CINRAD/SA雷达面临必要的技术升级。其中，CINRAD/SA的数据获取单元(Data Acquisition Unit，DAU)是天气雷达监控雷达各分系统状态并实现关键控制功能的一个雷达组件，适用于国内SA、SB、CA、CB、XA等多种型号天气雷达。它提供与维护面板、塔/市电以及发射机的接口 [ 8 ] ，它虽然在雷达整体故障列表里作为监控单元属于故障较低的部分 [ 9 ] [ 10 ] ，但是由于一些器件濒临停产，升级迫在眉睫。DAU以其丰富的雷达状态检测功能和关键命令控制功能，在雷达维修维护中起到重要帮助作用。雷达故障分析定位时，杨传凤等 [ 11 ] 、潘新民等 [ 12 ] 、舒毅等 [ 13 ] 和刘远等 [ 14 ] 都充分利用了DAU的监控优势。在新一代天气雷达主要技术升级和双偏振两个气象行业专项的资助下，DAU链路进行了技术升级和双偏振技术方案的设计。"
"DAU组件位于雷达数据获取(Radar Data Acquisition, RDA)机柜中，是RDA计算机的双向通信链路。其通信接口协议为RS-232，波特率19200，8位数据，奇校验，1个停止位。DAU由DAU底板、DAU数字板、DAU模拟板和下光纤板(个别型号无光纤板)组成。它将监测到的状态信息和数据传给RDA计算机，并将RDA计算机的命令解码后传输给外围设备。其监测的信息，有来自发射机、塔/供电设备、环境传感器及接收机电源等的112个数字信号和48个模拟信号；其发送的主要控制命令，有发射机开高压命令、波导开关转换命令、天线底座操作命令、音频报警命令等 [ 15 ] [ 16 ] 。正是这样数量众多的监测功能和关键命令控制功能，使得DAU处于雷达系统中关键的位置，它的可靠工作是雷达稳定运行的有力保障。DAU升级，增加了双偏振所需的模拟参量检测和控制功能。除此之外，新升级的DAU数字板在实现原理上采用状态机结构的现场可编程门阵列(Field Programmable Gate Array, FPGA)程序设计较旧的可编程阵列逻辑(Programmable Array Logic, PAL)门逻辑电路性能有巨大的提升。  DAU采集数据按类型分成两种，模拟量数据和数字量数据。模拟数据和数字数据是根据天气雷达中的使用需求进行分类的，通过信号分类可是雷达信号监控更加更加便捷化和合理化。如温度、压强、电压等参数须采用模拟信号采集获得；一些关键部件的状态量、故障码等则通过数字电平逻辑的数字状态方式获得。 模拟量数据指的是对模拟信号的采集监测，分别来自温度传感器、电源和RDA等部分的电压和电流形式的模拟信号。这些模拟信号经运算放大器整形进入模数转换器(Analog to Digital Convertor)处理，变成数字信号经过DAU与雷达数据采集状态控制平台(Radar Data Acquisition Status Control, RDASC)接口发送到RDA计算机。该模拟数据由6个8位模拟多路器构成，总计可实现48路模拟量的采集。表1中 Table 1 序号 名称 范围 精度 单位 字节 平台 1 波导加压机压强 0~87 0.87 psi 14 Bislsan双偏振 2 室内温度 0~+50 0.5 ℃ 15 单偏振/双偏振 3 发射机风道温度 −10~+60 0.5 ℃ 17 单偏振/双偏振 4 天线罩温度 −50~+50 0.5 ℃ 18 单偏振/双偏振 5 天线功率1 −0.4~9.6 0.2 mW 31 单偏振/双偏振 6 发射机功率1 −0.4~9.6 0.2 mW 32 单偏振/双偏振 7 发射机功率2 −0.4~9.6 0.2 mW 36 双偏振 8 底座伺服+28 V 0~40.8 0.32 V 37 单偏振/双偏振 9 底座伺服+15 V 0~20 0.16 V 39 单偏振/双偏振 10 底座伺服+5 V 0~6.64 0.05 V 41 单偏振/双偏振 11 信号处理器+5 V 0~6.64 0.05 V 44 单偏振/双偏振 12 天线功率2 −0.4~9.6 0.2 mW 45 双偏振 13 维护面板+28 V 0~37.4 0.29 V 46 单偏振/双偏振 14 维护面板+15 V 0~20 0.16 V 47 单偏振/双偏振 15 维护面板+5 V 0~6.64 0.05 V 48 单偏振/双偏振 16 底座伺服−15 V 0~20 0.16 V 52 单偏振/双偏振 17 维护面板−15 V 0~20 0.16 V 55 单偏振/双偏振 18 DAU测试位0 7~11 2 57 单偏振/双偏振 19 DAU测试位1 118~136 2 58 单偏振/双偏振 20 DAU测试位2 221~252 2 59 单偏振/双偏振 表1. DAU采样监控的模拟量 罗列了除备份信号以外的雷达系统中监测模拟量数据的详细信息，包括信号名称、测量范围、测量精度、单位、在数据中的字节位置以及适用于的单偏振或双偏振雷达平台形式。需要特别注意的是，室内温度传感器、发射机风道传感器使用+28 V供电，天线罩温度传感器使用+15 V供电；3个DAU模拟测试位默认参数值分别为：9，128，236，当超出表1中推荐范围时报警，表征模拟信号数字化后的数据不可信，需要维护。 数字量数据由位(Bit，BIT)数据和离散数据组成。BIT位数据指的是来自发射机的总线格式数据。由DAU发起地址请求，然后发射机将这些数据处理形成后以并行总线方式返回给DAU。DAU发射机接口数据由3线控制产生8个地址，每个地址对应8BIT数据，共计64个BIT量。离散数据指的是对离散状态监控，收集来自继电器、开关和监控电路的报警、状态和故障数据。这些继电器和开关信号分布在整个RDA、塔/供电系统和发射机上。监控电路数据主要以除发射机BIT位以外，包含在发射机功能区域检测的离散状态和故障数据。表2中罗列了除备份和接收机相关电源信号以外的雷达系统监测的数字量数据的详细信息，包括信号名称、在数据中的字节以及比特位置、信号归属以及在DAU数字板上对应的接口芯片。 Table 2 序号 名称 字节 位 芯片 归属 1 发射机接口信号地址 - - U21 发射机接口信号 2 发射机接口数据 0~7 0~7 U2/U4/U7 发射机接口信号 3 发射机高压关 8 1 U12/U24 发射机离散信号 4 发射机故障循环 8 2 U12/U24 发射机离散信号 5 发射机不可操作 8 3 U12/U24 发射机离散信号 6 COHO时钟故障 8 4 U12/U24 发射机离散信号 7 DAU通信故障 8 5 U24 DAU通信信号 8 波导加压机状态 8 6 U24 塔/供电和接收机信号 9 空调1压缩机关 9 0 U14 塔/供电和接收机信号 10 空调2压缩机关 9 1 U14 塔/供电和接收机信号 11 发电机维护请求 9 2 U14 塔/供电和接收机信号 12 电池电压低 9 4 U14 塔/供电和接收机信号 13 发电机故障 9 5 U14 塔/供电和接收机信号 14 发电机开关非自动 10 0 U15 塔/供电和接收机信号 15 发电机电压频率有效 10 1 U15 塔/供电和接收机信号 16 航顶灯故障 10 2 U15 塔/供电和接收机信号 17 机柜门检测系统故障 10 3 U15 塔/供电和接收机信号 18 发电机罩起火/冒烟 11 0 U18 塔/供电和接收机信号 19 发电机罩检测故障 11 1 U18 塔/供电和接收机信号 20 市电电压频率有效 11 2 U18 塔/供电和接收机信号 21 安防未授权进入报警 12 0 U22 塔/供电和接收机信号 22 安防设备故障 12 1 U22 塔/供电和接收机信号 23 安防关闭 12 2 U22 塔/供电和接收机信号 24 天线罩门开 12 7 U22 塔/供电和接收机信号 25 空调1滤网脏 13 0 U26 塔/供电和接收机信号 26 空调2滤网脏 13 1 U26 塔/供电和接收机信号 27 发射机滤网脏 13 2 U26 塔/供电和接收机信号 表2. DAU采样监控的数字量  表3是目前国内CINRAD/SA等型号天气雷达系统使用中的RDASC/DAU控制命令。DAU组件中的DAU数字板接收RDA计算机软件RDASC发出的控制命令。其中，RDASC/DAU控制命令分为两种类型：5字节的命令，由1个字头和4个字节组成；1字节的命令，仅有字头。其控制命令的详细构成如表3。该表中的字头和字节均以十六进制表示，其中状态请求命令和复位命令以1字头字节的方式发送；其余命令以5字节的方式发送。 值得注意的是“0x06”字头的命令，可以单独发送，也可以叠加发送——在相应的字节上采用或的逻辑叠加。例如波导开关和发射机开高压命令叠加发送的命令序列为“0x06，0x01，0xC1，0x01，0x01”，其中第2个命令字节“0xC1”是“0x81”和“0x41”按位取或构成。另外，执行波导命令时，要求天线罩门必须是关闭状态。这样的控制策略是为了防止天线罩门打开时有人进入发生意外。"
"DAU技术升级主要是对DAU数字板和DAU模拟板的升级，并实现DAU相关的双偏振监控需求。  DAU数字、模拟板的升级要完全兼容现有CINRAD/SA雷达系统的信号接口和RDASC软件的控制接口。数字、模拟板的单板设计须采用向下完全兼容的方案，不仅要支持现有的数据格式和控制策略实现单板的无缝隙替换，还要支持雷达升级、双偏振扩展的测量和控制相关需求。此外，为了保障新旧版本的顺利更迭，新升级的电路可用性和可靠性不能低于现有的电路。  图1为DAU升级设计的原理功能框图。新的DAU模拟板主要实现运算放大器对模拟信号的电平转换，符合采样要求的模拟信号分时复用ADC完成采样功能。其功能较为单一，而且多路器和ADC的时序受控于DAU数字板。新的DAU数字板设计采用FPGA为实现平台，它与RDA计算机采用RS-232标准电气接口。DAU数字板上的FPGA作为控制核心，要控制板内的异步通信(Universal Asynchronous Receiver/Transmitter, UART)芯片HD1-6402完成串口数据的收发工作；要控制模拟板上的多路器分时复用ADC；要控制模拟板上的ADC完成采样；要控制板内的各路信号的采集；还要实现对RADSC下发控制命令的解码并传达给执行单元。 Table 3 命令名称 字头 字节0 字节1 字节2 字节3 状态请求 0x02 复位命令 0x03 音频报警开 0x03 0x01 0x21 0x81 0x01 音频报警关 0x03 0x01 0x01 0x01 0x01 天线底座操作 0x06 0x01 0x01 0x09 0x01 波导开关 0x06 0x01 0x81 0x01 0x01 波导开关2 0x06 0x01 0x01 0x21 0x01 发射机开高压 0x06 0x01 0x41 0x01 0x01 命令关闭 0x06 0x01 0x01 0x01 0x01 表3. RDASC/DAU控制命令 图1. DAU功能框图  图2是DAU数字板FPGA程序控制的流程图。FPGA首先通过控制UART芯片将收到的串口数据进行解码，按照表3中数据字头定义进行解码——只提取以0x02、0x03、0x06为字头的命令数据。然后按状态请求命令和控制功能命令进行程序分流。分流后的控制命令，如果数据符合表3定义则传达控制命令，并通过电气接口进行执行；如果数据不符合表3定义则重新进入接收数据的解码模块等待新的命令。分流后的状态请求命令，则按RDASC/DAU接口中定义的数据顺序执行模拟信号采样和数字信号收集，将获取到的数据通过UART发送，即收即发，不缓存数据。  正常情况下RDASC以2 s的时间间隔向DAU发送状态请求数据，命令数据不定时发送。DAU数字板的FPGA内设置一超时计数器来判定串口通信是否正常。当超过9 s时，没有接收到来自RDASC的任意命令，内部计数器产生一个超时信号，该信号会驱动RDA维护面板上的报警灯亮起以示通讯超时。当RDASC与DAU通信超时失败时，暂停门联锁使发射机、波导开关和天线底座伺服停止工作，以免系统不受控对雷达起到保护作用。  天气雷达的双偏振技术指在原有发射水平极化电磁波的基础上，再新增垂直极化的电磁波发射。因此双偏振发射机发射两路电磁波时，需要新增一路垂直极化的波导，通过RDASC/DAU接口实现表3 图2. FPGA程序控制流程图 新增的波导开关2命令来实现控制。另外，DAU需要新增对垂直极化的发射机功率和天线功率模拟信号检测。新增的两路功率检测传感器信号从DAU链路模拟板接入采样，分别排在表1中RDASC数据序列中的第36和45字节，从而实现偏振功率参数的监控。  旧的DAU模拟、数字板全部采用直插的阻容和芯片，单个元器件在电路板中占用的面积较大，最终导致电路板的布局和布线较为困难，均采用8层印刷电路板(Printed Circuit Board, PCB)板实现。新的DAU模拟、数字板根据PCB底部的信号接口位置，按芯片的功能进行区域优化达到芯片的合理布局，均以4个PCB板层实现了板图设计。另外，DAU数字板采用1片FPGA实现了原有10片PAL芯片的功能，选用体积较小的贴片的阻容元件，实现了元器件的集约化。器件布局合理后，对信号的布线设计起到积极的推动作用。单个信号层上实现了信号平行走线，多个信号层之间实现了信号垂直走线。这样的信号走线形式降低了信号间的干扰，实现了优良的电磁兼容性。"
"目前，新升级的DAU模拟、数字板已经在全国SA、SB、CA、CB及X波段等多个单双偏振天气雷达型号上成功应用。新的电路板，稳定性和可靠性较旧型号由大幅度提升。特别是数字板，采用FPGA控制程序状态机稳定，程序加载后在芯片内部由门逻辑和寄存器组成，不会产生由堆栈溢出或程序跑飞造成死机的问题；单片FPGA替代了原来10片可编程芯片的方案设计，解决了原来方案中由于单片可编程芯片故障造成联锁导致其他可编程芯片不能正常工作的现象，对提升天气雷达系统的可靠性做出了监控部分应有的贡献。"
"需求牵引，技术进步，产生了具有国际先进水平的业务使用多普勒天气雷达。优化改进后的DAU模拟、数字板器件布局和信号走线较原电路更加合理，并且通过批量生产和自2011年以后汛期新旧电路板应用和维修数据统计分析，新的电路板具有成本更低，可靠性更高的特点。在当前电子技术的迅猛发展的趋势下，芯片设计能力和制造工艺的大幅度提升，贴片芯片较直插芯片的功耗更低和可靠性更高的特点使其成为当前主流趋势。在后续持续的改进中，有以下升级优化方案： 1) 采用功能、性能和稳定性更高的贴片芯片设计，降低功耗、增强可靠性； 2) 将数字板UART串口通信功能写入FPGA中，设计更加集约化； 3) 统计使用中受损率较高的元件，加强电磁兼容设计。如DAU发射机接口差分信号采用带瞬态二极管作为保护电路，可实现±4000 V的信号保护能力，有效降低改善来自发射机端的电磁兼容问题，增强接口的可靠性。"
