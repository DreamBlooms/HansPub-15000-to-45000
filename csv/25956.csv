"基于最小二乘原理，本文研究了点云三维坐标转换的模型及其迭代解法，介绍了一种不求旋转角度而将旋转矩阵的元素作为未知参数进行求解的方法，将原本的七参数模型转换成十三参数模型，介绍了求解参数的模型和解法。弥补了传统七参数法在面对大旋转角时的不足，该方法能够解决任意旋转角的三维坐标转换。 关键词 :点云，最小二乘，三维坐标转换 Copyright © 2018 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"三维激光扫描技术是近十几年迅速发展起来的一项三维数据获取的新兴技术。它可以通过对研究对象数字化，得到大量点的三维坐标集合，称为点云数据。 点云配准实质是将扫描采样获得的不同扫描坐标系下的两组包含重复区域的点云数据，通过确定公共点之间的坐标变换参数转换至统一坐标系。 郑二龙等提出一种非迭代的求解七参数的方法，首先根据奇异值分解求出坐标转换矩阵，再根据最小二乘法，求解出3个平移参数和一个尺度参数 [ 1 ] 。曾文宪等提出了一种适用于任意旋转角的非线性模型 [ 2 ] 。陈义等提出以方向余弦为参数，构造旋转矩阵，然后对矩阵线性化，利用最小二乘迭代法，求解出转换参数 [ 3 ] 。 传统的七参数方法在用于旋转角很小的情况时，会忽略一些互乘项，旋转矩阵的元素由正弦函数和余弦函数组成，在面对小旋转角时会将正弦相似为0，余弦相似为1，相应的尺度参数和该部分互乘项之间的关系也被忽略，在面对大角度旋转角时，由于这些近似，求解的参数估值会产生偏差，甚至会导致失真。因此本文我们采用十三参数的模型，采取不求旋转角，求旋转矩阵的方法，将旋转矩阵的九个元素当作未知参数进行求解，可以解决任意旋转角的坐标转换。"
"最小二乘原理及其最优化准则是求解参数最优估值过程中最常用的函数模型，最小二乘的函数模型和随机模型归纳为 [ 4 ] ： 函数模型为： B X = L + d (1) 随机模型： { E ( d ) = 0 D = σ 0 2 ∗ Q = σ 0 2 ∗ P − 1 (2) 式中，B为系数矩阵，X为待估的参数向量，L为实际观测向量，d为随机观测误差。D为d的协方差阵，Q为协因数阵，p为观测值权阵。 σ 0 为单位权中误差。平差时，一般对参数X都取近似值 X 0 ，令 X = X 0 + x (3) 带入上式并令 l = L − ( B X 0 + d ) = L − L 0 (4) 上式中， L 0 = B X 0 + d 为观测方程的近似值，所以l是观测值与其近似值之差，由此可得误差方程为： V = B x − l (5) 由最大似然估计求得的最小二乘最优平差准则为： V T P V = min (6) 在该准则下，针对不同的问题，可以构建不同的平差方法。间接平差方法就是在该平差准则要求下常用的求解待定参数的方法。按照最小二乘原理，满足上式平差准则的要求。按照数学上求函数自由极值的方法可得间接平差的解法，可导出求解公式为： X = ( B T P B ) − 1 B T P B (7)"
"最小二乘(LS)是求解非线性方程的组的数学解法，在求解三维坐标转换参数中，将观测向量作为待估参数，三维坐标转换模型可描述为 [ 4 ] ： C 1 = C 2 μ R ( ε ) + I n [ Δ X   Δ Y   Δ Z ] (8) 式中，n表示两点集中公共点个数， I n 表示 n × 1 的元素为1的向量； C 1 , C 2 分别为源数据坐标系和目标数据坐标系下的公共点坐标； R ( ε ) 为旋转矩阵。旋转矩阵为正交矩阵，应满足正交矩阵的条件 R T R = R R T = E 。 旋转矩阵 R ( ε ) 为 R ( ε X ) R ( ε Y ) R ( ε Z ) 的乘积，其中 R ( ε X ) , R ( ε Y ) , R ( ε Z ) 分别为： R ( ε X ) = [ 1 0 0 0 cos ( ε X ) sin ( ε X ) 0 − sin ( ε X ) cos ( ε X ) ] R ( ε y ) = [ cos ( ε Y ) 0 − sin ( ε Y ) 0 1 0 sin ( ε Y ) 0 cos ( ε Y ) ] R ( ε Z ) = [ cos ( ε z ) sin ( ε z ) 0 − sin ( ε z ) cos ( ε z ) 0 0 0 1 ] R ( ε ) = [ cos ( ε Y ) cos ( ε Z ) cos ( ε X ) sin ( ε Z ) + sin ( ε X ) sin ( ε Y ) cos ( ε Z ) sin ( ε X ) sin ( ε Z ) − sin ( ε X ) sin ( ε Y ) cos ( ε Z ) − cos ( ε Y ) sin ( ε Z ) cos ( ε X ) cos ( ε Z ) + sin ( ε X ) sin ( ε Y ) sin ( ε Z ) sin ( ε X ) cos ( ε Z ) − sin ( ε X ) sin ( ε Y ) sin ( ε Z ) sin ( ε Y ) − sin ( ε X ) cos ( ε Y ) cos ( ε X ) cos ( ε Y ) ] 在三维坐标转换模型中，七参数法是应用最广泛的。所谓七参数包括一个比例参数、坐标原点的三个平移参数以及三坐标轴旋转的三个角度值。七参数的坐标转换模型为： [ X Y Z ] = [ Δ x Δ y Δ z ] + ( 1 + k ) ∗ R ( ε Z ) R ( ε Y ) R ( ε X ) [ x y z ] (9) 当两个三维坐标系中，有三个或三个以上的同名点时，即可运用七参数法进行求解。但是七参数法在欧拉旋转角较小的情况下，不但进行了近似，而且还忽略了一些互乘项，近似化程度过高模型容易失真。在三维配准过程中，为实现任意角度的三维坐标配准，有人提出了在不求欧拉旋转角的情况下，求旋转矩阵 R ( ε ) 的方法，即把旋转矩阵的9个元素当作未知数进行求解。 即可得： R = R ( ε X ) R ( ε Y ) R ( ε Z ) = [ a 11 a 12 a 13 a 21 a 22 a 23 a 31 a 32 a 33 ] 此时未知参数为 Δ x , Δ y , Δ z , K , a 11 , a 12 , a 13 , a 21 , a 22 , a 23 , a 13 , a 32 , a 33 十三个参数。 对式(9)用Taylor级数展开将非线性七参数模型进行线性化。在参数初值 Δ x 0 , Δ y 0 , Δ z 0 , k 0 , ε x 0 , ε y 0 , ε z 0 ，根据(9)，令 K = k + 1 得： [ X Y Z ] = [ Δ x 0 Δ y 0 Δ z 0 ] + K 0 ∗ R 0 [ x y z ] + [ d x 0 d y 0 d z 0 ] + R 0 [ x y z ] d K + K 0 * d R [ x y z ] (10) 式中， d Δ x 0 , d Δ y 0 , d Δ z 0 为平移参数改正数， d K 为尺度参数改正数， d R 为旋转矩阵的微分。当两数据点集中，有足够的对应控制点时(三个或者三个以上)，根据式(10)就可构造三维坐标转换模型，并结合一定平差方法和最优准则进行求解计算得到参数的最佳估值。"
"上面介绍了基于最小二乘的三维坐标转换模型的建立，下面将推导该模型的解法。三维坐标转换的公式为 [ 5 ] ： [ X Y Z ] i = [ Δ x Δ y Δ z ] + K ∗ R [ x y z ] i (11) 式中， [ x y z ] i 为原坐标系下的坐标， [ X Y Z ] i 为目标坐标系下的坐标， [ Δ x Δ y Δ z ] 为平移参数，K为式(9)中k+1，R为旋转矩阵。 R = R ( ε X ) R ( ε Y ) R ( ε Z ) = [ a 11 a 12 a 13 a 21 a 22 a 23 a 31 a 32 a 33 ] 旋转矩阵为正交矩阵，应满足正交矩阵的条件 R T R = R R T = E ，则旋转矩阵的九个元素满足下面的非线性条件： { a 11 2 + a 12 2 + a 13 2 = 1 a 21 2 + a 22 2 + a 23 2 = 1 a 31 2 + a 32 2 + a 33 2 = 1 a 11 a 12 + a 21 a 22 + a 31 a 32 = 0 a 11 a 13 + a 21 a 23 + a 31 a 33 = 0 a 12 a 13 + a 22 a 23 + a 32 a 33 = 0 (12) 从而，R矩阵中仅有三个独立参数，其他6个参数可以通过正交条件用三个独立参数表示。 在以往空间坐标系转换中，若有三个以上的公共控制点，应用最小二乘原理解算式(11)便可得到三个平移参数、三个旋转参数、一个尺度参数。但由于旋转矩阵中仅有三个独立参数，而其余六个是非线性函数，因此直接解算式(11)非常麻烦。因此将1个尺度参数、3个平移参数、9个方向余弦参数共13个参数设为位置参数。将式(11)用Taylor展开得： [ X Y Z ] = [ Δ x 0 Δ y 0 Δ z 0 ] + K 0 * R 0 [ x y z ] + E 3 × 3 [ d x 0 d y 0 d z 0 ] + M 3 × 1 d K + N 3 × 9 d R (13) 其中： R 0 = [ a 11 0 a 12 0 a 13 0 a 21 0 a 22 0 a 23 0 a 31 0 a 32 0 a 33 0 ] E = [ 1 0 0 0 1 0 0 0 1 ] M = [ a 11 0 x i + a 12 0 y i + a 13 0 z i a 21 0 x i + a 22 0 y i + a 23 0 z i a 31 0 x i + a 32 0 y i + a 33 0 z i ] N = [ K 0 x i K 0 y i K 0 z i 0 0 0 0 0 0 0 0 0 K 0 x i K 0 y i K 0 z i 0 0 0 0 0 0 0 0 0 K 0 x i K 0 y i K 0 x z i ] 则可以列出误差方程 V = ( E M N ) [ d Δ x 0 d Δ y 0 d Δ z 0 d K d R ] − L (14) 式中： L = ( Δ x 0 Δ y 0 Δ z 0 ) + K 0 R 0 ( x y z ) i − ( X Y Z ) i (15) 则可以表示成间接平差的形式： V = B x − L (16) 式中， B = ( E M N ) ； x = ( d Δ x 0 d Δ y 0 d Δ z 0 d K d R ) T 。 接着对6个正交约束条件进行线性化，并写为标准形式为： C x + W x = 0 (17) 式中： C = [ 0 0 0 0 2 a 11 0 2 a 12 0 2 a 13 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 a 21 0 2 a 22 0 2 a 23 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 a 31 0 2 a 32 0 2 a 33 0 0 0 0 0 a 21 0 a 11 0 0 a 22 0 a 21 0 0 a 32 0 a 31 0 0 0 0 0 0 a 13 0 0 a 11 0 a 23 0 0 a 21 0 a 33 0 0 a 31 0 0 0 0 0 0 a 13 0 a 12 0 0 a 23 0 2 a 22 0 0 a 23 0 a 32 0 ] W x = ( a 11 0 + a 12 0 + a 13 0 − 1 a 21 0 + a 22 0 + a 23 0 − 1 a 31 0 + a 32 0 + a 33 0 − 1 a 11 0 a 12 0 + a 21 0 a 22 0 + a 31 0 a 32 0 a 11 0 a 13 0 + a 21 0 a 23 0 + a 31 0 a 33 0 a 12 0 a 13 0 + a 22 0 a 23 0 + a 32 0 a 33 0 ) 附有限制条件的间接平差的数学模型为： V n , 1 = B n , u x ^ u , 1 − l n , 1 (18) C s , u x ^ u , 1 + W x s , 1 = 0 (19) D = σ 0 2 Q = σ 0 2 P − 1 法方程为： N b b x ^ + C T K s − W = 0 (20) 式中， N b b = B T P B ； W = B T P L ； K s = N c c − 1 ( C N B B − 1 W + W x ) ； 则得到其解为： x = ( N B B − 1 − N B B − 1 C T N c c − 1 C N B B − 1 ) W − N B B − 1 C T N c c − 1 W x (21) 应用本方法进行坐标转换，可按以下步骤实现： 1) 近似值的确定。一般情况下，取 K 0 = 1 , [ Δ x 0 Δ y 0 Δ z 0 ] = [ 0 0 0 ] , R 0 = [ 1 0 0 0 1 0 0 0 1 ] 2) 按式(16)组成误差方程，若有n个点，则可有3n个误差方程； 3) 按式(17)组成约束条件方程。 4) 根据附有限制性条件的间接平差来求解参数的最新值，此时需要注意的是矩阵B的条件数非常大，在求逆时需要使用广义逆矩阵的方法求 N b b 。 5) 迭代的终止条件是上一次计算出来的参数与本次计算得到的参数之间的差值的绝对值小于10 -6 。根据参数的大小判断是否满足收敛要求，重复步骤2~4，直到满足收敛要求。"
"为验证附上述两节中三维坐标转换的模型和解法的可行性。本文结合MATLAB程序语言，利用三维激光扫描仪在常州地铁扫描的数据中的两站点云数据来演示点云坐标的配准过程： 1) 利用上述方法根据标靶球的坐标来求解转换参数。 转换参数结果如下： R = ( 1 7.3651 0.8680 − 7.3651 1 0 − 0.8680 0.960 1 ) Table 1 序 号 源数据点 目标数据点 x y z X Y Z 1 2.107484 12.212549 −101.853825 −0.242471 −9.304229 −101.208775 2 −0.049283 10.694711 −101.382187 −2.282473 −10.978848 −100.737045 3 0.454784 9.404896 −101.723618 −1.681765 −12.227415 −101.079466 4 1.063523 11.735919 −101.825103 −1.248179 −9.857202 −101.180641 5 2.555473 9.67305 −101.614822 0.393676 −11.80323 −100.969852 表1. 1、2测站标靶球坐标 图1. 未配准点云图 图2. 配准完的两站点云 T = ( − 0.0004 − 0.0276 − 0.0032 ) K = 1 2) 利用上述求得的转换参数对两站的点云数据进行配准。源数据点和目标数据点坐标如表1所示，未配准点云如图1所示，配准完点云如图2所示。"
"在配准过程中，常用的七参数模型在面对小旋转角时会进行相似以及忽略一些互乘项，因此当旋转角为大旋转角时便会由于近似化程度过高使程序失真。本文采取在不求欧拉旋转角的情况下，求旋转矩阵的方法，即把旋转矩阵的9个元素当作未知数进行求解的十三参数的方法，该方法适用于求解任意旋转角的三维坐标转换，大大提高了该方法的适用性。"
