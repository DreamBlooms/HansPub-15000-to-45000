"本文主要介绍了防电击保护自动检测装置的组成，搭建的测试系统采用意法半导体STM32系列的微处理芯片作为峰值断电模块的主要部件，运用采样积分的方式自动进行剩余电压的计算。此装置能够自动进行频率识别，并对宽频率范围的交流电压进行断电及剩余能量测试。电子电气设备在峰值断电后的能量测试，能够及时了解设备断电后的剩余能量情况，防止对操作人员产生电击危险，同时为检测机构开展产品检测工作及企业研发产品提供技术支撑及技术参考。 关键词 :防电击保护，自动检测，剩余能量 Copyright © 2017 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"目前防电击保护检测装置有结合示波器使用的峰值断电装置，能够对用电设备进行断电操作，但仅限于频率50 Hz及60 Hz，而且要先判断用电设备供电频率，手动选择频率点，再进行峰值断电，具有一定的限制 [ 1 ] 。现实中很多电子电气产品供电频率是一个范围50~60 Hz，且需要对剩余能量进行计算。本文研究的防电击保护自动检测装置能够对宽频率范围进行检测，在峰值处断电后进行能量积分计算，最后通过显示屏显示出来。"
"目前的安全标准对于峰值断电后剩余电压进行严格的规定，信息技术安全标准GB 4943.1-2011中规定A型可插式设备在电网电源断接处，放电时间常数不应超过1 s，B型可插式设备在电网电源断接处，放电时间常数不应超过10 s。音视频安全标准GB 8898-2011中规定用电源插头与电网电源连接的设备，在拔出插头后2 s，插头不得危险带电，电压不能超过交流35 V或直流60 V。家用电器安全标准GB 4706.1-2005中规定通过一个插头来与电源连接的器具，在电压峰值时从电源断开，断开后的1 s时，测量插头各插脚的电压不应超过34 V。医疗设备安全标准GB 9706.1-2007中规定，用插头与供电网连接的设备，在断开电源后1 s时，各电源插脚间及电源插脚与外壳间电压不应超过60 V，若电压超过此值，剩余能量不应超过2 mJ [ 2 ] 。"
"防电击保护自动检测装置主要包含频率测量、峰值断电、能量测试及显示模块四个部分。频率测量模块对供电电源的频率进行测量，之后交给峰值断电模块在交流电压达到峰值后通知继电器断电。采用测试电路对剩余电压进行能量测试，最后通过显示模块显示出来。 总体设计框图如下图1所示。  频率测量模块采用多周期与量化延迟相结合的测量方法，测频系统如图2所示。整个测频电路由一个1 s时序模块(由F0分频产生，外部输入晶振进行分频，外部时钟晶振为10 MHz，分频出1 s时钟信号)，三个计数控制模块，两个16位计数器，两个间隔计数器(并行)和通信控制模块组成，四个计数器的 图1. 自动检测装置设计框图 图2. 测频系统框图 计数值通过通信控制模块送入微处理器(STM32)进行计算处理。CLK = 100 MHz，S1，S2，S3为计数值选通控制，ED为读数控制位，计数能达到小数点后面的一位数字，使测量精度进一步提高，测量分辨率达到了0.1 Hz。 多周期测量消除了被测信号的±1字误差，但在闸门时间内存在标准信号的±1计数误差，而量化延时短时间间隔测量法可以通过延时单元较准确的测量出短时间，因此利用多周期同步与量化延时相结合的频率测量方法可以使频率测量的精度大大提高。  通过频率测量电路计算供电电源的频率，为FxHz，那么从过零点计时间，应每隔1000 ms/FxHz * 0.25出现电压峰值，通过控制电路通知继电器断开电源，之后采样电路模块进行电压采样。峰值断电流程图如图3所示。  设备在峰值断电后的曲线是不规整的曲线，通过采样电路对电压进行采样，横坐标为时间，纵坐标为电压值，放电曲线也比较陡，剩余能量即为实际放电曲线与横纵坐标所形成的面积，采用积分的方法求面积，通过信号采集模块一组电压值，采样时间为1 s，测量无感电阻两端的电压，根据积分公式计算剩余能量，最后通过显示屏显示出来。 STM32采集电压值，定时器为1 s，通过判断定时器是否为高电平来控制采样，当定时器为1 s时停止采样，开始计算剩余能量值。采样时间设定越短越精确。能量测试流程图如下图4所示。积分计算公式如式1所示 [ 3 ] 。 E = U 1 2 R Δ T + U 2 2 R Δ T + U 3 2 R Δ T + ⋯ U n 2 R Δ T (1)  显示模块采用4.3寸液晶面板，典型供电电压为3.3 Vdc，宽高比16:9，点间距为0.066 * 0.198 mm，像素间距为0.198 * 0.198 mm，可视区域为100.8 * 58.71 mm，满足显示模块的使用要求。流程图如图5所示。 液晶屏采用ILI9320控制器，控制器初始化主要包括管脚定义、开内部振荡器、清屏、行列地址及垂直和水平RAM地址位置等。所有的数据存在GRAM中，有效降低数据传输的工作 [ 4 ] [ 5 ] 。 图3. 峰值断电软件流程图 图4. 能量测试软件流程图  STM32微处理器通过两个引脚，即WR/PC7：向TFTLCD写入数据；RD/PC6：从TFTLCD读取数据。RST为硬复位TFTLCD信号线，直接接到STM32的复位脚上。控制器自带显存，其显存总大小为172820 (240 * 320 * 18/8)，即18位模式(26万色)下的显存量，模块的16位数据线与显存的对应关系为565方式。ILI9320的R3 (入口模式命令)、R7 (显示控制命令)、R32和R33 (设置GRAM的行地址和列地址)是四条最基本的引线，接入芯片STM32，就可以实现ILI9320与STM32的通信。 整个系统采用软件编程与硬件电路结合的方式实现防电击保护自动检测，STM32微处理器能够实现12位精度的模数转换，最快转换速度为1 μs，用DMA方式传输数据，提高了系统的工作效率。"
"通过示波器分别测试了音视频、信息技术设备及家用电器设备的几个典型产品，峰值断电后波形如图6、图7、图8所示。 图5. 液晶显示模块流程图 图6. 峰值断电波形图(电视机) 图7. 峰值断电波形图(计算机) 图8. 峰值断电波形图(洗衣机) Table 1 序号 产品类别 能量值(mJ) 1 电视机 0.35 2 计算机 0.42 3 洗衣机 0.28 表1. 不同产品剩余能量计算值 从图中可以看出，被测设备在峰值断电后，电压非线性下降，根据积分采样电压公式1，式中ΔT取50 μs，R取2 kΩ，计算剩余能量值，整个取样时间为1 s，计算结果如表1所示。"
"现有的研究有峰值断电及能量测试的剩余电压装置能够实现在固定的频率上进行峰值断电，峰值检测示波器仅能够进行峰值断电后图像显示，都存在一定的局限性 [ 5 ] 。本次设计的防电击保护自动检测装置能够实现宽频率范围检测，峰值断电，能量积分与结果显示。家用电子电器设备以及医疗设备在断电后，插头部分会潜在电击危险，通过防电击保护自动测试装置实验后，能准确判断出剩余能量情况。 此装置的难点在于峰值断电部分，频率测量模块测量出供电电源的频率值，在经过定时器定时，通知继电器断电。该套装置采用了STM32系列的微处理芯片作为控制电路的主要部件，结合电压采用、数据处理等技术，研发出防电击保护的测试装置，性能稳定，操作简单。准确地检测电子电气及医疗设备的剩余电压和能量值对于检测机构及企业具有十分重要的意义。"
