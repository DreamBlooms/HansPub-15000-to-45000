"低照度环境下拍摄的图像往往会出现细节模糊不清的情况，传统的Retinex算法可以有效提高图像质量，然而当图像亮度整体较低时可能会出现过增强现象。为了改善低照度环境下拍摄图像的质量，本文提出了一种基于HSI颜色空间的改进的多尺度Retinex图像增强算法，采用引导图像滤波消除应用Retinex算法所产生的“光晕伪影”现象，并利用原图像的亮度信息对多尺度Retinex算法增强后的图像进行了亮度重构，有效地抑制了过增强等失真现象，进一步提高了图像增强质量。实验结果表明，本文算法与传统的多尺度Retinex算法相比在低照度图像亮度增强、对比度增强和图像细节信息保护方面具有更好的表现效果。 关键词 :低照度，Retinex，引导滤波，亮度重构"
"在低照度环境下拍摄的图像由于光线条件和照度不均匀的影响，经常会存在图像细节模糊不清的状况，使人难以分辨感兴趣区域，对图像的存储价值以及图像的进一步处理都带来了负面的影响。在某些专业的图像应用领域，如智能监控、图像检索 [ 1 ] 、信息鉴定等，有效增强低照度图像质量具有重要的意义。 目前常用的图像亮度增强算法有基于直方图均衡化的全局图像增强算法 [ 2 ] 、基于取反的图像增强算法、基于Retinex理论的图像增强算法 [ 3 ] 等。其中基于Retinex理论的图像增强算法对于亮度比较复杂的图像具有较好的增强效果，因而受到了研究者的广泛关注。Retinex理论是Land在20世纪70年代提出的，该理论提出之后，许多研究者对其进行了深入的研究，提出了很多改进算法 [ 4 ] ，如随机路径Retinex算法 [ 5 ] 、基于中心/环绕的Retinex算法 [ 6 ] 等。其中基于中心/环绕的Retinex算法指出：当前像素点的亮度可由其周围环绕像素点的亮度来进行估计，环绕像素的权重取决于所选择的环绕函数。在研究过程中，学者们提出使用高斯函数、指数函数等作为环绕函数，并论证了使用高斯环绕函数的合理性，先后提出了单尺度Retinex算法(single scale Retinex, SSR) [ 7 ] [ 8 ] 和多尺度Retinex算法(multi-scale Retinex, MSR) [ 9 ] 。MSR算法是多个SSR算法处理结果的融合，图像增强质量相对于SSR算法有一定的提高，然而MSR算法是在RGB颜色空间中对各颜色通道直接进行处理，这样往往会造成各通道增强幅度不一致从而引起失真现象；同时对于亮度普遍较低的低照度图像，使用MSR算法进行增强后，经常出现对比度减弱、图像细节模糊、过增强等现象，严重影响了增强图像质量。 针对MSR算法存在的上述问题，本文提出一种基于HSI空间的改进的多尺度Retinex算法。该算法先将原图像从RGB转换至HSI空间，然后在MSR算法中使用引导滤波 [ 10 ] 代替高斯滤波作为环绕函数进行照度估计，最后利用原图像的亮度信息对增强后的图像进行亮度重构，重构后的图像经过空间反变换得到目标图像。"
"在Retinex模型中，图像 是由场景中物体的反射亮度和光照亮度两部分组成的，也称之为反射图像和亮度图像，分别用 和 表示。Retinex图像增强的思想就是从原图像中剔除环境亮度的影响，求解出物体本身的颜色特性，从而实现图像增强的目的。在SSR算法中，亮度图像是平滑的， 用来表示高斯卷积函数，则有： (1) (2) 其中，高斯卷积函数可表示为： (2) 其中 由归一化函数决定： (4) 在式(3)中， 代表尺度参数，即高斯模版的半径，它的大小会直接影响图像的增强效果。 SSR算法控制使用单一的尺度参数来进行图像增强，因而图像的增强效果受所选择的尺度参数影响；利用SSR算法增强图像时，往往不能使图像的局部细节信息、色彩保真性能及动态压缩范围等特性达到一个比较好的综合视觉效果。因此，在研究过程中人们又提出了MSR算法。相对于SSR算法，MSR算法引入了多个不同的SSR算法，然后通过带权重求和的方式将经过SSR算法处理的结果融合起来，得到最终的增强图像。 MSR算法的计算公式如下： (5) 式中， 表示MSR算法中所选择的尺度个数，通常情况下 取值为3； 在这里代表权重， ； 表示所选择的环绕函数， 和单尺度中表示的意义相同。在MSR算法中，不同的SSR算法一般选择不同的尺度参数。"
"MSR算法可以实现图像的动态范围压缩,同时较好地保证了图像的色感一致性。MSR算法实质上是在对数空间用原图像减去高斯函数与原图像的卷积的值，图像被减去了平滑的部分，剩下了图像中变化较快的部分，从而突出了图像的细节信息，实现了图像增强的目的。然而对于低照度图像，使用MSR算法进行增强后，虽然能够突出图像的细节信息，但是增强后的图像往往对比度减弱，颜色与原图偏移较大甚至出现过增强等失真现象，因此有必要对该算法进行改进。 针对MSR算法在处理低照度图像时存在的上述缺陷，本文提出了一种基于HSI空间的改进的MSR算法。该算法先将原图像从RGB转换至HSI颜色空间，在HSI颜色空间对亮度分量单独进行处理；为了缓解采用Retinex算法可能产生的“光晕伪影”现象，同时使增强后的图像具有更多的边缘细节信息，本文算法选择使用引导滤波作为MSR算法的环绕函数来进行照度估计；针对MSR算法在低照度图像增强时可能产生过增强等失真现象的问题，本文算法提出使用亮度重构的方法来进行亮度调整；最后将经过亮度重构的图像由HSI空间转换至RGB空间进行显示。  传统的MSR算法对R、G、B三个颜色通道图像分别进行增强，然后将增强后的结果合成图像。增强前三原色间存在一定的比例关系，增强后这种比例关系被破坏，即RGB色彩空间三原色间强烈的相关性影响了处理结果的色彩重现，从而产生了色彩失真，影响了图像的增强效果。 HSI颜色空间反映了人的视觉系统感知色彩的方式，以色调(H)、饱和度(S)和强度(I)三种基本特征来感知颜色。相对于RGB颜色空间，HSI颜色空间具有以下优点：其一，亮度分量与色调、饱和度三者相互独立，可以分开进行处理，亮度分量的变化对图像的颜色信息不会产生影响；其二，HSI颜色空间更符合人类的视觉习惯和知觉特性，同时有利于进行图像处理。因此，本文选择将图像从RGB转换至HSI颜色空间进行处理。  应用Retinex算法处理图像时，由于假设光照是平缓变化的，因此在图像的高对比度边缘区域往往会产生“光晕伪影”现象，常见处理该问题的方法是采用具有边缘保持性能的滤波器如双边滤波器来代替高斯滤波器进行照度估计。图像引导滤波是近年来提出的一种局部线性图像滤波器，它在实现平滑滤波的同时具有良好的边缘保持性能，同时相对于双边滤波器具有较低的时间复杂度，实时性较好，因此被广泛应用于图像增强领域。本文使用引导滤波代替高斯滤波作为环绕函数来进行照度估计以缓解“光晕伪影”现象对图像增强效果的影响。 分别定义滤波输入图像为 ，滤波输出图像为 ，引导图像为 ，则引导滤波过程可以描述为： (6) 其中， 是像素索引值， 和 是两个常数， 是方形窗口内中心像素的索引值。滤波输入图像 和输出图像 之间的最小重构误差可描述为： (7) (8) 其中 和 是引导图像 在窗口 内的均值和方差， 是控制滤波平滑程度的参数， 代表邻域窗口内像素点的个数， 是输入图像在窗口 内的均值。滤波器的输出可表述如下： (9) (10) 在这里 和 分别是 和 在以像素 为中心的邻域窗口 内的平均值。因此，主要的滤波过程就是把这个局部线性模型应用到整幅图像。  由于HSI空间中的亮度信息与色调、饱和度信息无关，因此我们对亮度信息的处理并不会改变图像原本的色调、饱和度信息。图像的亮度被增强后，亮度与饱和度间的相对关系发生变化，可能导致增强后的图像在色彩感知上发生变化从而引起失真。因此，对于经过MSR算法增强后的图像，有必要利用原图像的亮度信息对其进行亮度重构。亮度重构的方法可表示为： (11) 其中，其中 是原始输入图像像素的亮度， 是使用引导滤波作为环绕函数进行MSR算法增强后像素的亮度， 是经过重构后像素的亮度。这里 是调节参数，取值范围在0到1之间。当像素的亮度越低时， 的取值应该更接近于0，这样才能增大 在重构像素值中所占的比重；反之，当像素的亮度较高时， 的取值应该更接近于1。假设像素点的像素最大值是 ，则调节参数 的值可以表示为： (12) 其中 是用来调节 大小的参数，本文中 取经验值3；当 越小时， 越小。"
"本文编程实现了所提出的基于HSI颜色空间的Retinex算法，并选取了动态范围较小的低照度图像进行了图像增强算法测试。同时为了验证本文所提算法的有效性，本文将MSR算法、限制对比度自适应直方图均衡化算法(Contrast Limited Adaptive Histgram Equalization, CLAHE) [ 11 ] [ 12 ] 和本文算法进行了对比性实验。图1、图2和图3分别给出了古镇背景、手机背景以及街景三张低照度图像采用不同算法的图像增强效果。 在图1中，原图(a)中古镇街道以及两旁的建筑在低照度环境下无法识别，在图(b)中可以较明显地看清楚街道以及两旁建筑的相对位置，但图像整体对比度较低；图(c)和图(d)都具有相对较高的对比度，然而图(d)细节信息更加丰富，图像具有较高的分辨率。 在图2中，图像(b)虽然提升了左侧暗区域图像的亮度，但是仍然存在着失真问题，图像较为模糊。对比图像(c)和图像(d)可以发现，本文算法不仅有效提升了图像亮度，而且增强后的图像明显具有较高的 图1. 不同算法古镇低照度图像增强对比 图2. 不同算法手机低照度图像增强对比 图3. 不同算法街景低照度图像增强对比 Table 1 图像 评价标准 原图 MSR算法 CLAHE算法 本文算法 古镇 图像标准差 67.398 72.452 91.726 126.263 信息熵 5.922 6.779 6.812 7.261 手机 图像标准差 47.270 53.923 69.257 72.351 信息熵 5.996 7.211 7.251 7.565 街景 图像标准差 47.182 59.417 57.631 63.321 信息熵 6.590 6.761 7.354 7.251 表1. 不同算法图像增强质量客观评价 对比度，图像增强质量有了进一步的提高。 在图3中，原图(a)具有较小的亮度区分，通过MSR算法增强后的图像(b)出现了明显的过增强现象，图像的色彩信息丢失严重；图(c)则出现了较为明显的色彩失真，严重影响了图像的视觉效果。本文算法通过亮度重构有效地抑制了过增强现象并改善了色彩失真问题，从而在图像增强质量上有较明显的提高，获得了更好的视觉效果。 上述对不同算法图像增强效果的分析表明，本文算法在增强图像亮度的同时有效地保护了图像的细节信息和对比度，提高了增强图像质量。  本文采用了标准差和信息熵作为评价图像质量的客观指标。图像的信息熵可以有效表示图像所包含的信息量，其值越大表示所包含的信息越多；而图像的标准差能够有效反映图像的对比度，其值越大表示图像对比度越高。表1给出了采用MSR算法、CLAHE算法和本文算法对上述三张低照度图像进行增强后的图像标准差和信息熵。 由表1中可以看出，采用本文算法增强后的图像其标准差明显较高，表明增强后的图像具有相对较高的对比度；同时使用该算法增强后图像的信息熵也高于传统的MSR算法和CLAHE算法，表明使用本文算法增强的图像包含更多的信息量。 主观和客观实验结果均表明本文算法对低照度图像具有较好的增强效果，能够在提升图像亮度和对比度的同时有效地保护图像的细节信息并防止产生过增强等失真现象，对于低照度图像的处理具有重要意义。"
"本文在传统的多尺度Retinex算法的基础上，提出了一种基于HSI空间的改进的多尺度Retinex算法，用于低照度图像增强。在算法中采用引导滤波代替高斯滤波作为MSR算法的环绕函数以缓解“光晕伪影”现象，同时利用原图像的亮度信息对MSR算法增强后的图像进行了亮度重构。实验结果表明，本文算法在增强图像亮度的同时有效地保护了图像的细节信息，提高了增强图像的对比度，对低照度图像具有较好的增强效果。"
