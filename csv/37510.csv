"本文针对运载火箭上升段的轨迹优化问题的高度不确定性和严格的飞行过程约束，利用了模型预测控控制(MPC)方法来构建最优控制问题，并将其采用多重打靶法转换为非线性规划(NLP)问题，最后采用内点法进行了在线求解。本文通过利用MPC的在线预测与优化能力减小不确定性影响，以及MPC的过程约束处理能力处理强约束条件，仿真结果表明该方法能有效适应不确定性及过程约束要求。"
"传统的上升制导算法是在飞行的早期高动压力段采用“开环”制导，即第一阶段，从升空到固体火箭助推器(SRB)分离和之后根据预定的时间或事件，之后切换到闭环真空制导方案 [ 1 ]。开环模式通常使用预先加载的姿态角指令，制导指令一般在地面生成，并随将发射当天的风更新到弹道设计中。真空段的制导方法基于最优控制理论，最早源于土星火箭的迭代制导模式(IGM) [ 2 ] 以及航天飞机的动力显式制导(PEG) [ 3 ]。 上升段制导的挑战在于大气内飞行段，空气动力和风的存在极大地增加了最优控制问题的求解难度问题，使解决方法难以可靠，充分地收敛，目前这段还是会是开环的。但是，开环制导没有足够的鲁棒性来应付较大的系统建模不确定性，尤其是对于新型发射任务来说。这类问题只能通过上升段的轨迹优化来降低影响。 一般来说，对于模型火箭，推力水平是固定的，当前变推力发动机还较少见。上升段的轨迹是通过寻求最优的推力方向，构成以到达路径最小燃料为目标的最优控制问题，近些年来国外专家学者不断对这类问题进行分析与提升 [ 4 ] [ 5 ]，并在所涉及的多个方面进行了探索。在求解数值算法方面，一般分为直接法和间接法。直接方法 [ 6 ] [ 7 ] [ 8 ] 将非线性控制问题转化为最优控制问题，并通过离散化方法转化为非线性规划问题(NLP)进行求解，一般依赖非线性(NLP)软件(IPOPT、BOCOP、GESOP、SNOPT等)。直接法可以轻松处理任何动力学约束条件，但是计算代价较大，且不容易获取收敛解。间接法 [ 9 ] [ 10 ] 将最优控制问题转换为边值问题，利用Pontryaguin最大原理(PMP)显式或隐式确定的进行求解。间接法能够快速获得收敛解，但是对初始值灵敏度高。除此之外，近些年也有学者研究了混合方法，即努力将直接方法和间接方法结合起来 [ 11 ] [ 12 ]，首先使用直接方法来建立良好的初始猜测，然后使用间接方法来产生精确收敛。对于此问题，国内学者也进行了大量研究 [ 13 ] - [ 20 ]，主要围绕轨迹、总体参数优化设计及最新的基于伪谱法的最优控制求解问题。 上述的研究方法主要处理纯轨迹问题，初步设计研究旨在为参考任务寻找最佳的运载器配置。在工程实际中，要解决的任务一般为多学科问题，需要同时解决配置参数和轨迹优化问题。由于其整体复杂性，只能分步解决，包括在运载火箭构型和轨迹优化之间进行迭代，直到趋于可接受的设计。 这类问题的一个典型特点是高动态和不确定性，需要一定的预测能力和在线优化能力，同时对于各类约束条件有较好的适应性。基于此类特点，本文拟探索使用模型预测控制(MPC)来解决上升段轨迹的预测能力，并能够针对约束条件的变化，进行在线优化。首先，对动力学模型进行了推导，然后给出了模型预测控制的最有控制问题构建，并利用多重打靶法将其转换为非线性规划问题，再采用相应的求解器进行求解，最后将其应用到国外某型运载火箭队仿真结果进行了验证。结果表明该方法能够很好地处理约束条件，通过在线优化保证最终的最优控制目标的实现。"
"通用上升段运载火箭运动方程，在惯性系中的运动方程为： r ˙ = v v ˙ = g ( r ) + T m ( t ) u + A m ( t ) + N m ( t ) m ˙ = − T v a c g 0 I s p (1) 其中，r为惯性位置，v为速度矢量，g为重力加速度，T vac 为真空推力的幅度，T为当前的推力，A和N为轴向和法向的空气动力；u为推力矢量方向，m(t)为当前时刻的质量，I sp 和g 0 为比冲和地球引力。 T = [ η T v a c + Δ T ( r ) ] / m ( t ) g 0 V r = V − ϖ e × r − V w A = A ( h , α , M , v ) = 1 2 ρ v r 2 S C A ≡ q S C A N = N ( h , α , M , v ) = 1 2 ρ v r 2 S C N ≡ q S C N ρ = ρ ( h ) = ρ 0 exp ( ρ 1 h + ρ 2 h 2 + ρ 3 h 3 ) a = a ( h ) = a 0 + a 1 h + a 2 h 2 + a 3 h 3 C A = C A 0 ( α , M ) + C A 1 ( M ) α + C A 2 ( M ) α 2 C N = C N 0 ( α , M ) + C N 1 ( M ) α + C N 2 ( M ) α 2 (2) 引力模型采用J2的模型。 基于J2的模型： g = [ g x g y g z ] = [ g r R 0 x + X r + g ω ⋅ b x g r R 0 y + Y r + g ω ⋅ b y g r R 0 z + Z r + g ω ⋅ b z ] g r = − μ r 2 [ 1 + 3 2 J 2 ( a r ) 2 ⋅ ( 1 − 5 sin 2 φ x ) ] g ω = − 3 J 2 ( μ r 2 ) ⋅ ( a r ) 2 ⋅ sin φ x (3) x ′ = x + R 0 x y ′ = y + R 0 y z ′ = z + R 0 z ω e x = ω e cos B 0 cos A 0 ω e y = ω e sin B 0 ω e z = − ω e cos B 0 sin A 0 V e x = ω e y z ′ − ω e z y ′ V e y = ω e z x ′ − ω e x z ′ V e z = ω e x y ′ − ω e y x ′ V ˜ x = V x − V e x + f x V ˜ y = V y − V e y + f y V ˜ z = V z − V e z + f z f x = − V w i n d cos ( ( A w i n d − π ) − A 0 ) f y = 0 f z = − V w i n d sin ( ( A w i n d − π ) − A 0 ) V ˜ 2 = V ˜ x 2 + V ˜ y 2 + V ˜ z 2 (4) 马赫数： ​ M = V ˜ a S L T 0 T S L = V ˜ 20.0468 T S L q S M = 1 2 ρ S L ⋅ ρ ρ S L ⋅ V ˜ 2 ⋅ S M = 1 2 ρ ⋅ V ˜ 2 ⋅ S M sin ( α + α w ) = − V ˜ y 1 V ˜ sin ( α + α w ) = V ˜ z 1 V ˜ x 1 2 + V ˜ z 1 2 (5) 其中， | α + α w | ≤ π 2 ， | β + β w | ≤ π 2 。 V ˜ x 1 = a b i _ 11 V ˜ x + a b i _ 21 V ˜ y + a b i _ 31 V ˜ z V ˜ y 1 = a b i _ 12 V ˜ x + a b i _ 22 V ˜ y + a b i _ 32 V ˜ z V ˜ z 1 = a b i _ 13 V ˜ x + a b i _ 23 V ˜ y + a b i _ 33 V ˜ z 其终端条件包括位置幅度、飞行路径角及相应的轨道要素，可以写为： r ( t f ) = r f v ( t f ) = v f r ( t f ) T v ( t f ) − r t v t sin ( γ t ) = 0 (6) 飞行路径约束条件一般包括：动压、动压攻角乘积、动压侧滑角乘积，以及保证火箭的飞行高度和控制矢量的单位化。 | r ( t 0 ) | ≥ R 0 | u i ( t ) | = 1 1 2 ρ v r 2 ≤ q max η T v a c m g ≤ a max q α ≤ | q α | max q β ≤ | q β | max (7) 初始条件由发射点的坐标及火箭的初始条件确定的。 r ( t 0 ) = r 0 v ( t 0 ) = v 0 m ( t 0 ) = m 0 (8) 终端条件： 终端条件保证速度、位置满足入轨条件。 a ( t f ) = a f e ( t f ) = e f i ( t f ) = i f Ω ( t f ) = Ω f ω ( t f ) = ω (9) 以上的各参量分别为：半长轴、偏心率、轨道倾角、升交点经度及近地点幅。"
"模型预测控制(MPC)是一种实现反馈控制的方法，并提供了一种有效的通用适用于在线优化的设计方法，主要应用于多输入多输出(MIMO)系统的控制系统，其最大的问题时候计算成本较大。随着计算技术的进步，计算能力已经大大提高，计算硬件和软件的最新进展也大大降低了成本并改善了这些计算的速度和可靠性，从而使计算密集型控制系统的收益/成本比越来越大。以MPC为代表的控制系统应用也越来越普遍，大大增加了对复杂多输入多输出系统设计控制器的需求。典型的MPC系统如图1所示。 x ( k + 1 ) = f ( x ( k ) , u ( k ) ) (10) 在k时刻，获取x(k)，在此基础上，在预测区域N内计算最优控制序列u(x(k))，将其应用到采样周期 [ k , k + 1 ] ，然后循环执行。 模型预测控制的三个主要过程：预测、在线优化和滚动时域执行。其本质上也是一类最优控制问题，其数学构成为： 控制目标： l ( x , u ) = ‖ x u − x r ‖ Q 2 + ‖ u − u r ‖ R 2 (11) 代价函数： J N ( x , u ) = ∑ k = 0 N − 1 l ( x u ( k ) , u ( k ) ) (12) 最优控制构成： min J N ( x 0 , u ) = ∑ k = 0 N − 1 l ( x u ( k ) , u ( k ) ) x u ( k + 1 ) = f ( x u ( k ) , u ( k ) ) x u ( 0 ) = x 0 u ( k ) ∈ U , x u ( k ) ∈ X (13) 图1. MPC结构图"
"当前，最常用的将最优控制问题(OCP)转换为NLP问题的方法包括打靶法和配点法。打靶法包括单打靶法和多重打靶法。  NLP决策变量： w = [ u 0 ⋯ u N − 1 ] (14) 将x(u)作为w、x 0 和t k 的函数： x u ( . ) = F ( w , x 0 , t k ) F ( w , x 0 , t 0 ) = x 0 (15) 代价函数： min Φ ( F ( w , x 0 , t k ) , w ) ≤ 0 g 1 ( F ( w , x 0 , t k ) , w ) ≤ 0 (16)  直接多重打靶法是解决边值问题的一种数值方法，其算法结构图如图2所示。该方法将寻求解决方案的时间间隔分为几个较小的时间间隔，解决了每个较小时间间隔中的初始值问题，并施加了额外的匹配条件以在整个时间间隔上形成一个解决方案。与单打靶法相比，该方法在非线性分布和数值稳定性方面具有重大改进。 图2. 多重打靶法结构图 NLP决策变量： w = [ u 0 ⋯ u N − 1 , x 0 ⋯ x N ] (17) 代价函数： min Φ ( F ( w , x 0 , t k ) , w ) ≤ 0 g 1 ( w ) = [ g 1 ( x 0 , u 0 ) ⋮ g 1 ( x N − 1 , u N − 1 ) g 1 ( x N ) ] ≤ 0 g 2 ( w ) = [ x ¯ 0 − x 0 f ( x 0 , u 0 ) − x 1 ⋮ f ( x N − 1 , u N − 1 ) − x N ] = 0 (18)  当前在处理NLP时，普遍采用了基于可行方向搜索的约束最优化方法，包括内部点信任区域线搜索算法和主动集信任区域线搜索算法。其中，具有代表性的是成熟于80年代中后期的序列二次规划算法(SQP)及内部点迭代算法(IPI)。 内部点技术实现了原始对偶内部点算法，使用障碍函数来确保算法可行。当优化问题包含许多不等式约束且大多数约束将作为严格的不等式满足时，内点法非常有用。如果只需要考虑很少的约束，就可以减小原始优化问题的大小和复杂性。 本文采用基于内点法的IPOPT对NLP问题进行求解。"
"以国外某型两级运载火箭为模型对象，初始条件为： 初始高度H 0 = 10 m，初始速度V 0 = 0，初始质量M 0 = [20000 kg 1000 kg]，结构质量为[2000 kg 200 kg]，阻力系数为[0.3 0.2]，比冲为[300 350]。 仿真结果如图3~10： 图3. MPC迭代求解过程 图4. 高度结果曲线 图5. 速度结果曲线 图6. 质量结果曲线 图7. 加速度结果曲线 图8. 推力结果曲线 图9. 航程结果曲线 图10. 动压结果曲线 从图3可以看出，MPC在迭代过程中不断对目标函数进行优化，同时在线处理飞行约束条件，单条轨迹的收敛时间在9 s左右。从图7、图8可以看出，整条轨迹控制指令平滑，飞行最大过载较低。从图10可以看出，最大动压控制较好，飞行过程对约束条件的在线处理效果明显。"
"对于具有高度不确定性及严格飞行过程约束运载火箭上升段轨迹优化问题，本文利用MPC构建最优控制问题，该方法能够通过在线预测与优化能力，并且能够利用MPC的过程约束处理能力处理强约束条件。方针结果表明MPC在迭代过程中不断对目标函数进行优化，同时在线处理飞行约束条件，单条轨迹的收敛时间在9 s左右，飞行过程对约束条件的在线处理效果明显。"
