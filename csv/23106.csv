"本文通过对传统下垂控制算法的有功、无功分析，引入虚拟电感的电压电流双环控制策略，虚拟电感使逆变器等效输出阻抗成感性，从而通过调节感抗匹配程度提供功率均衡效果；提出一种多逆变器并联运行的改进型下垂控制算法，通过改进型下垂控制参数设置，减弱了阻抗对环流的影响。实验仿真结果表明，改进型多逆变器并联的微电网改进型下垂控制算法提高了多逆变器的并联运行性能，有效减小了多逆变器并联运行的环流问题，大大提高了多逆变器并联运行的无功均衡效果。 关键词 :微电网，感性虚拟阻抗，改进下垂控制法 Copyright © 2017 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"微电网作为分布式发电单元接入电网的一种有效手段，逐渐引起了广泛关注 [ 1 ] ，在高渗透率下多微电网配电网管理系统中，微电网主要包括：分布式发电(Distributed Generation)类型的微型发电设备(例如微型燃气轮机、燃料电池、风机、光伏阵列)、储能设备(例如飞轮、储能电容和电池)和可控(柔性)负荷设备(例如电动汽车)，这些具有可控能力的设备允许连接到上级高压配电网并网运行，当大电网出现故障或其他外部扰动或自然灾害时可以脱离主网实现孤岛独立运行，从而提高供电质量 [ 2 ] [ 3 ] [ 4 ] 。 为有效抑制环流及改善系统无功的均分问题，本文对传统下垂控制的功率分配进行分析，引入感性虚拟阻抗的多逆变器的控制策略，由滤波电阻值决定其输出阻抗，进而决定其功率输出；通过考虑线路阻抗对传统下垂控制算法的影响，得到电阻与下垂系数的关系，提出一种改进型下垂控制算法。通过实验仿真验证了所提方法的有效性。"
"以3台逆变器并联为例，图1为使用3个电压源逆变器的3个分布式电源微电网结构图，其中L、C分别为逆变器的输出起滤波作用的滤波电感和滤波电容，R 1 为分布式直流电源1的等效逆变器输出电阻和线路电阻之和，X 1 为分布式电源1的等效逆变器输出电抗和线路电抗之和；R 2 为分布式电源2的等效逆变器输出电阻和线路电阻之和，X 2 为分布式电源2的等效逆变器输出电抗和线路电抗之和；R 3 为分布式电源3的等效逆变器输出电阻和线路电阻之和，X 3 为分布式直流电源1的等效逆变器输出电抗和线路电抗之和，K为逆变器的输出继电器。 U 1 ∠θ 1 、U 2 ∠θ 2 和U 3 ∠θ 3 分别为分布式电源逆变器的空载输出电压；θ 1 、θ 2 、θ 3 为分布式电源逆变器的空载输出电压与母线电压的相角差。由图2可得逆变器i (i = 1, 2, 3)输出的有功功率和无功功率分别为 P i = 1 | Z i | [ ( E U i cos θ i − E 2 ) cos ∅ i + E U i sin θ i sin ∅ i ] (1) Q i = 1 | Z i | [ ( E U i cos θ i − E 2 ) sin ∅ i − E U i sin θ i cos ∅ i ] (2) 式中第i个逆变器的阻抗幅值为 | Z i | ： | Z i | = R i 2 + X i 2 (3) 图1. 含有3个分布式电源的微电网结构图 图2. 原理图 式中 Z i 包含第i个逆变器的输出阻抗和线路阻抗； R i 为第i个逆变器的输出电阻和线路电阻之和； X i 为第i个逆变器的输出感抗和线路感抗之和； U i 为第i个逆变器的空载输出电压幅值； θ i 为第i个逆变器的空载输出电压与母线的相角差； ∅ i 为阻抗角， ∅ i = arctan R i X i (4) 在高压系统中，传统下垂控制策略应用于系统等效输出阻抗为感性的系统，即满足 X i ≫ R i ，此时可忽略逆变器的输出电阻和线路电阻之和 R i ，简化得到 P i = E U i sin θ i X i (5) Q i = U i ( U i − E cos θ i ) X i (6) 实际中相角 θ i 很小，可近似得到 sin θ i = θ i ， cos θ i ≈ 1 ，式(5)和(6)可分别简化 P i = E U i X i θ i (7) Q i ≅ U i ( U i − E ) X i (8) 由上式可知，逆变器输出的有功功率主要受逆变器的空载输出电压与母线的相角差影响，逆变器输出的无功功率主要受逆变器的空载输出电压幅值影响，由于实际工程中逆变器的空载输出电压与母线的相角差很难检测到，因此一般由频率代替相角实现控制，可得P/f下垂控制方程表达式 [ 14 ] ： { f i = f 0 i − m i ( P i − P 0 i ) U i = U 0 i − n i ( Q i − Q 0 i ) (9) 式中— f i 、 U i 分别为逆变器输出频率、电压； f 0 i 、 U 0 i 分别为逆变器的额定频率、额定电压； m i 、 n i 分别为逆变器的有功/频率(P/f)、无功/电压(Q/U)下垂控制系数； P i 、 Q i 分别为逆变器的有功功率和无功功率； P 0 i 、 Q 0 i 分别为逆变器的额定有功功率、额定无功功率。 而在实际的低压微电网中，线路阻抗主要成阻性 [ 15 ] ，即满足 R i ≫ X i ，此时可忽略逆变器的输出感抗和线路感抗之和 X i ，简化可得 P i = U i ( U i − E cos θ i ) R i (10) Q i = − E U i sin θ i R i (11) 实际中相角 θ i 很小，可近似得到 sin θ i = θ i ， cos θ i ≈ 1 ，可得以下表达式 P i = U i ( U i − E ) R i (12) Q i ≅ − E U i θ i R i (13) 由上式可知，逆变器输出的有功功率主要受逆变器的空载输出电压幅值影响，逆变器输出的无功功率主要受逆变器的空载输出电压与母线的相角差影响，由于实际工程中逆变器的空载输出电压与母线的相角差很难检测到，因此一般由频率代替相角实现控制，可得到P/V下垂控制 { f i = f 0 i − u i ( Q i − Q 0 i ) U i = U 0 i − v i ( P i − P 0 i ) (14) 式中u，v为下垂控制系数。由以上高、低压线路阻抗的特性分析可知，逆变器输出的有功、无功功率偏离额定有功、无功功率时，电压与频率值较额定值也有一定量的偏移，因此上述P/f与P/V下垂控制均为有差调节。   本文分析传统下垂控制的功率分配是基于阻性线路。 { f i = f 0 i − u i ( Q i − Q 0 i ) U i = U 0 i − v i ( P i − P 0 i ) (15) 根据上式，当3台逆变器的频率相等( f 1 = f 2 = f 3 )系统达到稳定时，只需使下垂系数与其额定功率成反比，即满足 f 01 = f 02 = f 03 (16) u 1 Q 01 = u 2 Q 02 = u 3 Q 03 (17) 即可使逆变器的无功率按期额定功率平均分配，即满足 u 1 Q 1 = u 2 Q 2 = u 3 Q 3 (18) 当无功功率在实现均分时，则 u 1 E U 1 R 1 θ 1 = u 2 E U 2 R 2 θ 2 = u 3 E U 3 R 3 θ 3 (19) 若 θ 1 = θ 2 = θ 3 ， U 1 = U 2 = U 3 ，则有下式成立 u 1 R 1 = u 2 R 2 = u 3 R 3 (20)  { f i = f 0 i − u i ( Q i − Q 0 i ) U i = U 0 i − v i ( P i − P 0 i ) (21) 由上式可知，要保证有功功率的平均分配，应满足下式 U 01 = U 02 = U 03 (22) v 1 P 01 = v 2 P 02 = v 3 P 03 (23) 而使下式 v 1 P 1 = v 2 P 2 = v 3 P 3 (24) 成立的条件是 U 1 = U 2 = U 3 (25) 在上式成立时，逆变器之间的电压差为 Δ U = U i + 1 − U i = v i + 1 P i + 1 − v i P i (26) 将下式的无功/电压下垂方程代入其有功表达式(21)得 P i = E U 0 i − E 2 R i + v i E (27) 将上式代入公式(26)得 Δ U = U 0 i − E 1 + R i + 1 E v i + 1 − U 0 i − E 1 + R i E v i (29) 由以上公式可知，当下式成立时，即 R 1 v 1 = R 2 v 2 = R 3 v 3 (30) 逆变器的无功功率将按额定容量平均分配。 综上可知，基于传统下垂控制的逆变器的有功与无功功率均分的条件应满足下式 { u 1 Q 01 = u 2 Q 02 = u 3 Q 03 v 1 P 01 = v 2 P 02 = v 3 P 03 f 01 = f 02 = f 03 U 01 = U 02 = U 03 (31) { U 1 = U 2 = U 3 R 1 v 1 = R 2 v 2 = R 3 v 3 ⇔ { θ 1 = θ 2 = θ 3 R 1 u 1 = R 2 u 2 = R 3 u 3 (32)"
"实现逆变器输出功率均分及抑制系统环流，均是通过虚拟阻抗对分布式发电单元之间的差异调节控制，在逆变器的输出端引入虚拟阻抗的实质是在电压闭环中加入一个输出阻抗调节模块的负反馈，将虚拟阻抗值与采集的电流乘积引入到电压调节中。虚拟阻抗的引入，不仅可以改变逆变器的功率传输特性，还可以解决线路阻抗引起的功率耦合，引入虚拟阻抗的3台逆变器并联运行等效图如图3。 如图3所示， Z i ( i = 1 , 2 , 3 ) 为逆变器虚拟阻抗； V i ( i = 1 , 2 , 3 ) 为逆变器输出电压； U i ( i = 1 , 2 , 3 ) 为逆变器输出的虚拟电压。其关系如下公式 V i = U i − I i Z i (33) 通过对逆变器的虚拟阻抗值 Z i 的调节控制虚拟电压，进而实现间接对逆变器的输出电压控制，达到对分布式发电单元逆变器输出功率均分及抑制系统环流的目的。  本文对并联逆变器采用带虚拟电感的电容电流反馈的双闭环控制相结合的方法，外环采用PI控制的电容电压控制环，用以提高系统输出功率的精度，内环采用P控制的电感电流控制环，用以改善系统的 图3. 引入虚拟阻抗的 3台逆变器并联运行等效图 动态性能。带虚拟阻抗的电容电流反馈控制逆变器结构图如图4。 引入虚拟电感后的电压参考值 U r e f * ；电压外环参考电压 U r e f ， K p v ， K i v 分别为PI控制器的比例和积分系数； i r e f 为电流内环参考电流， K p i 为电流环调节器比例系数； T d 为数字控制延时； K p w m 为逆变器增益；L、C分别为主电路滤波电感、滤波电容； K l 、 K u 分别为电感电流、电容电压反馈系数； u 0 为逆变器输出电压； i 0 为线路电流； Z v 为虚拟阻抗。由图4可知，当未加入虚拟电感时： u r e f = u r e f * (34) u = ( k P v S + k i v ) k p i k P W M Δ u r e f − L s 2 Δ i 0 (35) Δ = L C s 3 + k U k p i k W P M C S 2 + ( 1 + k l k p i k W P M k p v ) s + k U k i v k p i k P W M (36) 由于滤波电容C的值较小可忽略不计，上式可近似为 Δ ≈ ( 1 + k U k p i k W P M k p v ) s + k U k i v k p i k P W M (37) 因此公式(35)可以等效为 u ≈ ( k P v S + k i v ) k p i k P W M ( 1 + k U k p i k W P M k p v ) s + k U k i v k p i k P W M u r e f − L s 2 ( 1 + k U k p i k W P M k p v ) s + k U k i v k p i k P W M Δ i 0 (38) 由上式可得逆变器的输出阻抗 Z o u t ≈ L s 2 ( 1 + k U k p i k W P M k p v ) s + k U k i v k p i k P W M = L s 2 s + k U k p i k W P M ( k p v s + k i v ) (39) 引入虚拟阻抗 Z V ( s ) ，可得 u r e f * = u r e f + Z V ( s ) i 0 (40) 加入虚拟阻抗 Z V ( s ) 的逆变器等效输出阻抗为 Z o u t * ( s ) = ( k P v S + k i v ) k p i k P W M ( 1 + k U k p i k W P M k p v ) s + k U k i v k p i k P W M Z V ( s ) + Z o u t ( s ) (41) 将公式(39)代入(41)若使 Z V ( s ) = k U L s ，可得 Z o u t * ( s ) = L s 。 综上，工频条件下引入虚拟阻抗 Z V ( s ) = k U L s ，输出电阻可忽略，输出阻抗近似为纯感性，即逆变 图4. 带虚拟阻抗的电容电流反馈控制逆变器结构图 器的输出阻抗值由滤波电感值确定，因此在对传统下垂控制方法改进时，即可利用图4控制策略对3台并联运行的逆变器进行控制，可不考虑各并联逆变器的输出电阻，仅需考虑滤波电感值。"
"由图4引入虚拟阻抗的控制策略，式中 R i 为第i个逆变器的输出电阻和线路电阻之和； X i 为第i个逆变器的输出感抗和线路感抗之和，有上述分析可知，为了降低 R i 对并联系统的环流的影响，对传统下垂控制算法进行改进的算法如下 { f i = f 0 i − k p f P i − k q f Q i U i = U 0 i − k p U P i − k q U Q i (42) 式中 k p f 、 k q U 为下垂系数，当 X i ≫ R i 时，此时 R i 虽然相对较小，但是仍然存在，系统能否并联成功， X i 、 R i 这两参数至关重要。 k q f 、 k p U 可提高功率均分精度，减小系统环流。首先应考虑下垂系数 k p f 、 k q U ，再根据有功、无功公式并考虑 R i 确定 k q f 、 k p U ，从而对传统下垂控制算法进行改进。 考虑到 k p f 、 k q U 对功率均分的影响，可得 k p f = Δ f P M A X (43) k q U = Δ U Q M A X (44) 上式中 Δ f 、 Δ U 为逆变器输出电压最大频率偏差和幅值偏差， P M A X 、 Q M A X 为输出最大有功、无功功率值。 对以下公式中的 U i 、 θ i 求导 P i = 1 | Z i | [ ( E U i cos θ i − E 2 ) cos ∅ i + E U i sin θ i sin ∅ i ] (45) 可得 ∂ P i ∂ U i = 1 | Z i | E cos ( ∅ i − θ i ) (46) ∂ P i ∂ θ i = 1 | Z i | E cos ( ∅ i − θ i ) (47) 有上式(46)、(47)可得 k p f 、 k p U 的关系 K p f K p u = ∂ P i ∂ U i / ∂ P i ∂ P θ i = 1 U i 1 tan ( ∅ i − θ i ) (48) 上式(48)化简得： K p U = K p f U i tan ( ∅ i − θ i ) ≈ K p f U i ( sin ∅ i − sin θ i ) (49) 由于并联逆变器在运行时空载输出电压与母线电压的相角差 θ i 很小，阻抗角 ∅ i 远大于相角差 θ i ， sin ∅ i = R i | Z i | 上式可化简为 K p U = K p f U i R i | Z i | (50) 对以下公式中的 U i 、 θ i 求导 Q i = 1 | Z i | [ ( E U i cos θ i − E 2 ) sin ∅ i − E U i sin θ i cos ∅ i ] (51) 可得 ∂ Q i ∂ U i = 1 | Z i | E cos ( ∅ i − θ i ) (52) ∂ Q i ∂ θ i = 1 | Z i | E U i cos ( ∅ i − θ i ) (53) 有上(52)、(53)式可得 k q f 、 k q U 的关系 K q f K q U = ∂ Q i ∂ U i / ∂ Q i ∂ θ i = − tan ( ∅ i − θ i ) U i (54) 上式(54)化简得 K q f = − K q U tan ( ∅ i − θ i ) U i ≈ − K q U sin ∅ i − sin θ i U i (55) 由于阻抗角 ∅ i 远大于相角差 θ i ，上式(55)可化简为 K q f ≈ − K q U U i R i | Z i | (56) 综上，多逆变器并联的微电网改进型下垂控制算法如下 { f i = f 0 i − k p f P i + K q U U i R i | Z i | Q i U i = U 0 i − K p f U i R i | Z i | P i − k q U Q i (57) 当 R i = 0 时，上式即为传统下垂控制算法，若引入感性虚拟阻抗，参考电压 u r e f * 则为 u r e f * = 2 U i sin ( 2 π f i t + θ i ) (58)"
"为了验证多逆变器并联的微电网改进型下垂控制算法，本文在Matlab/Simulink仿真平台搭建了3台逆变器并联运行仿真模型。微网电压等级380 V、单台逆变器功率等级50 kW、负载类型为阻感性负载，3台逆变器线路阻抗均为0.1 + j0.03Ω，仿真参数如表1。3台并联逆变器模型基本结构如图5。 Table 1 参数 数值 三台逆变器连线阻抗/Ω 0.1 + j0.03 三台逆变器滤波电感/mH 2.64 × 0.05e−4 三台逆变器滤波电容/uF 1e−6 三台逆变器负载阻抗/Ω 10 + j0.01 表1. 三台逆变器并联运行仿真参数 图5. 3台并联逆变器模型基本结构 以下为未加入感性虚拟阻抗的传统下垂控制算法时的实验仿真波形如图6，加入感性虚拟阻抗的改进下垂控制算法的实验仿真波形如图7，仿真时间为16秒。 在3台逆变器并联运行工况下，第8秒，分布式发电单元1线路的继电器闭合，本地负载增加，由3台分布式发电单元并联运行的仿真波形变化情况分析可知，图6(a)和图6(a)为3台逆变器并联运行时的稳态电流仿真波形图，电流幅值在第8秒开始变大，后趋于稳定，但是电流幅值整体并不均匀(即出现环流，稍后详解)，而加入感性虚拟阻抗后的稳态电流幅值更均匀。图6(b)和图7(b)为3台逆变器并联运行时的输出有功仿真波形图，有功在第8秒变大，后趋于稳定，未加入感性虚拟阻抗与加入感性虚拟阻抗后的输出有功仿真波形图基本保持一致，不论负载如何变化，系统有功始终维持不变。图6(c)和图7(c)为3台逆变器并联运行时的输出无功仿真波形图，未加入感性虚拟阻抗时本地负载增加前后，逆变器并联运行时输出无功均衡效果较差，加入感性虚拟阻抗后，逆变器并联运行时输出无功均衡效果较之前有很大的提高。 由于任两台逆变器之间的环流即为 i h = ( i 2 − i 1 ) / 2 ，i 1 和i 2 为任意两台逆变器连接线路上的电流，可知 i 2 − i 1 的幅值越大，表明实际的环流越大。图8(a)和图9(a)分别为3台逆变器线路连线上的电流仿真波形。 通过对图8(a)和图9(a)稳态电流仿真波形图对比分析，可知改进下垂控制算法的3台逆变器稳态输出电流的幅值、相位基本一致，即改进下垂控制算法的环流较小。对比图8(b)和图9(b)输出有功仿真结果，可知传统下垂控制算法的3台逆变器并联运行时输出有功在0.01秒至0.04秒之间出现不一致，之后趋于稳定，而改进下垂控制算法输出有功始终保持一致，即输出有功均衡效果较好。对比图8(c)和图9(c) 图6. 未加入感性虚拟阻抗的传统下垂控制算法时的实验仿真波形。(a) 3台逆变器并联运行时的稳态电流仿真结果；(b) 3台逆变器并联运行时输出有功仿真结果；(c) 3台逆变器并联运行时输出无功仿真结果 图7. 加入感性虚拟阻抗的改进下垂控制算法的实验仿真波形。(a) 3台逆变器并联运行时的稳态电流仿真结果；(b) 3台逆变器并联运行时输出有功仿真结果；(c) 3台逆变器并联运行时输出无功仿真结果 图8. 传统下垂控制算法时的实验仿真波形如图。(a) 3台逆变器并联运行时的稳态电流仿真结果；(b) 3台逆变器并联运行时输出有功仿真结果；(c) 3台逆变器并联运行时输出无功仿真结果 图9. 改进下垂控制算法的实验仿真波形图。(a) 3台逆变器并联运行时的稳态电流仿真结果；(b) 3台逆变器并联运行时输出有功仿真结果；(c) 3台逆变器并联运行时输出无功仿真结果 输出无功仿真结果，传统下垂控制算法的3台逆变器并联运行时输出无功在0.005秒后出现较大的波动，即无功均衡效果较差，而改进下垂控制算法输出无功基本保持一致，无功均衡效果较好。"
"由于实际的微电网的逆变器输出阻抗不同；其到公共并网点的距离长短不一，实现阻感性或者纯阻性线路不同容量逆变器有功、无功功率的均分时各逆变器的电压幅值和相位不一致；容量与线路阻抗成反比，采用传统下垂控制策略，很难实现逆变器的功率均分。 本文通过对传统下垂控制算法的有功、无功分析，设计了引入虚拟阻抗的电压电流双环控制策略；提出一种改进型多逆变器并联的微电网改进型下垂控制算法。实验仿真结果表明，改进型多逆变器并联的微电网改进型下垂控制算法提高了多逆变器的并联性能，有效减小了多逆变器并联运行环流问题，大大提高了多逆变器并联运行的无功均衡效果。"
