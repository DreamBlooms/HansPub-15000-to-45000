"通过对大比例尺DLG数据库的可视化存在的问题分析，本文提出一种解决思路，针对其中的关键技术进行了相关研究，得到了一体化符号系统、颜色映射模式、空间叠置规则判断技术等多个关键技术成果。将这些成果应用到大比例尺DLG自动可视化快速制图系统中，成功实现对湖南省不动产基础1:2000 DLG数据库的自动可视化处理，达到了良好的制图效果，极大的提高了制图效率。 关键词 :符号系统，关系规则，颜色模式映射，自动化制图，制图可视化 Copyright © 2018 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"湖南省不动产基础数据库包含了覆盖全省域内的1:2000 DLG数据库成果，为了在不动产统一登记工作和国民经济建设其它领域有效应用该成果，需要输出DWG格式的可视化地形图数据。通用的GIS系统进行符号化后输出存在众多问题，同时GIS系统的一些强大的制图功能产生的制图成果也无法直接转换为Autodesk的DWG格式。为了满足项目的需要，笔者负责开发的自动可视化制图软件，利用AutoCAD软件提供的接口，定义了一套完整的大比例尺DLG一体化符号系统，同时基于OGR开源库开发了一套轻量级空间运算和分析组件，以此为基础，通过与不动产基础数据进行适配，比较好的解决了湖南省不动产基础测绘成果大比例尺DLG的制图问题。目前已经建立了一套表达体系，完成了各类大比例尺符号的一体化表达；能够自动规范不动产数据库中类桥梁等依赖于绘制顺序的要素；实现了通过打印机适配文件进行RGB与CMYK配色模式的互转；使用ArcGIS智能标注功能进行智能化标注，并将结果映射到一体化符号系统中；通过将组件包装成应用服务进行消息监听，实现自动化批量制图。"
"针对湖南不动产成果基础数据库的出图项目，在开发前进行了调研分析，发现需要满足该项目要求，面临以下几个方面的问题。  1) 复合面状图元的采集规则不一致 大比例尺DLG数据库标准以国家基础测绘标准为基础，采用了相同的要素编码、图层和数据字典。项目生产由具备测绘资质的十几家测绘单位承担，未使用统一测绘生产软件，各生产软件的符号规则不完全相同，尤其是对面状符号的表达不同，标准中未明确复合图元要素的采集规则，不同软件对复合图元素的绘制规则产生差异，导致制图符号化时产生不一致，影响地形图质量。 2) 面要素多种线型表达问题 涵洞、桥梁等面要素的符号表达需要由多种不同线型图元配合才能完成 [ 1 ] 。为了表达符号同时保留要素的完整结构，需要将不同图元进行复合，并保留各图元的拓扑关系。 3) 多种线、面要素共边问题 在DLG数据库中线要素、面要素之间相接处存在边界重复，在可视化制图过程中应该根据制图表达要求予以消除 [ 2 ] ，同时需要保证要素的完整性。 4) 色彩模式映射问题 地形图标准中颜色以CMYK色彩模式表达 [ 3 ] ，而DWG格式中的色彩模式为RGB，两者之间需要建立映射关系。  1) 要素的绘制顺序 DLG数据库中各要素没有定义绘制顺序，而地形图表达中在地图平面叠置要素一般按要素的投影优先顺序表达。 2) 要素间的关系配置 地形图中各要素之间的关系要求合理配置，为了达到图面清晰美观，需要对要素采取适当的移动、缩放、综合取舍等方式进行处理 [ 4 ] ，经过分析，大比例尺地形图在采集过程中对针对要素进行了综合取舍，因此图面冲突主要表现在注记与要素之间的位置关系。 3) 不规则植被面的符号表示问题 地形图中大面的植被符号采用品字型注记可以满足要求，但对于狭长、小面积植被则需要采用一定的算法进行合理注记 [ 5 ] [ 6 ] ，以达到较好的质量效果。  湖南省不动产基础测绘大比例尺DLG成果覆盖全省范围，图幅数量大于20万幅，由于不动产统一登记项目的急切需要，必须在较短时间、较少资金和人力投入的前提下完成所有DLG数据库的可视化地形图生产，满足基本用图需求。此外，还要求能够对地形图数据进一步精编，提供高质量的地形图。"
"针对大比例尺DLG制图过程中存在的问题，结合ArcGIS和AutoCAD系统二者的各自的特点和优势来解决。在AutoCAD环境中建立一体式符号系统；搭建一个轻量级空间分析工具；以分析工具为基础定义一套要素空间关系规则，实现要素的标准化、规范化；以分析工具为基础，定义要素空间规则对共边要素进行处理；研究两种颜色模式的映射模型；建立ArcGIS与AutoCAD要素中间件完成两个平台间的要素映射。  基于ObjectARX自定义实体技术结合图形规则重定义技术 [ 7 ] ，开发一套要素符号表达系统，主要解决复合线、面要素的制图符号。 对于复合面要素，采用自定义实体技术，以线符号为基本单元扩展为弧段，弧段组成环来表现面要素的图形结构，由于组成图元边界的基本单元是弧段，因此可以灵活的控制其的样式和可见性，从而满足面要素各种样式的边界表达。以点要素为基本单元，组成标识子图元，可以实现各类面填充符号的表达，面图元的色彩填充则采用传统铺色算法完成表达。 对于复合线要素，采用规则重定义技术定义绘制规则实现多种图元复合成的线符号表达 [ 8 ] [ 9 ] 。复合线要素可以作为复合面的弧段，从而丰富复合面的边界表达。 对于文本注记，采用自定义实体技术，用可隐藏线要素作为注记各个文字的定位和角度承载图元，配合文本样式实现任意注记一体式表达。 为了统一表现和维护要素的各类要素符号绘制，同时方便不同规则的图形符号扩展定义，符号绘制系统采用“抽象工厂” [ 10 ] 设计模式设计，设计结构见图1。 图1. 符号绘制系统设计图  被动光源色彩CMYK模式主要针对印刷使用，印刷四色模式是彩色印刷时采用的一种套色模式，利用色料的三原色混色原理，加上黑色油墨，共计四种颜色混合叠加，形成所谓“全彩印刷”。RGB色彩模式是工业界的一种颜色标准，是通过对红(R)、绿(G)、蓝(B)三个颜色通道的变化以及它们相互之间的叠加来得到各式各样的颜色。计算机显示器大都是采用了RGB颜色标准，因此制图系统需要建立CMYK与RGB模式的映射关系，以同时满足制图和打印输出的需要 [ 11 ] 。两种模式的映射并没有统一的映射标准，而依赖于打印机与显示器的配色系统，符号系统采用将打印机色彩配置文件导入，与显示器系统进行匹配，形成映射关系实现两种模式的自动转换，使得显示色彩与打印输出色彩尽可能一致。  为了解决前章所述的诸如类桥梁要素的方向快速识别，共边要素边界的识别和处理，以及提取要素的结构线来解决狭长面的图元符号定位等问题。还需要开发一套空间分析和图形结构提取工具。 基于格网空间索引组件 [ 12 ] ，结合OGR提供的空间运算组件形成一套满足需要的空间分析工具，在此基础上定义拓扑规则查询器，实现各要素之间的空间逻辑查询与判断。对于不同需求的运算，通过定义逻辑查询表达来实现，见表1和表2。  通过定义一套规则以控制不同要素的显示顺序，按照属性定义规则和要素Z值两种方式结合进行控制。其中属性规则可由用护根据要素的图层、代码以及其它附加属性方式进行规则定义，对于不能满足要求的特定要素，能过要素的Z值来确定叠置顺序，Z值坐标越大则显示在前，同样Z值的要素则依据定义的属性规则由系统确定叠置顺序。通过两种方式结合，可以在兼顾效率的情况下精确的控制要素的顺序显示。  基于ArcGIS Desktop/Engine的智能标注引擎结合数据标准制定标注规则，通过开发中间件将标注结 Table 1 要素代码 要素名称 拓扑规则 识别边类型 搜索要素代码 4503053 铁路桥 Cross IsFirstOpenEdge 4101012|4101032|4101042|… 4503063 公路桥 Cross IsFirstOpenEdge 4208014|4208024|4201014|… 2705013 滚水坝 Overlay IsSecondEdge 2705014 4505023 依比例尺的人行桥 Touch IsFirstEdge 2211002|2212002 4506013 火车隧道 Cross IsFirstOpenEdge 4101012|4101032|4101042|… 表1. 类桥梁要素方向识别与修正规则定义表(节选) Table 2 要素代码 要素名称 拓扑规则 处理方式 搜索要素代码 2101013 河流 Touch Hide 2101013|2211003|… 2401013 水库 Touch Hide 2401013|2101013|… 2402003 溢洪道 Touch Hide 2101013|2211003|… 4511062 路堤坡脚线 Touch Break * 表2. 共边要素边界处理规则定义表(节选) 果映射至制图系统，实现要素注记的自动移位标注。同时，将植被符号转换为同等大小的文字标注，实现植被配置符号避让地理要素和要素注记，获取的位置经过范围滤除处理，获取得到配置植被符号的标注位置，再将位置信息映射至符号系统。通过联通ArcGIS组件与制图系统的数据流，最大程度利用业界先进的智能标注算法，用来解决制图工作中工作量较大的注记拖移整饰工作。"
"系统设计遵循稳定性优先兼顾效率，自动化为主兼顾精编的原则，采用传统的瀑布流开发方式进行，依照需求调研分析、概要设计、详细设计、集成测试等几个步骤完成。在精心设计后的软件架构和关键技术研究基础上通过基于AutoCAD和OGR结合ArcGIS的自动化制图系统构建了一套大比例尺DLG制图系统，软件的整体架构如图2所示。 系统采用C/S架构，通过将AutoCAD和ArcGIS相关组件封装为服务的形式，通过操作控制台实现一键自动成图系统，控制台与各功能组件之间的关系，见图3所示。 软件的基础组件采用Visual C++ 9.0和ObjectARX SDK开发。服务和应用组件使用.Net FrameWork 3.5框架，采用Visual Studio 2013基于ArcGIS Engine/Object和ObjectARX.NET开发。"
"系统开发过程中进行了单元测试和组件模块测试，主要以白盒测试为主，主要由开发人员自测和交互测试，对测试的结果进行修改完善后进行系统集成测试，从功能性和运行性能两个方面测试情况统计，详见表3和表4。"
"基于本课题的研究，笔者开发了一套大比例尺DLG自动可视化快速制图系统，解决大批量DLG数据库的地图的自动化生产和可视化地形图生产的问题。该系统很好的解决了各类地理要素的规范化和标准符号化，尤其是复杂图元要素方面的表达问题。系统通过一体化符号系统和要素间的逻辑规则化算法 图2. 制图系统总体架构 图3. 制图系统组件图 Table 3 功能模块 测试需求项 代码覆盖率 测试结果 基础功能(白盒测试) 地理空间参考定义管理 100% 通过 空间拓扑与空间运算 100% 通过 空间索引 100% 通过 服务交互通讯接口 100% 通过 地理要素表达接口 100% 通过 制图业务功能(黑盒测试) 数据库导入 通过 控制参数设置 通过 类涵洞、桥梁多边形方向识别 通过99.2% ≥ 95% 地图符号化 通过99.1% ≥ 95% 处理要素公共边 通过 图框添加与定制 通过 要素叠置控制 通过 一键成图批处理 通过 成果输出 通过 表3. 功能测试情况表 Table 4 执行效率测试要点 数量 单位 耗时(s) 测试结果 面要素求交集 10,526 个 6.1 通过 面要素求并集 10,526 个 5.9 通过 求面要素缓冲区 10,526 个 1.1 通过 线要素构建区 6751 个 5.3 通过 数据库数据导入 200 幅 460 通过 交换数据输出 200 幅 860 通过 一键出图功能测试 200 幅 18,461 通过 表4. 效率稳定性测试情况表 实现复杂图元要素的自动化构建，通过智能标注及多级叠置规则定义技术来优化各类要素之间的制图关系表达。系统成功地对大量湖南省不动产数据进行了自动化制图，达到了良好的成图效果，极大的提高了制图效率。对随机抽取的200余幅地形图处理效率为每幅92秒，每幅图自动化完成制图工作量的95%以上。 目前系统还存在以下不足，需要在下一步工作中对系统进行优化。 1) 当前版本的自动化制图系统还不支持分布式工作协同，计划下一步研究使用结构化网络自动实现制图工作分配和任务派发。 2) 由于AutoCAD平台的数据加载方式还不支持动态缓冲式加载，无法支持超大数据量的分景图制图任务，计划向Autodesk Map 3D平台迁移以解决该问题。"
