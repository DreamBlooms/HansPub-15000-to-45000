"本文以硬币分拣装置的控制为研究对象，重点讨论了基于DSP的硬币整理机器的控制系统设计，主要阐述了电涡流传感器的硬币检伪、光电计数器的硬币计数检测、步进电机的细分控制等模块的研究。通过各个模块的协调配合实现了混杂硬币的分拣、检伪、包装等功能。 关键词 :DSP，电涡流传感器，步进电机，数据处理"
"本文所设计的是针对集硬币分类、整理、包装和检伪功能为一体的装置的控制系统。系统主要由硬币分类及检伪模块、整理模块、硬币包装模块三大模块组成。目前，我国许多金融机构没有专门的硬币分类、清点、整理设备，多道工序目前仍停留在手工操作层面上，劳动强度大，工作效率低。针对国外硬币处理机来说，无论是大型还是小型都有一定的水平，技术较成熟，但是价格昂贵 [ 1 ] [ 2 ] 。本设计以分拣盘、导轨及包装滚柱为主要元素构建机械结构，尽可能地减少了机器体积以及成本。电涡流传感器被广泛用于硬币的识别中，但是利用互感原理引起阻抗变化进而通过分辨相位方法识别的研究尚未出现，本文设计了一种基于相位变化鉴别硬币真伪的方法，是一种创新性的设计方法。此外，使用相位鉴别硬币具有信号采集处理简单，精度高，实时性强等优点。 在包装控制方面，步进电机的驱动采用了细分电流的驱动方法，能够细分步进电机的步进角，减少步进电机运动的误差，同时该技术相当成熟，拥有许多成熟的IC可以使用，可以减少工作量以及提高系统稳定性。 软件开发环境我们选择了CCS，CCS是TI公司提供的集成开发环境，采用TI公司的C编译器，针对DSP的独特性能要求进行了编译优化，使C语言能够充分发挥DSP的强大处理能力。"
"本文所针对的是集硬币分类、整理、包装和检伪功能为一体的装置。机械系统主要由硬币规整及检伪模块、硬币分类模块、硬币包装模块三大模块组成，如图1所示。 图1. 整体机械系统结构图"
"系统控制结构如图2所示，主要分为电涡流传感器检伪、光电计数器计数、电磁铁开关、步进电机等四个模块组成。  电涡流传感器的原理如图3所示，根据法拉第电磁感应定律，一个通有交变电流 的线圈，将在线圈周围空间会产生一个交变磁场 ，若被测导体在该范围内，金属导体内就会有感应电流 产生，由于这种电流的路径在金属导体内是闭合的，会在导体内产生电涡流。所以被测导体会产生电涡流 ，以及一个交变磁场 ，且 与 方向相反，力图削弱 的作用，从而使线圈的电感量、阻抗和品质因素发生变化 [ 3 ] 。 为了简化分析，可将电涡流看成是一个线圈和一个电阻构成的闭合回路，故电涡流传感器的等效电路如下图4所示： 图2. 系统模块结构 图3. 电涡流传感器原理图 图4. 电涡流传感器等效电路 图中 ， 为电涡流传感器的电阻和电感， ， 为被测导体的等效电阻和电感。两者之间的互感系数为M，激励电压为 ，根据基尔霍夫电压定律，有： (1) 由式(1)解出等效阻抗为： (2) 由式(2)可得探头线圈的等效电阻和电感分别为： (3) (4) 由式(3)、(4)可以看出探头线圈的等效电阻增大，等效电感减小 [ 4 ] 。考虑到线圈的等效阻抗还与探头距离导体的距离、被测导体的磁导率、电阻率和激励电流的频率有关。因此，探头线圈的等效阻抗Z与以上因素的关系可以表示为： (5) 其中， 为线圈探头距离导体的距离； 为被测导体的磁导率； 为被测导体的电阻率； 为线圈中激励电流的频率。 所以，在硬币分拣装置检测中，当不同的硬币经过探头时，等效阻抗会不相同，电压信号的相位会发生变化。由此可以通过对比数据库中的真值与测量值的差异来判断被测硬币的真假，实现对硬币的检伪工作。 检伪中传感器首先需进行“学习”任务，传感器采集真币的数据，经转换电路将其转换成电压信号，然后通过相敏检波电路得到信号相位，再经过模数转换后进入DSP，将采集到的瞬时信息输入DSP处理器，将其与DSP数据库中的真币数据进行对比分析，从而判断出被测硬币的真假。传感器电路空载时的电路波形图如图5所示： 图5. 电涡流传感器空载仿真图 由图5可知电路输出为1 v的正弦波，然后由相敏检波电路输出相位信号，再经过DSP内置ADC转换之后，就可以由DSP处理后判断真伪币。  由于激光对射式开关具有性能稳定、响应速度快、光扰小、寿命长等优点，故本次控制采用M12激光对射光电计数开关传感器对硬币进行计数。当有信号触发时，传感器输出低电平，DSP接收到信号后将数码管数字加1，计数次数达到50次时，将数码管的数字清零，同时处理器发出信号驱动开关将收币通道关闭，为下一步包装做好准备。之后的硬币停留在预备筒内。  步进电机可用于机械装置精确前进、后退和旋转等运动的控制，当没有超载时电机的转速、停止的位置只取决于脉冲信号的脉冲数，而不受负载变化的影响，而且它可以在较大的频率范围内通过改变脉冲频率实现速度调节。 当需要两相混合式步进电机具有更小的步距角时，可以对每次切换的电流做改变。若每次只改变绕组电流一部分，则转子只按比例转动歩距角的一部分，从而实现步进电机歩距角的细分。为此，定子绕组电流从一个方波变成阶梯状的波形。定子绕组电流是阶梯式的，电流细分成正弦阶梯状，每流过一个阶梯电流则转子就转动一微步，每流过一个正弦周期电流则转子就转动一个歩距角 [ 5 ] 。细分驱动方式是一种成本较低的控制方式，本次控制将采用两相混合式步进电机的细分驱动方式。 当在步进电机的两相绕组中通入如下相位关系的电流： (6) 按照式(6)对步进电机A、B相电流进行控制，转子转动角度大小即为α值，当i与α为离散值时，每当电流变化一个值时，则转子转动一个角度，从而实现了步进电机步进角的细分。因此，在实际应用中我们可以通过产生阶梯电流脉冲，产生拟合的正弦曲线，来进行步进电机的细分控制，细分步数即电流阶梯数。如图6所示： 图6. 细分电流曲线 实现方案： 产生细分电流的系统框如图7： 1) 理想波形发生器数学模型： 本次控制采用4细分电流来控制步进电机，其电流为： (7) 其中 、 为A、B相的电流值，t为步数，4为细分数。 先计算每步的电流值 、 ，然后存放在ROM中。运行时，计算机给ROM发出地址信号，ROM中的相应数据经过DA转换输出相应的电流值，其值作为理想电流值。 2) PID控制环节： 为了提高系统的稳定性和准确性，可在系统中串联PID控制器。为了方便实现，设计采用软件PID控制。其PID的微分模型为： (8) 对式(8)进行离散化处理，使模拟PID微分方程离散化成为数字PID差分方程。当传感器的采样周期足够小时，可作如下近似处理： (9) (10) (11) (12) 由式(9)、(10)、(11)、(12)、可得到数字PID差分模型为： (13) 通过DSP编程可实现软件PID算法 [ 6 ] 。 图7. 电流细分系统框图 3) PWM发生器 DSP从电流反馈采样电路中获取得到A、B相的实际电流值，与给定的A、B相电流值比较，求出其差值。然后，将差值信号经软件PID环节整形，再将整形后的信号送至DSP事件管理器的PWM产生模块，以产生有效输出信号。将PWM信号送至步进电机驱动芯片，由步进电机驱动芯片对PWM信号做功率放大和相应的整形等处理后输出呈拟正弦曲线波到步进电机绕组，最终达到对步进电机绕组电流的控制，以实现精确的步进角控制。 4) 电流反馈 电机A、B相绕组电流的采样信号从功率驱动电路的两个采样点以电压的形式输出，因为绕组电流存在正反向，则输出电压也存在正反向。这一电压需要送到电流反馈电路中进行限幅、偏置等处理。  如图8所示，系统的控制检测流程如下。"
"CCS (code composer studio) [ 7 ] 是TI公司提供的集成开发环境。CCS目前有CCS2000，CCS5000和CCS6000三个不同的型号。本次设计采用CCS2000。 使用CCS2000集成开发环境，可以很轻松的建立、管理工程，同时TI提供了强大的专为DSP优化的C语言编译器，可以通过C语言充分发挥DSP强大了处理能力。"
"对于硬币的实验对象，用电涡流传感器测试了不同硬币的特征电压值，选择了新版的1元、5角、1角和三种伪币(用游戏币代替)进行了测试，得到如图9数据曲线。 分析数据曲线可知，伪币的特征电压值范围与真币的特征电压值范围有明显的区分度，而且不同面值的真币之间也有一定的区分度，所以本次设计的传感器能将伪币检测出来。"
"本文以硬币分拣装置的系统控制为研究对象，重点讨论了基于DSP的硬币整理机器的控制系统设计，主要阐述了电涡流传感器的硬币检伪、光电计数器的硬币计数检测、步进电机的细分控制等系统的设计。 其中检伪传感器使用电涡流传感器，该传感器通过AD8950产生信号通过探头采集信号并进行后置处理，最后使用AD8302进行相位检测，从而区分真伪币。该传感器具有非接触、精度高、实时性好的特点，能够满足硬币分拣检伪的需要。 图8. 系统检测流程图 图9. 硬币特征电压值曲线 装置的动力系统主要由高精度的步进电机与传动系统等组成，通过细分电流的驱动方法，以达到很高的步进精度，从而保证硬币分拣装置机械运动的准确性。 使用CCS2000作为集成开发环境，可以在一个软件中完成代码工程的建立、管理、编译、调试等行为，同时可以发挥DSP的强大信号处理能力。"
