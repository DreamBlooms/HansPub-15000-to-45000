"为实现数控机床几何误差的快速检测与准确补偿，提出了基于6D激光干涉仪的误差检测与建模方法。基于多体系统理论构建了机床的空间误差模型。基于6D激光干涉仪完成了对机床几何误差的检测，并提出了6D误差与空间误差模型的适配方法。针对误差数据中存在的波浪型误差，提出了基于傅里叶级数的误差建模方法，其相比于多项式在精度上提升了15%。基于i5os系统对圆轨迹进行了误差的补偿实验，补偿后圆度提升了58.79%，对机床精度的提升具有重要意义。"
"几何误差作为机床误差检测中的关键部分，其与热误差共同占据了机床误差中的70%。相较与动态误差的时变性，几何误差具有不随环境和运行状态变化而改变的特性，因此几何误差的检测与补偿对于机床的精度提升具有极大的意义 [ 1 ] [ 2 ]。机床中不同部件上的几何误差共同作用最终会导致机床空间误差的产生，对于空间误差常用的模型是基于多体系统齐次坐标变换的方法进行构建 [ 3 ]。几何误差产生的原因是由于机床零部件的设计和本身制造精度上的偏差，以及由于部件装配过程中的不准确而引起的误差等。目前对几何误差的检测方法主要是以使用激光干涉仪为主的多线路径测量法主要有12线法 [ 4 ]、13线法 [ 5 ]、7线法 [ 6 ] 等。田文杰等 [ 7 ] 使用改进9线法，根据建立了几何误差的辨识模型，对误差进行辨识且实现了误差的溯源。目前，关于6D激光干涉仪的误差检测与误差模型适配上的研究还比较少。 几何误差具有位置相关性，对其进行有效的参数建模以达到准确的表述和预测几何误差的效果，成为了误差检测中与补偿的关键因素。郭然等 [ 8 ] 多项式表达的不足针对提出了基于切比雪夫多想是的几何误差参数化建模方法。冷寿阳等 [ 9 ] 提出了基于勒让德多项式的几何误差建模方法，对加工中心的几何误差进行了准确的预测。目前对于几何误差的参数化建模主要是采用多项式以及多项式的相关展开去构建。对于多项式建模的问题在于难以确定多项式的次数使之在过拟合的前提下保证其准确性。对于一些具有波浪型的误差而言，使用多项式进行误差的建模，在准确度上不够理想，无法准确表达误差。 综上，本文从6D激光干涉仪的检测与参数建模出发，提出了6D误差与空间误差模型的适配方法，针对多项式表达不足，提出了基于傅里叶级数的参数化建模方法，有效的提升了误差预测的精度。最后，以圆轨迹的误差预测与基于i5os系统的补偿证明了误差辨识与参数建模方法的有效性。"
"以常见的立式加工中心为例，一般其由X、Y、Z三个直线轴以及床身立柱主轴等部件等组成，三个直线轴由于本身的制造精度和装配误差，在运动的过程中会产生6个空间自由度的误差。以X轴为例，其误差的几何意思如下图1所示。当工作台在沿X方向运动的过程中分别会产生沿X方向的定位误差 d x ( x ) 和Y方向的直线度误差 d y ( x ) 以及Z方向的直线度误差 d z ( x ) ；以及绕X的角度误差 ε x x ，绕Y的角度误差 ε x y 和绕Z的角度误差 ε x z 。在21项几何误差中，以直线度的基准直线作为轴的位置，所以轴与轴的位置并不是准直的，以垂直度误差 S x y 、 S x z 、 S y z 分别表示X轴和Y轴，X轴和Z轴以及Y轴和Z轴间的垂直度误差。对于上述误差在运动学建模中对正方向做出如下规定：以右手笛卡尔坐标系规定线性误差的正方向：与坐标系正方向一致的为误差为正；将角度误差以满足右手螺旋法则的误差为正。 图1. X轴6项误差的几何意义 针对机床运动部件在运动过程中的6项自由度误差，使用API XD-6D激光干涉仪作为检测工具为例，单轴单次检测可以得到6项自由度误差，可以极大的提升检测效率。由于测量的数据主要用于探究数控机床的误差，选取了较小的测量间距，各轴的测量信息如下表1所示。根据国标中的相关规定，对于运动轴每个测量点位上至少需要往返4个方向上的测量值，所以以往返5次进行测量，取平均值作为误差数据。检测前先对机床实行1小时的热机，以尽量减小在检测中由于热误差所带来的影响。由于机床低速运动的误差来源主要是几何误差，所以选取的测量时运动轴的进给速度F = 200 mm/min，检测现场如图2所示。 Table 1 直线轴 X轴 Y轴 Z轴 起点坐标/mm (0, 163.626, 243.220) (−212.772, 0, −342.094) (−290.704, −294.885, 0) 终点坐标/mm (500, 163.626, 243.220) (−212.772, −400, −342.094) (−290.704, −294.885, −300) 测量间距/mm 10 10 10 表1. 直线轴检测的起点坐标 图2. 几何误差检测现场 使用MATLAB编写的程序对API检测的数据进行提取。由于检测数据默认的6D方向会与误差模型中的规定的6D误差的方存在部分不一致的情况，需要进行一定的转换。以X轴的检测数据为例，其转换关系如下表2所示。对于线性误差部分而言，定位误差、水平方向和竖直方向的直线度误差的正方向均符合右手笛卡尔坐标系的正方向，而在角度误差中偏摆角和俯仰角的误差正方向与误差模型中的正方向相反。 Table 2 项目 X轴误差项 符号 定位误差 X轴定位误差 d x ( x ) 直线度XX X轴Y方向直线度误差 d y ( x ) 直线度YY X轴Z方向直线度误差 d z ( x ) 角度A X轴偏摆角度误差(绕Z) − ε x z 角度B X轴俯仰角度误差(绕Y) − ε x y 角度C X轴滚转角度误差(绕X) ε x x 表2. X轴6D误差转换表 在水平方向和竖直方向的检测数据中，由于其耦合了余弦误差、垂直度误差、导轨的直线度误差和角度误差的影响，需要对这一综合的直线度检测数据进行解耦。根据直线度的定义，作为形状误差的一种，其是用于描述包容实际直线且距离最小的两条平行线之间的距离，用于描述直线是否准直，对于基准直线的选取使用最小二乘的方法得出直线度检测数据中的基准直线用以描述直线度偏差，如图3所示。 图3. 最小二乘法评定直线度 以X轴Y方向的直线度为例，如下式(1)所示： { Δ y x i = Δ y i − ( k x i + b ) ( k , b ) = min ∑ i = 1 n ( Δ y i − ( k x i + b ) ) (1) 上式中：k和b表示使用最小二乘法得到的基准直线的斜率和截距， Δ y x i 表示测量直线上第i点的真实直线度， Δ y i 表示测量直线上第i点的水平直线度测量数据， x i 表示测量直线上第i点相对于测量原点的坐标值。  以床身为参考坐标系，根据多体系统理论以及齐次坐标变换方法，可以得到运动链的传递关系：WCS→XCS→YCS→MCS→ZCS→SCS→TCS。各移动部件在运动过程中的理想运动和位姿的偏离用误差矩阵的方式进行描述，如表3所示： Table 3 轴 误差矩阵 X轴 Δ T x = [ 1 − ε x z ε x y d x ( x ) ε x z 1 − ε x x d y ( x ) − ε x y ε x x 1 d z ( x ) 0 0 0 1 ] Y轴 Δ T y = [ 1 − ε y z ε y y d x ( y ) − y S x y ε y z 1 − ε y x d y ( y ) − ε y y ε y x 1 d z ( y ) 0 0 0 1 ] Z轴 Δ T z = [ 1 − ε z z ε z y d x ( z ) − z S x z ε z z 1 − ε z x d y ( z ) − z S y z − ε z y ε z x 1 d z ( z ) 0 0 0 1 ] 表3. 运动部件的运动矩阵和误差矩阵 其中， d i ( j ) 表示j轴在i方向上的线性误差， ε j i 表示示j轴绕i方向上的角度误差( j = x , y , z ; i = x , y , z )。 一般情况下设各体的不存在静态误差，所以对应的静态误差矩阵为单位矩阵。根据理想状态和实际状态下刀具切削点在工件坐标系内的坐标差值可以得到由于几何误差而引起的刀具端的偏差量E的表达式为： { E = P T → M − P W → M P W → M = T Y P T Y → M Δ T y ⋅ T X P T X → Y Δ T x ⋅ P W P T → M = T Z P T Z → M Δ T z ⋅ P T (2) 上式中： T X P 、 T Y P 、 T Z P 分别表示X、Y、Z轴的静态位置矩阵； T X → Y 、 T Y → M 、 T Z → M 分别表示X、Y、Z轴的动态位置矩阵； P W 、 P T 分别表示工件对应点在工件坐标系内的坐标和刀具切削点在刀具坐标系内的坐标。 P W → M 、 P T → M 分别表示工件上刀具对应点和刀具切削点在参考坐标内的坐标。 对于半闭环或者开环的三轴机床而言，由于不存在光栅这一固定的基准，因此在建模的过程中上式(1)中各运动轴的静态位置矩阵可以是加工空间中的任意位置 [ 10 ]。因此，可以将上式中的误差模型进行简化，其具体的方法如下。 a) 记录下三轴检测时数控系统的示值，如表1所示，然后进行6D误差的检测。 b) 以三轴的交点作为误差的基准点，设其作为所有部件的坐标系的坐标原点，这样就可以将误差模型中的静态位置矩阵进行简化为单位矩阵，简化了误差表达式。 c) 将X、Y、Z三轴的误差减去基准点的对应误差，就可以得到相对于基准点的误差值。由于机床其他部件的位置限制以及6D传感器的安装限制等原因，会出现三个测量轴没有交点的情况，此时可以选取两轴的交点作为基准点，本文以X轴和Y轴的检测交点作为基准点，基准点的坐标为(163.626, −212.772, −290.704)。将上述各值带入误差模型中可以得到相对于基准点下的空间误差表达式为： { Δ x = − d x ( x ) − d x ( y ) + d x ( z ) − y ( ε x z + ε y z ) − z ( ε x y + ε y y ) + y S x y − z S x z Δ y = − d y ( x ) − d y ( y ) + d y ( z ) + x ε x z + z ( ε x x + ε y x ) − z S y z Δ z = − d z ( x ) − d z ( y ) + d y ( z ) − x ε x y + y ( ε x x + ε y x ) (3) 式中： Δ x 、 Δ y 、 Δ z 分别表示X、Y、Z方向的偏离误差；各项几何误差都是相对于基准点的相对误差值。"
"目前对于几何误差的参数化建模主要是采用多项式以及多项式的相关展开去构建。对于多项式建模的问题在于难以确定多项式的次数使之在过拟合的前提下保证其准确性。对于一些下弯型或者悬臂型的误差而言，多项式能够较为准确的对误差进行表达。对于一些波浪型的误差而言，如Y轴的定位误差，如图4所示，使用多项式进行误差的建模，在准确度上不够理想，无法准确表达误差。 图4. Y轴的定位误差 考虑到误差的波动性，对此本文提出一种基于傅里叶级数的误差项参数化建模方法。通常，3~5阶的傅里叶级数能够有效的表达误差变化规律，傅里叶级数的阶数越高对于几何误差的表述越准确，但是阶数过高会引入参数过多的问题，使得表达式过于复杂。以Y轴的定位误差为例，以三阶傅里叶级数对误差进行参数化建模，其表达式如下所示。 Δ y = a 0 + ∑ n = 1 3 ( a n sin n y + b n cos n y ) (4) 将上式更改为矩阵形式，在MATLAB中使用最小二乘法对傅里叶级数的系数进行求解。 Δ y = C ⋅ P (5) 式中： P = [ a 0 a 1 b 1 a 2 b 2 a 3 b 3 ] T C = [ 1 sin y 1 cos y 1 sin 2 y 1 cos 2 y 1 sin 3 y 1 cos 3 y 1 1 sin y 2 cos y 2 sin 2 y 2 cos 2 y 2 sin 3 y 2 cos 3 y 2 ⋮ ⋮ ⋮ ⋮ ⋮ ⋮ ⋮ 1 sin y m cos y m sin 2 y m cos 2 y m sin 3 y m cos 3 y m ] 以Y轴的定位误差为例，进行基于3阶傅里叶级数的参数化误差建模实例，得到的误差拟合曲线与7阶的多项式拟合误差进行对比，如图5所示。 图5. 多项式与傅里叶级数拟合对比 3阶傅里叶级数相比7阶多项式，能够更加有效的对这一类波浪型误差进行表述，残差能够有效控制在2 μm以内。对于实际的加工而言，任意位置的尺寸超差都会引起工件的报废，所以对于误差检测与补偿的评定应该整个行程上的残差绝对值的最大值emax应作为评价标准之一。其次确定系数R 2 可以度量拟合优度，其值的取值范围为[0, 1]，其值越接近1表示拟合越好。SSE表示残差平方和，均方根误差RMSE表示拟合曲线和原始数据的接近程度，其值越小表示拟合越好，上述参数的表达式如下： R 2 = 1 − ( ∑ i = 1 n ( y i − y ˜ i ) 2 ) ∑ i = 1 n ( y i − y ¯ i ) 2 (6) SSE = ∑ i = 1 n ( y ˜ i − y i ) 2 (7) RMSE = 1 n ∑ i = 1 n ( y i − y ˜ i ) 2 (8) 上式中： y i 是实际测量值； y ¯ i 是实际测量值的平均值； y ˜ i 是模型预测值。 Table 4 拟合方法 emax(μm) R 2 SSE RMSE 3阶傅里叶 1.69 0.8815 2.85 × 10 −5 0.00093 7阶多项式 1.99 0.8666 3.22 × 10 −5 0.00099 表4. 拟合评价参数对比表 由上表4可得，对于3阶傅里叶级数和7阶多项式在未知参数相等的情况下，3阶傅里叶级数的各项拟合指标均优于多项式拟合，从最大残差的绝对值来看，3阶傅里叶级数的拟合准确性相比的多项式提高了15%。"
"圆轨迹检测以两轴联动方式以球杆仪作为检测工具进行圆弧检测，在联动的过程中所引入的动态结合误差数量也较多。球杆仪是一种用于检测机床综合误差的精密仪器，相比于激光干涉仪具有设备价格低，测量效率高，操作简便的特点，但是由于检测轨迹的限制，不能检测出单轴的几何误差量，所以常用与机床的检验中。对于圆轨迹的误差验证工作流程，如下图6所示，在XOY平面上任意选取一个位置，预测半径为100 mm的圆轨迹，使用RenishawQC-20 W无线球杆系统进行实际的轨迹误差检测，并进行对比。 图6. 圆轨迹误差预测流程图 选取点(343.507, −285.090, −286.430)作为圆心，检测的半径为100 mm，安装球杆仪进行检测。虽然在球杆仪的软件中带有除去由于底座和主轴的中心杯具不对中而引起的偏置误差，但是在安装的过程中尽量对中，以减小中心偏置的量。为例尽量的获得更多的检测数据，选取的运动轴的进给率为200 mm/min，按照先逆时针后顺时针的方法进行检测，检测现场如图7所示，按照上述流程产生了圆轨迹的预测与实际的对比图如图8所示。 图7. 球杆仪实验现场图 图8. 圆轨迹误差预测图 预测的轨迹与实际测得数据相符并且趋势一致，最大残差仅为4.5 μm。理论上经过误差模型预测后，若该部分误差能够全部进行补偿，则理想补偿后的圆的圆度应为7.1 μm，可以提升64.32%。因此可以证明基于多体系统理论构建的误差模型以及使用API激光干涉仪测得的数据以及对其6D误差的处理方法能够准确的预测出机床的空间误差，为机床的精度提升提供了坚实的基础。  i5os数控系统是由沈阳机床开发，该系统依靠Finch高速通信组件使得上层软件能够实时的读取CNC中的参数信息，依托该功能，开发了基于i5os的误差实时补偿系统，在补偿软件中，由于能够读取当前运动轴位置这样的实时性，可以有效的结合基于傅里叶级数的参数化误差建模方法，将测得的几何误差，使用参数化建模，根据Finch组件读取运动轴当前位置等相关信息，生成该位置下的几何误差，根据空间误差模型得到该点下的空间误差，并实时写入CNC的运动控制模块中，实现空间误差补偿功能。为了验证该补偿平台的有效性，在(343.507, −285.090, −286.430)位置进行圆轨迹的补偿实验，实验现场图和补偿前后的对比图如下所示。 图9. 圆轨迹补偿前后对比图 在图9中，补偿前由球杆仪测得的原始误差中，圆度误差为19.9微米，中心偏置X和Y分别为−5.2 μm和1.8 μm。补偿后的圆度误差为8.2 μm，中心偏置X和Y分别为−0.5 μm和3.0 μm。在XOY平面上进行圆轨迹检测，经过补偿后圆度提升了58.79%，有效的对圆轨迹误差进行了补偿，证明了补偿软件的有效性，同时可以基本达到补偿的预期。虽然并没有达到理想补偿后的圆度值，略有细微的不足，其可能的原因在于实验时按照补偿前和补偿后进行的，由于进给率较小，造成机床的运行过程中不免引入的热误差的影响，造成后面一次的圆度值偏大。"
"本文以数控机床的几何误差建模以及补偿为研究内容，以立式加工中心机床的为例，构建了空间误差模型，并基于API XD-6D激光干涉仪对运动轴的几何误差进行了检测与转换。针对机床常见的波浪型误差提出了基于傅里叶级数的几何误差参数化建模方法，证明了该方法在同等系数个数的情况下，相比于多项式在残差最大值上减小了15%，同时各项拟合评价参数均优于多项式误差表达。根据空间误差表达式结合傅里叶级数的参数建模方法对使用球杆仪实测的圆轨迹进行了准确的预测，证明了模型的准确性。基于i5os系统编写了误差补偿软件，对圆轨迹进行了补偿实验，经过补偿后的圆轨迹精度提升了58.79%，证明了补偿软件的有效，同时也证明了基于6D激光干涉仪的机床误差检测与建模方法在工程中的准确性与实用性。"
