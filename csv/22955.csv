"为适应运动状态下的心率检测，以低功耗微控制器STC11L01E为控制核心，采用性能优秀的绿光光电反射式传感器SON1303采集心率信号，并通过滤波、放大、信号调理再送入微控制器处理，设计平滑抗干扰算法得到的心率数据由数码管实时显示，在心率失常时给出报警信号。经实物检测心率准确率达到98%以上，可有效检测心率。整个系统采用低功耗设计。 关键词 :运动心率，光电传感器SON1303，心率计算，低功耗 Copyright © 2017 by author and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"心率是用来描述心动周期的专业术语，是指心脏每分钟跳动的次数。它是一项重要的人体机能指标，也是初步判断心脏及身体是否正常的指标。现有的心率仪主要适用于静态心率测量，大多采用成本较低的透射式光电器件作为心率信号采集器。而运动状态下因晃动、光线、皮肤差异等干扰因素导致测量误差大，甚至失效 [ 1 ] [ 2 ] [ 3 ] [ 4 ] [ 5 ] 。本心率仪就是一个可穿戴智能电子小设备。主要采用性能优越的绿光反射式光电传感器采集心率信号，可对静止或运动状态下心率进行较精准的监测，并对不同年龄心率特征的一般范围进行监测，当超出范围时给予声音警示。 脉搏为体表可触摸到的动脉搏动 [ 6 ] 。心脏的左心室周期性收缩将血液挤压流入主动脉，血流压力以波的形式从主动脉根部开始沿着整个动脉系统传播，这种波称为脉搏波。脉搏波所呈现出的形态、强度、速率和节律等方面的综合信息，作业医疗诊断的依据。身体正常时心率与脉搏是相等的，脉搏的测量更容易实现，因此测心率实质上就是测一分钟内的脉搏次数。"
"本文主要讨论便携式较精确的检测方法。中医把脉只能粗略感知心率，且受主观经验与感觉影响大。医疗上通过测量心电图算出心率太复杂。目前脉搏波的测量方法常用的有光电容积法和压电式测量法。PVDF (极化的聚偏氟乙烯)压力传感器由于测压端面积较大 [ 7 ] ，将产生位置相关性影响，且采用直接接触法还会产生一系列不利的影响。故本文采用光电检测法。 光电法是基于郎伯－比尔(lamber-beer)定律，即物质在一定波长处的吸光度和他的浓度成正比，当恒定波长的光照射到人体组织上时，通过人体组织吸收、反射衰减后测量到的光强在一定程度上反映了被照射部位组织的结构特征。人体皮肤、肌肉、骨骼等非血液组织的光吸收量是恒定的，而静脉血的搏动相对于动脉血十分微弱可忽略，故定波长光源照射在体表的光强变化就反映了血容积搏动，如图1所示。 图1. 光电式检测脉搏原理示意图"
"3. 选择光电式脉搏传感器SON1303 [ 8 ] 光电式脉搏传感器主要由光源、光敏器件、信号调理控制电路构成。因采用不同的光敏元件而有多种实现方法。光敏元件主要有光敏电阻、光敏二极管、光敏三极管和硅光电池。光敏元器件输出的电流极低易受到外界干扰，而且对后续的放大器的要求较高，故经光敏元件及后继的信号处理、放大、调理电路等构成的分立式脉搏采集电路较复杂，易受众多干扰，检测不稳定。集成脉搏传感器具有结构简单、无损伤、体积小、功耗低、可重复好等优点，故本设计选用反射式光电脉搏传感器SON1303，符合运动心率仪可穿戴、便携、低功耗、精确可靠的要求。 SON1303是一款超低功耗的心率传感器，适用于可佩戴式智能电子产品、手机、医疗器械等领域。为使检测更灵敏稳定，对光源和光敏元件协调设计，光源是波长为570 nm的双绿光LED；光敏元件为高灵敏度光感IC，接收端波长也匹配为570 nm，且涂有对应波长的纳米涂层，故光源的波长落在光敏元件检测灵敏度较高的波段，比红光更能实现高感度测量。绿色LED和高科技纳米涂层环境光检查传感器组合封装入小型COB封装，内部集成一级放大器，比普通光敏器件性能与灵敏度更优，可自由灵活的测量身体部位。当光源发出的光照射在组织上，经反射后被光敏元件接收并将脉动的光强度信号转变为脉动的电信号。再对交直流信号分离，从而得到光电容积脉搏波(图2)。 SON1303具体特性如下： 1) 高集成度(双绿光LED，绿光源信噪比、温漂、信号质量更好；高灵敏度光感IC；前段运放IC) 2) 超低功耗(<0.5 mA) 3) 尺寸很小(4 × 2 × 1.05毫米) 4) 高灵敏度：无需晶振 5) 工作电压、电流：2.3 V~6 V；12 mA； 6) 输出电流：Io(max) = 5 μA 7) 均值电压为3 V 8) 输出电压Vout 取决于RL和Io的值： Vout ( MAX ) = IO ( MAX ) ∗ RL < VO (SAT) 图2. SON1303内部电路及外围转换电路"
"本运动心率仪的系统框图如图3所示。由反射式光电传感器检测到心率信号并处理后进行显示，包括即时显示和定时显示。本心率仪设5种模式，默认模式的检测范围为50~150；其他模式为成人(60~100)、老人(55~65)、幼儿(90~100)、儿童(80~90)。当心率超过各模式的范围时通过声音报警5秒。存储功能也分按键即时存储和自动定时存储。查看功能也分即时查看、近期查看和定期查看。 4.2. 选择单片机STC11L01E [ 9 ] 因系统可便携要求低功耗，并可掉电存储数据，外围接口所需引脚约16，故选择STC11L01E单片机，它的特征如下： 电压：3.6~2.1 V FLASH ROM：1 K；EEPROM：2 K；SRAM：256 定时器：2；UART：1 IO：16 (20-SOP封装) 另外还有：看门狗、内置复位、内部低压中断、掉电唤醒专用定时器、5个掉电唤醒外部中断等。  信号检测电路如图4所示。在其内部已对信号做一级放大，最高幅值约为： Vout ( MAX ) = IO ( MAX ) ∗ RL = 5   μA ∗ 3 0   K = 15 0 mV 图3. 心率检测系统框图 图4. 基于SON1303的心率信号检测电路 此脉冲信号非常微弱，且频率很低(如脉搏50次/分钟为0.78 Hz，200次/分钟为3.33 Hz)，还伴有各种噪声干扰，故该信号经过如图5电路处理，包括C4隔直流、二级放大变换为正弦波、再经三级整形滤波放大为方波。图5中的发光管是心率的指示灯，随心脏率动闪烁。图5的信号处理电路封装为SON3130，工作电压范围从2.1 V到5.5 V (配合心率监测电路时通常为3 V供电)，提供1 MHz的频率带宽，工作电流可低至60微安，偏置电流为10 PA，配合SON1303心率传感器可达到非常低的功耗。  主要控制部分电路如图6所示 [ 10 ] 。图6中的信号输入端与图5右上角“输出方波端连接”。  系统整体流程如图7所示。主要环节及处理方法如下： 图5. 后继信号处理电路原理图 图6. 心率控制部分电路原理图 图7. 简易心率仪控制流程图 1) 模式切换：在外中断0的服务程序中作出模式标识数据，以供在主程序中判断模式并执行相关程序。 2) 心率存储：数据存储在单片机内部EEPROM中，分自动和按键存储。a) 自动定时存储：每天固定7点自动进行心率数据监测存储，每周日12点依次显示存储的七天的心率数据，并通过声音提醒用户查看。b) 按键存储：在外中断1的服务程序中完成，存储当下及接下来的10分钟的心率值，每分钟记录一个值。 3) 查看心率：通过T0 (设计为外中断用)中断服务程序完成。并联共阳数码管的显示通过定时中断扫描完成。为省电，显示器不显示，第一次按“查看”键时才显示此刻的心率值。第二次按“查看”可查看最近10分钟的心率数据。第三次按“查看”键，可查看一周定点的7个心率值。 4) 心率计算：经传感器采集与处理后的心率信号近似为方波的矩形波，故可按数字信号处理，检测该信号的周期，便可计算出心率值。考虑到运动带来的干扰，心率算法中加入滤除干扰脉冲的处理。心率信号接入单片机T1脚，在程序中检测T1脚的电平，此处检测T1的上升沿，第一个上升沿便开始计时，若脉宽 < 50 ms，则认为是干扰，重新检测；为有效信号时，等待第二个上升沿到来时停止计时，这个时长便是心率周期。连续检测8个心率周期数据，去最大、最小值，再求平均数，经计算便得到修正心率值。因心率是低频信号，如50~240心率值对应周期是1.2 s~250 ms，而51内核的单片机一般最大定时值约60 ms，不能直接记录心率周期。故取基本定时值5 ms为计时单位，则心率为50时只要记数240个5 ms，极限心率240时只要记录50个5 ms，即能保证计时精度也方便8位单片机的数据处理。  本心率仪与医院的电子血压脉搏计及装有检测心率APP的手机参照比较，结果如表1，可见实际误差在2%以内。"
"采用新型可穿戴的反射式光电传感器和后继的信号处理电路采集到了心率的方波信号，经单片机控制系统处理后能正确显示出心率数值，当心率值超出各模式下预设范围时能发声报警。应用单片机内的EEPROM还可存储、查看心率数据。经软件处理对即时心率、短期心率有一定过程性的监测，起到一定的健康监护作用。本心率仪采用低功耗设计，采用3 V电池供电即可，经对比测试分析，是性价比较好的便携式智能健康小装备，准确率达到98%以上。 Table 1 心率1 心率2 心率3 心率4 心率5 心率6 心率7 医院 53 62 76 83 110 136 151 手机 55 64 73 81 115 145 160 本心率仪 (误差) 54 63 75 82 110 135 153 默认模式下，发声报警 1.8% 1.6% 1.3% 1.2% 0 0.74% 1.3% 表1. 系统测试数据记录与分析"
