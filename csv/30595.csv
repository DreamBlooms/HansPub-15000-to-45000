"为提高工程图的绘制效率，提出应用基于实例推理尺寸自动标注技术，结合实例库构造方法和图形检索技术，提出图元重定义方法和设计实例的知识表达方法，给出了相似推理标注的算法，并合理布局尺寸，最终实现尺寸的自动标注。最后结合轴类零件的标注实例，验证了此方法的可行性。 关键词 :案例推理，图形检索，图元重定义，自动标注 Copyright © 2019 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"工程图纸是表达机械零件结构形状、尺寸大小和技术要求的图样，是零件生产制造过程中的重要技术文件。工程图纸中的尺寸标注代表了零件的尺寸信息和加工工艺要求等，但是在图纸绘制过程中，尺寸标注仍然是一项繁琐的工作，占用大量的绘图时间，如果能实现工程图纸中零件的尺寸自动标注功能，则能够很好地提高工作人员的绘图效率。虽然目前存在一些尺寸自动标注方法，但是大多数方法只能识别一下特征，尺寸标注的很多知识很难形成比较固定的模型 [ 1 ] ，往往需要应用到以往的标注经验来完成，基于实例推理的方法恰好能够利用以往的经验来完成新的任务。 基于实例推理是一种应用过去的经验解决现在问题的一种技术方法 [ 2 ] 。基于实例推理的过程主要分为四个步骤，案例检索、案例重用、案例修改和案例存储 [ 3 ] 。首先将已经标注好的工程图纸作为实例和经验的来源，建立实例库，其次根据给定的目标图纸检索从实例库中检索出相似或者相同案例，然后通过比较实例和目标图纸来确定目标图纸的尺寸标注，最后将得到标注方案或者进行修改后得到的标注方案。若是得到的标注方案可以直接应用，则即可实现自动标注，若是修改后可以应用，可将修改后的标注方案和图纸作为新的案例存储到案例库中。"
"实例图形可以分两层来看，见图1所示，第一层是作为一个完整的图形来看，主要进行图形检索案，第二层是实例知识表达的设计，主要是便于通过对比案例图纸和目标图纸之后，推理出目标图纸中需要添加标注信息的具体位置和标注类型。图形由数量不等的种类不同的图元组成，案例图可以分为图元对象和标注两部分，标注和图元对象是一一对应关系。 图1. 实例工程图的组成  组成图形的图元主要点、线、弧和圆等几种。为了便于推理标注过程的完成，重新定义图元概念。  一般在绘图软件中定义点的组成元素只有x、y、z轴的三个坐标值，如果只通过坐标值的话并不能判断两个点是否相似，所以在这里重新定义点的属性。 定义1点是由坐标值、二进制属性值和邻接数组组成的。 定义一中坐标值有x、y、z轴三个方向的坐标值，二进制属性值为一个32位的二进制数，邻接数组为大小为8的数组，见图2所示。32位二进制数的第1到第8位代表见图2中0点的8个方向的位置是否存在一点点和点0有直线相连。第9到第24位代表圆弧连接点的和点的连接情况，每位数的具体意义在圆弧重定义中介绍。第25到32位为预留位，不做计算用。其中0点和2、4、6、8方向的点的连线和相邻的两条线的夹角范围是0到90度。点的邻接数组为这个点的1到8之间八个方向的点的二进制属性值。 图2. 点的重定义  通常线段的定义一般由起点、起点坐标和终点、终点坐标组成，为了便于实现推理过程，给线段添加了一些属性。 定义2线段是由起点、终点和中点和线型组成，其中起点包括起点坐标值，起点二进制属性值和起点的邻接数组，终点包括终点坐标值，终点二进制属性值和终点的邻接数组，中点包括中点坐标值。  圆的组成元素主要有圆心坐标和半径或直径，这里添加类类似于点的二进制属性值的属性。 定义3圆是由圆心坐标、半径、象限点和圆心二进制属性值组成。 重定义后的圆添加了4个象限点和圆心的二进制属性值，象限点位置见图3所示，图中a、b、c、d四个点代表中间圆o的四个象限点。圆心的二进制属性值为一个八位二进制数，从第一位到第八位分别代表在圆o的1到8位置上是否存在一个圆，若存在，则相应二进制位置为1，否则置为0，图3中中间圆的圆心二进制属性值为11111111。  圆弧即为圆上任意两点之间的部分。通常由一个圆心、圆的半径和圆弧起始点可以确定一个圆弧，这里对圆弧添加一些属性。 定义 4圆弧为某一个圆上任意两点之间的部分，圆弧属性包括这个圆重定义后的属性，同时还包括圆弧起始点二进制属性值、圆弧起始点的邻接数组以及圆弧角度。 图3. 圆的重定义 首先定义圆弧起点到圆弧终点方向为顺时针方向，即从圆弧一个端点A沿弧线到圆弧另一个端点B走，如果是顺时针方向走，则这个端点A为圆弧起点，B为圆弧终点，否则A为圆弧终点，B为圆弧起点。圆弧起始点的属性包括点重定义后的全部属性。其中，点得32位二进制属性值的第9到24位意义代表圆弧起始点的位置，若圆弧起点位于第1、2、3、4象限内，则二进制数第9、10、11、12位置1，否则置0；若圆弧起点位于第a、b、c、d象限点上，则二进制数第17、18、19、20位置1，否则置为0；若圆弧终点位于第1、2、3、4象限内，则二进制数第13、14、15、16位置1，否则置0；若圆弧终点位于第a、b、c、d象限点上，则二进制数第21、22、23、24位置1，否则置为0。  图元对象的相似指在不同工程图中的两个图元对象的相似性。如果处在不同工程图中的两个点有相同的二进制属性值，则说这两个点是相似的；若果不能通过二进制属性值判定两点的相似性，则可以继续比较两点的邻接数组。线段的相似，指在处在不同工程图中的两条线段有相同的起始点的二进制属性值。圆的相似是指处在不同工程图中的两个圆有相同的圆心二进制属性值。圆弧的相似指在不同的工程图中，如果两个圆弧有相同的起点属性和重点属性，则说明两个圆弧是相似的，如果不能只通过起始点判断圆弧是否相似，则可以继续通过两个圆弧的圆心二进制属性值判断两圆弧是否相似。  添加标注信息首先要确定一个标注对象，根据标注的组成形式 [ 4 ] 和标注类型 [ 5 ] [ 6 ] ，一个完整标注的确定包括几个必要的元素：标注对象、标注放置点、标注类型和标注文字，见图4所示。 图4. 标注组成元素 轴类零件中常用的标注类型包括对其标注、线性标注、圆的直径标注、轴体的直径标注、角度标注、倒角标注等 [ 7 ] ，每种标注类型都有必要组成元素，根据这些组成元素设计成标注模板，当工程图中有需要标注的对象时，直接对对象套用标注模板添加标注信息。通常，一个标注信息的添加是在工程图中一个图元对象上或者两个图元对象之间添加标注，对于图4中的标注可以认为是在线段12上添加的对其标注，也可以认为是在点1和点2之间添加的对齐标注。常用标注组成见图5所示。 图5. 常用标注及其组成"
"首先从实例库中检索出和目标图纸相似或者相同的案例，然后根据检索结果，将目标图形和实例图形分别根据图元重定义的概念进行处理，得到目标图形的对象集合和实例图形的对象和标注的集合，根据两个集合的对比对目标图形进行推理标注。 自动推理标注算法如下： 1) 从实例库中检索和目标工程图相似的实例。 2) 如果检索不到相似实例，则进行人工标注，然后将人工标注后的结果作为新的实例添加到实例库中，结束流程；否则进行下一步。 3) 对检索到的相似实例根据图元重定义后的概念进行处理，得到标注对象集合D1{Di{Oi}|Di为标注类型，Oi为图元对象，Oi的个数可能为1个，也可能为2个}，集合中对象只存储如图1中有标注的对象。 4) 对目标工程图形根据图元重定义的概念进行处理，得到组成图形的图元对象的集合D2{Oj|Oj为图元对象}。 5) 从D1中取一个标注Di和相应的对象Oi，遍历D2，判断是否有对象Oj和Oi相似，如果有，对Oj添加标注，如果没有，则选择Di下一组对象，遍历D2进行对比标注，如此循环。 6) 当遍历完D1集合时结束整个过程。 推理过程只确定了目标图中需要添加标注的对象，当目标图中所有可能添加的标注信息确定之后，还要对尺寸检测，合理布局，防止出现尺寸干涉。完成尺寸布局之后得到的标注方案结果，即为推理得到的标注方案。"
"基于案例推理的轴类零件尺寸自动标注流程见图6所示。实例推理过程只是根据实例推理出图形中需要添加标注的对象，并不对尺寸排列处理，因此确定标注对象之后还要对尺寸进行布局规划 [ 8 ] 。 图6. 基于案例推理自动标注流程图"
"以VisualStudio2015为开发平台，在AutoCAD2016上进行测试自动标注结果。根据前文介绍，一个阶梯轴的需要添加标注的类型包括线性标注、对其标注、轴体直径标注、倒角标注等，一个阶梯轴的组成图元对象通常包括点、线和圆弧等，按照图元重定义的概念处理这些对象后，得到实例图的组成对象和标注集合见表1所示，得到目标工程图的组成图元对象集合见表2所示。 Table 1 标注类型 图元对象1 图元对象2 对象1属性值 对象2属性值 倒角 点 点 52 18 倒角 点 点 88 144 径向直径 点 点 52 133 径向直径 线 线 起点：20 终点：80 起点：5 终点：65 径向直径 点 点 88 67 径向直径 线 线 起点：20 终点：81 起点：5 终点：81 线性 点 点 18 144 线性 点 点 18 81 线性 点 点 20 80 线性 点(弧起点) 点(弧终点) 8256 320 线性 弧(象限点) 弧(象限点) 起点：65540 终点：4194308 起点：1048640 终点：262208 线性 点 弧(象限点) 5 起点：8256 终点：320 线性 点 弧(象限点) 18 起点：65540 终点：4194308 表1. 实例图的组成对象和标注的集合部分内容 Table 2 图元对象 属性值 数量 图元对象 属性值 数量 点 18 1 点 52 1 点 133 1 点 88 1 点 144 1 点 67 1 点 5 6 点 20 6 点 81 8 点 80 1 点 65 1 弧 起点：8256 终点：320 2 弧 起点：65540 终点：4194308 2 弧 起点：1048640 终点：262208 2 表2. 目标图的对象集合部分内容 逐一取实例中的标注类型和与之对应的标注对象，判断目标图中组成对象是否有相似的对象，有过有，则添加和实例标注相同类型的标注信息，标注结果如图7所示。 图7. 阶梯轴自动标注结果图"
"本文通过对图元进行重定义、对相似对象进行重定义并应用实例推理技术实现了轴类零件的尺寸自动标注。文章设计了图形知识表达方法和推理自动标注的算法，并以VisualStudio2015为开发平台、在AutoCAD2016上进行测试，得到较好的测验结果。由此可以得出，本文提出的图元重定义方法能够良好实现将图形从“形”到“二进制数”的转换，将图形特征相似转换为二进制数的对比，拓展了图形特征相似的方法，也证明了基于案例推理的方法在尺寸自动标注应用上具有良好的可行性和可靠性。"
