"论文提出了单相光伏并网逆变器NARX模型的系统辨识方法。针对商用光伏并网逆变器的“黑箱”特征，以及现有的线性化建模方法无法解决逆变器的强非线性问题，将单相光伏并网逆变器视为“黑箱”，无需逆变器内部电路、功率开关器件等拓扑结构和参数及其控制系统的类型和逻辑关系，仅仅利用逆变器输入–输出两侧的外部测量数据，基于NARX模型非线性系统辨识技术，可建立较为准确的数学模型，实现对商用光伏并网逆变器准确描述其动态特性的可能。辨识所得单相光伏并网逆变器NARX模型结构简单，运算量小，在模型的复杂性和模型的精确性方面取了很好的平衡，适用于电力系统对并网光伏发电系统的调度、联合运行与协调控制、随机模拟等需要快速建模与简单模型结构的研究领域。 关键词 :光伏，逆变器，系统辨识，NARX，黑箱"
"能源危机和气候变化是今天全球面临的主要挑战之一。作为人类应对这些挑战的努力，太阳能光伏产业应运而生。光伏发电通过大量逆变器接入电力系统，并网逆变器成为负责能量转换并提供必要控制的核心单元 [ 1 ] - [ 3 ] 。目前由逆变器供应商提供的数学模型都是基于分析建模法，主要包括状态空间平均法 [ 4 ] - [ 6 ] 、离散迭代映射法 [ 7 ] - [ 10 ] 、图形建模技术 [ 11 ] - [ 15 ] 、计算机分析软件(例如PSpice [ 16 ] [ 17 ] )和数学工具(例如小波变换 [ 18 ] )等。然而，上述分析建模法所需要逆变器的结构、参数、微分方程、控制类型及开关拓扑等信息，因各制造厂家的技术保密而无法全面了解，使用方难以判断其准确性，要通过逐个产品的验证测试来修正其模型，这对于设备使用方来说具有极大的难度，制约了分布式电源接入电力系统的建模、仿真、控制方法、电能质量等方面的研究与设计 [ 19 ] ，因此迫切需要提出新的分布式电源逆变器建模方法来满足新能源并网系统的理论分析与建设需求。 光伏并网逆变器的产品研发分成两个部分：拓扑结构和控制策略。现有对逆变器拓扑的研发，都是沿着拓扑发现、模态分析、参数设计、仿真和实验研究的步骤，这是一个典型电工学的研究方法。该方法的先天不足在于：首先假定逆变器拓扑结构可用的基础上开展研究的，而在进一步分析中完善拓扑，整个研究过程中不断重复错误、修正、改进的步骤，最终确定该逆变器有效性和特性；控制策略的研发都无需考虑逆变器模型，而是通过在实际中的不断调试来达到较好的控制效果 [ 20 ] 。因此，无论是拓扑结构还是控制策略的设计，都经历了不断调试的过程，这使得实际的光伏并网逆变器产品与原始的数学模型已经相去甚远，加上生产厂家的技术保密，设备使用方根本无法获得逆变器准确的数学模型，光伏并网逆变器表现出的是完全的“黑箱”特性。 光伏并网逆变器是一种开关型功率变换器，运行于开关状态；由于反馈控制环节的引入，功率开关器件的占空比随输入电压等发生变化，使得的占空比和输出之间是非线性的函数关系；构成光伏并网逆变器的元器件(包括开关器件、滤波元件、检测元件、控制器等)具有非线性，且参数在系统实际运行中会漂移变化；为了避免开关过程中桥臂直通现象的发生，在开关器件的驱动信号中设置了死区，死区效应是一种光伏并网逆变器内部的非线性扰动 [ 21 ] ；在光伏并网逆变器中存在着准周期、倍周期分岔、边界碰撞分岔、切分岔、环面破裂分岔、非混沌奇怪吸引子、共存吸引子、间歇性分岔和阵发混沌等丰富的非线性现象 [ 6 ] [ 7 ] ；因此，这决定了光伏并网逆变器是一种天然的强非线性系统。 现有逆变器数学模型研究均建立在线性电路的分析理论基础上，基本思路是线性化的方法，即对各个开关工作模态做时域上的平均处理，同时忽略其非线性部分，由此得出相应的数学模型。对于逆变器普遍存在的强非线性特征，此类方法具有较大的局限性，理论研究不能完全与实际相吻合，无法很好地解决开关非线性的问题，尤其不具有一般和广泛的适用性。 因此，本文提出利用非线性系统辨识技术对单相光伏并网逆变器进行建模，该方法基于非线性理论和离散时间系统，选用了非线性系统辨识领域中简单而常用的NARX (nonlinear auto regressive with exogenous input)模型，将单相光伏并网逆变器视为“黑箱”，根据在实验中采集的“黑箱”所表现出来的输入–输出信息，辨识出与“黑箱”特性等价的单相光伏并网逆变器NARX模型。"
"NARX模型是线性ARX (auto regressive with exogenous input [ 22 ] - [ 24 ] )模型在非线性领域的扩展应用，其通用的函数表达式如下： (1) 式中：y(t)为NARX模型的输出；u(t)为NARX模型的输入；f(·)是取决于有限个先前输入–输出的非线性函数；n a 为NARX模型输出的阶次；n b 为NARX模型输入的阶次；n k 为NARX模型输出的延时量。NARX模型的结构如图1所示，主要由回归分析器和非线性估计器组成。  NARX模型的回归分析器利用“黑箱”t时刻及以前的输入信息 和t时刻以前的输出信息 进行计算分析，然后将结果x(t)输出给NARX模型的非线性估计器。  NARX模型的非线性估计器包含了非线性函数模块和线性函数模块，通过它们将NARX模型的回归分析器与NARX模型的输出建立起映射关系。NARX模型非线性估计器的数学表达式如下： (2) 式中：y为非线性估计器的输出，即NARX模型的输出；x为非线性估计器的输入； 为线性函数模块的输出；d为输出偏置； 为非线性函数模块的输出；r是回归矢量的平均值；Q为非线性子空间。 图1. NARX模型结构图 NARX模型的非线性估计器可采用小波网络(wavelet networks)、树分割网络(tree-partition networks)、S型网络(sigmoid networks)等 [ 25 ] 。 ① 小波网络 当NARX模型的非线性估计器采用小波网络函数时，式(2)将被定义为如下的非线性函数： (3) 式中：P为线性子空间；L为线性系数；c s 为尺度变换矩阵，c w 为小波变换矩阵；a s 为尺度系数；b s 为尺度膨胀；a w 为小波系数；b w 为小波膨胀；尺度函数f(·)和小波函数g(·)均为径向函数： (4) (5) 式(3)亦可表示成如下形式： (6) 其中：函数F(x)的前半部分 为线性函数模块的输出；F(x)的后半部分为非线性函数模块的输出。 ② 树分割网络 NARX模型的非线性估计器亦可采用树分割网络。树分割网络采用的是二叉树非线性估计，其定义的非线性函数y = F(x)中，F(x)是分段线性函数，其由x空间的二元分区P来定义，在每个分割单元P k 中，F(x)为线性映射，当x属于P k 时 (7) 在J层的二叉树中，每一个位于1 < j < J层的节点都含有两个j + 1层的子代节点和一个j − 1层的父代节点。位于1层的根节点只有两个子代节点，J层节点只含有一个父代节点。二叉树中的每一个节点都关联着一个分割单元。当节点k不是终止叶时，分割单元P k 将被分割成两个子代节点的分割单元，分割由半空间 和 来定义，其中B k 用于改进分割子代节点时最小二乘算法的稳定性。 ③ S型网络 NARX模型的非线性估计器采用S型网络时，式(2)将被定义为如下的非线性函数： (8) 式(8)亦可表示成如下形式： (9) 式中：P是线性子空间；Q是非线性子空间；L是线性系数；b是膨胀矩阵；r是回归分析器的平均值；d为输出偏置；a为输出系数；c为变换矢量；S型函数f(×)具有连续、平滑及饱和的非线性特性，采用指数S状的曲线来描述 [ 26 ] ，其数学表达式如下： (10)"
"单相光伏并网逆变器的非线性系统辨识建模流程如图2所示，将单相光伏并网逆变器的输入–输出数据分成两组，分别用于系统辨识建模与模型验证；利用在MATLAB上编写的程序，对单相光伏并网逆变器的输入–输出数据进行基于NARX模型的非线性系统辨识建模，辨识出各种参数条件下的NARX模型；然后把验证数据输入至各个待定的NARX模型，将其输出波形与实测波形进行比较验证，得出精度最高的单相光伏并网逆变器NARX模型。  光伏阵列的输出特性具有强烈的非线性，它既非恒压源，亦非恒流源，也不可能为负载提供任意大的功率，是一种非线性直流电源。光伏阵列的输出电流在大部分工作电压范围内近似恒定，在接近开路电压时，电流下降率很大。光伏阵列的输出功率亦呈非线性过程变化 [ 27 ] 。 因此，在单相光伏并网逆变器的非线性系统辨识过程中，需要采集并网逆变器的直流输入电压U dc 、直流输入电流I dc 、交流输出电压u ac 和交流输出电流i ac ，数据采集的同时完成数字采样，采样频率应满足采样定理，采样间隔不宜过长，否则并网逆变器的信息损失过大，直接影响辨识模型的精度。  单相光伏并网逆变器内部的控制系统采用闭环控制方式，由图1可知，NARX模型中的回归分析器不仅需要黑箱的输入信息，同时还要利用到黑箱的输出反馈信号，这一特性可以充分描述逆变器内部的闭环控制系统特性。因此，本文采用NARX模型对逆变器进行非线性系统辨识。 图2. 单相光伏并网逆变器的辨识建模流程 由式(1)可得单相光伏并网逆变器NARX模型的表达式： (11) (12) 式中：u ac (t)、i ac (t)为单相光伏并网逆变器NARX模型的输出；U dc (t)、I dc (t)为单相光伏并网逆变器NARX模型的输入。单相光伏并网逆变器NARX模型输出的阶次n a ，单相光伏并网逆变器NARX模型输入的阶次n b ，单相光伏并网逆变器NARX模型输出的延时量n k 分别为： (13) 式(11)和式(12)描述的单相光伏并网逆变器NARX模型，可以用q次多项式来描述(逼近)其函数结构： (14) (15) 在上述单相光伏并网逆变器NARX模型结构的基础上，综合考虑计算处理能力的限制，将单相光伏并网逆变器NARX模型阶次和延时的范围限定在[1, 20]的区间内，基于ARX模型，逐次估计并计算预测误差J(n)： (16) 式中：y(t)是单相光伏并网逆变器的实测输出电压/电流；ŷ(t)是单相光伏并网逆变器NARX模型的输出电压/电流；阶次n = n a + n b ；N为实验数据的个数。当J(n)逐渐减小并趋于稳定时，得到一族[n a , n b , n k ]值，将其作为单相光伏并网逆变器NARX模型回归分析器的阶次和延时量，选用小波网络非线性估计器，完成单相光伏并网逆变器NARX模型的非线性系统辨识建模。  利用NARX模型进行非线性系统辨识的过程中，NARX模型的回归分析器可以选取不同的阶次和延时，NARX模型的非线性估计器可以选取不同非线性函数进行估计，辨识计算将得出一族单相光伏并网逆变器NARX模型，即由式(11)和式(12)所描述的具有不同参数的单相光伏并网逆变器NARX模型。因此，需要对各个待定的单相光伏并网逆变器NARX模型进行比较验证，以获得最能反映实际单相光伏并网逆变器动态特性的NARX模型，验证方法如下： 计算单相光伏并网逆变器NARX模型输出与系统实测输出的最佳拟合度(Best Fit)，所得数值最大者的精度最高。 (17) 式中：y是单相光伏并网逆变器的实测输出电压/电流；ŷ是单相光伏并网逆变器NARX模型的输出电压/电流； 为实测输出y的平均值。 根据赤池(Akaike, 1972)原理，具有最小赤池最终预测误差(Akaike’s Final Prediction Error, FPE)和最小赤池信息准则(Akaike’s Information Criterion, AIC)的模型为最精确的单相光伏并网逆变器NARX模型。 (18) (19) 式中：V为损失函数；d为被估参数的个数；N为实验数据的个数。 当 时， (20) (21) 损失函数V的定义如下： (22) 式中：θ N 表示被估计的参数 [ 28 ] 。"
"为了验证上述基于NARX模型的非线性系统辨识方法的可行性，本文在7.68 kW光伏并网发电系统中进行了相关实验测试，实验系统包含屋顶光伏电池板、单相逆变器、波形记录仪、计算机、220 V配电网等，实验装置与系统结构如图3所示。 在7.68 kW光伏并网发电系统正常运行的情况下，波形记录仪的四个电压、电流通道同步记录单相光伏并网逆变器输入–输出侧的直流输入电压U dc 、直流输入电流I dc 、交流输出电压u ac 和交流输出电流i ac ，采样频率为5000 Hz，波形记录仪可以连续记录40 s的单相光伏并网逆变器运行数据，并将数据传输至计算机进行非线性系统辨识。  在实验数据的基础上，利用前述基于NARX模型的非线性系统辨识技术，其中NARX模型的非线性估计器采用小波网络，得出单相光伏并网逆变器NARX模型，然后计算和比较各不同阶次与延时的NARX模型的赤池最终预测误差(FPE)、赤池信息准则(AIC)和最佳拟合度(Best Fit)，部分结果见表1。 图3. 实验装置与系统结构 Table 1 n a n b n k f FPE f AIC f Best Fit /% 电压 5.4146 1.7023 78.60 9.4483 2.3979 71.64 11.2286 2.7262 69.88 8.3439 2.1865 64.20 10.4350 2.5690 62.41 7.5446 2.0414 48.59 8.6475 2.2272 59.69 电流 5.4146 1.7023 93.81 9.4483 2.3979 70.47 11.2286 2.7262 24.78 8.3439 2.1865 −77.07 10.4350 2.5690 −63.91 7.5446 2.0414 88.90 8.6475 2.2272 90.05 表1. 不同阶次与延时的单相光伏并网逆变器NARX模型特性 由表1知，在各不同阶次和延时的单相光伏并网逆变器NARX模型中，赤池最终预测误差(FPE)和赤池信息准则(AIC)的最小值分别为5.4146和1.7023，其对应的单相光伏并网逆变器NARX模型的输出电压、电流最佳拟合度(Best Fit)也为所有模型中的最大值，分别为78.60%和93.81%。由此得出辨识效果最佳的单相光伏并网逆变器NARX模型，该模型的数学表达式如下： (23) (24) 其中，单相光伏并网逆变器NARX模型的输出阶次n a ，输入阶次n b ，输出延时量n k 分别为： (25) 单相光伏并网逆变器NARX模型的输出电压u ac 采用含有2个小波元的小波网络非线性估计器，输出电流i ac 采用了含有4个小波元的小波网络非线性估计器，由式(23)和式(24)所描述的单相光伏并网逆变器NARX模型通过线性近似处理后得到的数学模型及参数如下： (26) 其中：T = 300 s；e(t)为噪声； ； ； ； ； ； ； ； ； ； ； ； 。  实验系统中的单相光伏并网逆变器采取自动运行方式，其控制系统的“黑箱”特点，使得无法人为变更其工作状态。因此，为了进一步探讨本文提出的非线性系统辨识建模方法及其所得单相光伏并网逆变器NARX模型的实用性，本节将利用单相光伏并网逆变器在不同天气条件下(晴、晴转多云、多云、阴雨)的全天运行数据进行验证。 晴天条件下，单相光伏并网逆变器及其NARX模型的输出电压、电流波形如图4所示，其中模型与实测输出电压的最佳拟合度为78.6022%，模型与实测输出电流的最佳拟合度为93.8082%。 晴转多云天气条件下，单相光伏并网逆变器及其NARX模型的输出电压、电流波形如图5所示，其中模型与实测输出电压的最佳拟合度为79.3864%，模型与实测输出电流的最佳拟合度为92.3989%。 多云天气条件下，单相光伏并网逆变器及其NARX模型的输出电压、电流波形如图6所示，其中模型与实测输出电压的最佳拟合度为81.5838%，模型与实测输出电流的最佳拟合度为84.3864%。 阴雨天气条件下，单相光伏并网逆变器及其NARX模型的输出电压、电流波形如图7所示，其中模型与实测输出电压的最佳拟合度为80.0302%，模型与实测输出电流的最佳拟合度为77.4241%。 表2列举出了不同天气条件下单相光伏并网逆变器NARX模型输出电压、电流的最佳拟合度。 由图4~7和表2的计算结果可得如下结论： ① 单相光伏并网逆变器NARX模型输出电压拟合度在不同天气条件下的最佳拟合度差异较小，其主要原因是单相光伏并网逆变器的输出电压受220 V配电网的约束，波动幅度很小； 图4. 晴天条件下模型与实测输出曲线 图5. 晴转多云天气条件下模型与实测输出曲线 图6. 多云天气条件下模型与实测输出曲线 图7. 阴雨天气条件下模型与实测输出曲线 Table 2 天气条件 输出电压(f Best Fit /%) 输出电流(f Best Fit /%) 晴 78.6022 93.8082 晴转多云 79.3864 92.3989 多云 81.5838 84.3864 阴雨 80.0302 77.4241 表2. 不同天气条件下单相光伏并网逆变器NARX模型的最佳拟合度 ② 单相光伏并网逆变器NARX模型的结构简单，其中输出电压u ac 只采用2个单元的小波网络非线性估计器，输出电流i ac 只采用4个单元的小波网络非线性估计器，使得模型在应用过程中的运算量较小； ③ 单相光伏并网逆变器NARX模型的最佳拟合度平均达到了87.0044%，这在模型的精确性和模型的复杂性方面取了很好的平衡，适用于电力系统对并网光伏发电系统的调度、联合运行与协调控制、随机模拟等需要简单模型结构与快速运算的研究领域。"
"针对商用光伏并网逆变器的“黑箱”特点，以及现有的线性化建模方法无法解决逆变器的强非线性问题，本文将单相光伏并网逆变器视为“黑箱”，研究了基于NARX模型的单相光伏并网逆变器非线性系统辨识建模方法。方法无需逆变器内部电路、功率开关器件等拓扑结构和参数及其控制系统的类型和逻辑关系，仅仅利用逆变器输入–输出两侧的外部测量数据，即可建立较为准确的数学模型。最后，通过与光伏并网发电系统中的逆变器实测数据进行比较验证，说明所得NARX模型可以较为准确地描述商用光伏并网逆变器的动态特性，而且模型结构简单，运算量较小，为日趋复杂的新型电力系统调度、联合运行与协调控制、随机模拟等科学研究与工程应用创造了条件。"
