"基于STKX的仿真技术，既继承了STK (Satellite Tool Kit)的专业性与逼真性，又能够无缝集成于软件中，已成为航天领域内仿真研究的一项重点技术。本文以灵巧卫星对地观测成像为工程背景，阐述了STKX技术的基本原理，对场景仿真中卫星、相机和观测目标的创建等工程技术问题进行了细致地说明，并展示了灵巧卫星对地观测成像的仿真效果，旨在为STKX技术的工程应用提供参考与借鉴。 关键词 :卫星成像，STKX，仿真技术"
"仿真技术由于其经济性和快速性，在航空航天领域内得到了广泛应用。针对卫星工作的二维、三维场景仿真，目前有两种常用的实现途径，一种是利用OpenGL等应用程序编程来实现二维、三维场景的显示，这种方式自主性比较强，但开发起来工作量大，需要精通复杂的航天器动力学知识；另一种途径就是在现有卫星仿真软件的基础上进行二次开发，比如美国Analytical Graphics公司开发的STK (Satellite Tool Kit)商业分析软件，不仅专业而且全面，仿真场景也极为逼真。基于该软件进行二次开发，就可以快捷地实现卫星工作场景的仿真。 基于STK的传统开发主要是利用STK/Connect模块，例如2006年，王军民等[ 1 ] 基于STK/Connect模块进行了卫星系统设计优化的研究，实现了对卫星系统的设计与优化，2009年，杜耀珂[ 2 ] 基于该模块利用VC进行了实时仿真驱动程序的开发，2012年，范增、冯永新等[ 3 ] 则利用该模块进行了卫星编队飞行的仿真研究，实现了STK与其他联邦成员之间的交互。这些研究拓展了STK的仿真功能，较好地完成了一些仿真研究。但该模块由于自身固有的局限性，存在着应用程序复杂、不能实现软件开发的无缝集成、占用内存资源大等缺点。STKX技术是STK软件提供的一种新的开发技术，与传统的STK/Connect模块相比，利用该技术，可以在不启动STK软件的情况下，将STK的仿真模块无缝集成在自主开发的软件中，同时可以响应用户操作，而且接口清晰明确，便于开发。丁哲峰、张传玉[ 4 ] 对STKX组件在控件仿真中的应用模式进行了一些研究，给出了基于STKX组件的空间仿真模式框架，陈波等[ 5 ] 以导弹攻防为背景对该技术进行了进一步的探讨，此外国内外的其他学者[ 6 ] -[ 9 ] 也做了一些应用与研究。但这些研究主要集中在对STKX仿真技术原理框架的梳理，对STKX技术在工程中的应用研究较少。特别地，利用C#语言开发STKX技术比起传统的C/C++语言更加集成化，封装性好，可以更加充分地利用STK提供的接口和类设置各种仿真参数。 灵巧卫星是一种能够快速机动对地面目标进行观测的卫星，它对保障我国现代农业、防灾减灾、资源调查、环境保护和国家安全都有着重大意义。本文针对这一特殊的工程背景，以STKX技术和C#语言为开发基础，对创建卫星、相机和观测目标的工程技术进行了详细说明，成功地实现了对卫星成像观测任务的仿真。"
"利用STKX来进行仿真开发的基本原理就是将STKX组件以控件模块的形式导入到C#语言所编写的窗体控制程序中，这样就可以通过该窗体与STK仿真软件的分析引擎进行连接，进而将STK的仿真场景及数据分析功能集成到自己所编写的软件当中。 基于STKX技术进行卫星成像观测任务的仿真，主要应用的STKX控件是2D控件和3D控件。2D控件即AGI Map Control，嵌入到软件当中，相当于STK软件的2D窗口，该控件可以显示以世界地图为背景，具有经度纬度指向的二维图像，卫星对地面进行成像观测的点目标、条带、区域、卫星的星下点轨迹，相机观测点在地面的轨迹等均可以在该界面进行显示，并且该界面可以响应鼠标点击移动等各种用户操作，通过底层代码的编写，该控件几乎可以实现STK中二维窗口的全部功能。3D控件即AGI Globe Control，与二维控件类似，它完成了观测场景的三维显示功能，除了可以显示二维场景中的各类信息外，在三维场景中还可以看到卫星的姿态变化、太阳光照情况等一些二维场景中无法显示的信息。该控件同样可以响应用户操作，便于开发人员直接控制。 利用C#语言进行程序编写时，可以通过两种方式实现对STKX控件的控制。一种与传统的控制方式相当，即利用Connect命令字符串。STK提供了大量的Connect命令，每一种命令都有其格式规范，按照规定的格式写好Connect命令，利用ExecuteCommand()方法发送该命令即可实现控制。例如发送命令“New/*/Satellite Sat1”就可以在场景中新建一颗名叫“Sat1”的卫星。另一种控制方式就是利用STK提供的类和接口来实现控制，这种方式方便直接，运行起来也比较快，但对STK不是很熟的开发人员而言，找寻相关的类和接口需要花费很多时间。同样以新建一颗名叫“Sat1”的卫星为例，利用类AgStkObjectRoot，通过代码root.CurrentScenario.Children.New (AgESTKObjectType.eSatellite, Sat1)，可以很容易地完成新建，而且通过接口IAgSatellite，可以对卫星的所有属性进行设置与控制。"
"卫星创建的基础是其轨道动力学模型的建立，之后通过设置卫星的姿态，便可以实现卫星机动观测过程的仿真。  创建卫星对象的重点在于对IAgSatellite等接口的灵活应用。轨道动力学模型是卫星对象的关键，最常用的轨道预报模型是二体模型TwoBody和高精度轨道预报模型HPOP。二体模型需要设置的基本参数有轨道的预报模型、开始时刻、结束时刻、输出步长、轨道历元、坐标类型、坐标系、经典轨道根数等。表1对这些主要参数的设置进行了整理。 当对轨道预报模型要求较高时，就需要使用高精度轨道预报模型HPOP。对于高精度模型而言，除了上述二体模型的参数设置外，还需要对摄动力等其他影响进行考虑。目前主要考虑的摄动力有中心天体引力、大气阻力、太阳光压、第三体引力等。这些摄动力参数的设置与二体模型中参数的设置类似。根据上述梳理的信息，结合任务需求合理设置上述参数，就可以成功创建观测任务所需的轨道动力学模型。  将卫星与相机对象建立完成后，观测与成像仿真的核心步骤就是控制卫星的姿态机动，进而仿真出卫星机动观测地面成像的过程。由于卫星机动观测目标的过程是一个非常复杂的机动过程，所以在成像时会经过多次机动控制，那么就需要设置多个姿态机动片段参数。对于这一复杂的过程，目前STK并没有提供多个姿态数据控制的接口，为此，本文采取的是发送STK的Connect命令来实现的。通过调整命令参数，就可以实现对姿态控制片段的添加、删除和修改。其主要的命令格式如下： AttitudeSegment {Add|Delete|Modify} {SegmentType}  相机是星载设备，所以相机必须是在建立好卫星对象之后才能创建的。与卫星对象的参数一样，相机的视场角大小、在地面的成像状态等参数同样是观测任务的核心参数，直接影响着观测仿真的结果。相机对象的建立主要使用的接口是IAgSensor。下面以任务中使用的矩形镜头为例，对相机的镜头类型、镜头水平方向视场角、镜头垂直方向视场角、相机光束颜色和地面成像状态等一些参数的设置进行了梳理说明，如表2所示。  观测目标即卫星观测成像的目标区域。根据常见观测目标的特点，可以将其分为三类：点目标、条带目标、区域目标。只有在场景准确创建出三类观测目标，才能进一步进行卫星姿态规划，完成卫星的观测成像仿真。这三类目标在仿真场景中的建立各有不同，下文将进行逐一介绍。  点目标是指宽度为相机幅宽、长度约等于幅宽的目标区域。点目标的创建，主要利用STK中的 Table 1 参数名称 使用的函数或属性 预报模型 IAgSatellite.SetAttitudeType 开始时刻 IAgVePropagatorTwoBody.StartTime 结束时刻 IAgVePropagatorTwoBody.StopTime 输入步长 IAgVePropagatorTwoBody.Step 轨道历元 IAgOrbitStateClassical.Epoch 坐标类型 IAgOrbitState.ConvertTo 坐标系 AgECoordinateSystem 经典轨道根数 AssignClassical 位置与速度 AssignCartesian 表1. 卫星二体轨道模型的参数设置 Table 2 参数名称 使用的函数或属性 镜头类型 IAgSensor.SetPatternType(AgESnPatternPatternType) 水平方向视场角 IAgSnRectangularPattern.HorizontalHalfAngle 垂直方向视场角 IAgSnRectangularPattern.VerticalHalfAngle 相机光束颜色 IAgSensor.Graphics.Color 填充成像区域 IAgSensor.Graphics.FillVisible 持续填充 IAgSnProjection.FillPersistence 三维场景填充 IAgSensor.VO.FillVisible 三维场景透明度 IAgSensor. VO.FillTranslucency 表2. 相机模型的参数设置 IAgTarget接口，通过该接口的Position属性，可以设置点目标的经纬度。利用Graphics属性可以对点目标的颜色、线条等二维场景中的参数进行设置。此外，还有VO、UseTerrain等属性可用来设置点目标的三维特性等参数。最常用的两种点目标输入方式，一种是直接输入点目标的名称、经度和纬度，利用上述属性编写函数AddPointTarget (string name, double latitude, double longitude)，即可实现点目标的的添加；另一种是在二维图中用鼠标点击来确定点目标，这种方法对于用户非常方便，此种方式通过委托IAgUiAx2DCntrlEvents_MouseDownEventHandler (object sender, IAgUiAx2DCntrlEvents_MouseDownEvent e)实现对鼠标单击的响应，然后再传递鼠标捕捉到的经纬度信息到函数AddPointTarget (string name, double latitude, double longitude)即可。  条带目标是指宽度为相机幅宽、长度明显大于相机幅宽的目标区域。它的创建可以通过IAgLineTarget接口来实现，利用IAgLineTarget接口的方法Add、Remove等可以实现条带上点的添加和移除。结合该接口的方法，编写函数AddLineTargetPoint (double latitude, double longitude)，通过传入经度纬度参数即可实现条带点的添加。也可以通过Connect命令“SetLine*/LineTarget/LineTargetLatLon” + LineTargetPoints来实现对一系列条带点的添加，LineTargetPoints表示一系列经纬度数据点的集合。与点目标类似，一方面，条带目标可以通过直接输入一系列条带上点的经纬度参数来进行创建，另一方面，也可以利用委托来实现二维场景对鼠标点击的响应，将鼠标捕捉的经纬度信息添加到条带序列当中，实现条带的创建。此外，针对大量数据或用户已有边界条带目标的处理，用户可以直接将区域目标的边界数据按照经度、纬度的格式写在txt文本中，然后将文件数据直接导入到场景中，从而创建条带目标，这样就极大地提高了创建条带目标的效率。  区域目标是指宽度长度均大于相机幅宽的目标区域，其创建主要依赖于IAgAreaTarget接口。该接口有AreaType、AreaTypeData、Graphics等属性，通过这些属性可以对区域的类型、区域数据、区域图形的颜色线条等进行设置。例如可以将区域类型设为边界点刻画型AreaType = AgEAreaType.ePattern，利用AreaTypeData的方法Add可以实现区域点的添加。不过，对于边界点很多的情况，用这种算法创建区域效率很低，可以将所有的边界数据存在一个数组中，然后利用CommonTasks属性的方法SetAreaTypePattern将整个数组一次性加载到场景中，即可实现区域的快速创建，从而大大提高区域目标的创建效率。与点目标、条带目标一样，对于区域目标数据的输入可以设计直接输入、鼠标点击和导入文件三种方式。 除了普遍区域的刻画外，利用STKX还可以仿真出一些特殊的地理信息，比如中国国内的省界、森林、湖泊等信息。利用命令格式GIS Import {ObjectType} [ ]与STK进行通信，可以加载.shp格式的地理信息，实现这种功能。"
"根据上述介绍，利用STKX技术，对卫星、相机、观测目标的接口及命令参数进行灵活设置就可以实现卫星、相机对象和观测目标的创建，对卫星姿态进行控制，就可以动态仿真出卫星成像观测的过程。取轨道仿真起始时刻1 Jul. 2015 12:00:00.000 UTC，半长轴7000 km，偏心率0，轨道倾角100˚，近地点幅角180˚，升交点赤经260˚，平近点角0˚。以三个条带为观测目标。其仿真效果图1所示。图中右边二维场景的背景是世界地图，并且在此基础上加载了中国国内的省界信息。红色线条为已经观测过的条带目标，浅蓝色线条表示将要观测的条带目标。左边是卫星观测的三维场景，在三维场景中，除了可以看到二维图上的一些仿真信息外，还可以动态地看到卫星姿态机动的过程和一些参数值的变化。 图1. 灵巧卫星成像观测效果图"
"本文对STKX在仿真技术上的应用原理进行了阐述，并结合灵巧卫星对地观测的工程背景，对卫星、相机、观测目标的建立进行了细致的梳理，基于STKX技术实现了卫星观测成像任务的仿真，并给出了仿真实例效果图。本文旨在于从工程的角度，深化航天领域内仿真技术的研究，为仿真技术在工程上的实现提供借鉴与参考。此外，在本文的基础之上，用户可以根据自己的实际工程需求，利用STKX技术灵活地实现各类仿真。"
