"随着室内外定位技术的发展，室内外位置信息的融合与统一应用，成为GIS研究的热点。本文针对室内外统一寻径的这一现实问题，以室内外空间路网作为研究对象，在分析室内空间区域功能，明确室内单元类型的基础上，基于空间感知规律，构建了室内外道路网络感知分层模型，将室内外路网简化为街道、建筑物、楼层和区块四个层次路网，并分析了各层次路网的特点，以及基于数据库的各层次路网拓扑关系存储和表达。以某单位室内外路网作为分析对象，构建了四个层次的路网结构，并通过寻径计算验证了所提出模型的可行性和有效性。结果表明，该分层模型符合人们对室内外路网的经验性层次认知，能够很好地刻画路网层次特征，能满足室内外一体化寻径计算的精度和效率的要求，为室内外导航应用奠定了基础。 关键词 :空间感知，拓扑关系，一体化寻径，位置服务，路网模型 Copyright © 2018 by author and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"随着国家城市化的快速发展，室内空间应用规模大幅增加，人员在大型场馆的活动日益增多。基于大型场馆的应急救援与寻径导航亟需室内外GIS共同参与以提供全新的技术支持，室内外路网构建已成为室内外位置信息融合应用的重要课题 [ 1 ] [ 2 ] [ 3 ] [ 4 ] [ 5 ] 。道路导航是室外GIS研究较多且应用较为成熟的领域，室内路网构建也多直接借鉴室外GIS的相关研究成果 [ 6 ] 。如Kwan利用最短路径算法为在建筑物内由于突发事件而受困的人员寻找最佳的疏散路径 [ 7 ] ；Lee等在考虑室内单元逻辑关系的基础上，利用直中轴变化来获取室内网络模型并将其用于三维空间中最短路径分析 [ 8 ] [ 9 ] ；Chen等在分析室内3D特征的基础上，构建了GNM (Geometric Network Model)模型 [ 10 ] ；Mandloi等则提出了一个整合室内环境及室外交通网络的三维空间模型用于路径导航分析 [ 11 ] ；此外Hong S、Zlatanova S [ 12 ] [ 13 ] 以及李渊 [ 14 ] 等也做了类似的研究。也有部分学者从环境认知的角度出发，利用空间句法理论构建了室内空间模型 [ 5 ] [ 15 ] [ 16 ] [ 17 ] 。但这些模型多局限于理论方面的探讨，分析精度难以满足实际需求，有些尚缺乏切实有效的建模方法支撑。因此，基于空间认知规律，综合考虑和概括室内外路网结构和特征，构建能够准确表达室内外路网拓扑关系的模型，实现一体化寻径就成为了室内外路径导航分析应用的关键。"
"室内空间单元的划分是路网模型构建的基础工作，文献 [ 18 ] 根据室内单元之间的沟通和联系将将室内空间划分为功能性单元和联系性单元，本文借鉴这种划分方法，并基于节点―弧段模型，将室内空间转换成由弧段元素和结点元素组成的通道网络模型。  点元素用来表达通道网络上的结点，如建筑物出入口、电梯出入口以及楼道拐弯处等。根据空间单元的划分以及基于空间层次感知原理。将功能性单元简化为功能性节点，并按所处的层次，功能性节点可以分为：①建筑物单元节点。代表整个建筑物，是和室外道路网络联系的顶层节点。②楼层单元节点。建筑物在垂直方向的划分，表达的是楼层，具有多个出入口，内部由各种水平通道联系。③区块单元节点。同一水平楼层中按照功能的不同所划分的区域，区块和区块之间有通道联系。④房间单元节点。房间节点为叶子节点，是终端单元，其特点是除了通过门廊和外部相联系之外，并无其它联系方式。  室内空间联系性单元可简化为弧段，根据弧段沟通联系的方向可分为水平联系弧段和垂直联系弧段 [ 19 ] 。水平联系性单元和垂直联系弧段紧密联系构成了室内通道网络。在实际应用中，可根据联通关系的复杂性、寻径目标的层次性，借鉴分层次认知的思想，构建等级不同的通道网络。  为了实现室内外导航一体化寻径的目的。本文面向室内外导航无缝切换的要求，基于室内空间认知规律 [ 20 ] ，从应用和显示的角度将室内外路网结构概括为街道级(Street Level)―建筑物级(Building Level)―楼层级(Floor Level)―区块级(Block Level)四个认知阶段的网络，从而构成了多层次、多尺度表达的室内外道路网络感知层次模型(IONHM，Indoor and Outdoor Network Hierarchical Model based on Cognition)。各个认知阶段(层次)的路网特点为： 1) 街道级路网特征(Street Level Network：Street-Building)。属于室内外路网结构的认知，感知区域室外路网的形状特征，表达了街道级别的路网基本轮廓。在该级别中，各个建筑物可作为道路网络中的一个节点来表达。 2) 建筑物级路网(Building Level Network; Building-Floor)。单个建筑物作为感知对象，楼层之间的联系通道首先被感知，形成建筑物楼层之间关系的认知。在该层次中，建筑物由不同楼层组成，楼层之间通过垂直路径(如楼梯、电梯等)相连。通过该层次的路网，可以明确到达各个楼层的路径。 3) 楼层级路网(Floor Level Network; Floor-Block层)。感知对象为单个楼层，实际应用中可以根据楼层区域的复杂情况对室内空间以及实体对象进行简化、关联及综合加工以实现分区，分区之间构成连通子图，路网和拓扑信息变得逐渐完善。 4) 区块级路网(Block Level Network-Block-Cell)。认知层次最深，在该层次中，每个室内空单元被分配至不同的联系单元，通过联系单元与楼层联系，再通过楼层之间的垂直通道(电梯或者楼梯)与室外道路相联系，路网图形与真实路网已经完全逼近，从而形成了对室内外路网的精细化表达。  室内外路网要素的拓扑关系可利用数据库来存储和表达 [ 20 ] 。对于分层网络来说，节点和弧段之间的拓扑关系除了室外道路网络的关联、邻接和包含等拓扑关系之外，还包括结点元素之间的层次关系，下面结合试验区域(图1)进行介绍。  该层次在室外路网的基础上增加各建筑物的出入口信息，从而可以利用寻径算法计算室内某点到建 图1. 研究区域 筑物的各出入口节点的路径信息。拓扑关系表达包括：1) 建筑节点表。建筑物简化为室外网络中的一个节点，如表1。其中Geometry表达建筑物的中心坐标，因为是最顶层，父节点(Parent-Node-ID)设置为NULL；2) 建筑物出入口节点表。存储建筑物的出入口节点信息，在应用中，需将这些点分配到街道网络中，如表2。  该层次网络表达的是楼层之间的联系，因此需要存储垂直方向弧段的信息。拓扑关系包括：1) 楼层信息表。如表3，用节点来表达建筑物各楼层的信息，Parent-Node-ID存储的是Building ID；2) 垂直弧段-节点关系表。表达的是电梯或楼层弧段与各楼层的交点(出入点)信息，如表4。Node-ID-Set 是指构成该弧段的节点集合，Type表达弧段的类型，0-电梯弧段；1-楼梯弧段；Active表达该垂直弧段的当前状况，True表示该弧段正常通行，False表示该弧段障碍，不可以通行；3) 节点信息表。存储了电梯/楼梯节点的详细信息。Type表达节点信息的类型，0-出入口点，1-电梯点，2-楼梯点。Floor Number表达的是该节点所在的楼层；Active表示该节点的活动状态，是否禁止通行或者停靠。如表5。  该层次网络表达楼层内不同部分(区块)之间的联系。水平楼层可以根据楼层的复杂程度划分为多个区块，如果楼层比较简单，也可以不进行区块的划分。Floor-Block表达水平楼层内各个block之间的连通。存储的区块信息如表6，区块联系弧段信息如表7。其中Direction表示联系的方向是单向还是双向。  存储各区块所包含的房间以及区块内的节点连通状况。1) 区块-弧段表。表达一个Block所包含的弧段，一个Block可以包括一个或多个走廊弧段，如表8所示。2) 弧段–节点信息表。表达弧段由哪些节点所组成。节点主要包括走廊弧段起始点、交点以及弧段之间的汇聚点等，如表9。3) 房间关联区块表。就是将室内房间分配到房间所在block，如表10。"
"为了说明IONHM层级树状网络的特点，这里选择某单位道路网络以某部门行政大楼(CESI)为例进行说明。大楼共分5层，每层共分为A、B和C共3个区域，一共有1台电梯和4部楼梯。图1(a)为大楼所处区域室外道路网络概况，图1(b)为大楼的整体外貌。 Table 1 Building ID Name Geometry Parent-Node-ID A CESI … NULL B OFFICE … NULL … … … … 表1. 建筑物节点表 Table 2 Entrance ID Building ID Geometry Reserve 1 CESI … NULL 2 CESI … NULL … … … … 表2. 建筑物出入口节点表 Table 3 Floor ID Name Geometry Parent-Node-ID F1 第一层 … CESI F4 第四层 … CESI … … … … 表3. 楼层信息 Table 4 VCC ID Type Active Node-ID-Set V1 0 True 1,2,3,4,5 V2 1 True … … … … … 表4. 垂直弧段-节点表 基于IONHM层级树状网络模型的特点，将该单位的路网以及CESI建筑物的室内路网进行认知分层和简化，概括为街道级―建筑物级―楼层级―区块级四个认知阶段的网络。图2(a)为街道级路网特征，在该级别中，各个建筑物被抽象为节点对象，并关联到原有路网上，如图2(a)中的CESI建筑物抽象为道路网络中的一个结点。图2(b)中表达的为建筑物级路网，其中的CESI大楼由5个楼层组成，楼层之间的包括5个垂直方向的通道。图中的点为道路与楼层的节点(例如楼层出入口)，弧段表达了楼层之间的联系通道。图2(c)为CESI大楼四楼楼层的区块分布，四楼楼层被划分为(a)、(b)和(c)三个区域，图2(d)为连通子图，其中“Δ”表达的是楼层之间的连接结点，“×”表示的是区块之间的连通结点。 图3为CESI大楼四楼的区块级内部网络，图3(a)为四楼室内单元的分布情况，3(b)为相应的网络图。 按照前述思路进行，最后得到IONHM分层路网，路网各层次的具体数据如表11所示。 寻径测试 为验证以上所构建的分层网络适用性，这里也将点―弧段模型引入室内空间(结点代表房间和出口，弧段代表通道等)，以进行对比，所构造的通道网络如图4所示。路网数据中节点数为1865，弧段数632。 图2. 街道级、楼层级和楼层级路网 图3. 区块级路网 采用上述两种不同的室内网络模型，以人正常的步速，利用Dijkstra算法计算用户从房间B408房间到1楼各出口的最短距离和所需的时间，以及采用两种不同的路网模型计算最短路径的寻径时间如表12所示。 图5为所计算的从B408到1楼出口的走电梯和楼梯的路径以及所需的最短时间(注：电梯路径不包括电梯等待时间)。Dijkstra算法的时间复杂度是O(n²)，采用传统的点―弧段模型，由于所有的节点都需要参与运算，B408到1楼到各个出口的运算时间约为300 ms。但利用IONHM分层模型，通过空间感知所进行的层次划分，每一个层次都可以大量减少参与运算的节点数，简化了计算网络，从而大大提高了运算 Table 5 Node ID Type Active Geometry Floor Number 1 0 True x1,y1,z1 1 2 1 True x2,y2,z2 2 … … … … … 表5. 节点信息表 Table 6 Block ID Name Geometry Floor Number A Block A NULL F4 B Block B NULL F4 … … … … 表6. 楼层区块信息表 Table 7 Block Arc From Node End Node Direction Floor Number A A B 1 4 B C A 1 4 C B C 1 4 … … … … … 表7. 区块弧段-节点表 Table 8 Block Arc Arc ID Floor Number A A 4 B C 4 C B 4 … … … 表8. 区块-弧段 的效率，因此计算B408到各个出口的最短路径的运算时间都较少，约为10 ms左右。虽然本实例中CESI大楼的楼层数较少，节点也不多，但实际上即使建筑物楼层数较多，通多分层处理，每次参与运算的点数也不会特别多，因此，IONHM模型不仅方便管理，而且对于室内外的一体化寻径具有较优的时间开销，能够获得较好的性能。"
"本文针对室内外统一寻径的这一现实问题，基于空间感知认知规律，构建了室内外道路网络感知分层模型，并以某单位行政大楼作为分析对象，实现了IONHM路网模型，基于该路网模型的模型构建以及路径计算表明：该分层模型符合人对室内外道路网络的经验性层次认知，能够很好地刻画路网的层次 Table 9 HCC ID Active Direction Node_ID_Set HCC1 True 1 101,102, …,104 HCC2 True 1 C HCC3 False 1 B … … … … 表9. 走廊弧段-节点关系表 Table 1 0 Cell ID Block ID Active Name 101 A True B408 102 B True A401 201 C True C201 … … … … 表10. 房间-关联弧段表 Table 1 1 路网层次 节点数 弧段数 说明 Street-building 5 5 和室外街道路网相连的出入口 Building-floor 26 20 电梯弧段、楼梯弧段 Floor-block 24 10 建筑物的第四层的分区(A、B、C) Block-room 122 36 第四层A区各个房间节点、弧段起止点、交叉点等 表11. 某building分层路网数据 Table 1 2 Exit Distance (meter) Time (minute) 寻径时间(wayfinding time, ms) Node-arc CLNM model Stair 1 102.2 1.42.03 312 15 Stair 2 152.6 2.21.52 310 16 Stair 3 130.0 1.52.20 322 12 Stair 4 148.4 2.10.11 332 15 Elevator 60.3 1.02.03 298 10 表12. 路径距离、时间和计算时间 特征，能有效缩短寻径计算的时间。进一步分析表明，即使在节点数和弧段大幅增加的前提下，寻径时间也不会耗费太多。因此该模型能够支持室内外统一寻径的问题，对于室内外的融合应用，例如室内空间应急疏散的寻径等问题，可以给出较为快速和合适的选择，为有关部门在规划或救灾中提供决策支持。 作为室内外位置信息融合应用的研究热点，面向室内外一体化寻径导航尚有很多问题有待进一步研究。本文IONHM模型构建，如结点、通道以及分层网络的实现目前只能通过手工或半手工创建，效率低下。因此，如何根据室内拓扑空间的构成，以及室内空间区域的功能，改进室内空间各区块的子网优 图4. 节点-弧段路网 图5. 楼层级路网 化划分策略，设计自动的分割算法，自动构建各层次的路网拓扑结构图 [ 21 ] ，取代目前的人工方法以提高IONHM分层网络的构建策略，是下一步继续研究的方向。"
