"本文讨论了基于二阶低通滤波器和基波正序分量提取的锁相技术，文中给出了详细的公式推导过程，用仿真和实验结果验证了该方法锁相的准确性，克服了传统方法的不足。 关键词 :锁相，并网型逆变器，正序分量，低通滤波器 Copyright © 2020 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY 4.0). http://creativecommons.org/licenses/by/4.0/"
"在电网基础设施比较薄弱的地方，或者电网负荷比较重的场景下，电网电压容易发生畸变，如电压波形含有低次谐波、三相电压不对称不平衡、检测电压时可能还存在高频噪声等，电压不是标准的正弦波形，此时三相并网逆变器并网运行，向电网输送交流电流，如果采用矢量控制技术，因为根据畸变的电网电压值，计算矢量变换旋转角，得到错误的结果，对应的是输入电流过零点相位偏移，造成矢量控制稳定性差，现场容易出现炸机现象，带来质量和安全问题 [ 1 ] [ 2 ]。因此，在进行矢量变换计算前，必须先有正确的锁相计算，得到准确的旋转角，避免矢量控制技术失败。并网型逆变器的锁相方法主要有三种：过零点检测法、对电网电压进行dq变换得到相差的方法、直接计算电网电压相角的正余弦值的方法。过零检测的锁相方法依赖于过零点的准确检测，而电网电压过零检测电路易受干扰，对于三相系统中任一相掉电后都无法进行锁相，所以该方法不适用于并网型逆变器。后两种方法适用于市电电压是理想正弦且对称的(对于三相系统来说)，如果把粗糙的市电电压直接作为锁相环节的输入，那么得到的相位正、余弦值会发生较大的误差。所以后两种方法存在的问题是锁错了对象，对其改进的关键应在锁相方法之外，即对市电电压基波正序分量正确有效地提取 [ 3 ]。"
"当电网的三相电压不对称且有畸变的时候，其合成的空间矢量实际上是由对应于正序基波分量的逆时针旋转的空间矢量、对应于负序基波分量的顺时针旋转的空间矢量和对应于谐波分量的空间矢量合成的。因为基波正序分量是最能表征电网电压本质特征的，所以应该选用基波正序分量作为锁相的对象。获取基波正序电压分量的基本方法包含两步：1) 用低通滤波器提取基波分量；2) 用对称分量法从基波中提取正序分量。 设三相电网电压不平衡且含有n次谐波分量，则可以表示为： { u a = U f + cos ( ω t ) + U f − cos ( ω t + φ − ) + ∑ n U n + cos n ( ω t + φ + ) + ∑ n U n − cos ( n ω t + φ − ) + u 0 u b = U f + cos ( ω t − 2 3 π ) + U f − cos ( ω t + φ − + 2 3 π )     + ∑ n U n + cos ( n ω t + φ + − 2 3 π ) + ∑ n U n − cos ( n ω t + φ − + 2 3 π ) + u 0 u c = U f + cos ( ω t + 2 3 π ) + U f − cos ( ω t + φ − − 2 3 π )     + ∑ n U n + cos ( n ω t + φ + + 2 3 π ) + ∑ n U n − cos ( n ω t + φ − − 2 3 π ) + u 0 (1) 其中， U f + 为正序基波分量的幅值， U f − 为负序基波分量的幅值， U n + 为正序n次谐波分量的幅值， U n − 为负序n次谐波分量的幅值， φ − 为负序分量的初始相位， ω 为基波的角速度， u 0 = ( u a + u b + u c ) / 3 为零序分量。 采样电路采集到的电网电压就是如式(1)所示的不平衡的含有谐波的电压，如果直接用它进行锁相，就会得到一个畸变的相位。所以必须对采样得到的电网电压信号进行处理，提取出正序基波分量。 首先要消除谐波的影响，要设计一个低通滤波器，滤除基波以上的各次谐波。由于电网电压中可能存在3次及更高次谐波，所以滤波器的截止频率不能高于 2 ω 。这样电网电压通过滤波器后基波会有比较大的相移，这是设计滤波器必须要考虑的问题。在下面的分析中可以看出，在提取正序分量的时候，需要基波信号相移90˚的量，所以这个低通滤波器可以设计为截止频率为基波频率，在基波频率点有90˚的相移。 假设经滤波以后，得到了基波的电网电压信号： { u a f = U f + cos ( ω t ) + U f − cos ( ω t + φ − ) + u 0 f u b f = U f + cos ( ω t − 2 3 π ) + U f − cos ( ω t + φ − + 2 3 π ) + u 0 f u c f = U f + cos ( ω t + 2 3 π ) + U f − cos ( ω t + φ − − 2 3 π ) + u 0 f (2) 其中 u 0 f = ( u a f + u b f + u c f ) / 3 为基波的零序分量。 则它的正序分量可以通过如下的对称分量变换得到： ( u a f + u b f + u c f + ) = 1 3 [ 1 a a 2 a 2 1 a a a 2 1 ] ( u a f u b f u c f ) 其中 a = e j 2 3 π = − 1 2 + j 3 2 (3) 将三相正序分量变换成 α β 分量，有下式： ( u α f + u β f + ) = 2 3 [ 1 − 1 2 − 1 2 0 3 2 − 3 2 ] ( u a f + u b f + u c f + ) = 2 3 [ 1 − 1 2 − 1 2 0 3 2 − 3 2 ] 1 3 [ 1 a a 2 a 2 1 a a a 2 1 ] ( u a f u b f u c f ) = 1 3 [ 1 − 1 2 − 1 2 0 3 2 − 3 2 ] ( u a f u b f u c f ) + 1 3 [ 0 j 3 2 − j 3 2 − j j 1 2 j 1 2 ] ( u a f u b f u c f ) = − 1 3 [ 1 − 1 2 − 1 2 0 3 2 − 3 2 ] ( u a f u b f u c f ) e − j π + 1 3 [ 0 − 3 2 3 2 1 − 1 2 − 1 2 ] ( u a f u b f u c f ) e − j π 2 = M 2 ( u a f u b f u c f ) e − j π + M 1 ( u a f u b f u c f ) e − j π 2 = 1 2 ( u α f u β f ) + 1 2 j ( u β f − u α f ) = − 1 2 ( u α f u β f ) e − j π − 1 2 ( u β f − u α f ) e − j π 2 (4) 这样就得到了基波正序电压 α β 分量。 将式(4)分成实部和虚部： U α β + f = ( U α + f ) + ( U β + f ) j (5) 最后进行锁相的求取： ‖ U α β + f ‖ = ( U α + f ) 2 + ( U β + f ) 2 sin ( θ f + ) = U β + f / ‖ U α β + f ‖ ,       cos ( θ f + ) = U α + f / ‖ U α β + f ‖ (6) 需要说明的是对于三相三线制，对电压采样得到的是线电压信号，需要按式(7)由线电压求取相电压。 U p h = T l − p h U l − l ,       T l − p h = 1 3 ( 2 1 − 1 1 − 1 − 2 ) (7)"
"由前面分析可知：在提取正序分量的时候，需要基波信号的相移90˚的量，即公式中出现了 e − j π / 2 ，也就是滞后90˚，所以可以采用二阶低通滤波器，截止频率设置为50 Hz。二阶滤波器的传递函数是： G ( s ) = ω n 2 S 2 + ω n S + ω n 2 (8) 图1. 滤波器频域分析 式中： ω n = 100 π ，从图1所示波特图可以看出来，在50 Hz处幅值为1无衰减，相位滞后九十度，超过50 Hz后幅值迅速衰减，因此同时起到了滤波与相移的作用 [ 4 ] [ 5 ] [ 6 ]。 令 a = ω n 2 + j 3 2 ω n ， b = ω n 2 − j 3 2 ω n 上式变为标准形式： ω n 2 S 2 + ω n S + ( ω n 2 ) 2 + ( 3 2 ω n ) 2 = ω n 2 ( S + ω n 2 ) 2 + ( 3 2 ω n ) 2 = ω n 2 ( S + ω n 2 + j 3 2 ω n ) ( S + ω n 2 − j 3 2 ω n ) = ω n 2 ( 1 S + ω n 2 + j 3 2 ω n − 1 S + ω n 2 − j 3 2 ω n ) 1 ω n 2 − j 3 2 ω n − ω n 2 − j 3 2 ω n = − ω n j 3 ( 1 S + ω n 2 + j 3 2 ω n − 1 S + ω n 2 − j 3 2 ω n ) (9) 上式推导过程中用到了分解式： ω n 2 ( S + a ) ( S + b ) = ω n 2 ( 1 S + a − 1 S + b ) 1 b − a 由于 1 S + a 的Z变换为 Z Z − e − a T ，式(9)Z变换表达式为： − ω n j 3 Z − 2 j e − 1 2 ω n T sin ( 3 2 ω n T ) Z 2 − 2 e − 1 2 ω n T cos ( 3 2 ω n T ) Z + e − ω n T 将 ω n = 100 π ， T = 5e   −   5 (假设采样频率为20 kHz)代入上式得到： ω n 3 × 0.9921767803 × 0 .02720363 Z Z 2 − 1.9841699571 Z + 0.9844147634 Y ( Z ) U ( Z ) = 0.000244807 Z Z 2 − 1.9841699571 Z + 0.9844147634 = 0.000244807 Z − 1 1 − 1.9841699571 Z − 1 + 0.9844147634 Z − 2 0.000244807 u ( k − 1 ) = y ( k ) − 1.9841699571 y ( k − 1 )                                                             + 0.9844147634 y ( k − 2 ) y ( k ) = 1.9841699571 y ( k − 1 ) − 0.9844147634 y ( k − 2 )                   + 0.000244807 u ( k − 1 ) (10) 式(10)即是所设计数字滤波器实现形式。至此基于基波正序分量的锁相方法实现过程可以用图2框图表示，图中LPF表示二阶低通滤波器。 图2. 基波正序分量相位求取过程"
"在Matlab中用simulink搭建仿真模块对锁相算法进行仿真。图3是对理想正弦波形进行锁相的仿真结果，图中蓝线表示电压波形，绿线表示角度的余弦，红线表示角度的正弦。由图3可以看出，绿线与蓝线在过零点处交汇重合，说明过零点相位一致，经过计算得到的余弦值满足锁相的要求。图4正弦波中叠加有三次谐波，波形发生畸变，按照本文所说的滤波方法和锁相的方法，可以看出绿线和蓝线在过零点处交汇重合，说明过零点相位一致，没有受到谐波干扰。从仿真结果看，提取基波正序分量进行锁相，方法正确可行。 图3. 对理想正弦锁相的波形 图4. 对带有三次谐波的正弦锁相的波形"
"图5. 左图为锁相波形，右表为各次谐波含量 实验是使用三相交流电源Chroma模拟各种畸变的市电电压波形，图5的实验波形中蓝线表示交流电源输出的电压波形，红线表示角度的余弦值，绿线表示角度的正弦值。右边的表格是模拟交流电压波形中各次谐波含量，含量值记录在相对应的表格中。可以看出交流源输出的电压波形已经严重畸变，按本文所讨论的锁相方法进行锁相计算，得到的余弦值在过零点处始终与电压波形过零点一致，没有受到电压波形畸变的影响。通过实验可以得到两点结论：1) 当电网中存在谐波时可以进行正确的锁相；2) 当电网电压的任何一相或者两相掉电的时候，仍然可以锁相。 图6中蓝线为交流电源产生的波形，绿线是按未提取基波正序分量的方法锁相得到的角度余弦波形，红线是按本文所讨论的锁相方法得到的角度余弦波形。可以看出在电源输出交流电压畸变的情况下，原锁相方法得到的角度余弦值也随之发生畸变，过零点处与交流源波形的相位关系已经不清楚，已不能正确反应相互间的相位关系。而按本文所提的锁相方法，余弦值没有受到电压波形畸变的影响，过零点处能够正确地反应相位关系。究其原因是原锁相方法本身不存在问题，主要是因为该方法锁错了对象，应该对市电电压的基波正序分量进行正确有效地提取，而不是将整个市电电压作为锁相的对象。 图6. 原方法锁相与本文方法锁相对比"
"本文所讨论的方法是基于市电频率稳定在50 Hz的情况，二阶低通滤波器先将基波以上谐波过滤掉，得到标准的正弦波形采样值；提取正序分量是为了消除负序分量的影响，更能真实准确地反应电网电压交流波形值。该锁相方法与传统的锁相方法相比，不需要在硬件上增加额外的投入，在矢量控制计算前仅根据式(10)在控制程序中编程实现锁相计算，CPU的计算工作量小，不影响矢量控制的实时性，保证了矢量控制的准确实现，解决实际工程问题成本低，效果好。该方法不仅适用于三相三线系统，还适用于三相四线系统，同时也适用于单相系统。在三相系统中，如果出现市电缺任何一相的情况，仍然可以锁住电网正序基波相位，抗干扰能力强，解决了传统锁相方法不适用于电网负荷较重或电网条件较差的情况，拓宽了产品的适用环境。"
