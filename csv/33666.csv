"时空图像测速方法(STIV)是一种以河流表面图像为分析对象、通过检测合成时空图像的纹理主方向获取一维时均流速的测量方法。由于具有空间分辨率高、实时性强、安全简便等优点，STIV方法在河流水面流速、断面流量的实时监测中具有特别的应用潜力。鉴于该方法在国内的研究尚处于起步阶段以及现有测流方法的缺点，本研究尝试引进STIV方法以更好地服务于国内水文测验工作。为了验证该方法的可行性并提出研究需求，在崇阳水文站与旋桨式流速仪进行比测试验。结果表明，STIV方法所获取的表面流速的相对误差均控制在16%以内，初步说明了该方法的可行性。 关键词 :流速测量，图像处理，时空图像，比测试验，STIV Copyright © 2020 by author(s) and Wuhan University. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"流量数据是水文研究最为基础的数据之一，也是一切水文研究的基础。由于天然河流复杂的流动特性以及恶劣的户外测验环境，天然河流的流量测量一直是水文测验中一项困难的工作。尤其是在当前洪水与干旱等极端情况频发的情况下，对于及时获取河流流速、径流量变化等关键信息的需求更为迫切，传统的流量测量方法由于自身种种缺点已经难以满足要求。 常见的流量测量方法包括流速仪法、浮标法以及多普勒流速剖面仪法(ADCP)等。流速仪法测流首先使用流速仪测量垂线的流速分布，再通过流速面积法计算流量。该方法是最基础也是目前应用最为广泛的测流方法，但是其费时费力。例如对于一个宽约300 m，设置有10条测速线的断面，即使采用最简单的一点法施测，一个测回也需要40~50分钟，而对于类似长江这样的大江大河，一个测回所需时间可达5个小时，甚至更久。此外，流速仪法属于接触式测流方法，难以保证水文测验人员自身的生命安全，尤其是在高洪时期；浮标法测流是另一种常用的测流方法，该方法通过测量出断面上水面浮标速度分布，再结合断面数据确定虚流量，最后乘以浮标系数得到断面流量 [ 1 ]。但是该方法在测量浮标流速、浮标系数的选取方面存在诸多不确定性，且该方法不适宜在发生特大洪水的情况下使用。正是由于上述缺点，该方法目前已很少采用；走航式ADCP于上世纪90年代初被长江水利委员会水文局率先引入到国内，并逐渐发展成为一种重要的测流方法。ADCP通过跟踪水体中散射体的运动来得到水流速度，与流速仪不同的是，ADCP可以一次测量垂线上的多点流速，再使用流速面积法得到断面流量 [ 2 ]。也正是由于ADCP的测量原理，导致了其在河流含沙量较高等情况下容易出现测量结果不稳定甚至严重失真的情况，此外高昂的价格也限制了ADCP在更大范围的推广使用。 伴随着信息技术的快速发展，基于图像、光学以及雷达的测流方法迅速发展，特别是基于图像的测流方法，因其简单、高效、安全而得到广泛关注。极坐标摄影浮标法是最早提出的基于图像的测流方法，该方法实质上是对传统浮标法的一种改进 [ 3 ]。其基本思想是采用摄影照片代替现场测量，通过人工标识或计算机识别的方式从照片中提取测流浮标的方位，进而求出运动轨迹上的水面流速。卫星遥感图像法是另一种基于图像的测量方法，随着高分辨率成像及合成孔径雷达(SAR)遥感技术的发展，卫星遥感图像被研究用于获取地面河流的形态及水位信息，并结合地面测量值和水文模型估计河流流量。该方法大致可分为利用河宽估计流量、利用水位估计流量以及利用多变量估计流量三种。目前卫星遥感图像法测流主要用于宽浅河流的流量估计，由于对地面信息和历史数据的依赖及过大的测量误差使之尚无法实用化，但可以为洪水、湿地、泥石流、堰塞湖等难以到达地区的灾害应急监测提供及时的先验信息 [ 4 ]。近十几年来，另一种通过分析河流表面图像变化的测流方法受到了广泛关注。该方法主要在河岸一侧架设相机，利用相机拍摄的水面视频图像来分析水流示踪物运动矢量的大小。作为一种非接触式的测流方法，它克服了传统接触式测流方法的缺点，可以简单、快速、高效、安全地测量流速和流量信息，尤其使得高洪时期的测量工作成为可能。此外，鉴于目前各水文站均配备有河流监控系统，这无疑为该方法的推广使用提供了良好的条件，同时也降低了使用成本。根据运动矢量估计方法的不同，该方法主要分为大尺度粒子图像测速法(LSPIV)和时空图像测速法(STIV)两类。LSPIV方法于20世纪90年代由Fujita等人提出 [ 5 ]，该方法是将实验室流体力学研究中的粒子图像测速(PIV)技术改进用于现场河流的水面流场观测及流量测量。它以天然漂浮物及涟漪等表面流动特征为水流示踪物，以自然光为主要光源，以数码相机或视频摄像机为图像采集设备，通过匹配分析区域内跟随表面水流运动的示踪物图像获得二维流速场 [ 6 ]。在国内，河海大学课题组以LSPIV为基本原理，建立了一套河流水面成像测速(RSIV)体系并开展了比测试验 [ 7 ]。然而，LSPIV也存在一些缺点：1) 测量依赖于水面示踪物的可见性，当采用天然示踪物时，由于示踪物密度低、时空分布不均，以及水面成像条件复杂等的影响，极易引起时均流场重建的失效或误差过大 [ 6 ] ；2) 分析区域大小的选择存在诸多不确定性。若分析区域尺寸过大，则会由于空间平均效应降低测量的空间分辨率 [ 8 ]。分析区域过小又容易因缺乏目标信息而导致出现误匹配 [ 9 ] ；3)所需存储空间大，计算效率较低 [ 10 ]。相比于LSPIV，Fujita等人于2007年提出的STIV方法在断面流量测量方面展现出更好的性能 [ 10 ]。尽管STIV方法仅能获得平行于流动方向的一维流速分布，但其空间分辨率能够达到单像素水平，并且算法效率是LSPIV的10倍以上，这已经足够满足实际流量测量工作的需求。Fujita等人先后在日本的多条河流使用该方法进行流量测量试验，均取得了较好效果 [ 10 ] [ 11 ] [ 12 ]。此后针对STIV方法拍摄河宽受限的问题，Fujita等成功使用不同拍摄俯角来加以解决 [ 13 ]，又使用高分辨率的红外线摄像机完成了基于STIV的夜间流量观测 [ 14 ]。目前对于STIV的研究与应用主要集中在日本，而在国内尚处于起步阶段。 针对STIV方法在测流方面的优良特性以及现有测流方法的缺点，本研究尝试引进STIV方法以更好地服务于国内水文测验工作。为了评价该方法的可行性并提出研究需求，于2019年6月14日在湖北省咸宁市崇阳水文站与旋桨式流速仪进行了流速比测试验。"
"在忽略风的影响下，诸如涟漪、波纹等河流表面流动特征是随水流一起运动的，因此可以认为其运动速度近似等于河流表面流速，这些表面流动特征的运动又会导致河流表面灰度发生变化，综上所述，河流表面灰度的变化大小可以反映河流表面流速的大小。我们可以在所拍摄的河流视频中沿水流方向设置一系列测速线，逐帧提取每条测速线的灰度信息以合成该测速线的时空图像。由于灰度的变化，在每幅时空图像中会呈现出带状纹理，带状纹理与竖直方向所夹的角度(纹理角)即反映了表面流速信息。  时空图像包含着河流表面灰度的变化信息，通过对时空图像中纹理角的识别可以得到表面流速信息。下面以一个实例来说明时空图像的生成：图1是现场拍摄的视频图像，图中红色箭头代表水流方向，红线代表沿水流方向设置的测速线，测速线长度为200像素，宽度为1像素。根据测速线的像素坐标位置，逐帧提取测速线的灰度，并按照从上往下的顺序进行排列，即可得到如图2所示的时空图像。 如图2所示，时空图像的横坐标代表测速线的长度，纵坐标代表视频拍摄时间。例如，在上面的例子中，测速线长度为200像素，则时空图像的横向宽度为200像素；视频的持续时间为15 s，每秒30帧，则时空图像的纵向宽度为450像素。 图1. 测速线设置 图2. 测速线的时空图像  在已经得到时空图像的情况下，需要采用一种合适的图像识别方法来检测时空图像中纹理角的大小。在目前的STIV方法中，选取灰度梯度张量法来对纹理角α进行角度识别，计算公式如下 [ 15 ] ： tan 2 α = 2 G x t G t t − G x x (1) 在(1)式中： G x x = ∬ S ∂ I ( x , t ) ∂ x ∂ I ( x , t ) ∂ x d x d x (2) G x t = ∬ S ∂ I ( x , t ) ∂ x ∂ I ( x , t ) ∂ t d x d t (3) G t t = ∬ S ∂ I ( x , t ) ∂ t ∂ I ( x , t ) ∂ t d t d t (4) 式中：I(x, t)表示时空图像中灰度的大小，S表示积分区域。 ∂ I ( x , t ) ∂ x 与 ∂ I ( x , t ) ∂ t 表示灰度的梯度，反映灰度沿x方向与t方向的变化情况，在本研究中采用Sobel算子H x 与H t 求解灰度梯度： H x = [ − 3 0 3 − 10 0 10 − 3 0 3 ] ，   H t = [ − 3 − 10 − 3 0 0 0 3 10 3 ] (5) 在这里引入一个相关性参数C，以检查时空图像纹理的清晰程度： C = ( G x x − G t t ) 2 + 4 G x t 2 G x x + G t t (6) 参数C的取值范围为0至1，参数C的值越大，表明时空图像的纹理越清晰。 为了尽可能排除时空图像中噪声对计算结果的干扰，我们将时空图像分成若干个小部分，先由(1)~(5)式求出各部分角度，再对各部分的角度值求平均，得到最终的纹理角大小，过程如图3所示。 用以下公式求解最终的纹理角大小： α ¯ = ∑ i α i ⋅ C ( α i ) ∑ i C ( α i ) (7) 式(7)的思想是：将各部分的相关性 C ( α i ) 作为各部分角度值的权重，对各部分加权平均求最终的纹理角 α ¯ 。这样，条纹更加清晰的部分将获得更大权重，而因噪声影响使得条纹不清晰的部分权重较小，使得求解结果更加准确。 图3. 纹理角求解过程  得到时空图像的纹理角后，根据测速线的实际长度即可求得测速线的流速。测速线的长度可以根据相平面坐标(x, y)与实际空间直角坐标(X, Y, Z)的关系求得 [ 16 ] ： { x = x p + f r 11 ( X − X p ) + r 12 ( Y − Y p ) + r 13 ( Z − Z p ) r 31 ( X − X p ) + r 32 ( Y − Y p ) + r 33 ( Z − Z p ) + Δ x y = y p + f r 21 ( X − X p ) + r 22 ( Y − Y p ) + r 23 ( Z − Z p ) r 31 ( X − X p ) + r 32 ( Y − Y p ) + r 33 ( Z − Z p ) + Δ y (8) 式中，(x p , y p )表示像主点的相平面坐标，(X p , Y p , Z p )表示相机的实际空间直角坐标，f代表焦距，(Δx, Δy)代表镜头畸变校正数，r ij (i, j = 1~3)是两个坐标的转换系数。 式(8)中含有12个未知参数，因此我们至少需要知道6个点的相平面坐标与实际空间坐标才能求解上述未知数(每个点可列出2个方程)，为此我们需要在现场设定6个或者6个以上地面标定牌，用全站仪测出它们相对于测站点的实际空间直角坐标，其相平面坐标则可直接从视频图像中获得。在求得上述12个未知数后，我们就可以根据(8)式并结合水位值算出时空图像上任意一点的实际空间直角坐标，从而求得所设置测速线的实际长度。  我们假设在实际空间直角坐标系中，涟漪等表面流动特征在时间T内沿测速线运动的距离为L，相应地，在相平面坐标系下则对应于在k帧内运动了i个像素，则测速线上的流速大小为： v = L T = i ⋅ S x k ⋅ S t = tan α ¯ ⋅ S x S t = tan α ¯ ⋅ S x ⋅ fps (9) 式中： α ¯ 表示纹理角大小，S x 表示每个像素所代表的实际距离(单位为：m/像素)，fps表示相机的帧速率(单位为：帧/s)。 最后可根据流速面积法，按照下面的公式计算流量： Q = ∑ i η ⋅ V i ⋅ A i (10) 式中： η 表示表面流速系数，V i 表示区间表面流速，A i 表示区间面积。"
"目前在水文测验中，将流速仪法测量得到的流量结果视为流量真值，因此流速仪法是比较其他测流方法的标准 [ 2 ]。为了验证上述基于图像识别的测流方法的可行性与准确性，于2019年6月14日在崇阳水文站与旋桨式流速仪进行了流速比测试验。流速仪测量与视频拍摄在无风时段同步进行，以满足STIV使用条件且保证二者测量的是同一时段水流。流速仪在起点距分别为70 m，80 m，90 m，100 m，110 m，130 m和140 m的垂线利用两点法测量垂线流速，同时测量位于水面下50 cm处的流速，将其近似视为表面流速。根据视频中流速仪的位置，在相同起点距处设置长度相等的测速线，按照第2部分的方法计算表面流速与流量，并比较二者测量结果。  崇阳水文站位于湖北省咸宁市崇阳县陆水河干流畔，隶属于长江水利委员会水文局，是国家级基本水文站。测流实验地面标定布置如图4中红框所示。 图4. 地面标定点布设 试验器材如表1所示。 Table 1 设备名称 包含器材 摄像设备 变焦相机、电源适配器、供电转换头、网线、USB转网口线、电源线、相机支架、笔记本电脑 坐标测量设备 全站仪、三脚架、棱镜、棱镜支架、广告牌支架、支架板、反光片 测流设备 流速仪、自动水位计 表1. 试验器材清单  试验采集的7个地面标定点的实际空间直角坐标与像平面坐标如表2所示。 Table 2 标定点序号 像平面坐标(像素) 实际空间直角坐标(m) x y X Y Z 1 166.908 335.534 1081.071 831.879 56.23 2 564.024 382.765 1102.712 870.848 52.623 3 1075.57 361.064 1138.318 896.316 55.285 4 1635.811 382.872 1176.145 931.232 55.576 5 147.008 648.009 1027.994 968.48 52.404 6 589.209 738.873 1029.006 986.218 53.574 7 1097.026 706.88 1041.348 986.027 52.547 表2. 标定点坐标 由流速仪测量得到的表面流速与垂线平均流速如表3所示，其中垂线平均流速是由两点法算出。 Table 3 垂线序号 起点距(m) 表面流速(m/s) 垂线平均流速(m/s) 1 70 0.54 0.395 2 80 0.67 0.530 3 90 0.69 0.580 4 100 0.63 0.515 5 110 0.53 0.440 6 130 0.51 0.410 7 140 0.35 0.205 表3. 流速仪测量结果   图像法测流的计算结果如表4所示。 Table 4 测速线序号 起点距(m) 时空图像 纹理角大小(度) 表面流速(m/s) 1 70 25.0928 0.5886 2 80 26.1604 0.6989 3 90 26.2567 0.7980 4 100 28.1977 0.6937 5 110 20.7749 0.5757 6 130 14.7121 0.5612 7 140 12.4562 0.3980 表4. 图像法测流结果  如图5所示，利用流速面积法求解断面流量(岸边流速系数取0.7)，流速仪法流量计算表如表5所示。 Table 5 断面序号 部分面积(m 2 ) 部分平均流速(m/s) 部分流量(m 3 /s) 1 16.42 0.28 4.54 2 12.25 0.46 5.67 3 14.90 0.56 8.27 4 16.60 0.55 9.09 5 18.70 0.48 8.93 6 41.50 0.43 17.64 7 16.50 0.31 5.07 8 4.02 0.14 0.58 表5. 流速仪法流量计算表 由表5可知，通过流速仪法计算得到的断面流量为59.78 m 3 /s。 图5. 断面示意图 图6. 流量计算结果 根据崇阳站多年观测经验，分别取表面流速系数为0.70~0.75，按照流速面积法计算断面流量。以取表面流速系数为0.7为例，断面示意图如图5所示，图像法流量计算表如表6所示。 Table 6 断面序号 部分面积(m 2 ) 部分平均流速(m/s) 部分流量(m 3 /s) 1 16.42 0.29 4.74 2 12.25 0.45 5.52 3 14.90 0.52 7.81 4 16.60 0.52 8.67 5 18.70 0.44 8.31 6 41.50 0.40 16.51 7 16.50 0.34 5.54 8 4.02 0.20 0.78 表6. 图像法流量计算表(表面流速系数为0.7) 由表6可知，当表面流速系数取0.7时，通过图像法计算得到的断面流量为57.87 m 3 /s。按照同样的方法计算取其他流速系数时得到的断面流量，结果如图6所示。  整理上述计算结果，可得表7。 Table 7 内容 起点距 流速仪法 图像法 绝对误差 相对误差 表面流速(m/s) 70 0.54 0.5886 0.0486 9.00% 表面流速(m/s) 80 0.67 0.6989 0.0289 4.31% 90 0.69 0.7980 0.1080 15.65% 100 0.63 0.6937 0.0637 10.11% 110 0.53 0.5757 0.0457 8.62% 130 0.51 0.5612 0.0512 10.04% 140 0.35 0.3980 0.0480 13.71% 表7. 计算结果 由表7可以看出，由图像法计算得到的表面流速均大于流速仪法实测值，相对误差基本在15%以内。事实上，为了消除水流脉动等因素的影响，流速仪在测量水面一点流速时，转子的实际入水深度至少要在水下50 cm以上才能保证测量值的稳定，因此流速仪测得的并不是真实的表面流速，而是水下50 cm左右处的流速，只是将其近似认为是表面流速，所以由图像法得到的表面流速大于流速仪实测值。从流量的计算结果来看，如图6所示，通过图像法得到的流量均在合理范围内，相对误差均不超过±5%，说明只要根据水文站特性适当选取表面流速系数即可得到令人满意的流量计算结果。"
"针对当前常见流量测量方法存在的问题，本文尝试引进STIV方法以更好地服务于流量测量工作。该方法认为在忽略风的影响下，诸如涟漪等河流表面流动特征是随水流一起运动的，因此可以认为其运动速度近似等于河流表面流速，这些表面流动特征的运动又会导致河流表面灰度发生变化，在逐帧连续提取的时空图像中形成条状纹理。纹理角度的大小就反映了表面流速的大小，所以可以通过识别纹理角的大小来计算表面流速。为了验证该方法的可行性，于崇阳水文站与旋桨式流速仪进行了比测试验，结果表明：图像法获得的表面流速的相对误差均控制在16%以内，由表面流速计算得到的流量也在合理范围内，初步说明了该方法的可行性。 未来的工作将结合现有结果对STIV方法进行完善，包括：1) 考虑风速对STIV方法的影响；2) 完善图像处理方法，提高示踪物特征，以增强STIV方法在诸如下雨、光照变化、倒影等复杂水面成像条件下的适应性；3) 对测速线长度、视频帧数等因素进行敏感性分析及不确定度评估，以便为STIV方法的应用提供更好指导。"
