"光照不均匀现象是遥感影像获取中常见的一个问题，光照不均匀影像往往存在反差不均匀现象，而Wallis滤波器对反差不均匀影像有特殊作用，故可以采用Wallis原理对光照和反差不均匀影像进行处理。经典的Wallis匀光结果影像也存在“块效应”和整体色调偏移等问题，本文提出一种基于Wallis原理改进的匀光算法，在消除光照不均的情况下也能改善反差不均匀现象。实验表明，改进后的匀光算法处理的结果影像能有效的实现光照和反差一致。 关键词 :光照不均匀，匀光，Wallis原理，反差不均匀，块效应"
"遥感影像在获取过程中由于多种因素的影响，如光学透镜成像不均匀、外部云层、大气衰减以及向阳背阳等条件，会造成同一幅影像内部不同区域的色调、亮度、反差等存在不同程度的差异，出现这种差异的现象称之为不均匀光照现象。这种现象会给遥感图像后期处理如图像后期的判读、解译和镶嵌等工作带来很大的困难[ 1 ] 。因此，需要对不均匀光照影像进行研究和处理，以便于后续利用。 在实际处理过程中匀光方法有以下两类：第一类是基于模型的匀光方法，其中大体有基于加性噪声模型法和基于照度与反射模型法，常用的有Mask匀光算法[ 2 ] 和Retinex匀光算法[ 3 ] ，MASK匀光方法相减得到的结果影像中较暗的区域反差低，较亮的区域反差高[ 4 ] ，Retinex匀光算法对边缘等影响高频信息有增强效果，但对影像对比度有一定的抑制作用，会造成反差下降[ 5 ] 。第二类是基于标准影像的匀光处理方法，具有代表的有Wallis匀光法。Wallis变换能在增强原始影像局部反差的同时又压制噪声，具有局部自适应功能。李德仁提出基于Wallis变换的色彩均衡处理方法，并应用于匀光处理软件GeoDodging中[ 2 ] 。经典的用于单幅的Wallisy匀光算法对光照不均匀影像进行了分块处理，不可避免的出现了程度不同的“块效应”，在选择标准影像上也未针对影像的具体情况进行选择，容易导致匀光后影像总体色调偏离。本文针对上述问题对Wallis匀光算法进行了改进，对影像进行重叠分块并合理选取标准均值和方差对影像块进行Wallis匀光处理得到初步匀光结果，再对分块重叠区域的过渡处理消除影像的“块效应”，实验表明，该算法有较好的匀光效果。"
"一幅影像的灰度均值反映了它的色调与亮度，方差则反映了它的灰度动态变化范围，并在一定程度上反映了它的反差，要想影像之间达到色彩平衡，应该使不同影像具有近似一致的灰度均值与方差。依据这个原理，Wallis滤波器将影像的灰度均值及方差映射到某一定值，并且使不同影像的灰度方差和灰度均值都近似相等[ 6 ] 。变换不同的影像之间或影像内部的不同位置上的灰度均值和标准偏差使之具有近似相等的数值，增强光照不均匀影像中灰暗区域的亮度及对比度。 Wallis匀光算法使用的滤波器可用下式表示： (1) 式中： 为原始影像在 处的灰度值， 为经过Wallis变换后结果影像在 处的灰度值， 为原始影像的局部灰度均值， 为原始影像的局部灰度标准偏差， 为变换后影像局部灰度均值的目标值， 为变换后影像的局部灰度标准偏差的目标值， 为影像方差的扩展常数， 为影像的亮度系数，分析(1)式，当b趋向于1时，影像均值被强制到 ，当b趋向于0时，影像的均值被强制到 。当调节系数c和b都取1时，此时(1)式也可表示为如下线性变换式(2)： (2) 分析(2)式，当 等于 ， 等于 时，即待校正影像与标准影像的均值和方差一致，采用(2)式进行变换不会引起影像灰度的改变，并且能使待校正影像与标准影像的亮度和方差基本一致。  经典的用于单幅的Wallis匀光算法处理的结果影像容易出现块与块明显的分界线，这是因为Wallis匀光将图像的左分块的均值和右分块的均值调成一致，但是相交的地方匀光后亮度不一致，所以出现明显的分界线。单幅影像的Mask匀光算法在处理不均匀光照影像过程中，并没有考虑原始影像的反差分布不均匀，得到的结果影像仍然存在反差不均匀现象。为了解决上述问题，将Wallis匀光算法进行了改进，下面将改进算法分成3个部分详细介绍：分块方案、标准影像的选取、重叠区域的过渡处理。 1) 分块方案 由式(2)可知，对影像进行Wallis匀光处理需要确定局部均值方差，即 和 ，经典的用于单幅的Wallis匀光算法对影像进行互不重叠的分块，取 和 为待处理点所在分块的均值和方差，标准均值方差为最亮区域的均值方差，由此容易产生“块效应”。为了克服这种“块效应”，在分块时将影像分成相互有重叠区域的矩形分块，再对矩形分块的重叠区域进行过渡处理。分块大小可依据影像大小来确定，一般将影像进行6 × 6分块，重叠区域设为块影像的四分之一，若重叠区域过大，在对重叠区域进行过渡处理是会增大计算量，若重叠区域过小，则不能对充分消除“块效应”。 2) 标准影像的选取 Wallis匀光算法另一关键在于确定标准均值方差。对于内部没有光照剧烈反差且光照不均区域不超过影像面积的一半的影像，将最大均值所在块的均值反差设为标准均值方差，因为对于这种影像，光照最亮的部分在成像时具有最好的光照条件，所受到的辐射衰减最小，最能代表地物真实的辐射状况[ 6 ] 。但是然而由于河流湖泊等地物的反射特性也会有其他情况导致遥感影像产生较大的光照反差，此时不能选取均值最大块作为标准块，可以选用整幅影像的统计参数作为标准参数[ 7 ] ，或者将目标均值设为经验值100~150之间，方差设30~70之间的数值。 3) 重叠区域的过渡处理 对相邻分块在重叠区域内出现的色调差异影像较大的是块的色调整体漂移，只需要通对块与块之间的重叠区域进行线性变换，使每个分块的色调接近相邻分块的色调，降低分块内部重叠区域内的色调差异，提高影像整体质量。重叠有以下两种情况，左右重叠和上下重叠，如图1和图2所示。 左右重叠区域的过渡处理： 对左影像在重叠区域内的每一个像素，按下式进行处理： (3) 对右影像在重叠区域内的每一个像素，按下式进行处理： (4) 其中， 原始影像在 处的灰度值， 是经过线性变换之后的灰度值， 和 分别表示左影像在重叠区域中的最左边和最右边边界上的像素的灰度值。 和 分别表示右影像在重叠区域中的最左边和最右边边界上的像素的灰度值。 上下重叠区域的过渡处理同左右影像在重叠区域内的处理方式一致。 改进的Wallis匀光算法流程图如图3所示，具体过程如下： 图1. 左右重叠示意图 图2. 上下重叠示意图 图3. 改进算法流程图 1) 读取待处理影像，并对影像进行重叠分块，计算分块后影像的均值方差。 2) 分析影像的具体情况，确定标准影像的均值方差。 3) 利用 、 、 、 进行Wallis匀光。 4) 对影像分块的重叠部分进行线性过渡处理，并得到最终结果影像。"
"为了验证改进后的Wallis匀光算法的有效性，选取了光照不均匀且反差强烈黑白影像，大小为512像素 × 512像素，如图4所示，用改进算法进行处理，如图5所示，同时将原始影像用经典Wallis匀光算法和和MASK匀光算法处理，结果分别如图6和图7所示。 对匀光处理结果的评价主要从定性和定量两个方面来进行分析，处理结果要反差适中、图像清晰、信息丰富，保持原影像的平均亮度，不过分增大影像反差，并且保持原影像信息不丢失。 1) 定性方面：从目视上看，原始图像左下区域偏亮，同种地物与其他部分相比呈现了不同的色调， 图4. 原始影像 图5. 改进的Wallis匀光算法结果图 与其他区域部分反差较大，图8为其灰度直方图，灰度范围主要集中在偏暗区域，反差较小。图7是将原始影像进行3 × 3正方形分块，计算每个分块的均值方差，取标准均值方差为整幅图像的均值方差，采用(2)式进行Wallis匀光所得结果图，可以看出，影像存在明显的块与块的分界线，且块与块之间明暗程度不一，目视效果不佳。但从图9看出，Wallis匀光增大了影像的反差。MASK匀光结果影像消除了原始影像部分偏亮的现象，但是也存在整体偏暗的问题，从图10中的灰度直方图中可以看出，影像灰度范围教小，降低了原始影像的反差。改进的Wallis匀光算法结果影像避免了出现“块效应”现象，整体平滑、清晰，目视效果好，从图11也可以看出影像增大了原始影像的反差，达到了匀光效果。 2) 定量方面：由于均值可以反映亮度变化，而平均梯度可以反映影像中微小细节反差与纹理变化特征，同时也表达影像的清晰度，故可以采用影像均值、标准差、平均梯度[ 8 ] 。均值的定义为整幅影像灰度的平均值，平均梯度是影像内灰度的差异，可以反映影像细部反差，平均灰度越大，细部反差就越大，平均梯度可以采用下式计算： 图6. 经典Wallis匀光算法结果图 图7. MASK匀光算法结果图 (7) 式中，M、N为影像的长宽， ， 分别为像素 在x，y方向上的一阶差分值。本文将原始影像与结果影像分为左上，右上，左下，右下四个不重叠部分，表1和表2分别是为原始影像和结果影像的均值、标准差和平均梯度。 从表1的数据可以看出，原始影像的均值、标准差和平均梯度都在左下部分大于其他各个区域，原始影像的亮度和反差较高，而右上部分的亮度和反差较小，整幅影像亮度和反差不均匀。比较表2结果影像的各个参数，传统分块处理结果图的参数中均值方差在各个部分分布均匀，影像各个局部和整体的的亮度和反差都比原影像有所提高，经过MASK匀光法处理的图像，均值在各个区域基本保持一致，但整幅影像偏暗，灰度均值在各个部分相差较小，且细部反差也变小，未提高影像清晰度。而经过Wallis匀光方法处 图8. 原始影像直方图 图9. 图6的直方图 图10. 图7的直方图 图11. 图5的直方图 Table 1 局部 原始影像 均值 标准差 平均梯度 左上 88.26 37.16 20.57 右上 70.15 31.17 18.75 左下 127.34 44.97 29.93 右下 82.62 38.57 21.37 表1. 原始影像均值、标准差和平均梯度 Table 2 局部 传统分块处理结果图 MASK匀光影像 改进算法匀光影像 均值 标准差 平均梯度 均值 标准差 平均梯度 均值 标准差 平均梯度 左上 89.56 30.06 21.55 85.84 27.00 23.78 90.50 31.53 30.52 右上 75.13 29.15 26.07 84.09 23.29 21.40 85.14 30.18 29.10 左下 99.41 36.05 28.95 89.23 30.53 22.97 101.97 33.11 26.48 右下 80.02 30.74 25.56 87.21 29.30 23.50 89.42 31.74 29.51 表2. 结果影像的均值、标准差和平均梯度 理的图像，均值在各个区域趋于一致，接近光照均匀影像。各部分反差与平均梯度较MASK匀光方法得到的结果有明显提高且各个部分保持一致，影像整体反差均匀，增强了影像细节信息，影像细节清晰。从定量方面分析，改进算法也具有优势。"
"MASK匀光方法和Wallis匀光算法都能使影像均值在各个区域保持一致，即改善图像的光照不均现象，但MASK匀光方法降低了影像的反差，使得匀光后影像出现反差不一致现象，Wallis算法在改善影像亮度不均现象的同时校正了影像反差，使整体影像反差趋于一致。改进的Wallis算法将影像进行了有重叠区域的分块并对重叠区域进行了过渡处理，避免了结果影像出现“块效应”。"
