"本文基于自动检售票系统业务、运营及分析需求，结合经典五层架构，通过将ACC、MLC、ITP纳入线网云平台，将SC纳入车站云平台，提出融合云服务能力ACC、SC、SLC和车票的智慧区域中心架构。在此基础上，通过分离AFC区域中心实时型和关系型数据库，明晰出具体的业务系统数据流向图。本文提出的智慧AFC平台系统，实现对系统运营､票务､收益､维修的集中管理功能，采用基于软件包的思想对中心系统体系结构进行设计，将系统功能实现划分成不同的软件包，满足单独部署和运行要求；在此基础上，研究区域中心各模块之间接口，细化出请求和响应报文的封装接口，实现系统应用接口的纵横向打通，实现不同设备标准接口和不同模块参数的组件化统一管理｡相关研究成果在贵阳市城轨系统得到有效应用，对我国轻轨的智慧化发展具有积极意义。"
"2017年10月，中共的“十九大”部署交通强国战略；2018年7月，国务院办公厅发布《关于进一步加强城市轨道交通规划建设管理的意见》(国办发[ 2018 ] 52号)，标志着中国城市轨道交通从2003年开始的规范发展阶段跃升进入优化发展阶段。优化发展阶段中重点研究在城市轨道交通行业中，如何融合下一代网络(Next Generation Network, NGN)技术、物联网(Internet of Things, IOT)、云计算(Cloud Computing)、人工智能(Artificial Intelligence)等新技术，建设结构网络化、制式多样化、装备智能化和技术自主化的“智慧城轨”，实现轨道交通行业在生产方式、组织形态、管理理念和商业模式的创新突破，实现从“城轨大国”到“城轨强国”转化。 从线到网，我国城轨运营走向网络化、集中化、智慧化，2020年3月，中国城市轨道交通协会发布《中国城市轨道交通智慧城轨发展纲要》中，重点指出通过智能票务系统提升智慧乘客服务体系；并明确在2025年，在自动售检票(Automatic Fare Collection, AFC)系统中，实现基于生物识别技术的实名制乘车服务，实现自动开关站、语音问询、信息服务、动态引导、环境调控、无感支付、语音购票的普适服务，推动完成各城市之间的票检智能合一，实现智能线网运力服务的精确匹配、安全准确、快捷高效；并保证在突发应急情况时，保证客流的智能化管理、快速引导和有序疏散 [ 1 ]。 智慧城轨的自动售票检票系统架构、数据传输方式、支付结算方式、相关系统互联互通等方面的建设相比传统模式有着较大的差异。同时，由于国内城市轨道交通AFC系统的建设标准不一、所处阶段不同、信息化建设进程差异较大，尤其是对智慧城轨发展形势下的AFC系统认知程度深浅有别，导致乘客使用不便、系统改造频繁、互联互通性差等问题，不利于轨道交通AFC系统的可持续发展。因此，迫切需要结合智慧城轨的AFC系统需求和国内各城市发展规划，研究AFC系统的可落地智慧化应用。"
"自动售检票AFC系统是基于计算机、通信、网络和自动控制等技术，实现轨道交通售票、检票、计费、收费、统计、清分和管理等全过程应用及管理。2007年建设部在《城市轨道交通自动售检票系统技术条件》(GB/T 20907-2007)中提出经典的AFC系统五层构架体系，区域中心分为清分中心ACC-线路中心LC-车站中心SCH-车站设备SLE-票卡五层架构，涵盖业务功能和数据功能两部分，其中具体核心业务功能在ACC、LC和SCH三层实现。  清算中心ACC层主要实现票务、运营、结算、分析和参数管理五大功能。其中，参数管理系统负责全局性的参数设置，包括设备、票卡、盈利和网安等全局性参数，并实现基于角色的访问控制 (Role-Based Access Control, RBAC)、数据备份审计、黑白名单生成、秘钥网安管控；分析管理系统负责票卡交易、客流分布、票务使用、设备状态的数据分析；结算系统负责城市“一卡通”与联网轻轨“一票通”的收益清算结算；运营系统负责对线路运行、设备运行、运营模式参数的状态监控，并设定和推送票价、票类、票率的各类运营模式参数信息；票务系统实现票卡的发行、初始化、使用、库存、调配、挂失管理管理。  线路中心LC层级实现线路参数、线路运营、线路票务的管理。线路参数管理系统实现本线路内黑名单、访问权限、访问控制、数据审核及备案管理；线路运营系统实现线路运行状态监视及分析，接收ACC各项参数；票务系统按照ACC指令，完成线路内的票务调度及费用清算。  车站中心SCH层，负责车站内的参数管理、运营管理和票务管理。根据LC调配指令，接收票务、费率、运营参数，管理本站点的车票流通、系统运营，控制SLE车站终端，并实现紧急应急响应。"
"随着新技术的出现和轻轨在不同城市间不同的运营发展，传统五层架构已不再完全适用，尤其体现在通信线路互联和软件系统互通方面。因此，基于五层架构体系进行拓展构建AFC系统区域中心(Zone Line Center, ZLC)的设计及应用开始出现，实现统一的运营规则、维护标准和线路建设，对高密度的轨道交通线网的高效运作有着极为重要的应用价值，也是线网网络化运营的研究重点和难点。 谢小星基于乘客出行路径，通过分析交通票务清分因素，确构建多路径可达的票务清分模型的方法和要素选择原则 [ 2 ]；张鹏、王健等人采用云计算构建互联网票务系统，提出“五 + 三”的互联网 + AFC融合架构模型，采用实时推送的方式保证支付数据的快速准确，并将升级后的AFC系统应用到南京地铁移动支付项目中，取得良好应用效果 [ 3 ]；叶彤提出了面向长三角区域一体化的城市轨道交通二维码票务互联互通实践与思考 [ 4 ]。 城市轨道交通的运营生产系统由车站、骨干传输网、线网控制中心组成，通过将车站作为一个云节点，把车站终端设备采集信息利用传输网传输到线网控制中心，由控制中心进行统一操作和管理，实现传送与业务控制分离，形成三级功能、两级架构、双活中心的智慧运营生产系统，保障综合监控、信号ATS、自动售检票、专用电话等业务效能提升 [ 5 ]。  AFC区域中心系统需求总体上分为业务前台系统、业务后台系统和运营分析管理三类 [ 6 ]。其中，业务前台系统负责区域中心所辖车站的日常管理，要求实现区域、车站、客流、系统的监控，实现运行参数(Equipment Operating Data, EOD)、黑灰名单和履历的设备管理，实现ZLC和各个总票卡库的统一管理和响应ACC的按需调拨，实现负责车站的资金使用管理；业务后台系统支撑前台系统和运营分析管理需求，要求实现以ACC为主时钟、覆盖线路终端车站的标准时钟管理，实现面向消息的接入及处理的通信管理，实现面向系统数据的传输、解析、核对、备份和安全的数据管理；运营分析管理要求实现面向设备的维修管理，针对后台的操作权限和系统日志管理，并能提供面向客流和收益的整体运营分析决策报告。  采取线网云平台和车站终端两层架构，线网云平台集中部署ACC和MLC业务，传统架构中SC层业务上移至MLC。依据票务管理部门运营职能，AFC系统主要功能涵盖面向车票的制造销售、流动回收、销毁采购的票务管理功能，面向车资票价的定价计算、购票检票、计费收费、回收补票的车费管理功能，面向客流数据的采集传输、统计分析、查询存储的数据管理功能，面向乘客的票务查询、异常处理、退票换票的票务服务，及通过“一卡通”与其他公共交通方式换乘实现费用清算结算功能。因此，本文在传统五层架构基础上，将融入云平台的AFC架构体系分为“自动售检票清分中心、车站系统、车站终端设备、非接触式车票”四层。其中，综合监控业务采用线网中心、车站两层架构，并分别纳入线网级云平台与车站级云平台；列车自动监控系统(Automatic Train Supervision, ATS)的线网级和线路级信号纳入信息系统云平台，站段级ATS采用独立物理机设置；自动售检票采用ACC、MLC以及SC三层架构，ACC、MLC纳入线网云平台，SC纳入车站云平台；专用电话采用线网中心、车站两级架构，设置软交换平台；交换平台、集中网管平台、录音平台等业务平台统一纳入线网级云平台。整体架构如图1所示。 图1. 基于云平台的AFC整体系统架构图 区域中心由第二层车站中心统一接入服务器实现集中运营管理，并通过标准化清算中心和车站中心接口实现与其它线路和车站的管理接入，实现车站应用和就近资源的整合管理，使得原有的线路运营管理模式发展为区域管理模式。模式的升级带来清分、数据、运营、报表、票务、收益、维修等功能的变化，并要求清分中心与车站中心接口的统一标准化，并设置数据汇聚节点。在线网中设置区域中心的AFC系统架构如图2所示。 图2. 基于区域中心的AFC系统架构图 根据互联网票务的特性，结合城轨AFC的智慧化需求，通过AFC智能平台新增对互联网票务的业务支持能力智慧化建设，通过新增互联网票务平台iAFC的建设，实现对传统票务和数字票务系统、二维码管理系统等新型互联网票务的业务能力支持，并支持城轨官方APP的用户实名认证管理、二维码扫码乘车、移动支付及城轨企业特色服务 [ 7 ]；基于城轨已有BOM的改造、新增iBOM或配套运营管理APP等一种或多种方式组合，实现对传统票务、互联网票务的乘客事务处理，为互联网票务业务提供相应的运营管理支撑能力。智慧AFC平台具备开放性，可满足城轨向各移动应用开放商业化运营的需要，智慧AFC平台与其它平台域的分工界面如下图3所示。 图3. 智慧AFC平台与其它平台域的分工界面图  区域中心数据库包括用于中心内各系统数据集的关系型数据库和要求响应处理时限的实时数据两部分组成。其中关系型数据库处理网络管理、系统管控、分析报告等功能，实时型数据库处理客流监控、设备监管等快速变化的在线更新事务。其数据中心也分为中心数据集群和交易处理集群两层，交易处理集群中心实现对ZLC车站交易数据的支持，并推送至中心数据集群，中心数据集群在此基础上，实现对运营、清分、财务数据的集中处理，为ZLC其他应用系统提供数据支撑服务。区域中心数据库及数据流如图4所示。 图4. 基于微服务架构的区域中心数据流向图 结合“高内聚、低耦合”原则，基于微服务架构按照功能不同，划分为不同软件服务模块，联通相关服务和应用子系统形成软件包，实现单个包的独立部署和运行，在能独立完成系统功能服务的基础上，与其他软件包实现整体功能的联合执行，形成一体化运营管理服务。具体软件包功能及部署如表1所示。 Table 1 软件包 主要功能 部署方式 设备交易处理 处理由车站设备产生的交易文件，包括文件的安全检查、文件异常检查、交易异常检查、 解析交易数据并插入数据中心数据库中；把设备交易数据向ACC传输 ZLC 处理由车站设备产生的交易文件，包括文件的安全检查、文件异常检查、交易异常检查、解析交易数据并插入车站计算机系统数据库中；把设备交易数据向ZLC传输；文件接收列表处理和文件恢复 SC 设备参数管理 化理ACC设备参数；处理ACC黑名单(黑名单作为独立管理对象进行管理)；处理ZLC设备参数 ZLC 接收来自ZLC的设备参数和黑名单；下发设备参数和黑名单至车站设备 SC 中央系统通信 在ACC-ZLC、ZLC-SC之间收发实时消息，在ACC-ZLC之间收发模式命令并向车站广播， 建立和维护ACC-ZLC、ZLC-SC之间实时通信 ZLC 在ZLC-SC之间收发实时消息，建立和维护ZLC-SC之间实时通信 SC 设备接口 在SC-SLE之间收发实时消息，建立和维护SC-SLE之间实时通信 SC 实时数据库 缓存本ZLC管辖范围内所有设备的状态、事件、命令及客流的实时信息；把本地缓存的设备状态、事伴、命令及客流实时信息上传至ACC；把本地缓存的设备巧态、事件、命令及客流实时信息保存至ZLC数据中心数据库中；提供设备/客流监控的实时通知接口 ZLC 缓存本车站范围内所有设备的状态、事件、命令及客流的实时信息；把本地缓存的设备状态、事件、命令及客流实时信息上传至ZLC；把本地缓存的设备状态、事件、命令及客流实时信息保存至车站计算机数据库中；提供设备/客流监控的实时通知接口 SC 库存管理 进ACC-ZLC、ZLC-SC之间的库存移动管理；计算/显示ZLC实时库存，生成日终库存汇总 ZLC 在ZLC-SC之间进行库存数据的同步；接收库存介质的操作员输入；计算/显示SC实时库存，生成日终库存汇总 SC 现金管理 管理ZLC现金流；进行ZLC现金日终汇总；在ZLC-SC之间进行现金数据的同步 ZLC 接收现金的操作员输入；计算车站现金日终汇总； SC 报表 提供其他人家模块没有包含的报表 ZLC 数据分析 数据差异分析、客流分析、收益分析 ZLC 维修管理 维修系统管理；设备模块管理；备品备件管理；设备故障管理；维修工单管理；维修计划管理；维修报告 ZLC 设备/客流监控 监控、管理并控制设备，实时监控设备；实时告警&事件管理；设备控制；ZLC实时客流 ZLC 模式管理；实时客流显示；设备数据库接口 SC 设备管理 增加、修改、删除设备；设备数据服务；设备变更通知管理；设备模块管理； ZLC 系统管理 数据库管理；系统管理；用户管理 ZLC 任务调度；系统自检测；AFC系统监测 SC 网络管理 所属范围内全部网络设备、服务器的配置、监视和控制；系统自动发现可网管的网络设备、服务器和PC；网管数据分析及可视化 ZLC 表1. 软件包功能分解及其部署应用表  在AFC系统中，接口分为模块接口、设备接口、系统接口三类，系统接口实现清分中心到线路中心、再到车站的信息流通；设备接口实现车站到现场设备的接口服务，设备接口实现票务读写设备的接入服务。 上述接口中，系统接口通过FTP文件传输方式、分组报文方式、时钟同步方式进行通讯，包括车站模式、车站状态、查询信息、票卡账户、广播消息等类别，系统接口架构的合理性决定着整个AFC系统的效率高低和稳定程度。AFC系统的接口报文种类如表2所示。 Table 2 序号 报文种类 传送方 报文说明 通讯类别 1 车站模式状态广播 ACC->ZLC ACC向线路广播所有车站的模式及状态 广播 2 车站模式控制 ACC向线路发送车站模式变化控制命令 下行 3 车站模式查询 ACC向线路发起对某车站模式状态查询 下行 4 票卡库存调拨命令 ACC向ACC发起库存调拨命令 下行 5 文件下传命令 ACC向ZC发出文件下载命令 下行 6 设备工作状态查询 ACC->LC ACC向LC发起单台设备工作状态查询 下行 7 设备模块状态查询 ACC向线路查能设各模块的工作状态 下行 8 票卡库在调拨 ZLC<->ACC 线路、ACC间票卡库存调拨信息 双向 9 实收现金上传 ZLC->ACC 替换班次钱箱后，线路向ACC上传应收和实收金额 上行 10 设备事件上传 ZLC按优先级向ACC上传线路内设备事件信息 上行 11 库有调拨申请 ZLC向ACC发起票卡库存调整申请 上行 12 车站设备票卡快照 车站设备内票卡库存快照上传 上行 13 ETP登陆申请 线路向ACC申请通讯用户名、密码、工作目录 上行 14 客流 线路向ACC传送实时客流信息 上行 15 设备工作状态报告 ZLC将线路设备状态改变信息即时向ACC发送 上行 16 票卡帐户查询 POST、综合客服->ACC 向ACC发起票卡帐户余额查询交易 上行 17 票卡充值历史查询 问ACC发起票卡充值历史查询交易 上行 18 票卡交易历史查询 向ACC发起票卡交易历史查询交易 上行 19 票卡状态更新 向ACC更新指定票卡的当前状态 上行 20 POST认证 POST->ACC POST向ACC申请设备认证 上行 21 车站模式状态报告 LC->ACC ZAC向ACC传送车站所在的模式及状态 上行 22 设备模块状态报告 LC将设备中各模块的工作状态向ACC上传 上行 表2. AFC系统接口报文类别清单表 在ACC-ZLC的报文基于XML进行封装，服务请求报文RequestMessage包括请求号ReqID、请求版本MsgVersion、请求流水号ReqSerialID、请求时间ReqDateTime、发起方号SourceID、发起线路SourceLineID、发起车站SourceStationID、接收方DesID、接收方线路DesLineID、接收方车站DesStationID、请求内容ReqInfo、验证码CRC等；应答响应报文AnswerMessage包括请求号ReqID、、请求版本MsgVersion、请求流水号ReqSerialID、发起方号SourceID、发起线路SourceLineID、发起车站SourceStationID、接收方DesID、接收方线路DesLineID、接收方车站DesStationID、响应内容AnswerInfo、验证码CRC等。请求报文封装代码如下，其中0xxxxxxxxx为CRC验证码｡ xxxx xxxx xxxxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxxxxxxxxxx"
"基于上述架构，在贵阳市构建基于开源Open Stack架构的轨道交通城轨云平台，采用H3CCloudOS企业级增强型云管理平台。通过面向城轨云用户灵活可扩展的运维架构和运维流程，提供功能完备的自动售检票系统AFC云业务服务台，并通过统一门户便于用户通过各种方式接入访问，提供应用服务。 与经典五层架构AFC体系相比，本文提出的智慧AFC平台系统，实现对系统运营､票务､收益､维修的集中管理功能，采用基于软件包的思想对中心系统体系结构进行设计，将系统功能实现划分成不同的软件包，满足单独部署和运行要求；在此基础上，研究区域中心各模块之间接口，实现不同设备通信协议的标准接口，实现基于组件化的不同设备､不同模块的参数统一管理｡此外，本平台可以从业务视角来管理融合基础架构的资源，从统一管理网络、服务器、存储、应用、虚拟化资源，通过内置业务健康评价模型，动态展示业务整体运行情况，基于智能分析量化业务健康水平，通过业务拓扑实现业务故障的快速定位，融合视角同步时间轴技术让管理员提前预知业务风险和瓶颈。"
"本文基于自动检售票系统AFC的应用需求，在经典五层架构基础上，详细分析了区域中心系统的核心业务后台、核心业务前台、运营支持与分析需求，提出融合云平台服务能力的智慧区域中心架构。本文所提出的架构中，分量AFC区域中心的实时型和关系型数据库，设计出具体的业务系统数据流向图，并提出基于微服务架构体系的软件包方案，实现打通并AFC系统中的系统接口。系统架构在贵阳市得到成功应用。应用结果表明，本文提出的架构在满足轻轨新线建设和网络运营要求的基础上，有效实现了运营效率的提升，并节约了运营期的大量成本，对智慧轻轨的未来发展具有积极意义。"
