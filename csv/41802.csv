"随着网络RTK技术的普及，测量作业可采用RTK的形式布设图根控制点，传统方法会将WGS-84坐标通过网络平台转为地方坐标，然后手动输入全站仪进行摆站测绘地物点坐标。针对全站仪数据后处理问题，以南方测绘NTS-391R全站仪数据为例，本文提出一种基于Fortran语言的后处理解算碎部点方法，该方法利用Fortran语言开发了一套软件，该软件仅由外业输入虚拟控制点坐标代号，就可通过内业后处理的方式解算碎部点坐标。实验表明，该方法大大节省了外业作业时间，提高了工作效率，同时减少了人为出错的可能，为全站仪数据后处理提供了一种新思路。"
"全站仪作为集光、机、电为一体的高技术测量仪器，在测绘行业中具有极为重要的应用，可以直接测量出测站点至目标点的水平角、垂直角、斜距、平距以及高差。 随着网络RTK技术的普及，在几分钟甚至更短时间内即可获得图根控制点的WGS84坐标，为了测量碎部点的坐标，传统的作业思路是：首先需要将WGS-84坐标转为地方坐标，然后手动输入全站仪进行摆站测绘地物点坐标。 然而，上述作业流程存在两个明显的缺点，一是需要等待坐标转换完成后才可以进行全站仪作业，大大增加了外业作业时间；二是每一次摆站都需要手工输入或导入控制点和后视点的地方坐标系坐标，极大增加了外业观测的繁琐程度和出错可能 [ 1 ]。针对以上存在的问题，本文通过数据后处理的方式通过内业解算所有地物碎部点的坐标，全站仪外业测量过程中只需输入控制点的代号即可，不需要输入准确的控制点坐标，控制测量和碎步测量得以同步进行 [ 2 ]，简化了外业操作步骤，缩短测量时间，减少了人为出错的可能。传统方法与本文方法外业流程对比如图1所示。 图1. 传统方法与本文方法外业流程对比"
"本模板仅针对采用A4纸型的论文版式。请务必确保您的论文采用A4幅面(21厘米 × 28.5厘米)进行排版。从全站仪中导出的原始数据为txt文本的形式，里面含有基本的作业信息，另外还含有摆站点坐标、后视点坐标以及至目标点的角度、距离等信息，具体数据格式如表1所示。 Table 1 标注符 标识符中含有的信息 JOB 工作名，文件保存路径的描述 DATA 日期，时间 NAME 测量员姓名 INST 仪器型号标识 UNITS (单位)米/英尺，度、哥恩、密尔 SCALE 格网因子，比例因子，高程 ATMOS 温度(℃)，气压(hPa) STN 点号，仪器高，测站点标识符 XYZ X (东坐标)，Y (北坐标)，Z (高程) BKB 点名，后视方位角，后视角度 BS 点号[，目标高] FS 点号，目标高，点号编码[，串号] SS 点号，目标高，点号编码[，串号] SD HA (水平角)，VA (垂直角)，SD (斜距) 表1. NTS-391R原始数据格式 计算碎部点三维坐标，主要依据的是极坐标原理和三角高程原理，用到的参数是表一中的STN、XYZ、BKB、SS、SD五个参数，这五个参数依次代表测站点代号、测站点和后视点坐标、后视点代号、碎部点代号及目标高、测站点到后视点的水平角、垂直角及斜距。"
"图2. 极坐标原理示意图 如图2所示，为了计算碎部点C的平面坐标，首先需要计算出 A B → 的坐标方位角 α A B ，如式(1)所示 [ 3 ] (为了公式表达的简洁性，本文所有公式均忽略π以及弧度和度之间的相互转换)。 α A B = α tan y B − y A x B − x A (1) 根据 A B → 所在象限的不同，编写程序时需要分多种情况进行判断，具体情况见表2。 Table 2 A、B坐标关系 α A B x A < x B y A < y B α A B = α tan | y B − y A | | x B − x A | y A = y B 0 y A > y B α A B = 360 − α tan | y B − y A | | x B − x A | x A = x B y A < y B 90 y A = y B 任意值(程序忽略此种情况) y A > y B 270 x A > x B y A < y B α A B = 180 − α tan | y B − y A | | x B − x A | y A = y B 180 y A > y B α A B = 180 + α tan | y B − y A | | x B − x A | 表2. 方位角计算 方位角计算程序： function azimuth(x1，y1，x2，y2) implicitnone real(8) ：： x1，y1，x2，y2 real(8) ：：azimuth real(8)，parameter ：：pi=3.1415926 if (x1==x2) then if (y1 azimuth=90 else if (y1>y2) then azimuth=270 end if else if (x1 if (y1 azimuth=atan2(abs(y2-y1)，abs(x2-x1)) azimuth=180*azimuth/pi else if (y1==y2) then azimuth=0 else if (y1>y2) then azimuth=atan2(abs(y2-y1)，abs(x2-x1)) azimuth=360-180*azimuth/pi end if else if (x1>x2) then if (y1 azimuth=atan2(abs(y2-y1)，abs(x2-x1)) azimuth=180-180*azimuth/pi else if (y1==y2) then azimuth=180 else if (y1>y2) then azimuth=atan2(abs(y2-y1)，abs(x2-x1)) azimuth=180+180*azimuth/pi end if end if end 原始数据中直接给出的是A、C之间斜距SD，此时需要根据A、C之间的垂直角VA计算得到A、C之间的平距SP，如式(2)所式： S P = sin ( V A ) ∗ S D (2) 设A、C在X方向的坐标增量为dx，在Y方向的坐标增量为dy，则坐标增量的计算需要分以下几种情况进行考虑，具体如表3所示。 Table 3 碎部点方位角 α A B + θ 碎部点坐标增量dx、dy 0 ≤ α A B + θ ≤ 90 or 0 ≤ α A B + θ − 360 ≤ 90 d x = S P ∗ | cos ( α A B + θ ) | d y = S P ∗ | sin ( α A B + θ ) | 90 < α A B + θ ≤ 180 or 90 < α A B + θ − 360 ≤ 180 d x = − 1 ∗ S P ∗ | cos ( α A B + θ ) | d y = S P ∗ | sin ( α A B + θ ) | 180 < α A B + θ ≤ 270 or 180 < α A B + θ − 360 ≤ 270 d x = − 1 ∗ S P ∗ | cos ( α A B + θ ) | d y = − 1 ∗ S P ∗ | sin ( α A B + θ ) | 270 < α A B + θ ≤ 360 or 270 < α A B + θ − 360 ≤ 360 d x = S P ∗ | cos ( α A B + θ ) | d y = − 1 ∗ S P ∗ | sin ( α A B + θ ) | 表3. 碎部点坐标增量计算 根据坐标增量此时可按式(3)计算得到碎部点C的平面坐标： x C = x A + d x y C = y A + d y (3) 依据三角高程原理，如图3所示，碎部点C的高程计算式为 [ 3 ] [ 4 ]： H C = H A + h A C = H A + S ⋅ tan α + i − ν (4) 式中： A C 、 H C 分别代表A点和C点高程，S代表A、C两点间水平距离， h A C 代表A、C两点间高差，i代表仪器高， ν 代表目标高。 图3. 三角高程原理示意图"
"外业在某测区内采用网络RTK模式测得两个控制点坐标KZ1，KZ2，然后分别以KZ2和KZ1作为摆站点和后视点，量取仪器高随便输入两个虚拟的三维坐标后开始测量，分别测量一个房角点FJ和一个支点Z1；然后在Z1上摆站，以KZ2作为后视，量取仪器高再次随便输入两个虚拟的三维坐标，测量一个围墙点WQ。 内业处理数据时，首先利用解算平台将KZ1、KZ2的WGS84坐标解算为地方平面坐标系坐标，然后直接运行软件调用程序所在文件夹内的控制点坐标文件，即可直接解算出所有碎部点坐标。由于Fortran语言是面向数值计算和工程计算领域的高级语言 [ 5 ]，本文没有在混合界面的开发上花费大量时间，而是采用VS2015平台将其编译为Release形式的可运行程序，只要将EXE程序、控制点坐标文件、全站仪原始文件放在一个文件夹下，双击运行即可直接输出结果。 图4显示的是原始数据以及程序运行后所输出的过程检查文件，图5是最终输出的成果文件。 图4. 全站仪导出的部分原始文件及程序输出的过程检查文件 图5. 标准试验系统结果曲线"
"城市测量用的最多的仪器就是全站仪，全站仪在建筑工程施工等领域都有着不可替代的应用。本文使得在外业没有已知点坐标的情况下虚拟观测成为可能，全站仪外业测量主要是记录保存必要的边、角信息，而把坐标的解算留到内业处理，极大地提高了外业测量的效率，减少了人为出错的可能，为全站仪数据后处理提供了一种新思路。"
