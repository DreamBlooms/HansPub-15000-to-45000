"本文基于WSN技术成功设计实现了一套医院环境监测系统，该系统采用TI公司的CC2530为核心芯片形成传感节点和汇聚节点，传感节点采集医院环境相关参数，包括温度、湿度、光照参数，节点之间应用ZigBee技术实现自组织网络，通过单跳或多跳的方式向汇聚节点传输数据，最终由汇聚节点将数据上传到监控中心。数据传输可靠性是无线传感器网络设计和实现中的一个关键问题，本文基于度约束最短路径树(DCSPT)算法设计了网络拓扑和路径选择，该算法对每个节点的子节点数量进行约束，可以有效减少“热点问题”发生，同时网络提供多路径传输并且使传输路径最短，通过网络的平均跳数、网络健壮性、数据成功传输率等指标对网络拓扑性能进行评估。通过实验测试表明以WSN技术形成的医院病房环境监测系统，实现了无线自组网数据传输，具有系统性能稳定、可靠性强、易于扩展和维护，较好地满足了使用要求。 关键词 :监测系统，ZigBee技术，数据传输可靠性，DCSPT算法，CC2530"
"针对医院病房环境因人多，对病房环境的温度、湿度、氨气浓度(因汗液、尿液挥发产生)、CO 2 浓度(因人的呼吸产生)、含氧量等实施监测，根据监测结果及时进行相应的处理，这将有利于病人的手术后恢复、治疗效果的提高。实施诸多病房的环境监测，可以选择有线监测网络或无线监测网络；然而，大部分医院已经装修完成后，没有预留有线网络的布线，并且上述各种待检测参数的监测位置分布各不相同；因此，选择无线监测网络是具有更好的普适性。本文选择运用ZigBee协议的无线传感器网络(WSN)实现了一套医院病房环境监测系统，该系统采用TI公司的CC2530为核心芯片，传感节点采集医院病房环境相关参数(包括温度、湿度、氨气浓度、CO 2 浓度、含氧量)，节点之间通过ZigBee协议实现无线数据传输通讯，最终把数据传输到监控中心的服务器并提供给各个医疗管理服务台，相关人员可以实时查看相关数据及曲线，以及追溯查阅历史环境状态和统计相应医疗效果用。"
"本文所述及的病房环境，包括病房内、病房外楼道和护士台，通常一个医院的一个住院楼有不同楼层，每楼层有多个病房再加过道、护士台，本文介绍的监测系统按一个住院楼组成一个基于WSN的病房环境监测系统。系统在病房内、过道、护士台单元放置传感器节点，以环境监测装置为单个传感器节点，在楼层内采用无线网络把节点的监测数据集中到位于楼层底部或中部的汇聚节点，然后由汇聚节点经过处理后通过医院内网或短信方式发送到监控中心。系统主要由三部分组成：1) 安装在病房内、病房外楼道和护士台的环境监测无线传感器节点；2) 安装在每个楼层内的汇聚节点；3) 在监控中心的服务器和各个医疗管理服务台的计算机。一个楼层的病房环境WSN监测系统组成示意图如图1所示。 图1所示的WSN监测系统中，主要包括汇聚节点和传感器节点，传感器节点完成环境参数监测，通过ZigBee技术进行组网，并通过无线进行数据的传输和中转，每个传感器节点都具有数据采集与数据 图1. 医院病房环境监测系统总体方案示意图 转发双重功能 [ 1 ] ，每个传感器节点考虑到现场安装随意性和方便性实行电池供电。传感器节点首先采集自身监测区域内的环境参数，通过单跳或以相邻节点接力传送的方式将数据传送到汇聚节点，然后汇聚节点通过医院内网或GSM/GPRS等方式传送到监控中心的服务器，监控中心服务器通过医院内网将监测数据传输到各个医疗管理服务台或护士台的计算机，在医疗管理服务台或护士台的工作人员可随时查看、了解病房环境的监测参数，并且还可以设定环境异常的预警值，在环境参数异常时计算机会有声光报警。"
"在医院病房环境实时监测系统结构中，硬件部分主要由若干传感器节点和汇聚节点两部分构成，除了传感器节点含有所监测环境参数的传感器模块、汇聚节点含有串口通讯模块外，在硬件设计上两者基本相似。医院病房环境实时无线监测节点主要由以下几部分组成，包括电源电路、微处理器、传感器模块、无线通讯电路、显示模块、串口通讯模块等。在系统设计中，核心模块采用的是德州仪器公司设计生产的CC2530芯片，该芯片集微处理器和无线通讯模块于一体，有效节约了硬件设计空间。传感器模块有三个，温湿度监测采用SHT11传感器芯片，氨气浓度监测采用MQ137传感模块，CO 2 浓度集成采用IRM202模块。微处理器主要作用就是对接收信息进行处理以及对各节点工作进行协调；无线收发模块负责网络中数据的收发功能，该模块很大程度上决定了传感节点的能耗。传感器节点与汇聚节点在硬件设计上主要在电源模块部分和无线通信模块部分 [ 2 ] 。传感器节点基本靠电池供电(除了个别节点在离市电插座很近的位置)，主要负责采集病房环境数据和一定的转发相邻节点数据的任务，所以通过使它大部分时间处于休眠状态来延长电池供电节点的寿命；汇聚节点主要负责无线网络建立和网络参数的设置，接受传感节点的数据并上传至监控中心，所以在硬件设计上相应增加了串口通信模块，因汇聚节点可安排在靠近市电插座的位置则采用市电供电，这样可以有效的维护无线传感器网络的稳定性和数据传输的可靠性。传感器节点硬件原理框图如图2，汇聚节点硬件原理框图如图3。 CC2530是TI公司设计生产的一款芯片，一个真正的片上系统(SoC)，被广泛的应用于实现以IEEE802.15.4为基础的ZigBee、WirelessHART和MiWi规范通讯协议的无线传感器网络。该芯片很好的结合了增强型51处理器和优良的RF收发器，并且在系统内具有可编程闪存。跟CC2430相比，CC2530在发射功率、低功耗、链路质量计算和RF射频等都有了很大的改进。它还具有4个不同的运行模式，各运行模式之间转换时间非常短，从休眠模式转换为工作模式只需要45 ms，符合超低功耗要求的系统设计。 图2. 传感器节点硬件原理框图 图3. 汇聚节点硬件原理框图 CC2530芯片主要有以下特性： 1) 硬件支持CSMA/CA，工作频带范围为2.400~2.4835 GHz； 2) 8051微控制核具备高性能和低功耗特点； 3) 抗干扰性能和接收灵敏度十分优良； 4) 可编程的输出功率高达4.5 dBm； 5) 芯片在供电模式1时，只有24 mA的电流，并只需要4 us就能唤醒系统；在睡眠定时器运行时，芯片仅仅只有1 uA的电流；在供电模式3时，芯片仅仅只有0.4 uA的电流，并且外部中断能唤醒系统； 6) 芯片具有数字化RSSI/LQI并且十分精确，同时具有强大的5通道DMA； 7) 具有可配置分辨率的12位ADC。 CC2530芯片与相关模块实现的功能： 1) 医院环境中的各个环境参数通过传感器模块采集，通过AD转换模块控制数据的采集、传输； 2) 通过I/O接口接收、响应处理器模块的数据指令和控制指令； 3) 通过控制无线收发接收模块来控制无线数据在网络中的传输； 4) 通过串口模块来实现与上位机的通信。"
"医院环境监控系统在软件设计上主要有上位机软件和下位机软件两个部分，下位机软件(包括传感器节点、汇聚节点的软件)主要负责数据的采集和数据无线传输至汇聚节点，上位机软件主要实现环境数据的显示、存储、环境状态分析以及异常报警。传感节点在监测区域内通过ZigBee技术实现无线自组网，在本课题中，下位机软件主要使用TI公司研发推出的Z-Stack协议栈，该协议栈可以完全支持ZigBee的CC2530片上系统解决方案，但是汇聚节点和传感节点因为在系统中的功能和作用不同，所有它们的软件设计也存在一定的不同。上位机主要采用C++来实现，界面可以实时显示系统网络拓扑、环境参数数值、环境参数曲线。 单片机程序开发选用IAR公司的IAR Embedded Workbench，它是一套专业的嵌入式软件开发工具，完全兼容C语言标准，支持35种以上8位、16位和32位微控制器结构，可以为不同层次开发人员高效、方便使用。该集成开发环境的代码继承能力使得程序员很容易就能掌握，提高了工作效率、降低开发成本、提高了产品的竞争力。 ZigBee协议分为两部分：PHY (物理层)和MAC (介质访问层)技术规范由IEEE 802.15.4工作小组定义；NWK (网络层)、APS (应用程序支持子层)、APL (应用层)技术规范由ZigBee联盟定义。ZigBee协议栈就是将各个层定义的协议都集合在一起，以函数的形式实现，并给用户提供API (应用层)，用户可以直接调用。ZigBee无线网络协议层的架构图如图4。  汇聚节点在系统中起着非常重要的角色，首先它负责建立和管理网络，接收和处理来自路由节点和传感节点的相关环境参数数据，而且还要负责与上位机进行通信，在与上位机通信中包括向上位机传输有关数据、接收来自上位机的数据并通过无线传输转发给下面的路由节点或传感节点。汇聚节点建立网络的主要步骤如下：初始化成功后，检测电源和扫描信道状态，发起建立一个新的网络，配置网络相关参数(包括设置信道、PANID、网络深度)，允许传感节点和路由加入和离开网络，为每个加入的节点分配地址，同时建立一个地址列表，接收上位机指令并下发给各个节点控制相关传感器节点采集环境参数，接收下面节点数据后通过串口通信发送给上位机，由上位机最终显示数据、存储数据。汇聚节点软件设计流程图如图5。 图4. ZigBee无线网络协议层的架构图 图5. 汇聚节点软件设计流程图  传感器节点在系统中主要负责对监测区域的环境参数采集和中转子节点的数据。传感器节点软件设计上的主要步骤：在上电之后，系统初始化，监听汇聚节点建立网络的信号，扫描网络信道，向汇聚节点申请加入网络，在得到确认后，加入网络；当汇聚节点发布环境数据采集命令时，传感节点成功接收命令，采集相应的环境参数数据，并向汇聚节点发送数据，在得到汇聚节点的接收数据响应之后，则开始发送。发送成功后，传感节点由工作状态转换为休眠状态，通过定时器定时，在一段时间后，进入新的一个循环。传感器节点软件设计流程图如图6。 图6. 传感器节点软件设计流程图  为了能够更好地供用户使用该系统，便于管理和监测环境参数，我们通过“串口–网口”转换器，将医院环境监测系统所实现的环境参数采集和控制，以物联网中间件IOTService方式提供给PC机上的应用程序。系统在上位机上的显示界面使用C++语言编程，数据通信基于TCP/IP协议。软件设计主要包括上位机与汇聚节点的通讯、通过汇聚节点向网络发布组网和数据采集命令等，具体软件设计流程图如图7。上位机界面的截屏，如图8和图9。"
"为了确定好的无线传感器网络拓扑和传输协议算法，先用基于组件的模块化的开放网络OMNeT++ (Objective Modular Network TestBed in C++)仿真平台 [ 3 ] 进行仿真，我们设计的是具有两个汇聚节点的无线传感器网络的鲁棒性拓扑结构，传感网络的传感节点周期性向汇聚节点汇报数据。在无错环境中，最短路径可以保证传感节点和汇聚节点之间的通信具有低能耗性和低延迟。通过这种方式完成设计，给出一个物理拓扑，该拓扑包含所有节点且具有一些特性 [ 4 ] ： 1) 鲁棒性：有冗余的链路来确保一个或多个链路失效时一个节点正常通信。考虑链路时序的情况，通过维护两种鲁棒性类型来实现。每个节点都有互不相干的路径到达每个汇聚节点从而维护确定性的鲁棒性，这样保证任意一个节点到达汇聚节点的一条路径失效时，数据可以通过备用路径来到达另一个汇聚节点。此外概率性的鲁棒性增加了多路径失效时包含的传感节点的比例； 2) 链路质量：在逻辑拓扑中，每个传感节点到达最近汇聚节点的路径距离最短，这不仅可以减少传输的次数而且减少网络的时延，传感节点通过备用路径到达第二个汇聚节点的路径长度也是最短的； 3) 子节点的数量：在拓扑结构中，必须存在一个约定数约定每个节点的子节点数量，这样可以减少热点节点的存在。 图7. 上位机软件设计流程图 图8. 显示节点分布的上位机软件界面 图9. 显示采集数据变化上位机软件界面 本文中用到的最基本的算法原理就是度约束最短路径传输树(DCSPT) [ 5 ] ，DCSPT的图表形式就是一个传输树，在网络中节点到达树的根部节点既汇聚节点的路径是最短的，同时存在一个约束树来约束传输树中每个节点所能有的最多子节点数量。该算法可以在多项式时间内找到一条度约束最短路径树，输入一个权重图表和一个度跳数d，通过特殊初始化、交叉和优化来生成可行的解决方案，输出网络中存在的d度约束最短路径。在这整个过程中反复设定图表中的每个节点为根，通过该算法产生度约束最短路径传输树，并应用于多汇聚节点的网络情况中，DCSPTs的根节点代表网络中的汇聚节点。汇聚节点的分布很大程度上决定了网络拓扑结构，所有对汇聚节点的部署研究很重要，考虑网络中存在两个汇聚节点的情况，采取边缘优选法和中间优选法产生汇聚节点的部署位置。 实验拓扑是25*25的网格，30个节点随意分布在网络网格点上。DCSPT算法运行初始定义一般节点度约束数为4和汇聚节点的度约束数为5。所有的节点包括汇聚节点的通信距离为6个单位长度，选择该通信距离可以使网络的密度不是很大，如果网络的密度太大，则从物理拓扑中生成DCSPT非常困难。节点的度约束数选择4和5，因为如果约束树小于4，将很难获得DCSPT，如果约束数大于5，则获得的DCSPT将都是一样的。 边缘优选法实验：首先我们固定了第一个汇聚节点的位置在网络的一个边缘上，然后在所有网格点上寻找另一个汇聚节点的合理位置。对第一个汇聚节点，我们尝试了第1列到第5列的所有网格点，对第二个汇聚节点，我们在尝试整个网络的网格点。我们发现从网络中最后10列中选择第二个汇聚节点的位置找到一对合理汇聚节点的可能性更高。这个实验给了我们一个汇聚节点位置选择的启发，成为边缘位置，既第一个汇聚节点的位置选择在网络中的前5列，第二个汇聚节点在最后5列选择位置。图10为边缘优选法示意图。 图10. 边缘优选法 中间优选法实验：在网络中央位置寻找合理的位置所有两个汇聚会靠得很近。对第一个汇聚节点，从列5到列20和行5到行20寻找网格，对第2个汇聚节点，从列20到列5和行5到行20寻找网格。实验场景有两种情况，第一种场景，中央搜索，当一对合理汇聚节点找到则停止寻找。第二种场景，中央最优，搜索直到找到最优汇聚节点对获得满足从节点到汇聚节点最小跳数距离。图11为中间优选法示意图。 从表1可以看到中间优选法形成的网络拓扑的首选路径平均跳数和备选路径平均跳数比边缘优选法都少，说明中央位置的两种策略相比边缘法在传输树上的路径质量更好，然而得到合理汇聚节点对的概率相对低，而且搜索的时间相对更长。 在第一个实验中，我们计算了逻辑拓扑中首选路径平均长度和备用路径平均长度，这个性能评估参量非常重要，因为在一个无线传感网络中，它的传输路径长度越短，则意味着数据包从每个节点到达汇聚节点的时延越小、能耗越低。 从这个实验中，我们发现中央位置策略拥有更好地路径质量，因为它产生更短的首选路径长度和备用路径长度。从图12可以得出这个结论，当汇聚节点分布在边缘是，普通节点到达汇聚节点的距离更长。 第二个实验中，我们测量了网络中每个汇聚节点在网络中的传输负载。从图13中可以看出，中央位置策略中两个汇聚节点的负载比边缘位置策略更平衡，这是因为在中央位置策略中，汇聚节点被放置在网络的中央，网络形成后，差不多数量的子节点数量向每个汇聚节点传输数据。在边缘位置策略中，第一个汇聚节点被放置在网络的更边缘和第二个汇聚节点被放置在里面一些，这样第二个汇聚节点可能拥有更多一簇邻居节点，同时更多的节点向第二个汇聚节点汇报。 节点的度直方图如图14显示，在逻辑拓扑中大部分节点度数为2，只有一些拥有高于5的度数。 图15显示了当网络发生多链路失效时，网络拓扑的鲁棒性。在网络发生多路径失效情况时，失联节点的数量会随着链路失联概率增大而增加。多路径失效时拓扑结构是具有鲁棒性的，因为失联节点只在10%比例波动，此时失联路径概率高达30%。但是，随着链路失联概率变得更大，失联节点的数量将会有指数级的增长。从实验同样可以看到，中央位置策略相对边缘位置策略具有更高的鲁棒性度，这是因为汇聚节点被放置在中央，因此它们具有更多的邻居节点，同时这些节点具有更大的概率和其中的一个汇聚节点连接。 图16显示在多链路失效时连接成功节点到最近汇聚节点的平均路径长度，从图中我们可以看出最初路径长度随着失联概率增大而增长，因为在路径选择时，更长的可选择路径被选择，但是随后平均路径长度会随着失联概率增大而减小。这种情况的发生时因为随着失联概率的增大越多的节点失联，同时更靠近汇聚节点的节点成为成功连接节点的概率更大，失联节点的路径长度不被计算，所以平均路径长度 Table 1 方法 个数 首选路径平均跳数 备选路径平均跳数 中间法 38 2.210 5.213 中间最佳法 38 1.798 4.70 边缘法 45 2.630 5.85 表1. 汇聚节点部署不同策略之间的比较 图11. 中间优选法 图12. 逻辑拓扑的路径质量 图13. 汇聚节点负载 图14. 节点度直方图 图15. 多路径失效下的拓扑鲁棒性 图16. 多径失联时的路径质量 减小。从实验中可以发现，拓扑可以承受在多选择路径下30%比例的链路失效情况，但是在更高链路失联时它就不能很好的运行。也可以得出，中央位置策略的平均路径长度减小得更缓慢相对边缘位置策略，这是因为中央位置策略的汇聚节点被部署在网络的中央，汇聚节点的邻居节点数量比边缘优选法时的更多，同时这些邻居节点有更大的概率连接其中的一个汇聚节点。"
"本文根据医院病房环境监测的需要和特点，设计研制了以CC2530芯片为核心的用ZigBee协议实现无线传感器网络的监测系统；为了保障监测系统的鲁棒性，将一个局域的无线传感器网设定两个汇聚节点，并根据不同组网状况，在实际的传输策略采用中间最佳法和边缘法相结合，以兼顾在保障鲁棒性基础上的最短路径、最少搜索时间和最低能耗的实现。本文实现的医院病房环境监测系统已在杭州某三甲医院应用，实践证明该系统具有很好的实时性，且在监测实际要求的数据采集频率中，无论是病房中见监测点还是在过道中的监测点，都没有丢包的现象出现。"
