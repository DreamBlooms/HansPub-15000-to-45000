"本文研究并设计了一种基于51单片机和4G模块的办公人员在位系统，本系统主要分为两个部分：下位机和上位机。下位机由单片机、按键、LED显示屏、压力传感器、串口转换器以及4G模块组成；上位机由云服务器、数据库、以及公众号组成。在下位机上，本系统通过设定好按键数据并经单片机处理后同时送给LED显示屏和串口转换器，LED屏显示按键状态，串口转换器将TTL数据转换成RS485数据传输给4G模块，4G模块通过HTTP协议将16进制消息传送到上位机。在上位机上，云服务器读取数据并编码存储入数据库。当用户在指定微信公众号发送工号数据时，云服务器端会返回相应人员在位状态。该在位系统具有成本低，适用性强和实用性好的特点，具有较大研究与应用价值。 关键词 :办公自动化，微信服务端，单片机，在线监控 Copyright © 2019 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"智能办公系统是综合运用了网络技术和先进设备的办公系统，其意义在于很大程度上提升了办事效率，减轻了工作强度，并实现了科学化的管理和决策 [ 1 ] 。现阶段的智能办公系统，已经在互联网网络技术的运用、应用内容的广度与深度等方面都有了崭新的变化和发展，并已经成为企业不可缺少的核心管理系统。办公自动化实现的是一种无纸化、智能化、高效化 [ 2 ] 的办公模式。随着智能办公系统的发展，如何实现企业员工在位状态信息的及时共享，对于提升企业员工协调工作效率，促进企业的发展具有重要的意义 [ 3 ] [ 4 ] 。 基于上述目的，本文研究并设计了一种基于51单片机和4G模块的办公人员在位系统。此系统主要是通过软件编程实现单片机设备、4G模块与在线服务器之间的通信，并通过微信公众号的转发，实现无论在何地都能实时了解办公人员的动向，提升日常工作的实施效率，大大缩短工作流程所需的时间，提升企业员工协作效率，促进企业快速发展，具有重要意义。"
"本在位系统的总体方案设计包括硬件设计和软件设计两部分。硬件部分由控制器模块、4G模块、显示模块、电源模块和按键模块组成；软件部分由云服务器、数据库与微信公众号组成。总体方案设计图如图1所示 [ 5 ] [ 6 ] 。"
"在位系统的硬件设计可以分为六个模块：控制器模块、显示模块、电源模块、串口转换模块、按键模块、压力感应模块以及4G传输模块。  由于本系统对控制器的实时性能要求不高，故选用51单片机 [ 7 ] 中使用较为广泛的STC89C52RC单片机作为控制器模块，其引脚图如图2所示。 图1. 总体方案设计图 图2. 单片机引脚图  显示模块只需用来显示当前单片机的状态，选用LCD1602液晶显示屏，其实物图如图3所示。  本系统将控制模块与4G模块供电分开。位系统控制模块需要5 V供电，而4G传输模块 [ 8 ] 则需要降压模块将220 V电压转为12 V电压进行供电。 图3. LCD1602液晶实物图  串口转换模块主要是用于数据的转换，考虑到其既要与计算机传输通信，又要与4G模块传输通信。本设计选用多功能合一的串口模块，芯片构成为CP2102 [ 9 ] ，其原理如图4所示。 图4. 转换模块使用原理图  为了实现员工在位不同状态的切换，本设计设置了4个独立按键来实现“Online”、“Waiting 30min”、“Meeting”、“Outing”四种状态的切换，并选用单片机的P3.3、P3.4、P3.5、P3.6输出控制信号。按键电路原理图如图5所示。  压力感应模块实现了压力检测门锁状态的功能，其由FSR薄膜压力传感器和薄膜压力传感器信号转换模块构成 [ 10 ] 。压力传感器的原理是将施加在FSR传感器薄膜区的压力转换成电阻值的变化，从而获得压力信息；薄膜压力传感器信号转换模块则将传感器的电阻信号转换成模拟电压信号或者高低电平信号。  4G传输模块选用众山物联公司的4G DUT模块。通过其将接收到的TTL数据通过HTTP协议传送到私人搭建的服务器上，其实物图如图6所示。 图5. 按键模块电路图 图6. 4G模块实物图"
"系统软件的总体设计是采用总分模块化的方式进行设计，如图7所示。下位机的软件设计先是设计出每一个子模块并进行子模块的程序编写，最后在主程序中直接调用子函数；上位机的程序设计是先设计出数据接收处理和存储的接口，再设计出与微信公众号的通信接口；最后设计出数据在数据库读取的接口，将上位机和下位机合并从而完成系统的软件设计。  a) 按键程序设计。按键程序设计的要求是要根据不同按键显示不同状态。 b) 显示程序设计。显示程序的逻辑是逐个读取内存中的字符，并将其拼接起来，当读取到最后一个字符后，结束程序。 c) 压力传感程序设计。压力传感程序要求不断扫描压力传感器状态，当检测到门锁压力变化时，会刷新当前内存中的数据。  上位机程序选用了腾讯云服务器搭建环境，后台应用选择EXPRESS框架，数据库选用了MYSQL数据库，公众号选择创建个人公众号并开启开发者模式。 图7. 软件设计流程图 a) 数据接收存储程序设计。数据接收存储程序用于将接收到的正确消息处理编码并存储于数据库中。 b) 交互程序设计。交互程序要求只有在用户输入正确工号的情况下，才会返回对应数据。"
"系统测试中，其实物如图8所示，办公人员通过操作按键模块和压力检测模块，首先在LCD液晶显示屏上显示按键和压力感应的消息，然后会把预先设定的按键消息转化成二进制，通过TTL转RS485转换器将信息传送到4G模块，4G模块将接收到的信息通过HTTP传输到设定好的服务器上，服务器将消息转换编码，并将其存储至数据库。按下按键的显示屏显示画面如下(以按下“Wait 30 min”按键为例)。 在服务器上，同时存在着一个接口服务用于接收和发送微信公众号信息。当用户在微信公众号界面输入需要查询的办公人员工号时，服务器会比对工号的正确性；如果用户输入的消息不符合要求，服务器将不会返回任何有效信息，这样能有效的保护了办公人员的隐私。企业员工按下不同按键后，在位系统返回查询结果如图9所示。可以看出，办公人员按下不同按键后，通过微信公众号查询服务器可实时返回办公人员在位信息的数据。 图8. 系统测试图 图9. 系统测试结果图"
"实现企业员工在位状态信息的及时共享，本文研究并设计了一种基于51单片机和4G模块的办公人员在位系统。系统主要分为下位机和上位机两个部分，其中下位机由单片机、按键、LED显示屏、压力传感器、串口转换器以及4G模块组成；上位机由云服务器、数据库、以及公众号组成。通过系统测试数据显示，办公人员按下不同按键后，本在位系统通过微信公众号查询服务器可实时反应办公人员在位信息的数据，且具备通过办公人员工号查询实现保障员工隐私的功能。因此，本文所提在位系统不仅可以实现企业员工在位信息实时查询的功能，且其成本低，适用性强和实用性好，具有较大研究及应用价值。"
