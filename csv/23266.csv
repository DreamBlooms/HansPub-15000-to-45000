"本文设计并开发了一种基于ARM + CPLD的三相无刷直流电机模型参考自适PI调速控制系统：由CPLD芯片实现无刷直流电机的换相与方波驱动、快速故障保护，兼具电机转子机械转速实时测量功能；由ARM芯片实现模型参考自适应PI控制算法。ARM与CPLD之间通过SPI总线接口实现全双工通信，两块芯片联合工作实现电机转速的精确控制。通过Simulink仿真和实际试验，验证了该驱动控制系统硬件结构和控制算法的有效性。采用的模型参考自适应PI控制算法，提高了无刷直流电机闭环负反馈控制的鲁棒性，使得电机参数或者电机负载发生变化时，在不重新整定PI参数的前提下，闭环控制系统依然能够保持良好的控制性能。 关键词 :无刷直流电机，模型参考自适应，仿真模型，鲁棒性，ARM，CPLD Copyright © 2018 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"无刷直流电机(BLDCM)具备直流电机优越的调速性能，伺服性能强，又取消了碳刷、滑环等结构所带来的各种问题，使得电机本身不附加励磁损耗和机械损耗，节电率很高 [ 1 ] ，非常适合应用于对用电量要求较为严苛的场合，例如，风电变桨控制系统所使用的变桨电机，或者是电动汽车所用驱动电机，就可以采用无刷直流电机，既可以达到优越的控制性能，又可以最大限度的可节省用电量，从而有效促进新能源产业的发展。 采用双芯片的控制结构，使得两块芯片各司其职，由CPLD负责无刷直流电机的换向与方波驱动，充分发挥了其硬件逻辑快速响应的优势，使得电机发生故障时能够实现快速保护；由ARM实现模型参考自适应PI控制算法，当电机的自身参数发生变化或者出现负载扰动时，模型参考自适应PI控制算法相较于传统的PI控制算法，有着更强的鲁棒性。两块芯片协同工作，确保电机安全、可靠、平稳运行。"
"系统的硬件结构如图1所示，三相无刷直流电机的驱动电路为三相全桥电路，电机的额定工作电压为24VDC，电机内置三相霍尔传感器用于转子位置检测。CPLD芯片5M240ZT100I5N主要实现电机的换相驱动和PWM调速，以及电机的快速故障保护，包括过压和过流保护等，还具备电机转子机械转速的实时测量的功能；ARM芯片STM32F100为主控制器，片内实现模型参考自适应PI控制算法，与CPLD配合实现转速双闭环控制。 ARM与CPLD通过SPI总线接口进行全双工通信。具体的通信机制是：ARM向CPLD发送控制字来，再由CPLD按照通信协议进行解析，进而控制电机的转速、转向和制动等，每一次下发控制字的同时CPLD上传当前的电机转速或位置信息给ARM。 闭环控制结构为双闭环串级控制系统，外环为转速环，内环为电流环，充分发挥了串级控制系统快速响应的优点；闭环控制算法的选择，摒弃了传统的增量式PI控制算法，而是采用了模型参考自适应 图1. 系统硬件结构图 PI算法，提高了直流无刷电机双闭环负反馈控制的鲁棒性，使得电机参数或者电机负载发生变化时，闭环控制系统依然能够保持良好的控制性能。"
"本文涉及的三相无刷直流电机的转子结构为隐极式结构，定子绕组为星型连接。 无刷直流电机的电压方程的矩阵形式可以具体表示为 [ 2 ] [ u a u b u c ] = [ R a 0 0 0 R b 0 0 0 R c ] [ i a i b i c ] + [ L a M a b M a c M b a L b M b c M c a M c b L c ] d d t [ i a i b i c ] + [ e a e b e c ] (1) 式中： u a , u b , u c ——每相定子绕组的相电压(V)； R a , R b , R c ——每相定子绕组的电阻(Ω)； i a , i b , i c ——每相定子绕组的相电流(A)； L a , L b , L c ——每相定子绕组的自感(H)； M a b , M a c , M b a , M b c , M c a , M c b ——两相定子绕组之间的互感(H)； e a , e b , e c ——每相定子绕组的反电动势(V)。 由于电机的三相定子绕组完全对称，所以有 R a = R b = R c = R (2) 因为直流无刷电机的转子结构形式为表面粘贴式的隐极结构，所以我们可以认为，电机的绕组电感一个常量，不随着时间的变化而变化。由于电机的定子三相绕组是结构完全相同而且对称摆放的，因此每相绕组的自感是相等的，两相绕组之间的互感也相等，可以取L，M，令： L a = L b = L c = L M a b = M a c = M b a = M b c = M c a = M c b = M (3) 则式(1)可以改写为 [ u a u b u c ] = [ R 0 0 0 R 0 0 0 R ] [ i a i b i c ] + [ L M M M L M M M L ] d d t [ i a i b i c ] + [ e a e b e c ] (4) 由于三相电流满足 i a + i b + i c = 0 (5) 式(4)可进一步简化为 [ u a u b u c ] = [ R 0 0 0 R 0 0 0 R ] [ i a i b i c ] + [ L s 0 0 0 L s 0 0 0 L s ] d d t [ i a i b i c ] + [ e a e b e c ] (6) 其中 L s = L − M 。 与大多数的物理系统相类似，在分析直流无刷电机的转矩和功率的时候，也可以采用能量转换的方式。电机在运行的过程中从电源吸收电功率，这些功率一部分转化电机的铜耗和铁耗，另一部分转化为机械驱动传递给转子，这部分功率就是电磁功率，它在数值上等于各相绕组的反电动势和电流的乘积之和，即 [ 2 ] ： P e = e a i a + e b i b + e c i c (7) 不计转子的机械损耗和其他损耗，电机输出的电磁功率能够全部转化为转子的动能，所以机械功率可以表示为： P e = T e ω (8) 式中： T e ——电磁转矩(N.m)； ω ——电机的机械角速度(rad/s)。 由式(7)和式(8)得 T e = e a i a + e b i b + e c i c ω (9) 要想能够构成一个完整的机电系统数学模型，除了上述推导出的电机的电压方程和转矩方程，还需要引入电机的运动方程 [ 2 ] ， T e − T L = J d ω d t (10) 式中： T L ——负载转矩(N∙m)； J ——转子的转动惯量(kg)。"
"如图2所示为三相无刷直流电机的驱动主回路。六个MOSFET的标号为M1~M6，的开关驱动信号由CPLD给出，三相霍尔传感器的输出脉冲信号接入CPLD的I/O引脚，CPLD片内逻辑首先对这三路脉冲信号进行整形，整形的目的是为了滤除脉冲信号上叠加的干扰信号。然后对应于整形后的脉冲信号组合，根据表1所示的真值表给出MOSFET的开关驱动信号。 表1所示的真值表适用于所有内置三相霍尔传感器的三相无刷直流电机。可以看出，任意时候，仅有两个MOSFET导通，也就是说，图2中所示三相全桥逆变电路为120˚导通型逆变电路，三相无刷直流电机在任意时刻仅有两相定子绕组通有电流，第三相定子绕组为悬空状态。 ARM片内程序，基于模型参考自适应PI控制算法，计算出控制量，然后通过SPI总线下发给CPLD，CPLD接收后按照通信协议解析，将控制量转化成对应占空比的方波信号，即PWM信号。CPLD基于表1确定了当前时刻应该导通的2个MOSFET，上桥MOSFET的驱动电平为常高，下桥MOSFET的驱动信号为PWM信号。开环控制下，电机转速满足式(11)： 图2. 三相无刷直流电机驱动主回路 Table 1 状态编号 霍尔(U、V、W) 电机转向 控制信号M1~M6 1 101 正转 100100 2 100 正转 100001 3 110 正转 001001 4 010 正转 011000 5 011 正转 010010 6 001 正转 000110 1’ 101 反转 011000 2’ 100 反转 010010 3’ 110 反转 000110 4’ 010 反转 100100 5’ 011 反转 100001 6’ 001 反转 001001 表1. 三相无刷直流电机换相驱动真值表 n =     PWM_Duty_Ratio ⋅ n 0 (11) 其中， n 0 为电机的额定转速，转速n与PWM信号的占空比 PWM_Duty_Ratio   成正比关系。 CPLD的片内逻辑还能够实现电机转子机械转速的实时测量，其硬件逻辑框图如图3所示。 具体实现方式是：CPLD接收到电机内置三相霍尔传感器的输出脉冲后，首先进行信号调理，也就是前述的脉冲整形。将整形后的脉冲信号作“异或”运算，可以得到频率与转子机械转速成正比的方波信号，然后基于传统的“T法测速”原理，在CPLD片内设计一个20 kHz的时基脉冲信号，也就是图3中的“基准时钟”。通过计算计算“异或”后得到的方波信号相邻两个上升沿之间的20 kHz时基脉冲信号的个数 N ，然后通过CPLD片内的D触发器，在D触发器的时钟上升沿，将计数值 N 通过SPI总线上传给ARM，ARM片内程序即可按照式(12)计算出当前电机的转子机械转速。 Rotor_Speed = 1 N / 20000 ⋅ 3 ⋅ p ⋅ 60 (12) 式(12)中， Rotor_Speed 为电机的转子机械转速， p 为电机的极对数， Rotor_Speed 的单位是rpm。图3中的“时间计数”时序图如图4所示。 图3. CPLD片内转子机械转速实时测量逻辑框图 图4. 时间计数逻辑的时序图 CPLD芯片的片内逻辑本质上属于“硬件逻辑”，其响应延时仅为逻辑门电路的输出延时，因此可以实现电机的快速故障保护。图1中所示的“电压电流检测”电路，首先将电压/电流传感器的输出信号转化为电压信号，然后接入两路电压比较器，电压比较器的输出接入CPLD的I/O引脚。只要有一路电压比较器的输出为高电平，CPLD接收到之后就会立刻封锁图2中6个MOSFET的驱动信号，起到保护电机的作用。"
"模型参考自适应控制在直流无刷电机控制系统中的应用主要的有三种：基于状态反馈的设计方法，基于信号自适应的设计方法，基于参数估计的设计方法 [ 3 ] 。本系统采用的基于信号自适应的控制算法，而这一控制算法正是通过ARM来实现的。  取直流无刷电机双闭环控制系统的状态方程为 x ˙ = A x ( t ) + B u ( t ) (13) 其中 x ( t ) ∈ R n 可测， u ( t ) ∈ R m , A ∈ R n × n , B ∈ R n × m 是常系数矩阵。取参考模型的状态方程为 x ˙ m = A m x m ( t ) + B m r ( t ) (14) 其中 A m ∈ R n × n 是一个常系数且稳定的矩阵， B m ∈ R n × m 是一个常系数矩阵， r ( t ) ∈ R m 是一个可选的、有界的、分段连续的参考输入。 控制系统的理想性能可以理解为直流无刷电机的双闭环控制的状态矢量 x ( t ) 能够跟踪参考系统给出的状态矢量 x m ( t ) 。 定义跟踪误差 e ( t ) = x ( t ) − x m ( t ) (15) 由式(13)，(14)和(15)可得 e ˙ ( t ) = x ˙ ( t ) − x ˙ m ( t ) = A m e ( t ) + σ ( t ) − b u A ( t ) (16) 其中 σ ( t ) = ( A m − A ) x ( t ) + ( b m − b ) r ( t ) 。 取Lyapunov函数为 [ 4 ] [ 5 ] V = 1 2 e T P e (17) 其中 A T P + P A = − Q ， Q 是一个正定矩阵。 对式(17)求导，得 V ˙ = e ˙ T P e + e T P e ˙ (18) 将式(16)带入上式得 V ˙ = − e T Q e + 2 e T P σ − 2 e T P b u A (19) 取信号自适应控制律为 [ 6 ] u A ( t ) = h ⋅ s i g n ( v ( t ) ) v ( t ) = d T e ( t ) ,     d T = b T P ,     P = P T > 0 (20) 其中 v ( t ) 是通用误差表达式， d T 误差加权系数向量， P 是对称的正定矩阵，且满足 A m T P + P A m = − Q ， Q = Q T > 0 。 由式(19)、(20)得 V ˙ = − e T Q e + 2 e T P σ − 2 e T P b h ⋅ s i g n ( b T P e ( t ) ) (21) 为了使 V ˙ < 0 ，我们就要合理地取 h 值使 h > σ ，这样才能保证系统的稳定性 [ 7 ] 。  取参考模型系统的传递函数为 G ( s ) = k 1 s 2 + k 2 s + k 3 (22) 相应的状态方程为 ( x ˙ 1 ( t ) x ˙ 2 ( t ) ) = ( 0 1 − k 3 − k 2 ) ( x 1 ( t ) x 1 ( t ) ) + ( 0 k 1 ) r ( t ) (23) 对应式(14)可知， A m = ( 0 1 − k 3 − k 2 ) ,   B m = ( 0 k 1 ) (24)  取 [ 8 ] Q = m ( 1 0 0 1 ) (25) 其中m为可变的正数，参考模型(22)的参数选择为 k 1 = 6.6 ,     k 2 = 3.3 ,     k 3 = 6.6 (26) 则根据式(20)可以计算出 P = m ( 7 5 3 40 3 40 69 400 ) ,     b = ( 0 20 3 ) (27) u A ( t ) = h ⋅ s i g n ( m ( 1 2 23 20 ) e ( t ) ) (28)"
"图5为三相无刷直流电机的模型参考自适应PI调速控制系统结构图，被控参数是电机的转速。 对应于图5，得到图6所示仿真模型。 对应于式(20)，取 h = 3000 ,   d T = ( 120                   12 ) ，基于图6所示的模型，分别在电机参数变化和电机负载变化两种情况下进行仿真，给定转速均为3000 rpm。图7为电机的转动惯量发生变化时的转速响应曲线，图8为电机的定子绕组电阻值发生变化时的速度响应曲线，图9为电机的负载发生变化时的速度响应曲线。 图5. 三相无刷直流电机模型参考自适应PI调速控制系统结构图 图模型 图7. 电机转动惯量变化时的速度响应 图8. 电机定子绕组电阻值发生变化时的速度响应 图9. 电机负载发生变化时的速度响应 由仿真结果可以看出，模型参考自适应PI控制算法能够保证当电机自身参数或者电机负载发生变化时，闭环负反馈系统仍能够保持较好的控制性能。"
"表2为试验所用三相无刷直流电机参数。  图10为电机开环调速试验时，上桥PWM驱动信号占空比分别10%和20%的情况下，示波器抓取的U相桥路的上、下桥MOSFET的驱动信号。 图10. 电机开环调速上、下桥MOSFET驱动信号波形  图11为电机转速闭环控制响应曲线，给定转速为1000 rpm，控制算法为模型参考自适应PI控制算法。在试验的过程中，当电机的转速达到稳态后，多次施加了负载扰动，由试验结果可以看出，当负载扰动出现时，电机转速会发生小幅波动，随后在控制算法的调节作用下，最终达到稳态1000 rpm，从而验证了模型参考自适应PI控制算法的有效性，也验证了这种基于ARM + CPLD的硬件架构的可靠性。 图11. 电机转速闭环控制时的速度响应曲线 Table 2 符号 参数 值 P m 额定功率 110 W V m 额定电压 24 VDC T m 额定转矩 0.35 N∙m ω m 额定转速 3000 rpm p 极对数 4 R p p 定子绕组电阻 0.85 Ω T C 转矩常数 0.11 N∙m/A 表2. 电机参数列表"
"本文详细介绍了一种基于ARM + CPLD的三相无刷直流电机模型参考自适应PI调速控制系统，由CPLD实现换相与方波驱动、快速故障保护和电机转子机械转速实时测量功能，由ARM实现模型参考自适应PI控制算法。双芯片联合控制实现电机精确的转速闭环控制，充分发挥了硬件架构与模型参考自适应PI控制算法的优越性。"
