"本文应用机器视觉技术解决高铁构架加工数字化升级改造过程中的零件防错需求，并针对平均绝对偏差值法在应用过程中的缺陷对算法进行了改进。改进结果经过应用验证，有效的解决了车间现场构架快速、准确视觉防错的问题。 关键词 :高铁构架，机器视觉，防错 Copyright © 2019 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"构架是高铁转向架的核心组成零件之一，其产品型号种类多，加工工艺路线长，过程十分复杂。其中非常重要的一个加工步骤是利用数控龙门镗铣加工中心对构架上的孔系特征以及平面/斜面特征进行数控加工。在数控加工开始前，因不同型号间零件目视化区分度有限，加工工人在调用对应数控加工程序时，需进行人工确认，以避免程序调用错误而导致的零件加工报废和设备损坏。与此同时，参考轨道交通行业制造企业智能制造规划思路 [ 1 ] ，随着智能制造技术应用的深入，构架数控加工过程发展的趋势是少人化，甚至无人化。未来在制造现场，工人仅需从事相对简单的装夹、辅助搬运等类型作业。零件加工防错等感知与判断类型的任务则交由机器视觉、无线射频标签等技术协同完成。 一个典型的机器视觉系统是一系列技术的集成应用，具体包括光学成像、数字图像处理、传感器应用、光源照明、模拟与数字视频处理、人机接口、机械工程与控制、系统集成等。视觉系统的工作循环过程主要包括通过机器视觉硬件将被摄取目标转换成图像信号；通过专用的图像处理系统根据像素分布和亮度、颜色等信息，转化成数字信号；由图像分析系统依据相应的分析算法对这些信号进行处理，抽取目标特征，得到判别结果，最终实现控制现场设备运作 [ 2 ] [ 3 ] [ 4 ] 。在零件识别与定位、质量检验、刀具磨损监控、精密测量、机器人导引等工业应用领域，机器视觉技术都得到了较广泛的应用，是支撑生产系统具备自学习、自感知、自适应、自控制能力的关键技术 [ 5 ] 。生产过程防错作为检测领域中的一类典型应用，也正得到越来越多的关注。"
"构架类型识别属于计算机图形学中的分类问题，典型的构架局部图如图1所示。当前加工的构架共有6类常见类型，其外观颜色与形状已基本定型，且与背景中的夹具平台存在较大的差异。各种构架以俯视图X，Y两个方向上的中心线，将俯视图四等分划分后，每个子区域中所具有的特征亦足够与其他构架区分开。因此可以把构架的四分之一区域建立标准模板，在视觉识别单元中，将夹具平台上的待加工构架与标准模板进行比较，判断该构架是否与标准模板为同一类型的构架。"
"由于构架本身存在一定的差异性，因此一致性判断中最为常见的方法是平均绝对差异值法 [ 6 ] ，即将待分析的对象与模板进行比较，二者各像素灰度值的差异小于设定的阈值时认为一致。为了避免求和计算时图像区域越大，则差异值越大的情况，因此需要将计算出来的总和除以像素个数，如公式(1)所示。 图1. 典型构架四分之一区域俯视图 D ( i , j ) = 1 M × N ∑ s = 1 M ∑ t = 1 N | S ( i + s − 1 , j + t − 1 ) − T ( s , t ) | (1) 其中： 1 ≤ i ≤ m − M + 1 ,   1 ≤ j ≤ n − N + 1 。 该公式表示在搜索图S中，以(i,j)为左上角，取M × N大小的子图，计算该子图与模板的相似度；遍历整个搜索图，在所有能够取到的子图中，找到与模板图最相似的子图作为最终匹配结果。 此方法中阈值的大小的设置将直接影响待加构架是否与当前模板一致判断结论的合理性。本文首先针对当前加工过的EZ20M、GSYEZ15M、GS10M等三类构架，拍摄采集了共117个构架样本图片采用该方法进行了构架判别分析，其平均绝对偏差值计算结果以及偏差分布直方图结果如图2所示。 图2. 样本图片分析结果示意图 利用常规的平均绝对偏差值法，能够准确地拒收非本产品的阈值约为27，但从上述结果可以发现，这个阈值却会产生大量错误拒收。以EZ20M为例，对本机床最近一段时间加工的该型号产品而言，错误地拒收本产品的情形将达到58件(平均绝对偏差值大于26.7的共有58件)，远高于正确地接收本产品的情形(24件)，这意味着在生产过程中，将会频繁误报警，并严重影响生产效率，需要对原始算法进行改进。 上述数据总体分布上符合实际情况，众多构架中与模板差异最小的一段[14.7~26.7]是EZ20M，由于前面所说的众多外部因素的影响，导致其分布比较散，有很大一部分构架与模板存在较大的绝对差异。 另一方面，由于各种加工构架的总体结构一致，彼此整体差异并不大，所以不属于EZ20M的构架与模板的差异也不可能很小，在[28.5~42.5]数据段，已经无法将EZ20M与非EZ20M构架进行正确划分。 对EZ20M构架，有2件的平均绝对偏差值分析结果在[86.7, 98.7]间，与正常水平偏离较远，它们在工位时所拍摄的图片如图3所示，从中可以看出，这2个产品存在明显的曝光过强的问题，这直接导致了分析结果中两个奇异点的出现。 图3. 曝光过强构架示意图 从上述分析中可以看到，同一类构架，当它的差异范围在一个比较小的范围内，通过选取阈值可以识别出来，而对于常规的视觉识别算法，当选取阈值达到30时，它开始把其他构架误识别为本构架。对非本构架的结果范围进行分析，选取阈值上限为28时，可以排除所有的非本构架，但这个阈值同时也把本构架错误地拒绝了，而且拒绝的比例相当大。"
"一个好的构架识别方法，必须是以极小的概率把本产品错误地判别为其他产品而拒绝本产品，同时也必须以极小的概率错误地把其他产品误认为本产品而接受。而对于这种高成本的大件产品加工，识别算法的目标可以概括为：容许在小概率地错误拒绝的时候人工干预校正，但是应该杜绝错误地接受其他产品的情形，因为这种错误导致机床设备使用本产品的加工程序进行该产品的加工，极易直接造成产品报废，带来严重损失。针对前述117个构架图片的实验结果，如果需要实现构架判别的目标，对于算法优化的基本目标可从两个方向展开：1) 对于本产品，计算结果的波动范围尽可能小；2) 对于非本产品，计算结果与本产品的计算值的差别应尽可能大。 同时，通过对前述误判的情形进行归纳分析，我们发现结果波动的因素主要有以下三类：1) 构架自身的不一致；2) 照明环境的变化；3) 其他环境的变化(夹具平台的背景，工具、夹具装夹位置)等。 光照的变化是导致结果值变动的重要因素之一，弱光下图像像素值偏小，此时与模板相比， | fx | 会变大，如果光线较模板制作时要强，会出现同样的问题。因此需要消除光照的影响，可以将模板的像素平均值计算出，将模板中各像素的像素值与像素平均值的差异数据处理为新的模板。在构架识别时，将待检构架的区域平均值计算出，然后把待检构架的像素值与区域平均值的差异作为新的构架数据。针对处理后的模板数据与构架数据，采用通过归一化的相关性度量公式来计算二者之间的匹配程度，如式(2)所示。 R ( i , j ) = ∑ s = 1 M ∑ t = 1 N | S i , j ( s , t ) − E ( S i , j ) | ⋅ | T ( s , t − E ( T ) ) | ∑ s = 1 M ∑ t = 1 N [ S i , j ( s , t ) − E ( S i , j ) ] 2 ⋅ ∑ s = 1 M ∑ t = 1 N [ T ( s , t ) − E ( T ) ] 2 (2) 其中， E ( S i , j ) 、 E ( T ) 分别表示(i,j)处子图、模板的平均灰度值。 采用归一化的相关性度量，其结果在0~1之间，1表示完全一致，0表示完全不相关，可以当作没有任何相似之处，因此结果值可以非常直观地看到构架与模板的一致性程度。 构架自身不一致的问题，主要是表面玷污、油漆不均匀等，可以通过中值滤波、色彩空间转换等方法进行预处理，降低其影响，然后对处理后的构架图片进行统计分析，找到其阈值变化范围。将其范围与其他构架的计算结果的范围不重叠时，便可利用相应的阈值正确判定是否指定种类的构架。 其他环境的变化，主要是背景的噪声，呈现出随机、多变而且可能存在较为显著变化的特点，难以通过预处理消除其影响，这里采用指定前景区域的方式来处理该问题，即选取能够体现构架特征的数个区域作为分析区域，定义区域时最小化背景，从而通过均值滤波去噪的方式消除背景的强干扰。 通过上述处理后，选择构架照片的左下侧区域作为分析对象，对某机床最近的加工构架进行分析，计算当前所有构架对EZ20M的匹配相似度。结果如图4所示。 由图4可以看出，经过上述处理后，已基本能够将不同类别的构架的分数区分开，但是依然没有达到目标。其中的问题是GSYEZ15M与GS10M两种构架的差异过小，称之为对应构架，如图5所示。对于这种情形，不管是使用平均绝对差值方法还是使用归一化的相关性度量，都会由于差异区域占构架区域面积过小，造成计算结果的差异过小，导致判断失误。 图4. 匹配度归一化处理后分析结果示意图 对此种特征，本文采用了显著特征区域定义法，即对左下角存在差异的区域进行合理定义，保证两种构架的差异部分在所定义的区域内占有不小于30%的比例。这里，由于构架与背景的复杂多变的缘故，虽然这种处理可以让差异较为显著，正确的构架与模板之间仍然可能出现呈现较大差异的情形，如果阈值设置比较严格，则会出现一定概率的拒收正确构架，如果阈值依情况设置得较宽松，则可能接受错误的构架，而这却是不容许的。 因此，本文设置了两个阈值，分别为严格阈值与宽松阈值，并设定相关拒收条件如下：若判断结果在严格阈值之内，直接判断接受，若判断结果在宽松阈值之外，直接判断拒收，若处于二者之间，则引入惩罚项对此进行处理。主要算法思想是，若本构架与对应构架模板相似度更高，则认为本构架错误接收的概率会显著增大，将计算对应构架模板的相似度与本构架模板的相似度之差，将当前的计算结果减去该值。若本构架与对应构架模板相似度更低，则认为本构架被错误拒绝的概率会显著增大，将计算对应构架模板的相似度与本构架模板的相似度之差，将当前的计算结果加上该值。 图5. 差异很小的两种构架(GS10M, GSYEZ15M) 采用前次测试的区域作为分析区域，对某机床最近的加工构架进行分析，计算当前所有构架对EZ20M的匹配相似度。结果如图6所示。 图6. 引入惩罚变量后的分析结果示意图 从图上可以看到，应用惩罚变量后，对构架的全部EZ20M产品都得到了较高的分数，非EZ20M产品，即这里的GSYEZ15M及GS10M的分数与EZ20M之间可以完全区分。因此应用上述方案后，对于实际的加工产品，可以实现完全识别，很好地满足了系统高效可靠运行的要求。"
"本文针对平均绝对差异值法在典型高铁零件视觉识别防错应用场景中的应用过程进行讨论后，结合归一化处理方法以及显著特征区域定义法对原算法进行改进并应用于实际系统中。本文所提出改进算法对于机械零件加工过程中，通过机器视觉进行防错的典型应用具有一定普适性，特别是在零件间相似度较高或零件族之间应用时，具有更好的效果。通过6个月以来的现场实际应用检验，在使用上述算法的基础上，通过分析选择具有显著区分度的多个特征组合来进行构架的识别与防错，准确率与可靠性均达到了现场生产体系要求，可为类似生产模式中的零件识别以及防错应用提供参考。"
