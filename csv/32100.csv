"文章分析了目前的无线传能控制系统的优缺点。为了解决磁耦合式无线传能系统的失谐问题，从理论上分析了系统的工作原理，提出了基于可变模全数字锁相环的频率跟踪控制方法；通过Simulink仿真分析了环路滤波器对系统响应速度和稳态误差的影响，并且通过在锁相环中增加误差量化环节提升了锁相环的锁相速度与锁相精度；最后基于FPGA设计了全数字WPT控制系统，实现了WPT系统的谐振频率自动跟踪，增加了系统过流和过温保护功能，通过仿真和制作样机进行实验，验证了本系统具有跟踪速度快，稳态误差小、安全稳定等优点。 关键词 :无线电能传输，FPGA，频率跟踪，可变模全数字锁相环 Copyright © 2019 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"无线电能传输(Wireless Power Transfer)技术可以实现电源与负载之间的电气隔离，使电能的传输更加方便灵活，具有广阔的应用前景，因此受到了广泛关注 [ 1 ] 。目前无线传能技术主要有磁耦合感应式、磁耦合谐振式、微波式 [ 2 ] 。磁耦合谐振式WPT系统具有传输功率大、传输效率高、传输距离较远等优点，得到了广泛的关注。为了实现系统的高效传输，必须使发射回路与接收回路的固有频率相同，在系统实际工作中受到外界环境影响，例如温升、寄生参数的改变等，都会引起系统参数的改变进而导致系统的固有频率发生改变 [ 3 ] [ 4 ] ，在电源频率不变的情况下，系统就会发生失谐，失谐会导致系统的传输效率与传输功率大大降低。为了提高系统的传输效率与功率，主要采用阻抗匹配调谐方式 [ 5 ] - [ 9 ] ，与改变供电电源的输出频率的方式来进行调谐 [ 10 ] [ 11 ] [ 12 ] [ 13 ] 。文献 [ 5 ] - [ 9 ] 分别通过可调电阻与可调电感来调节系统网络参数，实现系统频率稳定，达到调谐的目的，但是这种方式受到谐振补偿结构的限制，三极管要接入电路拓扑，使系统频率和功率都要受到三极管的限制，因此这种方法主要应用在小功率磁耦合谐振式WPT系统中；文献 [ 10 ] 采用补偿电容矩阵的方法进行调谐但是由于电容容值具有一定的步长因此调谐的精度受到限制。因为调整发射端电源供电频率的方法具有结构简单、易于实现、精度较高等优点，因此目前得到了广泛的应用，文献 [ 11 ] 中使用了模拟锁相环来跟踪谐振频率，进而调整电源的输出频率，但是由于模拟锁相环中心频率不可变，调谐频带较窄，无法实现全频带调节，因此当系统的频率发生较大变化时就无法完成调谐；文献 [ 12 ] 采用FPGA编程的方法，对谐振频率进行扰动，但是扰动调谐的步长太大会降低调谐精度，如果步长太小，会增加调谐的时间，因此在精度与跟踪速度上存在矛盾；文献 [ 13 ] 设计了高精度锁相环，重点分析了锁相环的数学模型，与参数设定，没有提出利用锁相环进行频率跟踪系统设计的具体实施方案。 本文基于FPGA设计了可变模全数字锁相环，并且通过仿真实验，分析了参数对于锁相环锁相精度与锁相速度的影响，并且根据实验结果，设计了可根据误差大小自动改变模值的全数字锁相环。并将该锁相环应用到磁耦合谐振式WPT控制系统上，通过Verilog硬件描述语言编程，最终实现了全数字磁耦合谐振式WPT控制系统。"
"磁耦合谐振式无线传能系统的补偿电容与线圈有串联与并联两种连接方式，在双线圈系统中有发射端和接收端两组线圈，所以系统有串-串、串-并、并-串、并-并，四种拓扑结构 [ 2 ] 。其中并-并、并-串适用于大功率电路，串-并拓扑主要应用于大阻抗负载的情况，串-串拓扑模型适用于小功率系统，如图1所示为采用串联-串联拓扑结构的磁耦合谐振式WPT等效电路图。 图1. 基于互感理论的WPT等效电路图  如图1所示为 U 1 系统的高频交流电源， C 1 C 2 为发射端与接收端的补偿电容， L 1 、 L 2 分别为系统的发射线圈与接收线圈M为系统的互感系数， R 0 为接收端负载。根据等效电路图可列出如下KVL方程。其中： ( U ˙ 1 0 ) = ( Z 1 − j ω M − j ω M Z 2 ) ( I ˙ 1 I ˙ 2 ) (1) 式中发射线圈阻抗 Z 1 = R 1 + j ( 2 π f L 1 − 1 ω C 1 ) 接收线圈阻抗 Z 2 = R 0 + R 2 + j ( 2 π f L 2 − 1 ω C 2 ) 如下所示可以求出发射线圈电流与接收线圈电流： I ˙ 1 = U ˙ 1 Z 1 + ( 2 π f ) 2 M 2 Z 2 (2) I ˙ 2 = j2 π f M I ˙ 1 Z 2 (3) 求出以上参数后就可以求出系统的传输效率： η = I ˙ 2 2 R 0 U ˙ 1 I ˙ 1 = ( 2 π f ) 2 M R 0 [ Z 1 Z 2 + ( 2 π f ) 2 M 2 ] Z 2 (4) 当系统处于串联谐振状态时发射线圈与接收线圈的阻抗虚部为0此时 Z 1 = R 1 ， Z 2 = R 0 + R 2 因此此时的传输效率最高。 (5) 为了保证系统高效传输必须要使系统工作在谐振频率，因此本控制系统中要设计了谐振频率跟踪功能，来保证交流电源的频率为系统的谐振频率。"
"如图2所示为现有的一阶全数字锁相环的结构，主要由鉴相器、数字环路滤波器、脉冲增减控制单元、分频器组成。根据其输入输出性质，推导出其传递函数如下所示 [ 14 ] ： 图2. 传统锁相环结构图 H ( s ) = U o ( s ) U i ( s ) = 2 f 0 k N s + 2 f 0 k N (6) T = k N 2 f 0 (7) 化简后得： H ( s ) = 1 T s + 1 (8) 上式中N为分频系数，f 0 为系统的时钟频率，k为数字环路滤波器的计数器模值。针对上述的传递函数，对本锁相环进行研究，如下表1所示为k值与T值的对应关系，此时f 0 为10 Mhz，N为32。利用Simulink软件对上述数学模型的不同k值进行阶跃响应仿真，仿真结果如图3所示。 图3. 锁相环的阶跃响应仿真图 Table 1 K 2 8 64 T 1.6 × 10 -6 1.3 × 10 -5 2.1 × 10 -4 表1. k值与T值的对应关系 由仿真结果可知当k = 2时锁相环系统响应速度最快，但是系统的稳定性最差。随着k值的增加，系统的响应速度变慢，稳定性增加。由此可以分析得出，当鉴相器输出的误差较大时，环路滤波器的参数k应该设置为较小值，这样可以加快锁相速度。当鉴相误差逐渐变小后，再将参数k设置为较大值，这样可以使系统稳定，减小稳态误差。  根据前面的结论，本文设计了如图4所示的可变模全数字锁相环。可变模全数字锁相环与传统数字锁相环相比增加了误差量化环节，输入信号宽度测量环节，并且将N分频器改为可变模分频器。 图4. 可变模全数字锁相环结构图 本锁相环采用了双D触发式数字鉴相器，鉴相范围为0~2π，具有鉴频鉴相的功能。如图5所示为鉴相器仿真效果图，图中CLK为系统时钟信号，CP1与CP2为输入信号，Ud为误差信号，Error为时钟信号调制后的误差信号，Flag为超前滞后标志信号。 图5. 鉴相器仿真图 误差量化环节是本锁相环的重要环节，主要功能是根据锁相误差输出k_mode来调节环路滤波器的模值k。其主要原理是，首先接收来自鉴相器的误差调制信号Error并且进行计数，计数值每个输入信号周期结束后清零，并且将计数值与预先设定的值Pmax = 100、Pmid = 30、Pmin = 10进行比较；当计数值大于Pmax = 100时输出k_mode = 001，当计数值大于Pmid = 30时输出k_mode = 010，当计数值大于Pmin = 10时输出k_mode = 011，当计数值小于Pmin = 10时系统输出k_mode = 110。 数字环路滤波器环节根据输入的k_mode值设置环路滤波器内可逆计数器的计数模值k。当k_mode = 001时k = 2，当k_mode = 010时k = 8，当k_mode = 011时k = 32，当k_mode = 110时k = 128。可逆计数器的计数方向由Flag信号控制，滤波器的输出信号为inc与dec信号。 脉冲加减控制电路的主要功能是调节信号的相位，当输入inc信号有效时，脉冲加减电路就将输入信号CP1的输出相位加一个时钟周期，当输入dec信号有效时CP1的输出相位就减掉一个时钟周期。 输入信号宽度测量环节，将每个输入信号周期进行计数，并且将计数值传送到可变模分频器作为分频系数。 脉冲加减控制环节输出信号到可变模分频器，可变模分频器根据输入信号测量环节的输出N进行分频，输出最终的信号。  根据提出的可变模全数字锁相环的控制算法，和无线传能系统的工作原理基于FPGA控制芯片设计了具有谐振频率自动跟踪功能的无线传能控制系统，其结构如图6所示。 图6. 频率跟踪控制系统结构图 起始信号发生模块给定系统一个80 Khz的方波信号作为起始信号；当WPT系统正常工作后，相位采集模块，将采集的电流信号转化为同频同相的方波电压信号，并且反馈到锁相环输入端，实现了电流的闭环控制；锁相环的输出信号接PWM模块的输入端口，PWM模块的输出为4路频率相同，相位两两互逆的方波信号；PWM输出的四路方波信号经过死区模块的处理最终得到逆变模块的驱动信号；AD采集模块采集外部电位器的电压值，并将阻值转化为数字信号，输出到功率调节模块；功率调节模块根据输入的数字信号调节输出方波信号的占空比，以此来控制BUCK电路，进而调节系统的输出功率；为保护系统安全，设置了系统保护单元，系统保护单元包括过流保护单元和过温保护单元，当AD采集到的电流过大时，过流保护单元立即输出过流标志信号，此时功率调节模块输出的波形占空比为0，锁相环输出为0；与过流保护模块相同，过温保护模块，当温度传感器检测的系统温度超过设定温度后，系统输出过温标志信号，此时系统会锁定锁相环输出为0，即功率电路与逆变电路同时关断。"
"本文采用Verilog硬件描述语言，选用Altera公司的EPIVCE10F17C8型号FPGA，实现了上述的以可变模全数字锁相环为基础的WPT控制系统，并且利用仿真工具Modelsim进行仿真，在仿真验证成功后制作了一台试验样机进行系统验证。  如图7所示为系统的锁相环锁相精度的仿真验证，其中时钟信号为50 Mhz，输入信号Sig_in频率为100 Khz。最终信号锁定时k_mode的值为110，此时鉴相误差信号Error小于10个时钟周期，而此时的输入信号周期为时钟周期的1000倍，因此本锁相环的锁相精度大于98%。 图7. 锁相环精度仿真图 如图8(a)所示为输入信号频率突然改变后的Modelsim仿真图，图中Sig_in信号频率由原来的100 Khz变为80 Khz，从图中可以看出在输入信号改变后的第六个输入信号周期，系统就再次将相位锁定。如图8(b)所示为输入信号相位突变后的仿真图，Sig_in的频率为100 Khz从图中可以看出系统在输入信号改变后的第7个信号周期就再次将相位锁定。 图8. 锁相环仿真图 由图8两图可以看出，在输入信号发生突变后，锁相环系统会立即响应，首先快速跟踪频率然后锁定相位，具有锁相速度快，锁相精度高等优点。 如图9所示为控制系统的Modelsim仿真图，图中输入信号Sig_in频率为80 Khz，PWM1、PWM2分别为加入死区的输出信号。从仿真波形可以看出，系统的输出Sig_out精确地跟踪了输入信号的频率与相位，并且经过死区模块的处理后输出一组互逆的PWM波形，用来驱动逆变电路的MOSFET对管。 图9. 频率跟踪控制系统仿真图  前面的仿真结果证明了本控制系统的可行性，为了进一步验证本控制系统的工作效果，制作了一台实验样机如图10所示。样机包括高频交流电源，发射与接收线圈，负载等部分。其中电源部分由整流电路，升降压斩波电路，逆变电路组成。其中本样机采用IRFP4568PbF型号MOSFET，驱动的型号为MIC4421。本样机的详细参数如表2所示。 图10. 样机实物图 Table 2 参数 数值 发射线圈电感L 1 /µH 41.2 接收线圈电感L 2 /µH 41.1 谐振电容C 1- /µF 0.1 谐振电容C 2- /µF 0.3 线圈距离/cm 20 中心频率/Khz 82 表2. 样机详细参数 为了方便示波器采样显示电压电流的相位关系，此处采集的电流，此电流互感器的变比为50:1，采集的电压相位图如图11所示，图中方波为电压信号，正弦波为电流信号。从图中可以看出WPT控制系统使系统正常工作，频率跟踪控制系统有效的跟踪系统的工作频率，使系统电流电压处于同相位，实现了WPT系统的数字控制。 图11. 发射线圈电压与电流波形图"
"本文改进了传统锁相环，基于FPGA设计了可变模全数字锁相环，在仿真与实验中证明了加入误差量化环节后系统的锁相速度明显加快且稳态误差变小，并在此基础上设计了应用于磁耦合无线传能系统的控制系统。经过仿真与样机试验验证，当改变发射线圈与接收线圈之间的距离时，系统能够自动跟踪工作频率使磁耦合谐振式WPT系统工作在谐振频率下。由于电流采集模块的存在，将电流转化为同频同相的方波时存在少许延时，因此电流电压之间的相位会存在很小的误差。本文是基于SS拓扑进行分析，交流电源的最大功率为500瓦，适用于磁耦合谐振式无线电能传输系统。"
