"本文根据胎动监测以确认胎儿是否处于正常状态的刚性需求，设计并实现了一套基于蓝牙传输的智能胎动检测系统。采用硬件终端 + 手机APP的监护模式，硬件终端实现胎动信号的采集与处理；手机APP实现对胎动信号的特征点识别，然后进行胎动计数。本系统有效的实现胎动自动检测，可及时发现胎儿胎动异常，降低围产儿发病率与死亡率，对于提高优生优育水平具有重要意义。 关键词 :胎动信号，蓝牙，胎动计数，手机APP Copyright © 2019 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"胎动是胎儿生命的客观征兆之一，现代医学也将胎动作为胎儿是否缺氧的临床指标，更是可以作为妊娠的诊断依据。胎动计数可以反映出胎儿的健康情况，如胎动减少提示胎儿可能缺氧，提醒孕妇去医院做进一步的检查，是产前监护的重要方法之一 [ 1 ]。根据统计表明，至少10%的严重智力迟钝和30%的大脑麻痹是由于胎儿在宫内缺氧所引起的，而且胎儿在生成过程中若有缺氧的状态极易导致其发育不良或早产，更有甚者发展为弱智儿童 [ 2 ]。因此，保证胎动信号检测的准确性与实时性，对及时发现胎儿胎动异常，降低胎儿发病率与死亡率具有十分重要的作用。 现有的胎动监测方法主要可以分为主动式和被动式两种。其中超声多普勒胎动监测通过向孕妇腹部发射超声，通过一系列信号处理过程后返回胎动信号为典型的主动监测方法，这种监测方法可直接检测胎儿的所有活动 [ 3 ]。但由于需定期去医院监测其局限性较大。被动式的监测主要包括在孕妇腹部采用心电、压力和加速度传感器等方法。 相比较于其他的被动式胎动测量方式，基于加速度传感器的测量法在设计上更加的简单易行。本文设计了一种胎动自动测量系统，集胎动检测、信号处理、模式识别、蓝牙传输于一体，采用多个传感器构成采集阵列，均匀布置在孕妇腹部。比传统的超声方式更加安全、廉价且简单方便，数据更容易获取，还能在任意时间段、任意地点进行监测。"
"莱昂哈德·欧拉对于刚体在三维欧几里得空间的取向采用欧拉角来描述，将刚体姿态的整个过程分解为三个连续旋转的步骤，其中每次旋转所围绕的轴正交于前后旋转所围绕的轴 [ 4 ]。如图1展示了旋转过程，先绕z轴旋转得到α角，绕旋转之后XY平面夹角N旋转得到β角，绕旋转之后的Z轴旋转得到γ角。 通过Z-Y-X欧拉角转换，将三个轴上的加速度值转换成大地水平面(XY面)与垂直方向上(Z方向)三个方向的加速度值，两个投影坐标系之间的转换可通过左乘适当的3 × 3转换矩阵 C α β [ 5 ] 得到，即任意加速度矢量x。 图1. 欧拉角 x β = C α β x α (1) 式中：x的上标β表示投影坐标系，矩阵C的上标β表示目标坐标系，下标α表示源坐标系。坐标转换矩阵如式(2)所示： C β α = [ cos θ cos ψ − cos ϕ sin ψ + sin ϕ sin θ cos ψ sin ϕ sin ψ + cos ϕ sin θ cos ψ cos θ sin ψ cos ϕ cos ψ + sin ϕ sin θ sin ψ − sin ϕ cos ψ + cos ϕ sin θ sin ψ − sin θ sin ϕ cos θ cos ϕ cos θ ] (2) 其中 θ 表示绕Y轴转动的俯仰角， ψ 表示绕Z轴转动的偏航角， ϕ 表示绕X轴转动的横滚角。 由式(1) (2)可求出大地坐标系各轴加速度，静止状态下，不论加速度传感器姿态如何，z轴上的加速度值等于g值，转换后的加速度绝对值与当前读到的加速度绝对值相等 [ 6 ]。 | a | = a x 2 + a y 2 + a z 2 (3) 式中 | a | 为合加速度值，a x 为加速度传感器转换后x轴方向上的加速度值，a y 为转换后y轴方向上的加速度值，a z 为转换后z轴方向上的加速度值。 采用4个加速度传感器作为本系统的胎动采集阵列端，分别能得到4个合加速度，可采集不同位置的胎动加速度值。当胎儿运动有动作发生时，会在母体某个或几个位置同时产生加速度，在接收到有两个或两个以上加速度传感器采集到的加速度值与预先设定的胎动加速度值符合时，则判定产生一次胎动。"
"系统主要有胎动加速度信号采集模块、主控模块、蓝牙通信模块以及电源管理模块与锂电池充电模块组成。其系统设计框图如图2所示。 系统通过将4个加速度传感器MPU6050均匀布置在孕妇腹部，同时采集全方位的胎动加速度信号，经过MPU6050内置转换器将模拟的胎动信号转换为数字信号，再与主控制器通信，主控制器随即对胎动信号处理后利用蓝牙模块无线传输至智能手机端，在手机端实现胎动波形的显示以及胎动信号的识别。 图2. 系统结构框图"
"目前，随着微电子、MEMS和新一代信息技术的飞速发展，用于胎动检测的传感器也越来越多，现阶段检测胎动信号的传感器主要有超声多普勒、压力和加速度传感器。 1) 超声多普勒 超声多普勒主要产生超声振动波作用于胎儿，经过回声及多普勒原理，获得处理后的胎动信号。尽管用于检测的超声剂量很低，但也属于有损探测范畴，不适于经常性、重复性的长时间连续家庭监测使用。 2) 压力传感器 压力传感器检测胎儿动作时对孕妇腹部产生的压力，采集其胎动信号，信号在滤波、放大和A/D转换后，再对胎动信号进行辨别。但存在结构复杂、成本高和使用不便的问题。 3) 加速度传感器 加速度传感器基于微振动检测的方法，可全方位捕捉胎儿不同方向不同部位的动作。随着加速度传感器的尺寸、功耗及价格进一步降低，使之比传统超声方式更安全、廉价和简单方便。也比压力式具有更好的可靠性、准确性和稳定性，适用于长时间连续检测不定方向的胎动信号。  胎动采集传感器采用六轴加速度传感器MPU6050，MPU6050内置的换能器将各轴上的具体加速度值转换成为电压值，然后模拟数字转换器将其转换成为数字量，可直接输出到主控制器。为了便于安装和检测，将胎动传感器制成小型PCB板，通过排线进行连接。MPU6050连接电路如图3所示。由于需要在孕妇腹部布置传感器阵列，采用IIC接口通讯，保证通讯速率在一个较高的水平。加速度传感器检测到胎儿活动对腹壁产生冲击，改变自身相对位置，产生加速度值的变化。采用4个传感器排列布置在不同的位置，可全面感知胎儿活动，并将采集的数据发送到主控制器。  加速度传感器在孕妇腹部对胎动进行实时检测，传感器阵列的全方位布置示意图如图4所示。其中1为孕妇、2为加速度传感器、3为智能手机、4为胎儿。因传感器的数量和位置直接影响着胎动检测的精度，由此遴选出最优的4个传感器，两两对称布置在孕妇腹部，全面感知胎动信号，可最大限度捕捉胎动信号。 图3. MPU6050连接电路图 图4. 加速度传感器阵列图  胎动数据的无线传输采用低功耗蓝牙技术，采用TI公司推出的兼容BLE协议的SOC芯片CC2541作为主要管理芯片，馒头科技设计的MTSerialBle作为蓝牙传输电路的核心芯片，支持蓝牙4.0的协议标准，并且支持主从一体，具有连接速度快，功耗低，体积小的优势。实现硬件系统与智能手机的无线连接，可进行完美的数据传输，系统采用串口与蓝牙连接，将硬件终端采集的胎动数据通过蓝牙模块无线传输至手机接收终端。其电路原理图如图5所示： 图5. 蓝牙模块电路原理图  核心处理模块的单片机采用意法半导体的STM32F103RCT6，是整个检测系统的主要控制单元，具有标准的32位RISC(精简指令集)处理器，有很高的代码效率，性能高，同时有丰富的I/O口以供与传感器通信使用。主要功能是是接收多位置的胎动数据，在进行处理后通过蓝牙模块打包发送至手机端。控制芯片STM32F103的外围电路主要包括单片机的最小系统与各个模块的通信接口，包括电源、复位、时钟电路等，如图6所示。 图6. STM32主控电路原理图  整个系统采用锂电池对其进行供电，需提供稳定的3.3 V电压，为了满足系统对电压的要求，采用RT9013稳压芯片为系统提供3.3 V稳定电压，采用TP4056管理芯片为锂电池充电。RT9013是一款高效的低功率打压调节器，其输入电压范围在2.2~5 V，满足本系统的需求。TP4056是一款完整的单节锂离子电池，采用恒定电流或恒定电压线性充电器，外部元件数目较少，适用于本系统的便携性。3.3 V稳压电路见图7，锂电池充电电路见图8。 图7. 3.3 V稳压电路原理图 图8. 锂电池充电电路原理图  由于系统硬件的布置要求，本系统采用模块化设计，四个胎动传感器分别制成四个小型PCB板，便于与孕妇腹部贴合，图9中所标注的1、2、3、4分别代表4个胎动传感器。同时为了减轻检测装置对孕妇的影响，传感器与主控板使用外壳包装，裸露的杜邦线用热缩管包裹，避免产生的弱电流对孕妇造成伤害。系统硬件设计实物图见图9。 图9. 系统硬件设计实物图"
"系统软件部分主要由终端软件设计、手机APP设计两个部分组成。其中终端软件设计主要完成对胎动数据的定时多路采集，通过主控制器对不同路的胎动数据进行整合，合并为一帧的数据，最后通过控制蓝牙模块将整合后的数据上传至手机终端。手机APP设计主要实现从MCU接收胎动加速度数据，再对接收的数据进行分析处理与模式识别，完成胎动波形显示与计数。  系统终端软件通过单片机串口、定时器、IIC等模块，实现对多路胎动数据的同步采集，再对胎动信号进行处理，最后通过蓝牙传输数据至手机终端。 终端信号处理采集见图10所示。主要分为三个部分：传感器数据接收部分，数据解包整理部分，数据包蓝牙发送部分。其中传感器数据接收部分主要是，利用定时器设定500Hz数据接收频率实现同步采集，获取完整的数据包后，通过辨别起始，结束字节，对其进行解包，然后通过数据包内提供的校验码进行数据检验，确认无误。数据解包整理部分主要是，将各路加速度数据按照加速度模块通信格式解包，获取所需要的各方向加速度数据，以及当前传感器的位置信息，再按照新的格式进行合帧打包。数据包蓝牙发送部分主要是，收集齐所有传感器数据后进行加首位校验位整合，并通过蓝牙发送至智能手机端。 图10. 终端信号采集处理  手机APP端设计是基于Android系统平台进行开发，通过Android平台实现对胎动信号处理，显示获取的信号波形，最后识别出胎动，进行胎动计数。 从设计框架来说，本系统的手机APP设计主要包括模型层、视图层及控制层三个方面。模型层主要用于服务器端的数据接收缓存与胎动模式识别。视图层主要用于波形显示、数据显示及用户信息的注册、登录、注销等。控制层主要用于用户操作，完成切换界面等用户请求。Android的MVC框架见图11所示。 图11. Android MVC框架图 数据处理通过Android的蓝牙接口接收从硬件终端发送的胎动加速度数据，完成坐标系的转换，获取胎动信号的特征点。其中胎动信号的特征点获取实现对胎动信号主波点定位。实现步骤见图12，具体步骤如下： 1) 通过Android的蓝牙接口从硬件终端获得一个数据包，进行解包与数据处理，选定一段信号； 2) 设定一个基准阈值，判断信号最大值是否大于阈值，若没有再取下一个数据包再处理判断； 3) 对阈值判断后的信号进行一阶微分： d x ( n − 1 ) = x ( n ) − x ( n − 1 ) ，其中n为整数； 4) 根据 d x ( n ) * d x ( n − 1 ) 的值来判断波峰与波谷，如果其值小于0，则记录该点(dx(n)为0时，记为−1)； 5) 对所有的波峰与波谷进行识别，从峰点开始检测，如果第一个点是谷点，则跳过。寻找所有满足比左邻近最小谷点值(初始值为信号最小值，指从上次检测到的有效峰值点开始，到当前峰点之间的最小谷值点)、比右邻近谷点都高于一定阈值的有效峰点，并且在一个有效峰值检测过程中，检测到的峰值为两次有效检测所有可能的峰点中的最大值点。有效则保留，无效则丢弃，进行下一轮峰值检测。"
"由于受测群体的特殊性，以及胎动发生的不定时性，考虑处于妊娠期孕妇自家中到医院来回检查的不便。本文为验证胎动检测系统的准确性，采用模拟胎动装置，在一段时间内模拟大小、方向、时间都不确定的随机胎动加速度，加速度传感器按阵列布置在模拟的孕妇腹部，采集产生的模拟胎动加速度，进行实验对比。实验测试结果见图13： 图12. 峰值算法检测步骤图 图13. 模拟测试结果 模拟10组胎动信号，其中无阴影部分柱形图表示每组模拟胎动次数，阴影部分柱形图表示每组模拟胎动误检次数，折线图表示正确检测率。图13统计的结果表明10组模拟测试中正确检测率最低为94.1%，平均正确检测率为97.3%。说明系统测量胎动的次数与实际产生的胎动次数有很好的一致性，本系统可供孕妇居家进行连续胎动监测。"
"本文设计并实现了基于蓝牙传输的智能胎动检测系统，基于模块化设计方案，分别对胎动采集模块，数据传输模块和数据收集终端进行设计。选用MPU6050加速度传感器，测量的加速度分辨率可达到0.0005 g。4个加速度传感器构成采集阵列，以STM32F103微控制器对胎动数据进行处理，通过基于BLE协议的CC2541对胎动数据进行无线传输至手机APP端，再对胎动数据进一步处理，得到胎动波形及胎动次数。 采用的硬件终端+手机APP的监护模式，为用户提供了一种科学有效、经济实在的健康监测方案。通过实验检测发现胎动产生的加速度与胎动的实际发生之间存在很好的相关性，但由于原始信号是由加速度传感器置于孕妇腹部采集的，采集到的成分比较复杂，除胎动外，宫缩及母体用力、呼吸、咳嗽、发笑等都能引起母体腹壁压力的改变，带来低频和高频的干扰信号，所以结果还是存在一定的误差，需要在后期中作进一步的探索与研究。"
