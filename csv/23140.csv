"为了有效的预防各类人群身体突发疾病而得不到及时救治的问题，本系统采用了以STM32F103为核心的处理器，设计了一个有效的监护报警系统，该系统利用脉搏采集模块以及体温采集模块测出当前的身体状况，通过信号的处理，判断当事人当前身体状况是否有问题，如果数据异常，则通过GSM报警模块，向预先设定的监护人手机发送警示短信。该设备经过测试，反应灵敏，报警及时，工作稳定可靠。 关键词 :STM32，脉搏信号采集，体温信号采集，GSM报警 Copyright © 2017 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"随着我国经济的发展，外来务工人员越来越多，留守儿童和空巢老人的处境逐渐受到关注。让他们度过一个生活有保障，精神上快乐充实的童年(晚年)，让他们的监护人及时掌握被监护人的身体状况，已经是摆在所有研究人员面前的一个重要课题。文 [ 1 ] 以STM32L152为主控制器，采用光电传感器和红外传感器分别采集人体的PPG信号和皮温信号，并通过蓝牙模块将数据传至安卓智能手机，用手机显示心率、呼吸、皮温的结果，仅实用于个人穿戴场合，没有远程监护报警功能。文 [ 2 ] 提出了一种基于STM32F103RE单片机的微型多参数健康监护终端的设计与实现方法，实现了人体心电、心率、血氧饱和度和姿态信息的采集、处理、显示与存储，但没有设计远程监护功能，缺少实时短信通知。文 [ 3 ] 利用STM32W108无线射频芯片，设计了一种心率实时监测和跌倒检测系统，但由于检测参数过少，应用范围受限。文 [ 4 ] [ 5 ] [ 6 ] [ 7 ] [ 8 ] 都是针对心率或血氧或脉搏的某项数据采集方案，没有考虑不同年龄段人群在这些数据上差异，距离实际应用还有一定的距离。文 [ 9 ] 基于STM32L152单片机和Android平台，设计了一款老人定位与运动监护系统，可实现对老人的远程监护，但该系统仅是针对位置和运动信息异常，没有身体参数采集，应用群体单一。 本文设计一个基于嵌入式STM32的监护报警系统，通过实时采集脉搏和体温信息进行数据分析，在异常时报警通知监护人，可以有效解决各类人群面对急病突发而无人知晓的困境。"
"本系统由战舰v3版STM32、脉搏传感器、体温传感器以及GSM800C构成。战舰v3版STM32较以往版本，不但闪存增大了一倍，还新增了10/100 M以太网接口、ATK-Module接口、光敏传感器、板载喇叭、RS232选择开关和接口，扩大了DC电压输入范围，并精简了多余接口，提高了开发效率，是开发本系统的首要选择。 传感器采集的脉搏和体温数据由STM32进行处理，根据设定的逻辑规则，生成相应的判断，决定是否启动GSM800C模块发送短信至监护人手机，并告知详细异常信息。 系统的具体判决规则如下： 儿童组在3分钟内，脉搏平均超过90或者体温平均超过37.5度时，就启动报警；青少年组在3分钟内，脉搏平均超过80或者体温平均超过37.5度时，就启动报警；老年组在3分钟内，脉搏平均超过60或者体温平均超过37.5度时，就启动报警。 方案实现框图如图1所示。 图1. 系统实现框图"
"该模块由MLX90614Bxx采集体温数据，经由LM2904 (如图2所示)放大后，通过热敏电阻，转化为数字信号，通过AD端口送至STM32的PA.0端。注意检测体温时一定要与人体表面密切接触，以防止传感器采集到的数据有误差。体温采集模块设计图如图3所示。  该模块由信号采集，A/D采样电路，电源电路，通信接口电路组成。脉搏采集由MSP403F5438芯片实现(如图4)。脉搏传感器采用了峰值波长为515 nm的绿光LED (AM2520)。光接收器采用环境光感受器(APMS-0005)，其感受峰值波长为565 nm，两者的峰值波长相近，灵敏度较高。 MSP403F5438传感器采集脉搏模拟信号，经AD转换为数字电压，然后将脉搏波形数据通过AD端口上传到STM32的PA.1端，如图5所示。  ATK-SIM800C模块是ALIENTEK开发的一款高性能工业级GSM/GPRS模块(开发板)，功能完善，可以低功耗实现语音、SMS和数据信息的传输，其工作频率为GSM/GPRS 850/900/1800/1900 MHz，尺寸为17.6*15.7*2.3 mm，能适用于各种紧凑型产品设计需求。 SIM800C的RX口连接到STM32的PA.2口，TX口连接到STM32的PA.3口。系统将采集到的脉搏和体温数据送至STM32，进行实时判决，根据判决结果决定是否启动报警。 图2. LM2904芯片图 图3. 体温采集模块设计图 图4. MSP403F5438芯片图 图5. 脉搏采集模块设计  //老年组代码示例 //头文件(部分) #include delay.h ∙∙∙ //初始化 u32 Animal_Heat_Set=37; float Temper,Temper_Set=40; u8 SendFlag=0; u8 LcdBuf[ 20 ]; u8 Init[ ] = {elder alarm system!}; u32 Animal_Heat; extern int IBI; //相邻节拍时间 extern int BPM; //心率值 int BPM_Set=120; extern int Signal; //原始信号值 extern unsigned char QS; //发现心跳标志 int main(void) { delay_init(); //延时函数初始化 NVIC_Configuration(); //设置NVIC中断分组2:2位抢占优先级，2位响应优先级 uart_init(9600); //串口初始化为9600 usart2_init(9600); //串口2接SIM800模块 LED_Init(); //蜂鸣器与LED初始化 Adc_Init(); //ADC初始化, LCD_Init(); delay_ms(1000); TIM2_Int_Init(99,719); POINT_COLOR=RED; //报警并LCD显示 LCD_ShowString(100,10,300,24,24,Init); while(1) { Reduced_Temperature(); if((BPM>BPM_Set)||(Animal_Heat { SendFlag=1; //设置发送短信号码 Send_HZ_TXT_Message(188521913**老人身体有异常，请及时回家探望！); } else if((BPM Animal_Heat_Set)) { SendFlag=0; } sprintf((char*)LcdBufAnimal_Heat_Set:%3d,Animal_Heat_Set); LCD_ShowString(30,150,300,24,24,LcdBuf); delay_ms(500); } }"
"实验分为三组，依次测量他们体温和脉搏，对数据进行判决后，测试系统响应情况。判决规则为：当脉搏每分钟跳动次数大于120或小于60，或者体温高于37摄氏度或低于36摄氏度，都被判决为不正常，其他情况则判决为正常。第一组选择了10名儿童，年龄在7~12岁之间，实验结果见表1；第二组选择了10名青少年，年龄在13~18岁之间，实验结果见表2；第三组选择了10名老人，年龄在60~80岁之间，实验结果见表3。  表1~表3的数据表明，在不同年龄段，所测得的体温和脉搏是不同的。为此，本系统标配有一个年龄段选择开关，分为儿童、青少年和老人三种模式。三组实验证明，本系统生理参数采集准确，判决规则有效，无一例漏报和误报出现，实现了设计目的。 实验中发现，GSM800C模块有时响应会有延迟，而且会重复发送同一异常状态短信，这也是下一步需要解决的一个问题。 Table 1 脉搏/bpm 体温/℃ 判决 是否响应 74 36.5 正常 否 83 36.7 正常 否 108 38 不正常 是 95 37 正常 否 120 36 不正常 否 97 36.2 正常 否 88 37 正常 否 74 36.7 正常 否 82 36.5 正常 否 110 38 不正常 否 表1. 7~12岁年龄组实验结果 Table 2 脉搏/bpm 体温/℃ 判决 是否响应 97 36.9 正常 否 85 37 正常 否 81 36.4 正常 否 148 37 不正常 是 120 36.8 不正常 是 83 36.3 正常 否 95 37.1 不正常 是 102 37.5 不正常 否 107 36.9 不正常 是 91 36.7 正常 否 74 36.1 正常 否 表2. 13~18岁年龄组实验结果 Table 3 脉搏/bpm 体温/℃ 判决 是否响应 103 37.2 正常 否 95 36.5 正常 否 87 36.8 正常 否 132 37.4 不正常 是 143 36.9 不正常 是 76 36.3 正常 否 104 36.1 正常 是 98 36.6 正常 否 136 37.2 不正常 是 表3. 60~80岁年龄组实验结果"
"虽然测到的数据与各个群体实际脉搏和体温有少数差异，但在判决时，程序自动根据统计规律给予了补偿，最终达到工作稳定，实现了预期设计目标，针对GSM800C重复发送异常短信问题，下一步将对以下几个方面进行改进：1) 提高硬件的品质；2) 改进代码处理逻辑；3) 改善各个模块的连接方式，缩小环境参数对采集数据的影响。"
