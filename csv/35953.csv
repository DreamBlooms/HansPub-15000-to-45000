"基于荧光寿命的光纤测温技术关键点在于将荧光信号中的直流分量与噪声信号等背景干扰去除，尽可能准确地求得荧光寿命 τ ，但在高精度测量时，运用传统的单指数模型算法，如最小二乘拟合、积分面积比、FFT拟合等方法处理多指数的荧光信号时，求取荧光寿命 τ 会带来很大误差。将LM算法和Prony算法引入荧光测温中，通过仿真分析可知，二者在处理多指数的荧光信号时较传统方法有明显优势，LM算法在低噪条件下，处理双指数模型的最大误差在±10 −4 ms之间，响应速度3 × 10 −1 s，适合用于高精度测量之中；Prony算法受噪声影响较为明显，在低噪环境下的最大误差为±10 −3 ms，响应速度可以达到2 × 10 −3 s，适合应用在快速响应条件下。 关键词 :荧光寿命，测温，数据处理，高精度测量，LM算法，Prony算法 Copyright © 2020 by author(s) and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY 4.0). http://creativecommons.org/licenses/by/4.0/"
"荧光测温是一种可以应用在工业、农业、医疗等行业的温度测量技术，因其抗电磁干扰的特点 [ 1 ] [ 2 ]，较传统热电偶测温有更大优势。同时基于荧光寿命的光纤测温系统有着不受激励光强干扰的特点，具有很好的发展前景 [ 3 ]。 实际应用时荧光寿命的理论衰减形式为： I ( t ) = I 0 exp ( − t / τ ) + I d + I n (1) 其中，I d 为直流分量，I n 为噪声信号，二者均属于背景干扰 [ 4 ] [ 5 ]。 τ 为荧光寿命，是温度的单值函数，求取 τ 值即可得到被测温度值 [ 6 ] [ 7 ]。为保证求 τ 的准确性，需要对接收的荧光信号进行去直流，消除背景噪声等预处理，通常采用最小二乘拟合、积分面积比、FFT拟合等方法 [ 8 ]。 但在高精度测量时发现，荧光信号为多指数形式，即： I ( t ) = I 0 exp ( − t / τ 1 ) + I 1 exp ( − t / τ 2 ) + ⋯ + I N exp ( − t / τ J ) + I d + I n (2) 此时传统针对单指数的各算法存在弊端，需寻找更准确的算法来进行提高测量的精度。 LM算法和Prony算法是针对多指数模型的数据处理方法 [ 9 ] [ 10 ]。本文通过仿真分析，研究将LM算法和Prony算法引入荧光测温的可行性和测量精度的问题。"
"定义待测荧光信号的模型为： I ( t ) = ∑ i = 1 k A i exp ( − t / τ i ) (3) 在这里，构造一个代价函数来估计衰减残差的平方和： S ( β ; t ) = 1 2 ∑ j = 1 n [ I j ( β ; t ) − y j ] 2 = 1 2 ∑ j = 1 n f j ( x ) 2 ≡ 1 2 F ( x ) T F ( x ) (4) 式(4)中的 F ( x ) 是由 f ( x ) 组成的向量值函数， β 是由A i 和 τ 组成的参数。这样一来，求取荧光寿命 τ 就变成了求取参数 β 来使得S最小化的问题。考虑到S不是呈线性关系，需要更加精确、快速的收敛方法，因此提出了使用LM算法来进行拟合。 LM算法的迭代格式为： x k + 1 = x k + d k (5) 其中d k 为搜索方向，在高斯牛顿法的迭代条件基础上，Levenberg和Marquardt提出了通过对角截断来对J T J矩阵进行衰减，即引进一个阻尼因子 λ ，使其能够在较大的初始范围内进行收敛： x k + 1 = x k − ( J T J + λ diag ( J T J ) ) − 1 J F ( x ) (6) 式中：J为I对 β 的梯度；J T J为Hessian矩阵；用Hessian的对角矩阵来代替单位矩阵，可以减小计算机字长短带来的累积舍入误差的影响，提高计算结果的精度。 阻尼因子 λ 在每次迭代过程中会进行自我调整，当S减小时， λ 相应减小，当 λ → 0 时，上式近似为高斯牛顿法；当S增大时， λ 相应增大，当 λ → ∞ 时，上式近似于最速下降法。当目标函数的精度达到预设值时，迭代结束。因此只要选择合适的迭代初值，就可以兼顾高斯牛顿法和最速下降法的优点，使得迭代收敛速度快，全局稳定性高。 在仿真过程中，使用LM算法分别对单指数模型和双指数模型进行了分析。  针对单指数模型，此时荧光信号为： I ( t ) = A 1 exp ( − t / τ ) + I d + I n 利用MATLAB做一条单指数函数曲线，设其模型为： y = A exp ( − i Δ t / τ ) + I d + I n 采样时间间隔 Δ t = 0.01   ms 。假设荧光寿命 τ = 0. 5   ms ，通过仿真反求 τ 值偏离0.5 ms的大小来分析LM算法对直流分量和噪声分量的敏感程度及算法处理速度。  令 A = 1 ，噪声信号 I n = 0 ，改变直流分量I d 的幅度与荧光信号强度的比，结果如表1所示。可以看出，利用LM算法求取荧光寿命 τ 时，会受到直流分量的影响，随着直流分量的增大，荧光寿命 τ 也逐渐偏离理论值。因此若想应用此法得到较高的测量精度需要想办法去掉直流分量，这是此法的一个弊端。 Table 1 采样点 直流幅度与荧光强度比 0.5% 1.0% 1.5% 2.0% 2.5% 30 0.500135 0.500341 0.500573 0.500680 0.500833 60 0.500179 0.500436 0.500663 0.500744 0.500927 90 0.500170 0.500396 0.500697 0.500817 0.501005 120 0.500075 0.500402 0.500649 0.500855 0.501017 150 0.500190 0.500489 0.500754 0.500962 0.501293 表1. 直流分量为荧光强度的0.5%~2.5%时的 τ 值表  令直流分量 I d = 0 ，改变噪声信号I n 的幅度与荧光信号强度的比，结果如表2所示。可以看出，LM算法对噪声不敏感，是一种精度较高的算法。采样点的选取不仅决定了数据处理速度，还与噪声有关，采样长度并不是越大越好，例如在0.5%的幅度比情况下，采样长度120的仿真结果最接近理论值，因此要根据实际情况确定采样长度。 Table 2 采样点 噪声幅度与荧光强度比 0.5% 1.0% 1.5% 2.0% 2.5% 30 0.499912 0.499937 0.499267 0.500507 0.499987 60 0.500063 0.500128 0.500101 0.500141 0.500616 90 0.500017 0.499746 0.500116 0.499800 0.499363 120 0.500014 0.500126 0.499800 0.500157 0.499010 150 0.500037 0.500310 0.499695 0.500272 0.500713 表2. 噪声幅度为荧光强度的0.5%~2.5%时的 τ 值表  用MATLAB做一条双指数曲线，设其模型为： y = A 1 exp ( − i Δ t / τ 1 ) + A 2 exp ( − i Δ t / τ 2 ) + I d + I n 假设荧光寿命 τ 1 = 0. 5   ms ， τ 2 = 0. 3   ms ，通过仿真反求两个 τ 值偏离程度来进行对比分析。 噪声信号的影响 通过单指数模型仿真分析可知，算法受直流分量的影响，因此此处讨论无直流情况下对噪声的敏感程度。选择采样长度为120，改变噪声幅度与荧光强度的比例，得到表3所示的结果。 Table 3 采样点120 噪声幅度与荧光强度比 0.5% 1.0% 1.5% 2.0% 2.5% τ 1 0.500014 0.499933 0.499865 0.500428 0.503992 τ 2 0.300196 0.300387 0.300392 0.300601 0.298640 仿真时长(s) 0.352149 0.355530 0.352190 0.349143 0.350027 表3. L-M算法拟合长度为120点时的 τ 值表 这里对比传统的最小二乘拟合法和FFT拟合法，分别在采样长度相同的情况下求取荧光寿命 τ 1 进行对比，结果如表4所示。 Table 4 采样点120 噪声幅度与荧光强度比 0.5% 1.0% 1.5% 2.0% 2.5% 最小二乘拟合 τ 1 0.380714 0.380733 0.380928 0.380765 0.380725 仿真时长(s) 0.001171 0.001132 0.001150 0.001185 0.001149 FFT拟合法 τ 1 0.412866 0.412858 0.412946 0.413007 0.412547 仿真时长(s) 0.001103 0.001055 0.001058 0.001072 0.001091 表4. 传统算法拟合长度为120点时的 τ 值表 对比以上两表数据可知，传统最小二乘法和FFT拟合法等算法在针对双指数模型时 τ 值计算效果较差，精度很低，误差最小在0.12 ms，受噪声影响明显，并不适合处理多指数荧光信号；而LM算法的误差维持在 0 −4 ms到10 −3 ms，测量精度较高，但由于算法需要使用到大量的迭代技术，对初值的猜测也有一定的要求，导致运行时间较长。针对这种情况，提出另一种扩充Prony算法进行改进。"
"Prony算法是使用多指数函数的一种线性组合来描述等间距采样数据的数学模型，可以根据采样值直接估算出信号频率、衰减、幅值和初相位的分析方法。 该算法针对等间距采样点，在荧光测温中，实际光谱的荧光寿命曲线可看做纯指数或一系列指数函数的叠加，形式为： I ( t ) = I 1 exp ( − t / τ 1 ) + I 2 exp ( − t / τ 2 ) + ⋯ + I n exp ( − t / τ n ) = ∑ j = 1 n I 0 j exp ( − t / τ j ) (7) 这样，当把采样值带入上式时，即可得到联立方程组： { I 0 = I 01 + I 02 + ⋯ + I 0 n I 1 = I 01 exp ( − Δ t / τ 1 ) + I 02 exp ( − Δ t / τ 2 ) + ⋯ + I 0 n exp ( − Δ t / τ n ) I 2 = I 01 exp ( − 2 Δ t / τ 1 ) + I 02 exp ( − 2 Δ t / τ 2 ) + ⋯ + I 0 n exp ( − 2 Δ t / τ n )                                                                                             ⋮ I 2 n − 1 = I 01 exp ( − ( 2 n − 1 ) Δ t / τ 1 ) + I 02 exp ( − ( 2 n − 1 ) Δ t / τ 2 ) + ⋯ + I 0 n exp ( − ( 2 n − 1 ) Δ t / τ n ) (8) 即： I i = I ( i Δ t ) = ∑ j = 1 n I 0 j exp ( − i Δ t / τ j ) (9) 其中，I i 为采样值，Δt为采样间隔，求解该非线性联立方程组，即可求得荧光寿命 τ 和幅值I 0j ，求解该方程组非常复杂，因此引入Prony算法， 设测量数据的估计模型为： I ^ n = ∑ i = 1 p b i z i n       ( n = 0 , 1 , ⋯ , N − 1 ) (10) 其中更一般的表示模型有： b m = A m (11) z m = exp ( a m Δ t ) ,       a = − 1 / τ (12) 这里，A m 为振幅，a m 为衰减因子，Δt为采样间隔，prony算法采用平方误差最小原则来使模拟信号向真实信号进行逼近，即： min ( ε = ∑ n = 0 N − 1 | I ( n ) − I ^ ( n ) | 2 ) (13) 同时考虑到估计模型函数是一个常系数线性差分方程的齐次解，因此定义了多项式： φ ( z ) = ∏ t = 0 p ( z − z k ) = ∑ i = 0 p a i z p − 1 (14) 改造式(13)有： I ^ ( n − m ) = ∑ i = 1 p b i z n − m       ( 0 ≤ n − m ≤ N − 1 ) (15) 将该式乘a m 并对p + 1个乘积求和： ∑ m = 0 p a m I ^ ( n − m ) = ∑ l = 1 p b l ∑ m = 0 p a m z l n − m ,     p ≤ n ≤ N − 1 (16) 代入 z l n − m = z l n − p z l p − m ，有： ∑ m = 0 p a m I ^ ( n − m ) = ∑ l = 1 p b l z l n − p ∑ m = 0 p a m z l p − m = 0 (17) 该式等于零正是因为第二项求和恰好是 φ ( z ) = ∏ t = 0 p ( z − z k ) = ∑ i = 0 p a i z p − 1 位于根z i 处的多项式 ϕ ( z i ) ，而 ϕ ( z i ) = 0 。因此可知 I ^ ( n ) 满足递推的差分方程： I ^ ( n ) = − ∑ m = 1 p I ^ ( n − m )       ( p ≤ n ≤ N − 1 ) (18) 假设测量值 I ⌢ ( n ) 与真实值I(n)之间关系为： I ( n ) = I ⌢ ( n ) + e ( n ) ，其中为e(n)一个加性高斯白噪声，这样就有了： I ( n ) = − ∑ m = 1 p a m I ^ ( n − m ) + e ( n ) = ∑ m = 1 p a m I ( n − m ) + ∑ m = 0 p a m e ( n − m )       ( p ≤ n ≤ N − 1 ) (19) 其中 a 0 = 1 ，上式表明白噪声中的指数过程是一个ARMA(p,p)模型，它具有相同的AR和MA参数，且激 励噪声为原加性白噪声e(n)。参数的最小二乘估计使 ∑ n = p N − 1 | e ( n ) | 2 最小，这又将得到一组困难的非线性方程。 估计AR参数的线性方法定义： ε ( n ) = ∑ m = 0 p a m e ( n − m )       ( n = p , ⋯ , N − 1 ) (20) 这样式(19)变为： I ( n ) = − ∑ m = 1 p a m I ( n − m ) + ε ( n ) (21) 所以求使 ∑ n = p N − 1 | e ( n ) | 2 最小就转换成了求使 ∑ n = p N − 1 | ε ( n ) | 2 最小，这就是扩充的Prony算法，即扩充的Prony算法 就是求解下列矩阵方程： [ x ( p ) I ( p − 1 ) ⋯ I ( 0 ) x ( p + 1 ) I ( p ) ⋯ I ( 1 ) ⋮ ⋮ ⋱ ⋮ x ( p ) I ( p ) ⋯ I ( p ) ] [ 1 a 1 ⋮ a p ] = [ ε ( 0 ) ε ( 1 ) ⋮ ε ( N − 1 ) ] 或 I a = ε (22) 为使 ε p = ∑ n = p N − 1 | ε ( n ) | 2 = ∑ n = p N − 1 | ∑ m = 0 p a m I ( n − m ) | 2 最小，求 ∂ ε p / ∂ a m 令其等于零，有 ∑ m = 0 p a m [ ∑ n = p N − 1 I ( n − m ) I ∗ ( n − i ) ] = 0 (23) 对应的最小误差能量： ε p = ∑ m = 0 p a m [ ∑ n = p N − 1 I ( n − m ) I ∗ ( n ) ] (24) 在这里定义： r ( i , j ) = ∑ n = p N − 1 I ( n − j ) I ∗ ( n − i ) (25) 则上述偏导式可写为 [ r ( 0 , 0 ) r ( 0 , 1 ) ⋯ r ( 0 , p ) r ( 1 , 0 ) r ( 1 , 1 ) ⋯ r ( 1 , p ) ⋮ ⋮ ⋱ ⋮ r ( p , 0 ) r ( p , 1 ) ⋯ r ( p , p ) ] [ 1 a 1 ⋮ a p ] = [ ε p 0 ⋮ 0 ] (26) 求解这一方程即可得到AR参数 a 1 , ⋯ , a p 和最小误差能量 ε p 的估计值。进一步可以求解如下特征方程的根Z： 1 + a 1 z − 1 + ⋯ + a p z − p = 0 (27) 这样，上述联立方程组模型就可以简化为： [ 1 1 ⋯ 1 z 1 z 2 ⋯ z p ⋮ ⋮ ⋱ ⋮ z 1 N − 1 z 2 N − 2 ⋯ z p N − 1 ] [ b 1 b 2 ⋮ b p ] = [ x ^ ( 1 ) x ^ ( 2 ) ⋮ x ^ ( p ) ] (28) 其中，幅值A i 为和衰减因子a i (即荧光寿命 τ )可表示为： { A i = | b i | a i = ln ( z i ) / Δ t (29) 由上推导，实现了Prony算法在荧光测温中的实现，现使用MATLAB软件分别对单指数模型和双指数模型进行分析。  用MATLAB软件做一条单指数荧光曲线，设其模型为： y = A exp ( − i Δ t / τ ) + I d + I n ， 采样时间间隔 Δ t = 0.0 1   ms 。假设荧光寿命 τ = 0. 5   ms ，通过仿真反求 τ 值偏离 .5 ms的大小进行分析。 针对单指数模型，令 A = 1 ，噪声信号 I n = 0 ，采样长度选择120，改变直流分量I d 的幅度与荧光信号强度，结果如表5所示。可以看出，Prony算法同样会受到直流分量的背景干扰，在直流分量较小时，仿真结果较好。 Table 5 采样点120 直流幅度与荧光强度比 0.5% 1.0% 1.5% 2.0% 2.5% 五次 τ 平均值 0.503418 0.499589 0.510936 0.518576 0.526724 表5. 直流分量为荧光强度的0.5%~2.5%时的 τ 值表(采样点120) 再令直流分量 I d = 0 ，采样长度选择120，改变噪声信号幅度与荧光信号幅度的比，结果如表6所示。可以看出，Prony算法对噪声很敏感，随着噪声的增加，仿真结果也越来越偏离理论值，在低噪环境下精度较好。 Table 6 采样点120 噪声幅度与荧光强度比 0.5% 1.0% 1.5% 2.0% 2.5% 五次 τ 平均值 0.500701 0.502971 0.515143 0.528520 0.550484 表6. 噪声幅度为荧光强度的0.5%~2.5%时的 τ 值表(采样点120)  用MATLAB做一条双指数荧光曲线，设其模型： y = A   exp ( − i Δ t / τ 1 ) + A 2 exp ( − i Δ t / τ 2 ) + I d + I n 假设荧光寿命 τ 1 = 0. 5   ms ， τ 2 = 0. 3   ms ，探究噪声对其的干扰。设拟合数据120点，改变噪声幅度与荧光强度的比例，结果如表7所示。由此可知在低噪环境下，Prony算法表现较好，仿真时长在10 −3 s数量级，比起LM算法更适合于快速响应环境下；同时其受噪声干扰较大，当噪声干扰较大时，精度不如LM算法。 Table 7 采样点120 噪声幅度与荧光强度比 0.5% 1.0% 1.5% 2.0% 2.5% τ 1 0.501421 0.492034 0.471874 0.435542 0.395383 τ 2 0.300739 0.295392 0.283338 0.170857 0.127272 仿真时长(s) 0.002446 0.009617 0.009727 0.010992 0.018512 表7. 噪声幅度为荧光强度的0.5%~2.5%时的 τ 值表(采样点120)"
"论证了LM算法与Prony算法可以运用在荧光测温系统中，比起传统数据处理方法，在处理多指数函数模型时有着明显优势。LM算法在低噪条件下，处理双指数模型的最大误差在±10 −4 ms之间，响应速度3 × 10 −1 s，非常适合用于高精度测量之中；Prony算法受噪声影响较为明显，在低噪环境下的最大误差为±10 −3 ms，相应速度可以达到2 × 10 −3 s，适合应用在快速响应条件下。两种算法各有优势所在，具有较好发展前景。"
