"在交通监控场景中，基于前车灯特征的车辆检测是夜间道路交通监控中的车辆智能检测方法。然而，前车灯在路面形成的反射光会对基于车灯的夜间车辆检测算法造成很大干扰。本文提出了消除路面反射光干扰的夜间车辆检测方法，利用反射光与车灯在视频图像中的亮度方差特征差异，构造基于决策树的反射光和车灯的分类算法，识别视频图像中的车灯和反射光，效消除图像中的反射光，然后提取候选车灯ROI；最后通过对车灯的几何约束匹配实现夜间车辆检测；该方法有效提高了夜间交通车辆检测的性能，检测性能优于现有算法。 关键词 :交通视频监控，夜间车辆检测，前车灯检测，反光消除，决策树，高斯滤波 Copyright © 2017 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"在交通视频监控系统中，通过智能分析检测视频图像中车辆信息实现交通车流分析、车辆追踪、实时车流控制等智能交通监测功能 [ 1 ] 。在白天的交通监控场景中，主要是通过车辆的颜色、形状、阴影以及运动信息实现车辆目标检测 [ 2 ] [ 3 ] [ 4 ] 。然而，在夜间交通监控场景下，白天车辆检测所使用的车辆特征不再适用，车辆的前车灯和尾灯成为了夜间车辆检测的主要目标特征 [ 5 ] [ 6 ] 。 对于夜间道路监控的车辆检测问题，基于前车灯特征的车辆检测是一种主要方法。R. Cucchiara [ 5 ] 提出了一种基于形态学的方法，利用形状、面积、对称性等车灯特有的形态特征为判断条件，筛选出真正的车灯并完成车灯的匹配；Bahlmann [ 6 ] 提出了一种基于模板的方法，以一些车灯常有的形状作为模板，通过对光亮区域进行模板匹配实现车辆检测；Chen [ 7 ] 在R. Cucchiara的基础上，增加车道线宽度作为判断条件，实现对车灯进行检测和匹配。 但是，车灯照射到路面形成的反射光对基于前车灯的夜间车辆检测方法造成强干扰，在雨天道路的反射光干扰尤为明显，严重影响车辆检测准确率。Wei Zhang [ 8 ] 提出了一种解决道路反射光干扰的方法，通过大气散射和拉普拉斯高斯滤波(LOG)，提取出可区分车灯和反射光的特征，再以马尔科夫随机场(MRF)方法将反射光剔除。本文在上述工作基础上，提出了利用反射光与车灯在视频图像中的亮度方差特征差异，构造基于决策树的反射光和车灯的分类算法，实现反射光消除和夜间车辆检测，其检测准确率和时间性能均优于上述方法。 本文方法的具体算法思想：首先，根据图像中车灯区域与反射光区域之间的方差梯度变化，Bouguer反射光衰减模型和高斯滤波等，构建和提前具有车灯和反射光显著区分度的统计特征；然后，构建基于决策树的车灯和反射光的分类算法，实现道路图像的车灯和反射光分类，并剔除反射光的干扰；最后，利用车灯的几何约束和车辆形态特征对车灯对进行匹配，实现夜间车辆检测。该方法在检测效果以及时间性能上均较优于已有的方法。 本文的夜间车辆检测处理流程如图1所示，分为两部分： 1) 特征提取与样本训练(图1中的黄色框部分)：特征提取：基于车灯与反射光的方差变化不同，利用Bouguer的衰减指数定律，构造视频图像中车灯与反射光对应的车灯和反射光的特征描述，这在第3节中提到；利用车灯和反射光图像训练样本，利用策树学习法进行车灯和反射光决策树分类器的训练。 2) 夜间车辆检测处理(图1中的蓝色框部分)：图像预处理：将图像进行初步的亮度阈值分割预处理；反光分类消除：再利用决策树对对预处理之后的图像进行车灯检测与反射光剔除；车灯筛选和车灯匹配：利用几何约束和形态学处理对图像进行车灯检测和车灯对匹配，输出车辆检测结果。 本文的主要贡献如下： • 基于车灯与路面反射光的亮度方差、Bouguer衰减指数等特征信息，提出并构造了视频图像的灰度图(Image Intensity, I)、反射光(Reflection Intensity Map, RI)、方差结果图(Variance Result, VR)，建立有很好区分度的(RI, VR, I)三维统计特征信息； • 通过建立包含不同夜间道路环境的车灯和反射光图像样本，训练并构造车灯和反射光的分类决策树，实现对夜间交通图像的反射光和车灯分类，消除车辆检测过程中的反射光干扰，有效提高夜间车辆检测性能； • 针对不同道路环境的视频监控图像数据集，本文算法和已有方法进行了反射光剔除和车辆检测实验比较，在不同亮度背景条件下，本文方法在车辆检测率和时间性能上均优于已有方法。 本文组织结构：第3节，车灯与反射光的统计特征分析；第4节，建立基于决策树的车灯与反射光分类方法，检测消除图像中的反射光；利用车灯对匹配实现车辆检测和跟踪；第5节，利用夜间交通视频进行实验验证和对比；第6节总结。"
"车灯是夜间车辆的显著特征。根据车辆前车灯和尾灯的特点，夜间车辆检测有以下几种方法：1) 基于车尾灯的颜色信息的检测方法，O’ Malley [ 9 ] 通过红色特征在HSV颜色空间下提取尾灯，并利用尾灯的互相关性以及对称性对车灯配对，该方法的检测效果不够稳定；Junbin Guo [ 10 ] 通过OTSU阈值分割和感兴趣区域提取来检测前方车辆的尾灯，利用尾灯的对称性以及帧之间车辆的相关性来检测前方车辆；该方法具有场景约束性，只适合于检测前方车辆，在道路交通监控场景下，这种方法不太适用。2) 基于车前灯的车辆检测方法，Chen [ 11 ] 利用图像亮度直方图双峰法对图像车灯进行分割提取，利用车道线为 图1. 夜间交通车辆检测流程 参照条件并利用车灯的对称性对车辆进行检测。该方法比尾灯车辆检测方法的环境适应性更好。但该方法较适用于检测前方车辆，但是车道线在夜晚场景下亮度降低路段难以正确的检测出来。3) 基于红外热成像的轮胎热能反射的车辆检测 [ 12 ] ，该方法利用红外热成像来滤除可见光的干扰，有较好的环境适应性，缺点是硬件成本较高。4) 基于车辆特征分类的方法 [ 13 ] [ 14 ] ，利用神经网络、支持向量机(SVM)对区域进行车辆分类，但是在夜间光照条件下该方法检测率较低。 对于夜间道路交通监控场景，车前灯检测方法具有较好的夜间道路环境适应性；但是，车灯的路面反光对夜间车辆检测形成严重干扰，雨天场景的干扰尤为明显，严重影响车辆检测的准确性。R. Cucchiara [ 5 ] 提出车灯与反射光的形状、大小以及车辆之间的最小距离等特征对两者进行区分，该方法在一定程度上提高了检测率，但仍然存在和车灯类似的反射光，不能从根本上解决问题。Tan [ 15 ] 提出了一种完全基于像素色度的计算方法，通过像素强度和非线性最大色度值提取出高亮反射区域，但是该方法主要针对的是水面反射光处理，并不适合处理夜间普通路面反射光。Eng [ 16 ] 利用运动矢量中值滤波和马尔科夫随机场(MRF)减少水面的反射光。Wei Zhang [ 8 ] 利用光衰减模型和反射强度分别检测到反射抑制图和大灯图，并用MRF将车灯与反射光进行区分，但是，该方法采用的MRF方法，计算复杂度较高。 本文在上述研究工作基础上，提出了一种基于亮度方差的描述特征，并采用决策树实现夜间路面反射光分类和筛除，较好地解决了监控场景下夜间道路车辆检测中的反射光干扰问题。该方法在道路环境适应性、检测性能、时间性能上均较优于已有检测方法。"
"本文根据对车灯和反射光亮度统计特征分析构造了一个能更好描述车灯区域和反光区域的三维特征，其中三维特征的每一维度分别为：灰度图(Image Intensity, I)、反射光(Reflection Intensity Map, RI)、方差结果图(Variance Result, VR)。灰度图I特征是使用直方图双峰法对原图的灰度图进行阈值分割得到；反射光RI特征是根据大气散射原理处理得到；方差结果图VR是通过将图像分割成若干3 * 3的矩阵块，计算图像每个像素点的方差值得到，如图2所示。  通过对监控场景下夜间道路车辆的图像灰度化处理后，发现车灯区域和反射光区域均很亮，车灯与反射光的像素值都很高，如果仅仅根据亮度特征，并不能准确区分车灯和反射光，检测车灯的准确率较低。 图2. (RI, VR, I)特征提取框架 根据数据统计发现，图像中的车灯区域和反射光区域周边的亮度方差有比较明显的差异。以车灯或反射光区域最外围的值为255的像素作为起始点，从边缘起始点从内往外进行扩散，选择距离为3个像素点的值X，随机从车灯和反射光中抽取这样的X各800个计算亮度方差值。图3显示了车灯与反射光之间的边缘方差差异较为明显：将得到的方差结果值放大100倍反应到图中可知，反射光的方差值在[0，20]范围内波动，而车灯的方差值在[100，120]范围内，可知车灯边缘方差变化大，反射光方差变化小。 车灯和反射光的方差变化较大，可以用于检测判断车灯的特征依据。方差的公式如下： S 2 = ( ( X 1 − M ) 2 + ( X 2 − M ) 2 + ⋯ + ( X n − M ) 2 ) / n (1) 其中，均值Ｍ M = x 1 + x 2 + ⋯ + x n n (2) 根据方差的定义和性质，在数据不稳定处，方差的值会较大。通过方差计算，数值指数型递减处得到的方差值较大，其他地方的方差值较小。 通过亮度方差计算处理的图像效果如图4所示，其中图4(b)是进行方差运算以后的方差结果图(Variance Result, VR)。计算一个像素点的方差值，使用一个3 * 3的矩阵块，使用公式(1)、(2)计算出像素点对应的方差值，将其归一化成0~255代替原像素点的值，得到方差结果图4(b)。从图4(b)中可以看到车灯区域的边缘具有明显的亮度值，而反射光区域的边缘基本不能检测到，和原图图4(a)对比可以看到，车灯区域被突显出来，而原先比较亮的反射光区域却被处理成了暗背景。  夜间场景下光源会被大气散射所影响。对于夜间道路车辆，反射光是车灯反射到地面再传送到摄像头上的，因此，可以将车灯与反射光看成是两个不同的光源。根据Bouguer的衰减指数定律 [ 17 ] ，大气散射模型如下： E ( d , λ ) = I 0 ( λ ) ⋅ γ ( λ ) ⋅ exp ( − d ) (3) 其中 I 0 ( λ ) 为光源辐射强度， γ ( λ ) 为波长λ的总散射系数，d为光源到屏幕的距离。 图3. 车灯与反射光区域像素的亮度方差统计分布 图4. 图像亮度方差VR处理效果。(a) 原图；(b) 亮度方差处理结果图-VR 对于图像I的像素点(x, y)，为其划分内部区域 Θ x , y i 和外部区域 Θ x , y e Θ x , y i = { ( x + u , y + v ) | − r ≤ u ≤ r , − r ≤ v ≤ r } Θ x , y e = { ( x + u , y + v ) | − 2 r ≤ u ≤ 2 r , − 2 r ≤ v ≤ 2 r } (4) 在区域 Θ x , y i 中寻找像素最小值 M I x , y i 和最大值 M A x , y i ，假设光源为 M A x , y i ， M I x , y i 为 M A x , y i 的散射光。散射系数定义如下： γ ( x , y ) = M I x , y i M A x , y i × exp ( − ε x , y i ) (5) 其中， ε x , y i 为 M I x , y i 、 M A x , y i 之间的距离。在区域 Θ x , y e 中找到最小值 M I x , y e 和最大值 M A x , y e ，同时也计算两者之间的距离 ε x , y e 。图像I根据大气散射定律得到的反射光图RI： R I ( x , y ) = | M I x , y e − M A x , y e ⋅ γ ( x , y ) ⋅ exp ( − ε x , y e ) | (6) 根据前面的说明，车灯周围区域的RI结果图结果值会相对较低，因为 Θ x , y i 和 Θ x , y e 代表了同一个光源的散射并有相同的散射系数。在像车灯这样的平面区域，RI的值较小，因为反射图的计算原理其实是一种边缘检测方法，因此在反射光区域RI有更大的强度。 根据图5中的原图5(a)和反射强光图5(b)的结果对比可以看出，RI结果图中，原图高亮的车灯区域变得不明显，相对于车灯的值，反射光区域有较高的亮度值。  在很多文献中提到的利用直方图双峰法来对图像进行预处理，因为夜晚车辆检测中有车辆的图的直方图大约如图6所示，从图中可以看到呈双峰分布。这副直方图可以和直方图双峰法的概念完美的契合，直方图双峰法的概念：假设图像中有明显的目标和背景，则其灰度直方图呈双峰分布，当灰度级直方图具有双峰特性时，选取两峰之间的谷对应的灰度级作为阈值。阈值的提取算法为从0到255方向上找到第一个峰值，然后再反方向上找到第一个峰值，接着在这两个峰值之间找到一个最小值(即谷底值)，最后确定这个谷值就是那个阈值了。通过统计夜间车辆检测中阈值大约在(210~245)之间。 计算出阈值T之后，对原图像灰度图中的感兴趣区域内的所有像素进行计算，大于阈值T的像素值不变，小于T的重设为0。经过直方图双峰法处理后的结果如图7所示(左侧为原图，右侧为处理后的灰度特征图I)。 图5. 反射强光图处理结果。(a) 原图；(b) 反射强光图RI 图6. 夜间车辆图像的像素亮度直方图 图7. 夜间车辆亮度阈值分割处理结果。(a) 原图；(b) 亮度阈值分割处理  本文构造了一组包含不同夜间道路环境的车辆图像样本，提取出1500个车灯像素和2200个反光像素，计算像素样本的(RI、VR、I)特征，将其归一化后形成如图8所示的样本分布图，可以看出(RI、VR、I)统计分布图中，车灯和反光有比较明显的区分度，可以利用这些特征进行车灯和反光的分类处理。 对应的车灯及反光的不同维度特征的处理效果，如图9所示。 图8. 夜间车辆图像的车灯和反射光正负样本的(RI, VR, I)特征分布图 图9. 车灯和反射光的(RI, VR, I)特征效果图"
"根据图8的样本统计分布特征，我们提出了基于决策树学习的车灯和反射光分类方法，实现图像反射光像素的提取。决策树学习分成两步：决策树训练和决策树预测。 训练决策树：事先准备好训练数据(特征向量和对应的标签)，从根节点递归构造进行训练数据的分裂。递归结束准则：树的深度达到最大值；在某节点所有的样本都属于同一类；跟随机选择相比，等选择到的最好的分类已经没有改进了。 决策树预测：输入一个测试样本特征，从根节点开始，到达每一个非叶子节点，根据不存度来选择向左走或向右走，该变量对应的索引值存储在被观测节点中，不断的根据当前变量是大于既定阈值还是小于阈值来确定算法往左还是往右走，直至到达叶子节点，赋给该节点的值就是预测算法的输出值，根据输出值来确定当前的节点是属于哪一类。ID3是常用的决策树算法，它的核心是通过采用信息增益的方式来选择能够最好将样本分类的属性。 熵： I ( X ) = − ( P 1 log 2 P 1 + P 2 log 2 P 2 + ⋯ + P k log 2 P k ) = − ∑ i = 1 k P i log 2 P i (7) 其中，X代表3700个正负样本集合；k代表样本集由k类样本组成，k = 2，样本集由车灯样本和反光样本2类样本组成；类别分别为w 1 , w 2 ； P i 表示每个取值对应的概率(i = 1, 2)。在分类过程中，使用信息熵来评价属性A (A = RI、VR、I)对样本集分类所做出的贡献。假设属性A有m个不同的取值，根据属性的m个不同取值将样本集X分化为m个子集合 X 1 , X 2 , ⋯ , X m ，令 P i = | X i | / | X | , i = 1 , 2 , ⋯ , m ；其中 | X | 代表集合X的样本个数；用属性A将样本集X划分以后，样本集X的信息熵为： I ( X , A ) = ∑ i = 1 m P i I ( X i A ) (8) 其中， I ( X i A ) = − ∑ j = 1 k P i j log 2 P i j ； P i j = | D i j | / | X | 。 本文利用RI、VR、I统计分布特征来区分车灯和反射光。 训练决策树，输入训练样本：三维特征(RI, VR, I)，计算三个特征对应的信息增益Gain，增益Gain (X, A)反应了属性A对分类所提供的信息量： Gain ( X , A ) = I ( X ) − I ( X , A ) 1) 选取三个特征中计算出信息增益值最大的作为根节点(比如VR)，往后进行递归分裂，直至走到叶子节点。 2) 选取特征中剩余的特征，进行继续分裂，到叶子节点，标记label，车灯样本标记为1，反射光样本标记为0。 3) 不断递归直至满足结束条件： a) 给定结点的所有样本属于同一类。 b) 没有剩余属性可以用来进一步划分样本．在这种情况下．使用多数表决将给定的结点转换成树叶，并以样本中元组个数最多的类别作为类别标记，同时也可以存放该结点样本的类别分布， 决策树预测：测试样本中抽取一个特征作为输入，根据上述构建的决策树，往下分裂走到决策树的叶子节点，判断得到对应的观测值result。 判别准则：现有一个观测数据 result = ( x 1 , ⋯ , x p ) T ，如果 x > x 0 ，那么判定 X ∈ G 1 ，如果 x < x 0 ，那么判定 X ∈ G 2 。此处 x 0 = 0.5 。  对原灰度图I进行反射光消除处理，生成夜间道路车辆的二值图像，对感兴趣区域进行车灯检测。 处理流程如下： Step 1：对灰度图分别采用3.2和3.3节的方法，得到RI、VR图； Step 2：采用直方图双峰法对图I进行阈值分割，提取出阈值T，对于小于T的像素值x = 0；对于大于T的像素值则转入step 3； Step 3：假设大于T的像素值坐标为 k ( x , y ) ，在I、RI、VR三图中找到k坐标点，提取出对应特征值 x I , x R I , x V R ，设 X = ( x I , x R I , x V R ) T ； Step 4：将step 3提取出的X采用上述的决策树学习进行分类，得到观测值x。 if ( x > x 0 )，则像素k为车灯像素，取图像的像素值 x = 255 ； else if ( x < x 0 )，则像素k为反射光像素，像素值 x = 0 ； 实际车灯检测效果如图10。  对于输入图像帧，对像素分类后的结果图像进行连通区域和包围矩形的提取，形成一系列的矩形区域 { C 1 , C 2 , ⋯ , C i , ⋯ , C n } 。设矩形区域i的面积为S i ，矩形区域内连通区域的面积为 S ′ i ，显而易见，夜间前车灯一般呈现圆形或矩形，并且饱满度较高，并且S i 大小一般较大等特点可以得到如公式(11)所示的判断条件。 { S ′ i = S i / 2 S i > T (9) 其中值T是使用不同场景的视频经过多次实验和测试得出，本文T取值为12。设有两区域C i ，C j 。利用车辆车灯的对称性原理对区域进行检测 [ 18 ] 。检测条件如下： 1) 同一车辆两车灯处于相似水平线上： C i , t ≤ C j , b ,   C i , b ≥ C j , t ，其中， C i , t , C i , b 和 C j , b , C j , t 分别为 C i 和 C j 的顶部、底部 [ 19 ] 。 2) 同一车辆两车灯的宽度与高度相似： T 1 < h < T 2 ,   T 1 < w < T 2 ，其中，h、w分别为两区域的高度比例和宽度比例 [ 3 ] 。T 1 、T 2 为判断阈值，本文采用的阈值T 1 、T 2 分别为0.7和1.3。 图10. 交通监控中的反射光消除和车灯检测结果图。(a) 车灯检测结果；(b) 交通图像中的车灯检测效果 3) 同一车辆两车灯的面积相近： 2 / 3 < S ′ i S ′ j < 2 / 3 。 S ′ i , S ′ j 为两区域的面积。 当一个连通区域满足公式(8)并且以上三个条件时，就可以将这个连通区域判断为车灯。 检测出车灯之后需要对车灯进行车灯对的匹配，车灯匹配根据车辆的对称性原理进行检测的，当两车灯满足以上车灯检测的三个条件，并且两个车灯之间的距离满足一个车灯区域宽度的2倍到8倍，由此完成车灯的匹配，从而检测出车辆，最终检测效果如图11所示。"
"本文实验采用640 × 480的夜间道路车辆监控视频，在Intel Core i5、4GB内存的PC上进行实验测试。本文方法与Wei Zhang [ 8 ] 提出的马尔科夫随机场(MRF)分类进行对比。Wei Zhang的MRF方法主要通过散射原理和LoG滤波处理，并利用对车灯与反射光分类。 针对视频监控中的道路车辆检测和车流统计要求，我们主要检测图像中的高度140到480像素之间的车灯，以避免道路远方车辆车灯的路面严重反射光的影响 [ 11 ] [ 20 ] 。本文方法与MRF分类进行对比，在车灯与反射光分类测试中，检测结果如表1。 针对道路背景亮度的适应性，实验挑选背景亮和暗两种视频进行测试，如图12。不同背景亮度环境下，决策树和MRF检测结果如表2所示，决策树在2种亮度背景环境下的车灯检测都有较高的检测率，背景亮度适应性比较强。MRF方法在亮度较高的环境中检测率相对较低，在亮度较暗的环境中，检测率与决策树学习接近。 从算法的检测时间性能：本文的决策树方法处理时间约为23帧/秒，MRF的方法处理时间约为14帧/秒，本文方法时间性能更优。 图11. 车前灯匹配和车辆检测效果 Table 1 Method Detection rate False positive DTree 91.9% 2.6% MRF 89.8% 34.5% 表1. 车灯检测结果 图12. 不同图像背景亮度下的车辆检测效果。(a) 较亮背景下的车辆检测；(b) 较暗背景下的车辆检测 Table 2 Method Scene Detection rate DTree Dark Scene 94.5% DTree Bright Scene 90.3% MRF Dark Scene 94.1% MRF Bright Scene 78.7% 表2. 两种亮度背景环境下的车灯检测结果"
"本文针对夜间交通车辆检测过程中的路面反射光对车灯检测的干扰问题，提出了利用反射光与车灯在视频图像中的亮度方差特征差异，构造基于决策树的反射光和车灯的分类算法，消除反射光对夜间车辆检测的干扰，提高夜间车辆的检测率。该方法对夜间交通图像中的车灯与反射光的亮度信息进行统计特征分析，采用亮度方差、光散射原理和高斯滤波，提取具有更好区分度的车灯与反射光的分类特征，采用决策树分类法对图像中的车灯和反射光进行分类，最后再根据车灯的形状和几何约束筛选出车灯，通过车灯对的对称性进行车辆检测匹配。通过夜间不同场景下交通视频的实验测试和对比，本文方法的检测性能优于已有方法。"
