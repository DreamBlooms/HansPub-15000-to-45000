"为了更准确的估计电池荷电状态(SOC)，我们考虑了影响SOC估计精度的主要因素和传统SOC估计方法的缺点，运用递推最小二乘法进行电池模型参数辨识，实现了模型参数的实时修正，提高了模型精度。我们采用次优无偏MAP时变估计器对噪声协方差矩阵进行实时更新，结合无迹卡尔曼滤波算法进行SOC在线估计，改进了传统UKF算法，降低了噪声对SOC估算的影响。试验和仿真结果表明，改进后的UKF算法相比传统UKF算法具有更高的估算精度。 关键词 :荷电状态(SOC)，在线辨识，次优无偏MAP时变估计器，无迹卡尔曼滤波(UKF) Copyright © 2018 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"电池管理系统(BMS)是电动汽车的重要组成部分之一，它的作用主要是监测动力电池组状态，保证其工作在合理的参数范围内。电池管理系统的关键技术包括热均衡技术、荷电状态(SOC)计算、健康状态(SOH)计算和安全快充技术等等。其中SOC能够反映动力电池组的剩余容量，从而得知电动汽车的续航里程，无疑是电池管理系统中最重要的参数之一。但由于SOC的不可直接测量性和锂电池系统的非线性，要实现对SOC高精度估算的难度很大 [ 1 ] 。 目前，国内外关于SOC计算的方法有很多，总结出来主要有以下几种：安时积分法、开路电压法、神经网络法和卡尔曼滤波法等 [ 2 ] 。其中，神经网络法由于模型复杂且模型精度依赖于训练数据集的完备性，因此还未在电动汽车上普及使用。而当前主要使用的开路电压法辅助安时积分法积分进行SOC估算，也有着不具备自我修正的能力和太过依赖传感器精度与SOC初值准确度的缺陷。卡尔曼滤波算法主要针对的是线性系统，而电池是一个强非线性系统，所以出现了改进的扩展卡尔曼滤波(EKF)算法，用泰勒展开的方法将非线性的状态方程线性化，但是这种线性化的方法由于忽略了泰勒展开的高阶项引入了较大的误差，且需要计算雅克比矩阵，计算量较大，对于在线估计存在一定的困难 [ 3 ] [ 4 ] [ 5 ] [ 6 ] 。针对EKF存在的缺陷，Julier等人提出了无迹卡尔曼滤波算法(UKF)，通过设计少量Sigma点，用Sigma点的分布逼近系统的状态分布，然后计算这些Sigma点经过状态方程的计算后，对其均值和方差的估算值采用UT变换，最后获得滤波值基于状态方程的更新 [ 7 ] [ 8 ] [ 9 ] [ 10 ] 。该方法省去了EKF的线性化步骤，减少了估算误差。但是电池模型在SOC估计上适应性差，并且模型的参数极易受外部因素影响 [ 11 ] 。采用离线辨识获取模型参数的方式不具备实时性，会影响到UKF的估算结果。而在线辨识能在电池工作过程中对模型参数进行实时更新修正，更有利于SOC的估算。由于电池在实际使用中，存在的系统噪声会随着实际工况而产生变化，具备很强的随机性 [ 12 ] ，若是将有色噪声单纯简化为白噪声，无疑会影响SOC估算的精度。 本文运用递推最小二乘法对模型参数进行在线辨识，采用次优无偏MAP时变估计器对噪声协方差矩阵进行在线更新，并结合无迹卡尔曼滤波算法进行SOC在线估计，改进了传统UKF算法，降低了模型和噪声对于SOC估算的影响。"
"本文选取Thevenin等效电路模型来模拟电池实际工作时的内部变化特性，如图1所示。 该等效电路是由电池电动势、一个纯电阻和一个电容电阻并联回路串联组成，其系统离散化状态空间方程为： [ U p , k S O C k ] = [ 1 − Δ t C p R p 0 0 1 ] [ U p , k − 1 S O C k − 1 ] + [ Δ t C p η Δ t C 0 ] [ I k − 1 ] + ω k (1) U t , k = [ 1 0 ] [ U p , k S O C k ] + [ R e ] [ I k ] + O C V + ν k (2) OCV为电池开路电压，U t 为电池输出端电压，R e 为电池的欧姆电阻，用来模拟电流突变时的电阻特性，R p 和C p 分别为电池的极化内阻和极化电容，它们并联构成容阻回路，用来模拟电池在极化效应表现出的端电压渐变的特性。 Δ t 为采样间隔， ω k 、 ν k 为随机干扰，通常当作高斯白噪声处理。  电池模型参数辨识方法分为离线辨识和在线辨识两种。针对实际工作时，电池模型参数会随着温度、SOH等各种因素而发生变化，本文采用递推最小二乘法对参数R e 、R p 、C p 进行在线辨识，其优点是能够进行实时修正，保证模型的精度，满足SOC估算的需求。 构造观测向量 φ k = [ y k − 1 , I k , I k − 1 ] ，参数向量 θ k = [ α , β , γ ] T ，其中 y k = U t , k − O C V = U p , k + I k R e , k = ( 1 − Δ t C p , k − 1 R p , k − 1 ) U p , k − 1 + Δ t C p , k − 1 I k − 1 + R e , k I k (3) 基本观测模型为： y k = φ k θ k (4) 图1. Thevenin等效电路模型 对观测方程进行差分处理可得差分方程： y k = α y k − 1 + β I k + γ I k − 1 (5) 其中 α , β , γ 是观测向量的参数。 联立(3)、(5)可得： { α = 1 − Δ t C p , k − 1 R p , k − 1 β = R e , k γ = R p , k − 1 Δ t + R e , k − 1 Δ t − C p , k − 1 R p , k − 1 R e , k − 1 C p , k − 1 R p , k − 1 (6) 然后开始递推最小二乘法的循环计算： 1) 对初始时刻的各参数进行初始化，并设定初始时刻为k − 1时刻，初始化对象包括观测变量的协方差矩阵 P 0 ，参数向量 θ 0 和遗忘因子 λ 。 2) 通过初始时刻端电压和开路电压，根据公式(5)，计算k时刻的 φ k 。 3) 计算k时刻的增益矩阵 L k ： L k = P k − 1 φ k λ + φ k T P k − 1 φ k (7) 4) 计算k时刻的观测向量协方差矩阵 P k ： P k = P k − 1 − L k φ k T P k λ (8) 5) 计算k时刻的观测模型参数向量 θ k ： θ k = θ k − 1 + L k e k (9) 其中 e k 是观测量的估计误差： e k = y k − φ k T θ k 6) 得到 θ k 后，就可以得到 α , β , γ ，然后通过公式(6)反推可得更新后的 C p , R p , R e ，从而根据上一个时刻的电池状态，完成了模型参数的实时更新。"
"无迹卡尔曼滤波算法是基于无迹变换的一种算法，其基本原理是利用采样点(也称为sigma点)的分布来近似非线性目标函数的概率分布。 目前sigma点的采样策略有很多，例如单形采样、对称采样等等。取sigma点方式也有两种：取一次sigma点或者取两次sigma点来代替非线性函数。 本文选择使用对称采样策略和一次取sigma点来代替非线性函数，Sigma点个数为3。n为非线性系统中状态变量的维数，这里取1。 UKF具体算法过程如下： 1) 计算权重： λ = α 2 ( n + κ ) − n = 2 (11) W 0 m = λ n + λ = 2 3 (12) W 0 c = λ n + λ + ( 1 − α 2 + β ) = 8 3 (13) W i m = W i c = 1 2 ( n + λ ) = 1 6 ,   i = 1 , 2 , ⋯ , 2 n (14) 2) 初始化： x 0 ¯ = E ( x 0 ) ,   P 0 = E ( x 0 − x ¯ ) ( x 0 − x ¯ ) T (15) 3) sigma点采样： 采取对称采样的取点策略： x k − 1 , 0 = x k − 1 x k − 1 , i = x k − 1 + ( n + λ ) P k − 1 ,     i = 1 , 2 , ⋯ , n (16) x k − 1 , i = x k − 1 − ( n + λ ) P k − 1 ,     i = n + 1 , n + 2 , ⋯ , 2 n 4) 预测更新： x k , i = f ( x k − 1 , i ) ,     x k ¯ = ∑ i = 0 i = 2 n W i m x k , i (17) P k ^ = ∑ i = 0 i = 2 n W i c ( x k , i − x k ¯ ) ( x k , i − x k ¯ ) T + Q k (18) Q k 为过程噪声，在传统的UKF估计算法中通常简化为高斯白噪声。 5) 测量更新： Y k , i = g ( x k , i ) (19) Y k ¯ = ∑ i = 0 2 n W i m Y k , i (20) P Y k , Y k = ∑ i = 0 i = 2 n W i c ( Y k , i − Y k ¯ ) ( Y k , i − Y k ¯ ) T + R k (21) P x k , Y k = ∑ i = 0 i = 2 n W i c ( x k , i − Y k ¯ ) ( Y k , i − Y k ¯ ) T (22) R k 为测量噪声，在传统的UKF估计算法中通常简化为高斯白噪声。 6) 最优估计： K = P x k , Y k / P Y k , Y k (23) e k = Y k − Y k ¯ (24) x k = x k ¯ + e k G (25) P k = P k ^ − K P Y k , Y k K T (26)  电池在实际使用过程中，过程噪声和测量噪声的统计特性会随着实际工况的变化而变化，具有很强的随机性。而在传统UKF算法中，通常将噪声简化为高斯白噪声处理，这会影响到SOC估算的精度。本文采用次优无偏MAP时变估计器对噪声协方差矩阵进行实时更新，数据加权策略为渐消记忆指数加权法，降低了噪声对SOC估算的影响，改进了传统的UKF估计算法。 基于次优无偏MAP时变估计器的噪声更新公式如下： ω k = ( 1 − d k ) ω k − 1 + d k ( x k − 1 − A k − 1 x k − 1 ) (27) ν k = ( 1 − d k ) ν k − 1 + d k ( x k − 1 − A k − 1 x k − 1 ) (28) Q k = ( 1 − d k ) Q k − 1 + d k ( K e k e k T K T + P k + P k ^ ) (29) R k = ( 1 − d k ) R k − 1 + d k ( e k e k T − P Y k , Y k ) (30) 式中b为遗忘因子，一般取0.95， x k = [ U p , k S O C k ] ， A k − 1 = [ 1 − 1 C p R p 0 0 1 ] ， K 为UKF中的卡尔曼增益， 为加权系数， d k = 1 − b 1 − b k 。 将计算所得的 ω k 、 ν k 、 Q k 、 R k 代入公式(1)、(2)、(18)、(21)中，即可完成SOC在线估计过程中噪声协方差的实时更新，替代了传统UKF算法中用高斯白噪声来代替系统噪声的方法，从而解决了噪声带来了误差问题。"
"本试验主要用于验证基于递推最小二乘法的电池模型参数在线辨识和基于改进的UKF算法的SOC估算的准确性。通过电池测试设备对一节容量为35 Ah的三元材料锂电池分别进行HPPC试验和DST动态工况试验，使用设备监测的SOC作为SOC真值，使用设备传感器测量的端电压作为真实端电压，与在线辨识结果和基于改进UKF的SOC估算值作对比。 首先验证基于递推最小二乘法的模型参数在线辨识的准确性。图2为HPPC试验过程中在线辨识实 图2. 电池模型参数随时间的变化图 时获得的电池模型各参数随时间变化的曲线。由于模型中各参数难以直接测量，无法验证辨识结果的准确性，故根据实时获得的模型参数计算得到端电压并与真实端电压进行比较，图3为真实端电压与在线辨识和离线辨识两种方法获取的估算端电压的对比。结果可以看出，在线辨识获取的模型参数计算所得的估算端电压与真实端电压更加吻合，误差更小。可以表明在线辨识得到的模型参数更为准确，模型精度更高。 图4为DST动态工况下改进UKF算法与传统UKF算法的SOC估算效果对比，可以看出改进后的UKF和传统UKF的估算曲线与SOC真值曲线都能较好的吻合。为了更好的进行估算结果比较，图5给 图3. 离线辨识和在线辨识估算端电压与真实端电压对比 图4. 两种方法的SOC估算值和真值对比 图5. 两种方法的SOC估算误差 出了两种方法估算结果对比真值的误差曲线。由图5可以看出，在工况前6000秒，传统UKF和改进后的UKF估算误差都低于3%，但是在600秒以后，传统UKF的估计误差迅速增大，而改进的UKF估算误差则基本保持不变。虽然在7000秒后，改进的UKF算法估算误差也有增加，但最高也未超过2.5%。从整个工况来看，传统UKF算法的抑制误差能力不如改进的UKF算法。由此可见，相比于传统UKF中将噪声简化为高斯白噪声，使用次优无偏MAP时变估计器对噪声协方差矩阵进行实时更新后，确实减小了算法中出现的误差，提升了SOC估算的精度。"
"1) 基于递推最小二乘法的电池模型参数在线辨识具有更好的实时性和可靠性，能够在电池工作状态下实时获得模型参数，提高模型精度，相比于离线辨识具有更好的实用性。并且从试验和仿真结果来看，在线辨识的估算结果相比离线辨识更为准确。 2) 基于改进的UKF算法的SOC在线估计通过次优无偏MAP时变估计器对噪声协方差矩阵进行实时更新，降低了噪声对于SOC估算的影响，在锂电池动态工况下的估算效果优于传统的UKF算法。从试验和仿真结果来看，改进的UKF算法在抑制误差方面明显优于传统UKF算法，并且能将误差始终维持在2.5%以下。"
