"随着网络信息交流量日益增长，信息安全问题成了网络资源应用的发展瓶颈。本文针对计算机与网络上文件的安全性问题，对DES算法以及LFSR密码生成算法进行研究，设计了基于DES和线性反馈移位寄存器(LFSR)的混合加密算法并通过FPGA实现，FPGA根据用户输入的密码组合，通过线性反馈移位寄存器产生一串密钥，然后通过USB将这串密钥发送至计算机中。上位机软件实现与下位机的USB通讯、用DES算法对任意文件进行加密和解密的功能。结果表明，该方案对任意文件加密效果好、速度较快，对于网络空间文件保护有较好的效果。 关键词 :DES加密算法，LFSR，FPGA，文件加密"
"随着21世纪网络信息时代的到来，网络空间上的文件保护问题成为了人们应用网络空间的心病。如何保护文件里的信息不被泄漏、保证文件的保密性和安全性是各行各业都很重视的课题，无论是政府、企业还是个人都逐渐依赖计算机存储信息，并借助网络传递、交换重要资料和洽谈贸易。这些信息无论是私人信息还是部门信息，无论是军用信息还是商业信息，在进行处理和传递前要以电子文档的形式存储在单机、服务器或网络上任意一台客户机上，因此电子文档的安全存储成为实现信息安全的首要条件[ 1 ] 。 针对网络信息安全性问题，CESVMC (Computable Encryption Scheme based on Vector and Matrix Calculations)加密方案，提升了数据存储、运算过程中的安全性，但运算时间比较长，存储和通信的负载较大 [ 2 ] 。通过软件运算进行加密与使用硬件进行加密相比，软件加密更容易破解。本文利用软件硬件各自的优势，取长补短，将FPGA用于加密算法设计，探索一个以FPGA为核心加密方案。"
"数据加密标准(Data Encryption Standard, DES)是由IMB公司研究发表，美国国家标准与技术研究院于1977年标准化的，目前最广泛应用的用于加密机密信息的加密方法 [ 3 ] - [ 5 ] 。 DES算法的加密由四部分完成，分别为：初始置换函数IP、子密钥Ki、密码函数F、末置换函数IP-1 [ 6 ] [ 7 ] 。DES算法需要用户提供一共64位长度的密钥用于加密与解密。算法可以提供高质量的数据保护，具有相当高的复杂性，实行经济而且运行效率高 [ 8 ] 。 DES算法只用到了64位密钥中的其中56位，还有8位并未参与DES运算，随着计算机的发展计算机运行速度越来越快，使得使用暴力破解法破解DES密钥的时间越来越短。为了保证使用DES算法的安全性，一般需要采用多重DES算法和AES加密算法，加长密钥的长度，增强DES安全性。  一个n级反馈移位寄存器如图1所示，其中 称为反馈函数，当 为一线性函数时，则称上图的反馈移位寄存器为线性反馈移位寄存器(Linear Feedback Shift Register, LFSR) [ 9 ] 。线性反馈移位寄存器具有非常适合硬件实现、能产生大的周期序列、能产生好的统计特性的序列、易于使用代数方法进行结构分析的特点 [ 10 ] - [ 12 ] 。 可设n级线性反馈移位寄存器的反馈函数： (1) 其中 为0或者1，一般C n 都为1。 由于反馈函数是作为最后一级的输入，又根据移位寄存器的特点，反馈的结果会在n个时刻之后输出，于是可以推导出输出序列{s i }： (2) 可以看出S n +k 与过去最近的n个时刻的输出S i 都有关系。 本设计的密钥生成模块采用带有适当的反馈函数的LFSR结构，使输出的56位密钥与128位的初始密钥都相关。当LFSR需要用作流密码器设计时，一般要求LFSR可以产生最大周期的密钥流，而当n级LFSR的反馈函数是本原多项式时，LFSR输出的可以达到最大周期2n - 1。这里LFSR的作用是令128位长度的初始密钥的每一位都至少与输出的56位长度的密钥中的一位相关。因此，可以根据需求设计LFSR的结构，而不必将其反馈函数设计成本原多项式。 本设计用户输入的原始密钥长度是128位，因此，需采用128级的LFSR结构。为了简化设计，可以令输出的56位密钥是连续输出的。基于这几个条件要求，式(2)中，n = 128， ， ，则式(2)可以改写成： (3) 如果每一个环节都接一个反馈的话，程序的工作量会比较大，因此可以进行以下简化，由于k是连续递增变化的，可令反馈函数f在每连续56个环节之内至少有一个反馈环节，取c 1 ，c 57 ，c 113 ，c 128 的值为1，其它c i 值为0，因此，根据式(1)、式(2)以及式(3)，本设计的LFSR的输出可以表示为： (4) 根据式(4)，可以得出LFSR结构如图2所示。若输出的56位密钥在LFSR输出第128位之后，就可保证初始密钥每一位都与输出密钥相关。该方法的优点是产生密钥速度快，但直接加密会带来传输速度慢等问题。  综合上述的方法，采取LFSR方法生成密钥，将LFSR与DES相结合进行加密的方案，即可提高速度，又可增加安全性。具体实现方法如下。 在硬件上，FPGA根据键盘输入的密码通过LFSR产生密钥之后，通过USB芯片传送给加/解密程序。软件上，加/解密程序将接受的密钥全部接受后再次通过DES算法产生子密钥，读取计算机上的文件然后进行加/解密，操作全部完成后删除原文件，从而完成对计算机上文件的加/解密，达到对计算机上文件的保护目的。 该方法允许用户输入密码组合长度最高可以达到16位，可能的密码组合的个数超过1016个。但是如果输入的密码长度是16位，由上面的描述可知，每一位密码都代表一个8位的KeyValue，16位的密 图1. 线性反馈移位寄存器 图2. 线性反馈移位寄存器的结构 码长度代表整个密钥长度为128位，当攻击者不知道每一个键值所代表的KeyValue时，可能的组合就有2 128 − 1个，因此，可以保证足够的安全性。 但128位长度超出了DES所需要的密钥长度，即用户输入的密码会有一部分无效。因此必须设计一种密钥生成方案，使输入的128位密钥中每一位至少与输出的56位长的密钥每一位相关的，这种方案可通过FPGA实现，但必须考虑尽量低的硬件复杂度，图3为加密系统结构框图。"
"FPGA加密器由上位机程序以及硬件装置构成，硬件装置由FPGA最小系统电路、USB芯片工作电路、按键电路构成，相关电路设计方案如下。  USB芯片CY 7C 68013A 电路共由CY 7C 68013A 芯片电路、24MHz晶振电路、EEPROM电路、Mini USB接口与CY 7C 68013A 连接电路构成，其电路原理图如图4所示。 时钟信号是芯片正常工作的必要条件，24 MHz晶振电路为CY7C68013A芯片提供外部参考时钟信号。Mini USB接口通过D−和D+两个网络与CY7C68013A芯片相连接。通过这个Mini USB接口，用户可以用数据线将硬件装置与计算机连接起来。USB数据通过差分线路D−和D+在硬件装置和计算机之间传递。需要从计算机读取数据时，D−和D+的数据进入USB芯片后芯片会自行对数据进行解码，将解码后的数据存进FIFO缓冲区，供FPGA读出。当FPGA需要向计算机发送数据时，通过FD[0..7]向芯片发送数据，然后芯片会自动将接收到的数据编码，然后将编码后的数据通过D−和D+发送至计算机中。Mini USB接口的作用还有通过USB上的5 V供电为整个硬件装置提供电能。EEPROM电路用于储存每次复位或者上电后USB芯片读取的固件程序。  本文采用的FPGA芯片是Altera公司Cyclone II系列的EP2C5T144C8N芯片，其电路由FPGA供电电路、JTAG电路、FPGA配置电路、FPGA外部时钟电路组成，其原理图如图5所示。 FPGA供电电路使用3.3 V电源为各个电源引脚提供电压，1.2 V电源为FPGA内部的逻辑元件提供 图3. 加密器系统结构框图 图4. CY7C68013电路原理图 电能。本设计使用的JTAG接口为10针JTAG接口，JTAG电路使已经被综合好的FPGA逻辑下载至FPGA上进行在线调试工作。在FPGA配置电路中，本文使用EPCS4SI8N作为FPGA的配置芯片，每次复位或者掉电之后，FPGA内储存配置信息的RAM里的数据便会丢失，所以需要配置芯片电路用于储存配置FPGA的配置信息，通过JTAG接口将由sof文件转化而来的JIC (JTAG Indirect Configuration)文件下载到配置芯片中，通过这种模式下载可以简化电路的整体设计。外部时钟源是一片50 MHz的有源晶振，FPGA时钟电路为FPGA提供参考时钟信号，以确保状态机、密钥生成、按键输入去抖等功能顺利实现。  整个FPGA逻辑设计主要分3部分设计：控制模块设计、密码输入模块设计以及密钥生成模块设计。本文使用Verilog HDL作为硬件描述语言来进行FPGA编程。其工作流程图如图6所示。 控制模块用于执行上电后软件全局复位、接收从PC机上发来的指令(0x01)、根据指令做出相应的响应三个操作。软件全局复位是为了确保FPGA逻辑中所有模块都可以同时复位，不会产生不确定的结果。其操作是通过对50 MHz主时钟的脉冲进行计数，当计数值小于设定值时复位信号保持低电平，让全局保持复位状态；当计数值等于设定值时，复位信号拉高，所有模块进入工作状态。当FPGA收到的来自计算机的指令后，控制模块会先把密码输入模块打开，等待用户输入密码。当用户输入密码完毕后，控制模块会禁止密码输入功能，然后打开密钥生成模块。密钥发生模块会自动将生成的密钥发送到计算机中。 密码输入模块用于执行接收输入密码、将不同的键值编码成不同的编码值和按下确定键后将整个密钥送到PR (密钥生成模块)中三个操作。人按下按键的时候，按键可能会处在反复在按下和松开两个状态中来回切换的状态，密码输入模块先进行消抖操作，然后将接收到的按键进行编码操作，当密码全部输入完成后根据按下的是发送键还是清除键对密码进行发送或者清空处理。 密钥生成模块的作用是把按键输入模块输出的数据接收，根据此数据通过线性反馈移位寄存器产生伪随机数列，再将数据送往USB芯片的缓存区中。"
"把FPGA加密设备连接至计算机之后，计算机的上位机能识别加密器的USB设备并读取相关的VID，PID。等待计算机使用者选择需要加密的文件之后，由使用者在独立键盘上输入密码，按下确认键之后FPGA将会把密钥通过USB芯片发至计算机中，计算机则开始进行加密操作，加密完成后计算机自动删除源文件并显示整个加密所消耗的时间，保留加密之后的文件，对于不同大小的文件其验证结果如表1所示。从表1可以看出，本加密器能够稳定的加密并还原计算机文件，加密和解密速度近1 M/s。 图6. FPGA的工作流程图 Table 1 文件大小 加解密消耗时间 60 KB 62 ms 20 MB 20.79 s 50 MB 51.97 s 表1. 加密速度测试数据"
"本文提出了一种基于线性反馈移位寄存器的加密计算机文件的方案，从理论上证明了这种方案的可行性并且通过FPGA实现。该方案结合了软件和硬件加密优势，具有很高的安全性，可应用于网络文件存储和传输，有一定的应用价值。"
