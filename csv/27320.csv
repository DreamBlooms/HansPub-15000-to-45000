"数控机床在加工时，偶尔会发生一些不明原因的故障，导致机床无法正常加工。本文介绍了一种基于故障录像回放的数控机床故障诊断方法，该方法通过预先配置需要触发录像的报警，以及机床发生故障时需要录像的采样数据，从而在数控系统报警时记录下相应的数据。通过对录像数据的回放和分析，可以对机床的故障进行诊断。 关键词 :数控系统，故障录像，录像回放，报警类型，采样通道 Copyright © 2018 by authors and Hans Publishers Inc. This work is licensed under the Creative Commons Attribution International License (CC BY). http://creativecommons.org/licenses/by/4.0/"
"数控机床在加工时，偶尔会发生一些故障，使数控系统产生报警，从而导致机床停止运行，影响工件的加工，严重时可能会损坏工件和刀具。因此，数控机床应具有自诊断能力，能采取良好的故障显示，检测方法，及时发现并能很快确定故障部位和原因，令操作人员或维修人员及时排除故障，尽快恢复工作 [ 1 ] 。现有的机床故障诊断技术主要有： 1) 根据报警内容进行故障诊断 2) 根据控制系统LED灯或数码管的指示进行故障诊断 [ 2 ] 3) 根据PC状态或梯形图进行故障诊断 4) 根据机床参数进行故障诊断 5) 用诊断程序进行故障诊断，包括启动诊断、在线诊断或称后台诊断和离线诊断 [ 3 ] 数控机床发生故障的部件由机械和电气两大部分 [ 4 ] ，发生故障的原因多种多样，按故障性质有如下两大类： (1) 确定性故障，确定性故障是指控制系统主机中的硬件损坏或只要满足一定的条件，数控机床必然会发生的故障。 (2) 随机性故障，随机性故障是指数控机床在工作过程中偶然发生的故障，此类故障的发生原因较隐蔽，很难找出其规律性，故常称之为“软故障” [ 5 ] 。 对于上述的偶尔才会发生一次的随机性故障，仅仅通过故障时报警信息的内容或者其他诊断方法有时很难找到故障原因。因此，如果能够在系统报警时，将系统内部的相关数据记录下来，然后通过对录像数据进行分析，就能够对问题分析起到很大作用。本文使用的诊断方法优势在于随机性的故障诊断提供了便利，为问题原因的查找提供了一种新的途径。 故障录像并非对界面显示或操作进行录像，而是对加工过程中数控系统内部的实时采样数据进行录像，因此需要预先对触发录像的系统报警和采样通道进行配置。 当数控系统监测到预先配置的报警时，就会将报警前最后10 s的实时采样数据进行记录，并保存在文件中。然后在示波器中查看录像数据，对导致故障的原因进行分析和诊断，从而帮助快速解决问题。"
"使用本方法进行故障诊断的流程与其他的基于现象的诊断方法略有不同，需要在故障第一次发生时，根据报警内容配置录像数据，在该故障第二次发生时，回放录像文件，从而进行分析诊断。故障诊断流程如图1所示。 图1. 基于故障录像回放的故障诊断流程图 本方法主要应用于机床在加工过程中偶然发生的随机性故障，需要故障至少发生两次。故障初次发生时，由于缺少相关的数据，因此需要根据报警内容，加工所使用的机床部件，以及加工程序的内容对故障录像进行配置，以便录像可能与故障相关的数据。当故障再次发生时，便可根据录像的内容进行故障诊断和分析。若原因未能查明，则可重复2~4步骤，修改录像配置后重新加工，在故障再次发生时进行诊断。"
"机床发生故障时机床的报警种类繁多，另外，系统运行时产生内部数据的类型也非常多。因此，需要预先配置能够触发录像的系统报警，并配置该报警发生时需要录像的采样通道。由于系统资源的限制，最多能够配置16种报警类型，报警类型配置如图2所示，每种报警类型最多能够配置32个采样通道，采样通道配置如图3所示。不同报警类型配置的采样通道可以重复，所有采样通道的类型总数最多为32个，报警配置与采样通道配置关系如图4所示 [ 6 ] 。 常用的机床故障诊断数据类型如下表1所示。  为了能够记录系统报警前最后10 s的录像，数控系统需要在运行时实时对采样数据进行记录并保存在内存中，然后在需要录像的报警发生时将内存中的数据写入到文件中，录像处理过程如图5所示。系统运行时根据故障录像配置中的采样通道进行实时数据采样，重复配置的采样通道仅会采样一次。因系统资源限制，故障录像文件最多保存10个，如果超过10个文件，则会自动删除最旧的录像文件。故障录像文件以文本的方式存储，以便于数据分析和查看。  通过示波器对录像文件进行回放，能够查看系统报警前最后10 s内部数据的变化情况，从历史记录文件列表中选择录像文件的界面如图6所示，所选录像文件的回放图形如图7所示。对录像数据进行分析和诊断，能够帮助确认问题的原因，对录像数据进行各种操作的功能如图8所示。 图2. 触发录像的报警类型配置图 图3. 报警发生时录像的采样通道配置图 Table 1 类型名称 说明 指令位置 数控系统要求轴移动到的位置 实际位置 轴实际移动到的位置 指令速度 数控系统要求轴移动的速度 实际速度 轴实际移动的速度 负载电流 伺服驱动器控制电机的力矩电流 跟踪误差 轴的指令位置和实际位置的差 表1. 常用机床故障诊断数据类型 [ 7 ] 图4. 报警配置与采样通道配置关系图 图5. 采样数据实时录像说明图 图6. 选择要回放的故障录像文件 图7. 录像文件回放图 图8. 录像回放操作图"
"客户现场有一台使用机械手刀库的铣床，换刀时偶尔出现乱刀，导致换错刀，从而出现机床撞刀。为查明原因，在PLC中增加G3013.7刀位计时超时报警，并在故障录像中配置相关采样点位，如表2所示。 通过对换刀报警前的录像文件进行回放，发现原因是因为刀库正在预选刀过程中(刀库正转/反转过程中)，又接收到新的选刀指令，且导致选刀方向与之前刀库旋转方向相反时，会出现转错一个刀位现象(图9)。  客户现场有一台车床，在运行过程中发现X轴偶尔有异响。经分析认为需要先确定是指令异常，还是执行部件异常导致，在故障录像中配置相关采样点位，如表3所示。 通过对X轴异响前的指令加速度进行回放，发现指令X轴加速度达到12.88 m/s 2 (1.3 G加速度)，正常情况加工时加速度只有0.2 G左右，此处显示出现异常。然后将现场运行参数进行对比，发现因小线段参数设置错误导致异常(图10)。  如图11所示，系统运行时偶尔发生电机电流超过最大值报警。通过对负载电流数据进行录像，发现在加工时存在电流波动异常变大的情况，从而可以认为可能是电机故障(图11)。 Table 2 X0.5 刀库计数信号 R111 T指令刀号 R110 选刀刀套号 B189 当前刀套号 Y1.6 刀库正转 Y1.7 刀库反转 Y2.1 刀臂正转 R104.2 选刀开始 表2. 刀库诊断采样点位 Table 3 X轴实际位置 X轴指令位置 X轴指令速度 X轴实际速度 X轴指令加速度 X轴实际加速度 表3. 进给轴诊断采样点位 图9. 刀库故障诊断图 图10. X轴异响故障诊断图 图11. 电机过流报警诊断图"
"基于故障录像回放的数控机床故障诊断方法，为机床的故障诊断提供了一种新的思路。该方法简单实用，能够直接在数控系统上使用，无需借助外部设备或仪器。对于用户现场的故障调查有很大的帮助，能够快速对故障进行分析和诊断。另外，故障录像文件也可用客户端工具进行查看和分析，对于事后问题的查找和总结也很有帮助。"
