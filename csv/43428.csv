"本文针对多元正态总体均值向量偏移问题，将双抽样策略与可变样本容量控制图相结合，构建了双抽样可变样本容量T 2 控制图(DSVSS T 2 图)。根据过程的实际运行状态，构建了马尔可夫链转移概率矩阵。综合考虑过程正常和异常两种状态下的运行成本、误报警损失、抽样成本及维修费用，结合Lorenzen-Vance经济模型，提出DSVSS T 2 控制图的经济设计模型并分析了均值向量变化对决策变量的影响。"
"对于一个复杂产品，通常包含两个或两个以上质量特性，且质量特性之间存在相关关系，采用单变量控制图对每个质量特性分别进行监控往往并不适合 [ 1 ]。同时监控多个质量特性的控制方案能够准确反映生产状态，及时发现过程异常。Hotelling (1947)第一次提出多变量T 2 控制图，可以有效监测多质量特性的生产过程中发生的偏移 [ 2 ]。 传统T 2 控制图的参数(抽样间隔h，样本容量n，控制限k)都是确定的，这类控制图统称为静态FSR控制图。静态FSR控制图对过程较小的偏移不敏感，难以满足精益的生产环境需求。基于此，Reynolds (1988)首次提出可变抽样间隔(VSI)控制图 [ 3 ]。随后，变采样间隔(VSI)、变样本容量(VSS)、变样本量和采样间隔(VSSI)、变参数(VP)等四种自适应监控方案得到了广泛研究。Aparisi (2001)将自适应方案加入多变量控制图，研究了可变采样间隔(VSI) T 2 控制图 [ 4 ]。Faraz (2009)提出了可变样本容量(VSS) T 2 控制图 [ 5 ]。Mahadik and Shirke (2011)构建了联合可变样本容量和可变抽样区间(VSSI)的T 2 控制图 [ 6 ]。Saniga (2015)研究了变参数(VP) T 2 控制图，并将其性能与其他自适应T 2 图进行了比较 [ 7 ]。 Daudin (1992)将双抽样思想加入到控制图中，即通过两阶段抽样来监控过程，并与传统的控制图进行对比，发现其表现出更好的统计特性，能够减少抽样数量，提高监测效率 [ 8 ]。Carot (2002)将双抽样和可变样本间隔相结合，提出DSVSI X ¯ 控制图 [ 9 ]。PH Lee (2012)构建了DSVSI X ¯ 控制图的经济优化方法 [ 10 ]。Mehdi Katebi (2020)将双抽样和自适应方案同时应用于多元控制图，提出了DSVSSI T 2 控制图，将所提出的T 2 控制图与现有的标准T 2 控制图和其他自适应多变量T 2 图进行比较，发现DSVSSI T 2 图能更快地检测平均向量中小到中等的偏移 [ 10 ]。 自适应控制图可变抽样间隔在实际生产中往往难以操控，使用DSVSS控制图，可以降低质量检测人员的操控难度。在过程出现异常时，样本量的扩大能够获得更多的过程信息。万强(2020)基于计件数据，提出双抽样可变样本间隔np图的经济设计方法 [ 11 ]。本文将双抽样可变样本容量的思想应用于多质量特性计量数据的过程监控中，提出多质量特性的DSVSS T 2 控制图，构建了DSVSS T 2 控制图的经济优化模型。"
"2. 双抽样可变样本容量T 2 控制图 本文首先将多质量特性的抽样过程分为两个阶段，包含三种不同的检测水平。第一阶段采用两种检测水平，即小样本检测水平和正常样本检测水平；第二阶段采用大样本检测水平。两个阶段如图1所示。 图1. DSVSS T 2 控制图两个阶段 现假定生产过程有p个需要监控的质量特性， X 1 , X 2 , ⋯ , X p ，质量特性向量 X = ( X 1 , X 2 , ⋯ , X p ) 服从p维正态分布，均值向量 μ = ( μ 1 , μ 2 , ⋯ , μ p ) ，协方差为 Σ 。抽取容量为n的样本，计算每个样本的样本均值 Χ i ¯ = ( X 1 ¯ , X 2 ¯ , ⋯ , X p ¯ ) ，计算样本统计量T 2 ， T 2 = n ( X i ¯ − μ 0 ) ′ Σ ( X i ¯ − μ 0 ) ，其中 μ 0 为过程受控状态下的均值向量，若计算的T 2 超出控制限，则过程被标记为失控。 DSVSS T 2 控制图具有 ( n 1 , n 2 , n 3 ) ， ( ω 1 , ω 2 ) ， ( k 1 , k 2 ) ，h八个设计参数，其中n 1 ，n 2 分别表示一阶段抽样的小样本容量和正常样本容量，n 3 表示二阶段抽样的样本容量， n 1 < n 2 < n 3 ； ω 1 为扩大抽样样本容量的警告限，ω 2 为进入二阶段抽样的警告限， ω 1 < ω 2 ；k 1 ，k 2 分别表示两个阶段的控制限， k 2 < k 1 。h为固定抽样间隔。为方便描述，现记： I 1 = ( 0 , ω 1 ) ， I 2 = ( ω 1 , ω 2 ) ， I 3 = ( ω 2 , k 1 ) ， I 4 = ( k 1 , ∞ ) ， I 5 = ( 0 , k 2 ) ， I 6 = ( k 2 , ∞ ) 。操作步骤如下： 步骤一：抽取样本量为 n 1 的小样本，计算样本统计量 T 11 2 ，进入步骤二。 步骤二：1) 样本统计量 T 11 2 落在 I 1 ，则过程受控，返回步骤一。 2) 样本统计量 T 11 2 落在 I 2 ，则过程受控，进入步骤三。 3) 样本统计量 T 11 2 落在 I 3 ，则过程受控，进入步骤五。 4) 样本统计量 T 11 2 落在 I 4 ，则认为过程失控，应立即寻找失控原因。 步骤三：抽取样本量为 n 2 的大样本，计算样本统计量 T 12 2 ，进入步骤四。 步骤四：1) 样本统计量 T 12 2 落在 I 1 ，则过程受控，返回步骤一。 2) 样本统计量 T 12 2 落在 I 2 ，则过程受控，返回步骤三。 3) 样本统计量 T 12 2 落在 I 3 ，则过程受控，进入步骤五。 4) 样本统计量 T 12 2 落在 I 4 ，则认为过程失控，应立即寻找失控原因。 步骤五：进入二次抽样阶段，立即抽取样本量为 n 3 的样本，计算样本统计量 T 2 2 ，进入步骤六。 步骤六：1) 样本统计量 T 2 2 落在 I 5 ，则过程受控，返回步骤三。 2) 样本统计量 T 2 2 落在 I 6 ，则认为过程失控，应立即寻找失控原因。 其中 T 11 2 = n 1 ( Χ 1 ¯ − μ 0 ) ′ Σ ( Χ 1 ¯ − μ 0 ) ， X 1 ¯ = ∑ i = 1 n 1 X i ； T 12 2 = n 2 ( X 2 ¯ − μ 0 ) ′ Σ ( X 2 ¯ − μ 0 ) ， X 2 ¯ = ∑ i = 1 n 2 X i ； T 2 2 = n 3 ( X 3 ¯ − μ 0 ) ′ Σ ( X 2 ¯ − μ 0 ) ， X 3 ¯ = ∑ i = 1 n 3 X i 。"
"马尔可夫链作为一种随机过程，在控制图的相关领域中，常用来预测控制图各个状态的转移概率，利用状态转移矩阵去计算控制图的统计指标，从而对控制图进行统计和经济优化。基于本文的双抽样可变样本容量T 2 控制图，为简单起见，假设 μ 0 和 Σ 已知，则T 2 服从自由度为p的中心卡方分布。若过程出现异常，均值发生偏移，T 2 服从非中心参数为 η 的非中心卡方分布。现将第一阶段的样本统计量 T 11 2 和 T 12 2 统称为 T 1 2 ，则可将过程分为以下四种状态： 状态一： T 1 2 ∈ I 1 状态二： T 1 2 ∈ I 2 状态三： T 1 2 ∈ I 3 ∩ T 2 2 ∈ I 5 状态四： T 1 2 ∈ I 4 ， T 1 2 ∈ I 3 ∩ T 2 2 ∈ I 6 其中状态四为吸收态，马尔可夫链转移矩阵P如下： P = ( P 11 P 12 P 13 P 14 P 21 P 22 P 23 P 24 P 31 P 32 P 33 P 34 0 0 0 1 ) 其中 P i j 为状态i转移到状态j的概率，因此 P 11 = P ( T 1 2 ∈ I 1 | n 1 ; h ) = P ( T 1 2 ≤ w 1 ) = F ( w 1 , p , η = n 1 δ 2 ) P 1 2 = P ( T 1 2 ∈ I 2 | n 1 ; h ) = P ( w 1 ≤ T 1 2 ≤ w 2 ) = F ( w 2 , p , η = n 1 δ 2 ) − F ( w 1 , p , η = n 1 δ 2 ) P 1 3 = P ( T 1 2 ∈ I 3 & T 2 2 ∈ I 5 | n 1 ; h ) = P ( w 2 ≤ T 1 2 ≤ k 1 ) × P ( T 2 2 ≤ k 2 ) = [ F ( k 1 , p , η = n 1 δ 2 ) − F ( w 2 , p , η = n 1 δ 2 ) ] × F ( k 2 , p , η = n 3 δ 2 ) P 14 = 1 − ∑ i = 1 3 P 1 i P 2 1 = P 3 1 = P ( T 1 2 ∈ I 1 | n 2 ; h ) = P ( T 1 2 ≤ w 1 ) = F ( w 1 , p , η = n 2 δ 2 ) P 22 = P 32 = P ( T 1 2 ∈ I 2 | n 2 ; h ) = P ( w 1 ≤ T 1 2 ≤ w 2 ) = F ( w 2 , p , η = n 2 δ 2 ) − F ( w 1 , p , η = n 2 δ 2 ) P 23 = P 33 = P ( T 1 2 ∈ I 3 & T 2 2 ∈ I 5 | n 2 ; h ) = P ( w 2 ≤ T 1 2 ≤ k 1 ) × P ( T 2 2 ≤ k 2 ) = [ F ( k 1 , p , η = n 2 δ 2 ) − F ( w 2 , p , η = n 2 δ 2 ) ] × F ( k 2 , p , η = n 3 δ 2 ) P 2 4 = P 3 4 = 1 − ∑ i = 1 3 P 2 i = 1 − ∑ i = 1 3 P 3 i 其中 F ( x , p , η ) 为非中心卡方分布的累计概率分布函数，p为自由度，即需要监控的质量特征的个数， η 为非中心参数，计算公式为 η = n δ 2 ，其中 δ 为多变量均值向量漂移量。"
"统计指标常用来测评控制图的性能表现。主要有受控状态下过程平均运行链长 A R L 0 ,平均周期时间 A T S 0 以及一个控制周期的平均抽样数 A N I 0 和失控状态下平均周期时间 A T S 1 以及一个控制周期的平均抽样数 A N I 1 ，计算公式分别如下： A R L 0 = b ′ ( I − Q 0 ) − 1 l A T S 0 = b ′ ( I − Q 0 ) − 1 h 0 A N I 0 = b ′ ( I − Q 0 ) − 1 N A T S 1 = b ′ ( I − Q 1 ) − 1 h 0 A N I 1 = b ′ ( I − Q 1 ) − 1 N 其中 b ′ = ( b 1 , b 2 , b 3 ) 为初始状态概率矩阵，为避免在过程开始就出现异常，一般设 b ′ = ( 0 , 1 , 0 ) ；I为3 × 3单位矩阵； Q 0 为多变量均值不发生漂移时 ( δ = 0 ) 转移概率矩阵P删除吸收态后的3 × 3矩阵， Q 1 为多变量均值发生漂移时 ( δ > 0 ) 转移概率矩阵P删除吸收态后的3 × 3矩阵； l ′ = ( 1 , 1 , 1 ) ； h 为取样间隔，由于该控制图采样间隔固定，则取样间隔向量 h ′ 0 = ( h , h , h ) ；N为取样个数向量,则 N ′ = ( n 1 , n 2 , n 3 ) 。"
"为方便该控制图经济成本的计算，现假设如下： · 控制图从受控状态开始运行； · 控制图受控时间服从均值为 1/ λ 的指数分布； · 控制图发生警报后，便停止运行，查找异常原因并完全维修； · 二次抽样间隔为0。 本文采用Lorenzen-Vance经济模型 [ 11 ]，首先计算控制图的单个过程周期时间 E ( T ) 。其中包括受控时间x，其服从均值为 1/ λ 的指数分布；失控时间AATS，由 A T S 1 减去过程漂移与之前最后一次抽样之间 的时间期望值 τ ，因为受控时间x服从均值为 1/ λ 的指数分布， τ = E ( x | 0 < x < h ) = 1 − e − λ h ( λ h + 1 ) λ ( 1 − e − λ h ) ， A A T S = A T S 1 − τ ；查找过程异常并完全维修的时间 ε ，是一个常量，则有 E ( T ) = 1 λ + A A T S + ε 将控制图从开始运行至报警记为一个运行周期，则控制图在一个运行周期内的成本，主要由五个部分组成： 1) 受控状态下的过程成本 记受控状态下单位时间成本为 c 1 ，因为受控时间服从均值为 1/ λ 的指数分布，则受控状态下的过程成本为 c 1 / λ 。 2) 失控状态下的过程成本 记失控状态下的单位时间成本为 c 2 ，失控时间为AATS，则失控状态下的过程成本为 c 2 × A A T S 。 3) 误报警成本 记寻找一个误报警的成本为 c 3 ，受控状态下的期望抽样次数为s，受控下的平均抽样次数等于过程开始到过程均值发生偏移前最后一次抽样的时间长度除以平均抽样间隔，由于抽样间隔固定，则 s = 1 / λ − τ E ( h ) = 1 / λ − τ h ，误报警的概率为 1 / A R L 0 ，则误报警成本为 c 3 s A R L 0 。 4) 抽样和检测成本 记一次抽样检测的固定成本为 c 4 ，则单个过程周期抽样检测的固定成本为 c 4 ( s + A A T S / h ) ；单个样品检测成本为 c 5 ，受控状态下，平均周期时间和平均抽样数分别为 A T S 0 和 A N I 0 ，则受控状态下的平均 单位时间抽样数为 A N I 0 A T S 0 ，当受控时间服从均值为 1/ λ 的指数分布时，受控状态下的样本抽样与检测成本为 c 5 × 1 / λ × A N I 0 A T S 0 ；失控状态下，平均周期时间和平均抽样数分别为 A T S 1 和 A N I 1 ，则失控状态下的平均单位时间抽样数为 A N I 1 A T S 1 ，失控时间为AATS，失控状态下的样本抽样与检测成本为 c 5 × A A T S × A N I 1 A T S 1 ；则抽样和检测的总成本为 c 4 ( s + A A T S h ) + c 5 ( 1 / λ × A N I 0 A T S 0 + A A T S × A N I 1 A T S 1 ) 。 5) 查找异常原因并完全维修的成本 记寻找异常原因并完全维修所需成本为 c 6 ，为一个常量。 综上，一个运行周期内的总成本 E ( C ) 为： E ( C ) = c 1 λ + c 2 × A A T S + c 3 s A R L 0 + c 4 ( s + A A T S h ) + c 5 ( 1 / λ × A N I 0 A T S 0 + A A T S × A N I 1 A T S 1 ) + c 6 则单位时间的运行成本函数 E ( A ) = E ( C ) E ( T ) ，该控制图的经济优化模型的目标函数为： min               E ( A ) s . t .                 0 < n 1 < n 2 < n 3 ≤ n max n 1 , n 2 , n 3 ∈ N + 0 < k 2 < k 1 0 < w l < w n < k 1 优化目标是确定控制图参数 ( w 1 , w 2 , k 1 , k 2 , n 1 , n 2 , n 3 , h ) 使得该控制图单位时间的运行成本最小。"
"假定某生产过程需要同时监控的质量特性有3个，即 p = 3 。系统异常运行时仅导致均值发生偏移，多变量均值向量偏移量 δ = 0.9 。系统受控状态下的运行时间服从均值为 1 / λ = 100 的指数分布。本文的模型参数初始值参照Lorenzen和Vance [ 12 ] 在其文献中的设定值，即受控状态下单位时间成本 c 1 = 114.24 ，失控状态下的单位时间成本 c 2 = 949.2 ，寻找一个误报警的成本 c 3 = 977.4 ，一次抽样检测的固定成本 c 4 = 2 ，单个样品成本 c 5 = 4.22 ，寻找异常原因并完全维修所需成本 c 6 = 1086 ，查找过程异常并完全维 修的时间 ε = 5 / 60 。将上述数据代入运行成本函数 E ( A ) = E ( C ) E ( T ) ，利用MATLAB遗传算法工具箱，得到8个决策变量 ( n 1 , n 2 , n 3 , h , w 1 , w 2 , k 1 , k 2 ) 和单位时间运行成本 E ( A ) 的最优解如表1所示。 Table 1 n 1 n 2 n 3 h w 1 w 2 k 1 k 2 E ( A ) 2 5 22 1.929 2.453 4.304 23.386 10.188 163.266 表1. 最优决策变量及目标函数值"
"为了研究均值向量漂移对决策变量及目标函数的影响，在上节基础之上进行灵敏度分析，如表2所示。 Table 2 δ n 1 n 2 n 3 h w 1 w 2 k 1 k 2 E ( A ) 0.5 2 5 29 4.518 0.892 0.919 18.872 6.698 199.260 1 2 5 19 1.800 3.016 4.653 22.376 10.597 158.253 1.5 2 5 12 1.632 5.579 6.279 22.925 12.605 144.245 2 2 5 8 1.607 8.217 8.286 23.623 13.607 139.608 表2. 均值向量漂移量δ对决策变量的影响 由表2可知随着漂移量δ的增大，第一阶段抽样的样本容量n 1 ，n 2 不变，第二阶段抽样的样本容量n 3 减小，抽样间隔h减小，警戒限w 1 ，w 2 增加，控制限k 1 ，k 2 增加，单位时间运行成本 E ( A ) 减小，说明对于DSVSS T 2 控制图而言，当生产过程均值向量发生微小偏移时单位时间成本较高，这是因为尽管自适应控制图对微小偏移的反应足够及时，能有效避免过程异常时的生产损失，但当微小偏移发生时，需要抽取更多的样本去获得生产过程的信息，抽样成本将会增加，单位时间成本将增加。"
"本文提出的DSVSS T 2 控制图可以同时监控多个关键质量特性，将双抽样(DS)策略和可变样本容量(VSS)联合，提高了控制图在检测平均向量中位移的灵敏度且易于操控。利用马尔可夫链方法导出控制图统计指标的计算公式并构建单位时间成本模型，提出双抽样可变样本容量(DSVSS) T 2 控制图的优化设计方法。灵敏度分析表明随着均值向量漂移量递增，一阶段抽样样本量不变，二阶段抽样样本量递减，控制图的抽样间隔递减，警戒限和控制限递增，单位时间成本递减。"
