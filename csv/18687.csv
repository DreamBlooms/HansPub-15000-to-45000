"为满足导向钻井中不用起钻变更钻具组合，就能快速钻出高质量的井眼轨迹的客观要求，提出了一种由单片机控制调频调压的供电模块设计方案。该方案与现阶段钻井导向系统中常用的由可调元器件构成的三端稳压电源所实现的供电模块、以及利用IGBT绝缘栅双极型晶体管的双向导电功能实现的供电模块不同在于，它采用单片机AT 89C 5控制调频调压主电路，结合桥式逆变电路，通过IR2110驱动实现调频，并设计过电流(压)保护。测试结果表明，依据该方案所实现的供电模块设计原理简单、控制可靠、成本低廉，能满足钻井导向系统在各类工况下供电模块应用要求。 关键词 :钻井导向系统，供电模块，单片机，脉冲宽度调制信号"
"定向钻井技术是石油钻探领域的核心技术，钻井导向系统的研发是其重要的保障。钻井导向指由井下随钻测量工具测量的几何参数：井斜、方位和工具面的数值传给控制系统，由控制系统及时纠正和控制井眼轨迹。这其中一个不可回避的重要技术问题是必须实现对钻井导向系统及其他附属设备的供电，且不用起钻变更钻具组合，进而快速钻出高质量的井眼轨迹。因此，针对钻井导向设备这类供电模块的设计与开发有着重要意义。 目前，国内外有关这类供电模块的设计及制造大体有两种方式，一种是采用由可调元器件构成的三端稳压电源所实现的供电模块，还有一种方式是利用IGBT绝缘栅双极型晶体管的双向导电功能实现的供电模块。用这两种方式制成的供电模块尽管在早期的钻采设备中也得到应用，但由于它们都不能被冠以“智能控制”，且稳定性和可靠性均有待提高。 电力电子技术的发展使得供电模块的控制器件以单片机或DSP等进行控制替代现有的以可调元器件或IGBT进行控制成为可能 [ 1 ] 。另外，若在供电模块中能够引入直接由直流驱动的逆变电路，将有效降低供电模块的成本和应用门槛。运用RRC变换器进行调压模块设计并配合单片机的使用，将使供电模块应用范围大为拓展 [ 2 ] 。因此，笔者所提出的这种采用单片机控制的可实现调频调压的供电模块在现代石油钻采和各类导向系统中将会体现重要实际应用价值。"
"完整的钻井导向系统由高效能钻头、导向动力钻具和供电模块组成一体，并辅之计算机软件所组成，钻头与钻具需要在地面控制人员的指令控制下适时变更定向和开转盘两种工况，连续完成定向造斜、增斜、稳斜、降斜及扭方位操作，而不用起钻变更钻具组合。尽管井下测控系统连续工作的电能通常是由钻杆内的高压泥浆带动涡轮发电机发电提供，并通过炭刷–滑环组成的集流环实现电能的传输。但系统完成钻井导向所需的这些动作则要求能提供电压与频率连续可调且被有效控制的供电模块驱动。为满足此要求，供电模块的设计总体框图如图1所示。 其主要工作过程为：由高压泥浆带动涡轮发电机发电所提供的单相交流220 V电压输入高频变压器，高频变压器的输出信号输入调频调压主电路；主电路由桥式电路、斩波电路、整流滤波电路、桥式逆变电路四部分组成，主电路输出所需的频率与幅度电压信号；控制电路部分由按键电路将供电模块所需产生的信号参数如电压、频率等输入到控制单片机，单片机输出相应电压和频率的脉冲宽度调制信号；脉冲宽度调制信号反馈输入到高频变压器和主电路中的桥式逆变电路，从而实现全模块输出电压可调和输出频率可调；若由于系统工作环境或工况要求使得主电路实际电压(电流)大于设计参数设定电压(电流)时，单片机将会接收到由保护电路输入的电平信号使之中断，以控制与保护模块。"
"调压电路设计如图2所示，主要工作原理为：由单片机对MOS管进行电平控制，以单片机键盘所设定的输出信号参数所产生的脉冲宽度调制信号实施对MOS管G极(栅极)和D极(漏极)的控制，S极(源极)悬空，具体控制方式为：脉冲宽度调制信号高电平时在MOS管G极开通，开通时导通电压等于0。反之，脉冲宽度调制信号低电平时在MOS管G极关闭，关断时电流等于0，只需在高频变压器输出端和调压电路输出端均加入合适的较大容量整流电容C1和C2使电压平稳输出，即可保证输出电压的稳定 [ 3 ] 。 图2中关于变压器T 1 磁芯的选取须采用较大磁通密度的构造，比如，若T 1 匝数比取1:1，设变压器初级次级绕组匝数为N 1 = N 2 = 60匝，变压器次级电流峰值I 1P = 0.85A，初级电感L 1 = 0.78 mH，查变压器技术手册知须选取耐压200V电压的EER42磁芯，这样留有一定的余量，以防涡轮发电机发电提供的单相交流出现故障，烧坏变压器；图2中关于MOS管的选取原则是，根据输入电压 ≤ 200 V，开关 图1. 供电模块设计整体框图 图2. 调压电路 频率 ≤ 100 kHz，则可选择MOS管型号为IRF640 [ 3 ] (IRF640参数为漏极源极电压VDS = 220 V，MOS管上升时间t R = 19 ns，下降时间t f = 5.5 ns，漏极电流I D = 18 A)。  调压模块控制的核心部件采用 89C 51单片机，由 89C 51的定时器中断控制调压电路中MOS管的导通和关断时间。逆变器通过单片机P2.0、P2.1口输出方波，单片机P2.0、P2.1口输出经过与非门送入驱动芯片IR2110以实现对MOS管S极的通断控制，从而产生符合设定频率的方波电压。同时根据导向系统不同工况所设调压参数通过按键键盘输入到单片机，单片机通过相应的程序设定定时器的初始值，内部产生符合要求的脉冲宽度调制信号来改变调压电路输出电压 [ 4 ] 。   为解决钻井过程中高温、高压、强机械冲击及泥浆的存在等恶劣工作环境状况下导向系统可靠性问题，作为调频调压电源模块其主要变换应包括两个方面：首先应将涡轮发电机所提供的单相交流220 V经高频变压器的输出交流信号变为直流，这通常由调压部分来完成。然后将所得到的直流用调频电路将其转换为设定频率的交流信号，并通过单片机 89C 51的外部中断INT1、INT0，在中断程序中通过查表修改相应定时器的初始值，使频率在一定范围内可调。外部中断子程序实现按键触发，改变输出触发脉冲频率，实现逆变电路电压频率可调功能。通过单片机调频按键改变定时器设定初值，从而实现模块调频 [ 4 ] 。 调频电路设计采用桥式逆变式 [ 5 ] 如图3所示，图中电容C的选取不需过多考虑，只要满足实际应用压差即可。桥式逆变电路中的开关器件对输入输出压差要求既不能过大也不能过小以及电流不能过大等应用要求，因为如果压差过大，则转换效率急速降低且逆变器件易击穿损坏；反之如果压差过小，则调频效率降低；而如果输出电流过大必将导致器件自身的高温保护或热击穿。考虑到这些因素，调频电路中可选用IPP26CN10N作为开关元件V 1 ~V 4 (查手册知：IPP26CN10N额定工作电压为100 V，电流为35 A，开通和关断时间分别为14 ns和16 ns)，能够满足设计需要。  调压模块控制的核心部件也采用 89C 51单片机，其控制原理及过程与调压模块控制大体相似，只是所连接的单片机端口不同，调频控制所连接的单片机的外部中断端口为INT1、INT0，在中断程序中通过查表修改相应定时器的初始值，从而实现频率上调或下调 [ 4 ] 。 图3. 调频主电路  保护电路如图4所示，其工作原理是：若由于导向系统工作环境或工况要求使得主电路实际电压(电流)大于设计参数设定电压(电流)时，高频变压器输出的交流信号经互感器TR，按TRAN-2P2S型互感器TR比例关系变换成与模块所需要的信号同级的标准二次电压信号；再经整流桥BR将其转化为直流电压信号；为提高保护可靠性，还需将此信号经旁路滤波电容C，输出稳定的直流信号；该稳定的直流信号将与由运放构成的比较器里所设定的额定值U 1 :A相比较，当实际电压小于或者等于额定电压时，比较器输出低电平0，信号经过逻辑与门和非门不会使单片机内部程序发生中断，模块电路正常运行，而当实际电压大于额定电压时，比较器输出高电平1，从而使单片机响应中断，发出保护信号，实现电路的继电保护 [ 6 ] 。  考虑到供电模块工作时，需要设置相关的工作参数，且模块运行状态需得到直观显示，故还需设置显示模块。可以选取LED作显示器件，LED的引脚可直接与单片机的IO端口连接，为全系统提供显示。  因为单片机产生的PWM信号较弱，无法有效驱动全模块中的功率器件MOS管，同时鉴于模块的稳定性、单片机的保护等因素的考量，必须设置相应的驱动。图5所示是常用的驱动电路，其基本原理为，由干电池和单片机产生的PWM信号驱动MOS管，选取合适的电阻(如R 1 = R 2 = 1 kΩ)，最大限度降低驱动电路自身的功耗。PWM信号送到三极管T(8550)的基极，控制T的集电极和发射极之间的开通与关断，以此控制MOS管漏极和源极的导通与关断，实现全模块驱动。"
"供电模块软件设计分为调频调压模块的软件设计和保护模块的软件设计。  调压控制芯片根据输入的调压要求，通过中断加查询的方式确定输入值，进行查表获得相应的赋值，以此调节PWM的占空比，并控制相应的继电器动作，从而实现调压。 系统中设置按键的输入、显示、报警等功能，对按键的处理采用中断加查询的控制方式，主要由外部中断INT0和P0、P3口完成。同时，LED采用扫描方式，进行电压输出值的扫描显示，主要由P2、P1完成，当程序出现故障时通过外部端口指示灯和电压显示不正常来报警。电压调整输出的PWM信号由P2.0口输出。定时器T0主要完成按键中的2S定时查询，定时器T1主要完成P2.0的定时中断输出， 图4. 保护电路模块 图5. 驱动电路 主程序主要完成初始值的设置，包括TMOD、TCON、IP、IE等单片机内各程序以及端口输出的初始状态和工作方式。 而调频模块的软件设计主要分为外部中断调频处理，产生频率控制信号和T0过压过流保护处理。由于电路要实现可调频功能，因此将程序编写分为各个模块，主程序对系统进行初始化。主程序主要实现初值设置、循环显示功能和输出触发脉冲功能，体现了对单片机内部触发和外电路显示的控制思路。调压系统外部中断控制子程序实现按键触发改变输出触发脉冲频率，实现逆变电路电压频率可调功能。通过改变R 1 、R 2 的值，改变定时器设定初值，调整触发频率。图6所示为调频调压模块的主程序流程图。  保护模块软件设计流程图如图7所示，保护中断子程序对逆变电路中高压、过流起到中断响应作用。当外部电压或电流过高时通过对单片机的T1口输入电平实现对逆变电路的中断。同时P0.0端口输出高电平，使相应继电器断开，对主电路进行保护。"
"按以上方案，笔者实际制作出一款调频调压供电模块，该模块能够稳定地输出电压在5~36 V范围内连续可调、输出频率在1~15 kHz范围内连续可调的正弦交流信号，经笔者在实验室的调试(调试过程另文叙述)，获得了较理想的输出正弦波。结果表明，模块输出幅度频率可在设定范围自由准确调节，输出信号稳定平整，输出质量高。 由于该设计方案中调压模块和调频模块电路彼此独立，实现了全模块输出电压与频率的独立调节，所设保护电路能有效保护其安全可靠。该供电模块不仅保留了传统的调频调压电源的基本性能，且模块 图6. 调压、调频控制主程序流程图 图7. 保护模块程序图 功耗小，工作稳定，可靠性高。若能采用较好的制作工艺，依据钻井导向设备的具体构造与供电的环境与场合使之嵌入并固化，必能很好地满足钻井导向系统中各类工况下的供电实际需求。"
